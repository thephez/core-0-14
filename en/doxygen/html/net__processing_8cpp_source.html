<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.14"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Dash Core: src/net_processing.cpp Source File</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="doxygen_stylesheetextra.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
		<div class="head"><div>
		<!--<a id="menumobile" class="menumobile" onclick="mobileMenuShow(event);" ontouchstart="mobileMenuShow(event);"></a>-->
		<a class="logo" href="/en/"><img src="logotop.png" alt="Dash"></img></a>
		<ul id="menusimple" class="menusimple menumain" onclick="mobileMenuHover(event);" ontouchstart="mobileMenuHover(event);">
		  <li><a href="/en/dash-for-developers">Developers</a></li>
		  <li><a>Documentation</a>
			<ul>
			  <li><a href="/en/developer-guide">Guide</a></li>
			  <li><a href="/en/developer-reference">Reference</a></li>
			  <li><a href="/en/developer-examples">Examples</a></li>
			  <li><a href="/en/developer-glossary">Glossary</a></li>
			</ul>
		  </li>
		  <li><a>Resources</a>
			<ul>
			  <li><a rel="noopener noreferrer" target="_blank" href="https://www.dash.org/community/">Community</a></li>
			  <li><a href="/en/vocabulary">Vocabulary</a></li>
			</ul>
		  </li>
		</ul>
		</div></div>
		<div class="body">
		<div class="breadcrumbs"></div>
		<div id="content" class="content">
		  <!-- <link rel="stylesheet" href="/css/jquery-ui.min.css"> -->
		  <h1>Dash Core Source Documentation (0.13.1.0)</h1>
		  <p class="summary">Find detailed information regarding the Dash Core source code.</p>
		<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<!--
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
			 <tbody>
			 <tr style="height: 56px;">
			  <td id="projectlogo"><img alt="Logo" src="logotop.png"/></td>
			  <td id="projectalign" style="padding-left: 0.5em;">
			   <div id="projectname">Dash Core
			   &#160;<span id="projectnumber">0.13.1.0</span>
			   </div>
			   <div id="projectbrief">P2P Digital Currency</div>
			  </td>
			 </tr>
			 </tbody>
			</table>
		</div>
		-->
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('net__processing_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">net_processing.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="net__processing_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2009-2010 Satoshi Nakamoto</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Copyright (c) 2009-2016 The Bitcoin Core developers</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Distributed under the MIT software license, see the accompanying</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="net__processing_8h.html">net_processing.h</a>&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="alert_8h.html">alert.h</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="addrman_8h.html">addrman.h</a>&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="arith__uint256_8h.html">arith_uint256.h</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="blockencodings_8h.html">blockencodings.h</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="chainparams_8h.html">chainparams.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="consensus_2validation_8h.html">consensus/validation.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hash_8h.html">hash.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="init_8h.html">init.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="consensus_2validation_8h.html">validation.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="merkleblock_8h.html">merkleblock.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="net_8h.html">net.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="netmessagemaker_8h.html">netmessagemaker.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="netbase_8h.html">netbase.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fees_8h.html">policy/fees.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="policy_8h.html">policy/policy.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="block_8h.html">primitives/block.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="transaction_8h.html">primitives/transaction.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="random_8h.html">random.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tinyformat_8h.html">tinyformat.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="txmempool_8h.html">txmempool.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ui__interface_8h.html">ui_interface.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="utilmoneystr_8h.html">utilmoneystr.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="utilstrencodings_8h.html">utilstrencodings.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="validationinterface_8h.html">validationinterface.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="spork_8h.html">spork.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="governance_8h.html">governance.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="instantx_8h.html">instantx.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="masternode-payments_8h.html">masternode-payments.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="masternode-sync_8h.html">masternode-sync.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="masternodeman_8h.html">masternodeman.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#ifdef ENABLE_WALLET</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="privatesend-client_8h.html">privatesend-client.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif // ENABLE_WALLET</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="privatesend-server_8h.html">privatesend-server.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="deterministicmns_8h.html">evo/deterministicmns.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="simplifiedmns_8h.html">evo/simplifiedmns.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="quorums__commitment_8h.html">llmq/quorums_commitment.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="quorums__dummydkg_8h.html">llmq/quorums_dummydkg.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="quorums__blockprocessor_8h.html">llmq/quorums_blockprocessor.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;boost/thread.hpp&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#if defined(NDEBUG)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor"># error &quot;Dash Core cannot be compiled without assertions.&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;std::atomic&lt;int64_t&gt; <a class="code" href="net__processing_8cpp.html#a147efbcf1410c50c56547340f1fe1ebd">nTimeBestReceived</a>(0); <span class="comment">// Used only to inform the wallet of when we last received a block</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="struct_iterator_comparator.html">   59</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_iterator_comparator.html">IteratorComparator</a></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;{</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> I&gt;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="struct_iterator_comparator.html#a3117b367674b069df7676416050e10c7">   62</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="struct_iterator_comparator.html#a3117b367674b069df7676416050e10c7">operator()</a>(<span class="keyword">const</span> I&amp; a, <span class="keyword">const</span> I&amp; b)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">return</span> &amp;(*a) &lt; &amp;(*b);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;};</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="struct_c_orphan_tx.html">   68</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_c_orphan_tx.html">COrphanTx</a> {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// When modifying, adapt the copy of this definition in tests/DoS_tests.</span></div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="struct_c_orphan_tx.html#abe878e681f993451d5433d3e12261cb4">   70</a></span>&#160;    <a class="code" href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> <a class="code" href="struct_c_orphan_tx.html#abe878e681f993451d5433d3e12261cb4">tx</a>;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="struct_c_orphan_tx.html#a06fa313a474fd4e6d0ed20bda7cbe69c">   71</a></span>&#160;    <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> <a class="code" href="struct_c_orphan_tx.html#a06fa313a474fd4e6d0ed20bda7cbe69c">fromPeer</a>;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="struct_c_orphan_tx.html#a09fd824b19c2e8433b44145b7b64f010">   72</a></span>&#160;    int64_t <a class="code" href="struct_c_orphan_tx.html#a09fd824b19c2e8433b44145b7b64f010">nTimeExpire</a>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;};</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;std::map&lt;uint256, COrphanTx&gt; mapOrphanTransactions <a class="code" href="net__processing_8cpp.html#aa3a81f44cff26dfccfc39a8ce01c1ae3">GUARDED_BY</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;std::map&lt;COutPoint, std::set&lt;std::map&lt;uint256, COrphanTx&gt;::iterator, <a class="code" href="struct_iterator_comparator.html">IteratorComparator</a>&gt;&gt; mapOrphanTransactionsByPrev <a class="code" href="net__processing_8cpp.html#aa3a81f44cff26dfccfc39a8ce01c1ae3">GUARDED_BY</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a5f18fbc4522a5c49d0c8ebbd15ecf2c0">EraseOrphansFor</a>(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer) <a class="code" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">   78</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">vExtraTxnForCompactIt</a> = 0;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> std::vector&lt;std::pair&lt;uint256, CTransactionRef&gt;&gt; vExtraTxnForCompact <a class="code" href="net__processing_8cpp.html#aa3a81f44cff26dfccfc39a8ce01c1ae3">GUARDED_BY</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#ae091b569e78315bb17c4b0c178aeb3b0">   81</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint64_t <a class="code" href="net__processing_8cpp.html#ae091b569e78315bb17c4b0c178aeb3b0">RANDOMIZER_ID_ADDRESS_RELAY</a> = 0x3cac0035b5866b90ULL; <span class="comment">// SHA256(&quot;main address relay&quot;)[0:8]</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// Internal stuff</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">int</span> nSyncStarted = 0;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    std::map&lt;uint256, std::pair&lt;NodeId, bool&gt;&gt; mapBlockSource;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    std::unique_ptr&lt;CRollingBloomFilter&gt; recentRejects;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classuint256.html">uint256</a> hashRecentRejectsChainTip;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">struct </span>QueuedBlock {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="classuint256.html">uint256</a> hash;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex;                               </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordtype">bool</span> fValidatedHeaders;                                  </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        std::unique_ptr&lt;PartiallyDownloadedBlock&gt; partialBlock;  </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    };</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    std::map&lt;uint256, std::pair&lt;NodeId, std::list&lt;QueuedBlock&gt;::iterator&gt; &gt; mapBlocksInFlight;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    std::list&lt;NodeId&gt; lNodesAnnouncingHeaderAndIDs;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">int</span> nPreferredDownload = 0;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">int</span> nPeersWithValidatedDownloads = 0;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keyword">typedef</span> std::map&lt;uint256, CTransactionRef&gt; MapRelay;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    MapRelay mapRelay;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    std::deque&lt;std::pair&lt;int64_t, MapRelay::iterator&gt;&gt; vRelayExpiration;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;} <span class="comment">// anon namespace</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">// Registration of network node signals.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keyword">struct </span>CBlockReject {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> chRejectCode;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    std::string strRejectReason;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classuint256.html">uint256</a> hashBlock;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;};</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">struct </span>CNodeState {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_service.html">CService</a> address;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">bool</span> fCurrentlyConnected;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">int</span> nMisbehavior;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">bool</span> fShouldBan;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">const</span> std::string <a class="code" href="rest_8cpp.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    std::vector&lt;CBlockReject&gt; rejects;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexBestKnownBlock;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="classuint256.html">uint256</a> hashLastUnknownBlock;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexLastCommonBlock;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexBestHeaderSent;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">int</span> nUnconnectingHeaders;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">bool</span> fSyncStarted;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    int64_t nHeadersSyncTimeout;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    int64_t nStallingSince;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    std::list&lt;QueuedBlock&gt; vBlocksInFlight;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    int64_t nDownloadingSince;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">int</span> nBlocksInFlight;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordtype">int</span> nBlocksInFlightValidHeaders;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">bool</span> fPreferredDownload;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">bool</span> fPreferHeaders;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">bool</span> fPreferHeaderAndIDs;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordtype">bool</span> fProvidesHeaderAndIDs;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">bool</span> fSupportsDesiredCmpctVersion;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    CNodeState(<a class="code" href="class_c_address.html">CAddress</a> addrIn, std::string addrNameIn) : address(addrIn), <a class="code" href="rest_8cpp.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>(addrNameIn) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        fCurrentlyConnected = <span class="keyword">false</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        nMisbehavior = 0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        fShouldBan = <span class="keyword">false</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        pindexBestKnownBlock = NULL;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        hashLastUnknownBlock.<a class="code" href="classbase__blob.html#aa340be5328d911272eded433d03f30a3">SetNull</a>();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        pindexLastCommonBlock = NULL;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        pindexBestHeaderSent = NULL;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        nUnconnectingHeaders = 0;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        fSyncStarted = <span class="keyword">false</span>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        nHeadersSyncTimeout = 0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        nStallingSince = 0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        nDownloadingSince = 0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        nBlocksInFlight = 0;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        nBlocksInFlightValidHeaders = 0;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        fPreferredDownload = <span class="keyword">false</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        fPreferHeaders = <span class="keyword">false</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        fPreferHeaderAndIDs = <span class="keyword">false</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        fProvidesHeaderAndIDs = <span class="keyword">false</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        fSupportsDesiredCmpctVersion = <span class="keyword">false</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;};</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;std::map&lt;NodeId, CNodeState&gt; mapNodeState;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">// Requires cs_main.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;CNodeState *State(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> pnode) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    std::map&lt;NodeId, CNodeState&gt;::iterator it = mapNodeState.find(pnode);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (it == mapNodeState.end())</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> &amp;it-&gt;second;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordtype">void</span> UpdatePreferredDownload(<a class="code" href="class_c_node.html">CNode</a>* node, CNodeState* state)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    nPreferredDownload -= state-&gt;fPreferredDownload;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// Whether this node should be marked as a preferred download node.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    state-&gt;fPreferredDownload = (!node-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a> || node-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>) &amp;&amp; !node-&gt;<a class="code" href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">fOneShot</a> &amp;&amp; !node-&gt;<a class="code" href="class_c_node.html#a721e2470c2c961b7599768a14be68781">fClient</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    nPreferredDownload += state-&gt;fPreferredDownload;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordtype">void</span> PushNodeVersion(<a class="code" href="class_c_node.html">CNode</a> *pnode, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman, int64_t nTime)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537">ServiceFlags</a> nLocalNodeServices = pnode-&gt;<a class="code" href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">GetLocalServices</a>();</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    uint64_t nonce = pnode-&gt;<a class="code" href="class_c_node.html#a3c5bbe8733398b4d14ce05d30aced57e">GetLocalNonce</a>();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">int</span> nNodeStartingHeight = pnode-&gt;<a class="code" href="class_c_node.html#a62937ed6238077e4c6e4364d75b4c0b7">GetMyStartingHeight</a>();</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid = pnode-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="class_c_address.html">CAddress</a> addr = pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="class_c_address.html">CAddress</a> addrYou = (addr.<a class="code" href="class_c_net_addr.html#a4e3b2fea2a6151c76684b3812df4a5c3">IsRoutable</a>() &amp;&amp; !<a class="code" href="netbase_8cpp.html#aef250c1632d217d8f3b752ddeacc0368">IsProxy</a>(addr) ? addr : <a class="code" href="class_c_address.html">CAddress</a>(<a class="code" href="class_c_service.html">CService</a>(), addr.<a class="code" href="class_c_address.html#a24e2309d92694a5a234751634bdf0458">nServices</a>));</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="class_c_address.html">CAddress</a> addrMe = <a class="code" href="class_c_address.html">CAddress</a>(<a class="code" href="class_c_service.html">CService</a>(), nLocalNodeServices);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pnode, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#a79d16fca661ece8c17e786943721fd34">NetMsgType::VERSION</a>, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>, (uint64_t)nLocalNodeServices, nTime, addrYou, addrMe,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            nonce, <a class="code" href="net_8cpp.html#a6c58f8ccc4c93105a44caf588562d609">strSubVersion</a>, nNodeStartingHeight, ::<a class="code" href="net_8cpp.html#a7935254c613d6f3cdadd3ce45f7efbff">fRelayTxes</a>));</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a8e02420c2f7c53579ccb90acf301ae75">fLogIPs</a>)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;send version message: version %d, blocks=%d, us=%s, them=%s, peer=%d\n&quot;</span>, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>, nNodeStartingHeight, addrMe.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>(), addrYou.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>(), nodeid);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;send version message: version %d, blocks=%d, us=%s, peer=%d\n&quot;</span>, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>, nNodeStartingHeight, addrMe.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>(), nodeid);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordtype">void</span> InitializeNode(<a class="code" href="class_c_node.html">CNode</a> *pnode, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="class_c_address.html">CAddress</a> addr = pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    std::string addrName = pnode-&gt;<a class="code" href="class_c_node.html#a4f5e98d3083fe8359d4c27d97eb0dcbb">GetAddrName</a>();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid = pnode-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        mapNodeState.emplace_hint(mapNodeState.end(), std::piecewise_construct, std::forward_as_tuple(nodeid), std::forward_as_tuple(addr, std::move(addrName)));</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span>(!pnode-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        PushNodeVersion(pnode, connman, <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>());</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordtype">void</span> FinalizeNode(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <span class="keywordtype">bool</span>&amp; fUpdateConnectionTime) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    fUpdateConnectionTime = <span class="keyword">false</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (state-&gt;fSyncStarted)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        nSyncStarted--;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (state-&gt;nMisbehavior == 0 &amp;&amp; state-&gt;fCurrentlyConnected) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        fUpdateConnectionTime = <span class="keyword">true</span>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> QueuedBlock&amp; entry, state-&gt;vBlocksInFlight) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        mapBlocksInFlight.erase(entry.hash);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="net__processing_8cpp.html#a5f18fbc4522a5c49d0c8ebbd15ecf2c0">EraseOrphansFor</a>(nodeid);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    nPreferredDownload -= state-&gt;fPreferredDownload;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    nPeersWithValidatedDownloads -= (state-&gt;nBlocksInFlightValidHeaders != 0);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    assert(nPeersWithValidatedDownloads &gt;= 0);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    mapNodeState.erase(nodeid);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span> (mapNodeState.empty()) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">// Do a consistency check after the last peer is removed.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        assert(mapBlocksInFlight.empty());</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        assert(nPreferredDownload == 0);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        assert(nPeersWithValidatedDownloads == 0);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">// Requires cs_main.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">// Returns a bool indicating whether we requested this block.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">// Also used if a block was /not/ received and timed out or started with another peer</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordtype">bool</span> MarkBlockAsReceived(<span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    std::map&lt;uint256, std::pair&lt;NodeId, std::list&lt;QueuedBlock&gt;::iterator&gt; &gt;::iterator itInFlight = mapBlocksInFlight.find(hash);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (itInFlight != mapBlocksInFlight.end()) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        CNodeState *state = State(itInFlight-&gt;second.first);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        state-&gt;nBlocksInFlightValidHeaders -= itInFlight-&gt;second.second-&gt;fValidatedHeaders;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> (state-&gt;nBlocksInFlightValidHeaders == 0 &amp;&amp; itInFlight-&gt;second.second-&gt;fValidatedHeaders) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="comment">// Last validated block on the queue was received.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            nPeersWithValidatedDownloads--;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">if</span> (state-&gt;vBlocksInFlight.begin() == itInFlight-&gt;second.second) {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="comment">// First block on the queue was received, update the start download time for the next one</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            state-&gt;nDownloadingSince = std::max(state-&gt;nDownloadingSince, <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>());</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        state-&gt;vBlocksInFlight.erase(itInFlight-&gt;second.second);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        state-&gt;nBlocksInFlight--;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        state-&gt;nStallingSince = 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        mapBlocksInFlight.erase(itInFlight);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">// Requires cs_main.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">// returns false, still setting pit, if the block was already in flight from the same peer</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">// pit will only be valid as long as the same cs_main lock is being held</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">bool</span> MarkBlockAsInFlight(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash, <span class="keyword">const</span> <a class="code" href="struct_consensus_1_1_params.html">Consensus::Params</a>&amp; consensusParams, <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex = NULL, std::list&lt;QueuedBlock&gt;::iterator **pit = NULL) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    assert(state != NULL);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// Short-circuit most stuff in case its from the same node</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    std::map&lt;uint256, std::pair&lt;NodeId, std::list&lt;QueuedBlock&gt;::iterator&gt; &gt;::iterator itInFlight = mapBlocksInFlight.find(hash);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (itInFlight != mapBlocksInFlight.end() &amp;&amp; itInFlight-&gt;second.first == nodeid) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        *pit = &amp;itInFlight-&gt;second.second;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Make sure it&#39;s not listed somewhere already.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    MarkBlockAsReceived(hash);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    std::list&lt;QueuedBlock&gt;::iterator it = state-&gt;vBlocksInFlight.insert(state-&gt;vBlocksInFlight.end(),</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            {hash, pindex, pindex != NULL, std::unique_ptr&lt;PartiallyDownloadedBlock&gt;(pit ? <span class="keyword">new</span> <a class="code" href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a>(&amp;<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>) : NULL)});</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    state-&gt;nBlocksInFlight++;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    state-&gt;nBlocksInFlightValidHeaders += it-&gt;fValidatedHeaders;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (state-&gt;nBlocksInFlight == 1) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">// We&#39;re starting a block download (batch) from this peer.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        state-&gt;nDownloadingSince = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>();</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span> (state-&gt;nBlocksInFlightValidHeaders == 1 &amp;&amp; pindex != NULL) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        nPeersWithValidatedDownloads++;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    itInFlight = mapBlocksInFlight.insert(std::make_pair(hash, std::make_pair(nodeid, it))).first;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (pit)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        *pit = &amp;itInFlight-&gt;second.second;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordtype">void</span> ProcessBlockAvailability(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid) {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    assert(state != NULL);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (!state-&gt;hashLastUnknownBlock.IsNull()) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        BlockMap::iterator itOld = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(state-&gt;hashLastUnknownBlock);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">if</span> (itOld != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() &amp;&amp; itOld-&gt;second-&gt;nChainWork &gt; 0) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">if</span> (state-&gt;pindexBestKnownBlock == NULL || itOld-&gt;second-&gt;nChainWork &gt;= state-&gt;pindexBestKnownBlock-&gt;nChainWork)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                state-&gt;pindexBestKnownBlock = itOld-&gt;second;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            state-&gt;hashLastUnknownBlock.SetNull();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">void</span> UpdateBlockAvailability(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a> &amp;hash) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    assert(state != NULL);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    ProcessBlockAvailability(nodeid);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    BlockMap::iterator it = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(hash);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (it != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() &amp;&amp; it-&gt;second-&gt;nChainWork &gt; 0) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment">// An actually better block was announced.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (state-&gt;pindexBestKnownBlock == NULL || it-&gt;second-&gt;nChainWork &gt;= state-&gt;pindexBestKnownBlock-&gt;nChainWork)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            state-&gt;pindexBestKnownBlock = it-&gt;second;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">// An unknown block was announced; just assume that the latest one is the best one.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        state-&gt;hashLastUnknownBlock = hash;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordtype">void</span> MaybeSetPeerAsAnnouncingHeaderAndIDs(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="sync_8h.html#acd61d0cb3b49f367728193720014aed0">AssertLockHeld</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    CNodeState* nodestate = State(nodeid);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (!nodestate || !nodestate-&gt;fSupportsDesiredCmpctVersion) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">// Never ask from peers who can&#39;t provide desired version.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (nodestate-&gt;fProvidesHeaderAndIDs) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">for</span> (std::list&lt;NodeId&gt;::iterator it = lNodesAnnouncingHeaderAndIDs.begin(); it != lNodesAnnouncingHeaderAndIDs.end(); it++) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">if</span> (*it == nodeid) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                lNodesAnnouncingHeaderAndIDs.erase(it);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                lNodesAnnouncingHeaderAndIDs.push_back(nodeid);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        connman.<a class="code" href="class_c_connman.html#a28701e595fcd7dd71791f105457db034">ForNode</a>(nodeid, [&amp;connman](<a class="code" href="class_c_node.html">CNode</a>* pfrom){</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keywordtype">bool</span> fAnnounceUsingCMPCTBLOCK = <span class="keyword">false</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            uint64_t nCMPCTBLOCKVersion = 1;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordflow">if</span> (lNodesAnnouncingHeaderAndIDs.size() &gt;= 3) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="comment">// As per BIP152, we only get 3 of our peers to announce</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="comment">// blocks using compact encodings.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                connman.<a class="code" href="class_c_connman.html#a28701e595fcd7dd71791f105457db034">ForNode</a>(lNodesAnnouncingHeaderAndIDs.front(), [&amp;connman, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion](<a class="code" href="class_c_node.html">CNode</a>* pnodeStop){</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pnodeStop, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(pnodeStop-&gt;GetSendVersion()).Make(<a class="code" href="namespace_net_msg_type.html#a4cdafba4d585b4699628412c7f1c3d8b">NetMsgType::SENDCMPCT</a>, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                });</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                lNodesAnnouncingHeaderAndIDs.pop_front();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            fAnnounceUsingCMPCTBLOCK = <span class="keyword">true</span>;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>()).Make(<a class="code" href="namespace_net_msg_type.html#a4cdafba4d585b4699628412c7f1c3d8b">NetMsgType::SENDCMPCT</a>, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            lNodesAnnouncingHeaderAndIDs.push_back(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        });</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">// Requires cs_main</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="keywordtype">bool</span> CanDirectFetch(<span class="keyword">const</span> <a class="code" href="struct_consensus_1_1_params.html">Consensus::Params</a> &amp;consensusParams)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() &gt; <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - consensusParams.<a class="code" href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">nPowTargetSpacing</a> * 20;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">// Requires cs_main</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordtype">bool</span> PeerHasHeader(CNodeState *state, <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">if</span> (state-&gt;pindexBestKnownBlock &amp;&amp; pindex == state-&gt;pindexBestKnownBlock-&gt;GetAncestor(pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>))</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (state-&gt;pindexBestHeaderSent &amp;&amp; pindex == state-&gt;pindexBestHeaderSent-&gt;GetAncestor(pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>))</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* LastCommonAncestor(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pa, <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pb) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span> (pa-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &gt; pb-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        pa = pa-&gt;<a class="code" href="class_c_block_index.html#ae1f702384690c6b8302e026a84172ef3">GetAncestor</a>(pb-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pb-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &gt; pa-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        pb = pb-&gt;<a class="code" href="class_c_block_index.html#ae1f702384690c6b8302e026a84172ef3">GetAncestor</a>(pa-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">while</span> (pa != pb &amp;&amp; pa &amp;&amp; pb) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        pa = pa-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        pb = pb-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Eventually all chain branches meet at the genesis block.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    assert(pa == pb);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> pa;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keywordtype">void</span> FindNextBlocksToDownload(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>, std::vector&lt;const CBlockIndex*&gt;&amp; vBlocks, <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a>&amp; nodeStaller, <span class="keyword">const</span> <a class="code" href="struct_consensus_1_1_params.html">Consensus::Params</a>&amp; consensusParams) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> == 0)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    vBlocks.reserve(vBlocks.size() + <a class="code" href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    assert(state != NULL);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// Make sure pindexBestKnownBlock is up to date, we&#39;ll need it.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    ProcessBlockAvailability(nodeid);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (state-&gt;pindexBestKnownBlock == NULL || state-&gt;pindexBestKnownBlock-&gt;nChainWork &lt; <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">nChainWork</a> || state-&gt;pindexBestKnownBlock-&gt;nChainWork &lt; <a class="code" href="arith__uint256_8cpp.html#a6a6e0e2e41ba7e31c4a741eb2426a516">UintToArith256</a>(consensusParams.<a class="code" href="struct_consensus_1_1_params.html#a85eafe7f37215d1b228b47d75e534cef">nMinimumChainWork</a>)) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">// This peer has nothing interesting.</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> (state-&gt;pindexLastCommonBlock == NULL) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="comment">// Bootstrap quickly by guessing a parent of our best tip is the forking point.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">// Guessing wrong in either direction is not a problem.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        state-&gt;pindexLastCommonBlock = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>[std::min(state-&gt;pindexBestKnownBlock-&gt;nHeight, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#ad4758bc8872ce065a9579f77c3171d40">Height</a>())];</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// If the peer reorganized, our previous pindexLastCommonBlock may not be an ancestor</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// of its current tip anymore. Go back enough to fix that.</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    state-&gt;pindexLastCommonBlock = LastCommonAncestor(state-&gt;pindexLastCommonBlock, state-&gt;pindexBestKnownBlock);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (state-&gt;pindexLastCommonBlock == state-&gt;pindexBestKnownBlock)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    std::vector&lt;const CBlockIndex*&gt; vToFetch;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexWalk = state-&gt;pindexLastCommonBlock;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// Never fetch further than the best block we know the peer has, or more than BLOCK_DOWNLOAD_WINDOW + 1 beyond the last</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">// linked block we have in common with this peer. The +1 is so we can detect stalling, namely if we would be able to</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// download that next block if the window were 1 larger.</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">int</span> nWindowEnd = state-&gt;pindexLastCommonBlock-&gt;nHeight + <a class="code" href="validation_8h.html#a3db9a6c313045e841191037a97268a96">BLOCK_DOWNLOAD_WINDOW</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">int</span> nMaxHeight = std::min&lt;int&gt;(state-&gt;pindexBestKnownBlock-&gt;nHeight, nWindowEnd + 1);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> waitingfor = -1;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">while</span> (pindexWalk-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &lt; nMaxHeight) {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">// Read up to 128 (or more, if more blocks than that are needed) successors of pindexWalk (towards</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// pindexBestKnownBlock) into vToFetch. We fetch 128, because CBlockIndex::GetAncestor may be as expensive</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="comment">// as iterating over ~100 CBlockIndex* entries anyway.</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordtype">int</span> nToFetch = std::min(nMaxHeight - pindexWalk-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, std::max&lt;int&gt;(<a class="code" href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> - vBlocks.size(), 128));</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        vToFetch.resize(nToFetch);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        pindexWalk = state-&gt;pindexBestKnownBlock-&gt;GetAncestor(pindexWalk-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> + nToFetch);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        vToFetch[nToFetch - 1] = pindexWalk;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = nToFetch - 1; i &gt; 0; i--) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            vToFetch[i - 1] = vToFetch[i]-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="comment">// Iterate over those blocks in vToFetch (in forward direction), adding the ones that</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="comment">// are not yet downloaded and not in flight to vBlocks. In the mean time, update</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="comment">// pindexLastCommonBlock as long as all ancestors are already downloaded, or if it&#39;s</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="comment">// already part of our chain (and therefore don&#39;t need it even if pruned).</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex, vToFetch) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">if</span> (!pindex-&gt;<a class="code" href="class_c_block_index.html#ad8b5a6560e7c0d4222066e2922178683">IsValid</a>(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573">BLOCK_VALID_TREE</a>)) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="comment">// We consider the chain that this peer is on invalid.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#ac5a336b45ca70e3ed2fc090bf2ee3011">nStatus</a> &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a> || <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#af1786dc229c215dea7f727c11df2c8dc">Contains</a>(pindex)) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#af3c6d6dd8a7579e5ce516d94b98d2db5">nChainTx</a>)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    state-&gt;pindexLastCommonBlock = pindex;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mapBlocksInFlight.count(pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()) == 0) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="comment">// The block is not already downloaded, and not yet in flight.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &gt; nWindowEnd) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    <span class="comment">// We reached the end of the window.</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    <span class="keywordflow">if</span> (vBlocks.size() == 0 &amp;&amp; waitingfor != nodeid) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        <span class="comment">// We aren&#39;t able to fetch anything, but we would be if the download window was one larger.</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        nodeStaller = waitingfor;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                    }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                vBlocks.push_back(pindex);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="keywordflow">if</span> (vBlocks.size() == <a class="code" href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (waitingfor == -1) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="comment">// This is the first already-in-flight block.</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                waitingfor = mapBlocksInFlight[pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()].first;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;} <span class="comment">// anon namespace</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="net__processing_8h.html#af0793c7c14e94d2d642f4ac89067a429">  566</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="net__processing_8cpp.html#af0793c7c14e94d2d642f4ac89067a429">GetNodeStateStats</a>(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> nodeid, <a class="code" href="struct_c_node_state_stats.html">CNodeStateStats</a> &amp;stats) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    CNodeState *state = State(nodeid);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">if</span> (state == NULL)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    stats.<a class="code" href="struct_c_node_state_stats.html#a62c2243d09166c1daaad84519700da3c">nMisbehavior</a> = state-&gt;nMisbehavior;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    stats.<a class="code" href="struct_c_node_state_stats.html#a7646deac801098e973a5bc50202f92cd">nSyncHeight</a> = state-&gt;pindexBestKnownBlock ? state-&gt;pindexBestKnownBlock-&gt;nHeight : -1;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    stats.<a class="code" href="struct_c_node_state_stats.html#a67c910a57285a63bbf0bb88ea7a9ca05">nCommonHeight</a> = state-&gt;pindexLastCommonBlock ? state-&gt;pindexLastCommonBlock-&gt;nHeight : -1;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> QueuedBlock&amp; queue, state-&gt;vBlocksInFlight) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">if</span> (queue.pindex)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            stats.<a class="code" href="struct_c_node_state_stats.html#a4b03fd8ecaa9268f7eca836e5e79c35a">vHeightInFlight</a>.push_back(queue.pindex-&gt;nHeight);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="net__processing_8h.html#ab02615ff65f91d69f8d786ec900baa8a">  581</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#ab02615ff65f91d69f8d786ec900baa8a">RegisterNodeSignals</a>(<a class="code" href="struct_c_node_signals.html">CNodeSignals</a>&amp; nodeSignals)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#adbe101522cf1fd496a8fdf2667744f0f">ProcessMessages</a>.connect(&amp;<a class="code" href="net__processing_8cpp.html#ab6b29c6674d192d8d881ccf2c0b5e545">ProcessMessages</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#ae96100eac4458c80929678cd6f58bc53">SendMessages</a>.connect(&amp;<a class="code" href="net__processing_8cpp.html#ad0cf88373f93a6b6e3936999e4212643">SendMessages</a>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#a1ce7c2d878dee3b81732b8ded51a7d6a">InitializeNode</a>.connect(&amp;InitializeNode);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#afeb0f429de9477d8e7c003d44050bf00">FinalizeNode</a>.connect(&amp;FinalizeNode);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="net__processing_8h.html#a3ef0cc6e9d9d6435ee2a5569244d6ebd">  589</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a3ef0cc6e9d9d6435ee2a5569244d6ebd">UnregisterNodeSignals</a>(<a class="code" href="struct_c_node_signals.html">CNodeSignals</a>&amp; nodeSignals)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#adbe101522cf1fd496a8fdf2667744f0f">ProcessMessages</a>.disconnect(&amp;<a class="code" href="net__processing_8cpp.html#ab6b29c6674d192d8d881ccf2c0b5e545">ProcessMessages</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#ae96100eac4458c80929678cd6f58bc53">SendMessages</a>.disconnect(&amp;<a class="code" href="net__processing_8cpp.html#ad0cf88373f93a6b6e3936999e4212643">SendMessages</a>);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#a1ce7c2d878dee3b81732b8ded51a7d6a">InitializeNode</a>.disconnect(&amp;InitializeNode);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    nodeSignals.<a class="code" href="struct_c_node_signals.html#afeb0f429de9477d8e7c003d44050bf00">FinalizeNode</a>.disconnect(&amp;FinalizeNode);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;}</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">// mapOrphanTransactions</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a1cb503e00969ffcc1b35a19bceb3d4d6">  602</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a1cb503e00969ffcc1b35a19bceb3d4d6">AddToCompactExtraTransactions</a>(<span class="keyword">const</span> <a class="code" href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a>&amp; tx)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;{</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordtype">size_t</span> max_extra_txn = <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-blockreconstructionextratxn&quot;</span>, <a class="code" href="net__processing_8h.html#a9d3753f6b45e9bc12172e63922e704fd">DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN</a>);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (max_extra_txn &lt;= 0)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (!vExtraTxnForCompact.size())</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        vExtraTxnForCompact.resize(max_extra_txn);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    vExtraTxnForCompact[<a class="code" href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">vExtraTxnForCompactIt</a>] = std::make_pair(tx-&gt;GetHash(), tx);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <a class="code" href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">vExtraTxnForCompactIt</a> = (<a class="code" href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">vExtraTxnForCompactIt</a> + 1) % max_extra_txn;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;}</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#ad5c880181bb5a6df5bf32cf46ba062ad">  613</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="net__processing_8cpp.html#ad5c880181bb5a6df5bf32cf46ba062ad">AddOrphanTx</a>(<span class="keyword">const</span> <a class="code" href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a>&amp; tx, <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer) <a class="code" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>)</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;{</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash = tx-&gt;GetHash();</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span> (mapOrphanTransactions.count(hash))</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// Ignore big transactions, to avoid a</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">// send-big-orphans memory exhaustion attack. If a peer has a legitimate</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">// large transaction with a missing parent then we assume</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// it will rebroadcast it later, after the parent transaction(s)</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// have been mined or received.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">// 100 orphans, each of which is at most 99,999 bytes big is</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">// at most 10 megabytes of orphans and somewhat more byprev index (in the worst case):</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sz = <a class="code" href="serialize_8h.html#aeb209536f7b746673a9c3fba8651b0e5">GetSerializeSize</a>(*tx, <a class="code" href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a>, <a class="code" href="class_c_transaction.html#afcc5960eab9d35f10c6f8e6675bf2a93">CTransaction::CURRENT_VERSION</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (sz &gt; <a class="code" href="policy_8h.html#aefbb84a1c575dfc90d140d06f8c8d1e9">MAX_STANDARD_TX_SIZE</a>)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;ignoring large orphan tx (size: %u, hash: %s)\n&quot;</span>, sz, hash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keyword">auto</span> ret = mapOrphanTransactions.emplace(hash, <a class="code" href="struct_c_orphan_tx.html">COrphanTx</a>{tx, peer, <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>() + <a class="code" href="net__processing_8h.html#a1ca092f66c0d0ea7ea0e930b5a72c500">ORPHAN_TX_EXPIRE_TIME</a>});</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    assert(ret.second);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a>&amp; txin, tx-&gt;vin) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        mapOrphanTransactionsByPrev[txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>].insert(ret.first);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="net__processing_8cpp.html#a1cb503e00969ffcc1b35a19bceb3d4d6">AddToCompactExtraTransactions</a>(tx);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;stored orphan tx %s (mapsz %u outsz %u)\n&quot;</span>, hash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;             mapOrphanTransactions.size(), mapOrphanTransactionsByPrev.size());</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;}</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">  646</a></span>&#160;<span class="keywordtype">int</span> <span class="keyword">static</span> <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(<a class="code" href="classuint256.html">uint256</a> hash) <a class="code" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;{</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    std::map&lt;uint256, COrphanTx&gt;::iterator it = mapOrphanTransactions.find(hash);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (it == mapOrphanTransactions.end())</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a>&amp; txin, it-&gt;second.tx-&gt;vin)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keyword">auto</span> itPrev = mapOrphanTransactionsByPrev.find(txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">if</span> (itPrev == mapOrphanTransactionsByPrev.end())</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        itPrev-&gt;second.erase(it);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> (itPrev-&gt;second.empty())</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            mapOrphanTransactionsByPrev.erase(itPrev);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    mapOrphanTransactions.erase(it);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a5f18fbc4522a5c49d0c8ebbd15ecf2c0">  664</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a5f18fbc4522a5c49d0c8ebbd15ecf2c0">EraseOrphansFor</a>(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> peer)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">int</span> nErased = 0;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    std::map&lt;uint256, COrphanTx&gt;::iterator iter = mapOrphanTransactions.begin();</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">while</span> (iter != mapOrphanTransactions.end())</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        std::map&lt;uint256, COrphanTx&gt;::iterator maybeErase = iter++; <span class="comment">// increment to avoid iterator becoming invalid</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> (maybeErase-&gt;second.fromPeer == peer)</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            nErased += <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(maybeErase-&gt;second.tx-&gt;GetHash());</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (nErased &gt; 0) <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;Erased %d orphan tx from peer=%d\n&quot;</span>, nErased, peer);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a8ba236d72126857f35e106fb4ebde610">  680</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="net__processing_8cpp.html#a8ba236d72126857f35e106fb4ebde610">LimitOrphanTxSize</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMaxOrphans) <a class="code" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;{</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvicted = 0;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keyword">static</span> int64_t nNextSweep;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    int64_t nNow = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span> (nNextSweep &lt;= nNow) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// Sweep out expired orphan pool entries:</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordtype">int</span> nErased = 0;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        int64_t nMinExpTime = nNow + <a class="code" href="net__processing_8h.html#a1ca092f66c0d0ea7ea0e930b5a72c500">ORPHAN_TX_EXPIRE_TIME</a> - <a class="code" href="net__processing_8h.html#a50cdb9bf0105f8f39008a7ec09909336">ORPHAN_TX_EXPIRE_INTERVAL</a>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        std::map&lt;uint256, COrphanTx&gt;::iterator iter = mapOrphanTransactions.begin();</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">while</span> (iter != mapOrphanTransactions.end())</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            std::map&lt;uint256, COrphanTx&gt;::iterator maybeErase = iter++;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">if</span> (maybeErase-&gt;second.nTimeExpire &lt;= nNow) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                nErased += <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(maybeErase-&gt;second.tx-&gt;GetHash());</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                nMinExpTime = std::min(maybeErase-&gt;second.nTimeExpire, nMinExpTime);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        }</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">// Sweep again 5 minutes after the next entry that expires in order to batch the linear scan.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        nNextSweep = nMinExpTime + <a class="code" href="net__processing_8h.html#a50cdb9bf0105f8f39008a7ec09909336">ORPHAN_TX_EXPIRE_INTERVAL</a>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span> (nErased &gt; 0) <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;Erased %d orphan tx due to expiration\n&quot;</span>, nErased);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">while</span> (mapOrphanTransactions.size() &gt; nMaxOrphans)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment">// Evict a random orphan:</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <a class="code" href="classuint256.html">uint256</a> randomhash = <a class="code" href="random_8cpp.html#af3aedae75efabb170337a497457f7ecf">GetRandHash</a>();</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        std::map&lt;uint256, COrphanTx&gt;::iterator it = mapOrphanTransactions.lower_bound(randomhash);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">if</span> (it == mapOrphanTransactions.end())</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            it = mapOrphanTransactions.begin();</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(it-&gt;first);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        ++nEvicted;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span> nEvicted;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">// Requires cs_main.</span></div><div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="net__processing_8h.html#a4b04650c6aa3e5b02921ba992658d647">  717</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(<a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> pnode, <span class="keywordtype">int</span> howmuch)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;{</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> (howmuch == 0)</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    CNodeState *state = State(pnode);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">if</span> (state == NULL)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    state-&gt;nMisbehavior += howmuch;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordtype">int</span> banscore = <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-banscore&quot;</span>, <a class="code" href="validation_8h.html#ae034ec95ea656e6d994828c1f5d7d596">DEFAULT_BANSCORE_THRESHOLD</a>);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> (state-&gt;nMisbehavior &gt;= banscore &amp;&amp; state-&gt;nMisbehavior - howmuch &lt; banscore)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s: %s peer=%d (%d -&gt; %d) BAN THRESHOLD EXCEEDED\n&quot;</span>, __func__, state-&gt;name, pnode, state-&gt;nMisbehavior-howmuch, state-&gt;nMisbehavior);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        state-&gt;fShouldBan = <span class="keyword">true</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s: %s peer=%d (%d -&gt; %d)\n&quot;</span>, __func__, state-&gt;name, pnode, state-&gt;nMisbehavior-howmuch, state-&gt;nMisbehavior);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">// blockchain -&gt; download logic notification</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno"><a class="line" href="class_peer_logic_validation.html#a806fa20043b60e1ea5773cd8fb908f0c">  748</a></span>&#160;<a class="code" href="class_peer_logic_validation.html#a806fa20043b60e1ea5773cd8fb908f0c">PeerLogicValidation::PeerLogicValidation</a>(<a class="code" href="class_c_connman.html">CConnman</a>* connmanIn) : connman(connmanIn) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// Initialize global variables that cannot be constructed at startup.</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    recentRejects.reset(<span class="keyword">new</span> <a class="code" href="class_c_rolling_bloom_filter.html">CRollingBloomFilter</a>(120000, 0.000001));</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="class_peer_logic_validation.html#a87704cec2345954fd7d138f3e8330247">  753</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_peer_logic_validation.html#a87704cec2345954fd7d138f3e8330247">PeerLogicValidation::SyncTransaction</a>(<span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx, <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex, <span class="keywordtype">int</span> nPosInBlock) {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span> (nPosInBlock == <a class="code" href="struct_c_main_signals.html#a6144f532a3944d55a9c0a4fe2e9283c5">CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK</a>)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    std::vector&lt;uint256&gt; vOrphanErase;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">// Which orphan pool entries must we evict?</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; tx.<a class="code" href="class_c_transaction.html#ad64447ea044ec850313696fc99412d95">vin</a>.size(); j++) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keyword">auto</span> itByPrev = mapOrphanTransactionsByPrev.find(tx.<a class="code" href="class_c_transaction.html#ad64447ea044ec850313696fc99412d95">vin</a>[j].prevout);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">if</span> (itByPrev == mapOrphanTransactionsByPrev.end()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> mi = itByPrev-&gt;second.begin(); mi != itByPrev-&gt;second.end(); ++mi) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; orphanTx = *(*mi)-&gt;second.tx;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; orphanHash = orphanTx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>();</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            vOrphanErase.push_back(orphanHash);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        }</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">// Erase orphan transactions include or precluded by this block</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">if</span> (vOrphanErase.size()) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordtype">int</span> nErased = 0;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        BOOST_FOREACH(<a class="code" href="classuint256.html">uint256</a> &amp;orphanHash, vOrphanErase) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            nErased += <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(orphanHash);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;Erased %d orphan tx included or conflicted by block\n&quot;</span>, nErased);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;}</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">  781</a></span>&#160;<span class="keyword">static</span> <a class="code" href="class_c_critical_section.html">CCriticalSection</a> <a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>;</div><div class="line"><a name="l00782"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">  782</a></span>&#160;<span class="keyword">static</span> std::shared_ptr&lt;const CBlock&gt; <a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a>;</div><div class="line"><a name="l00783"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a263ae1b219e81c6c3de9b65ee52605a9">  783</a></span>&#160;<span class="keyword">static</span> std::shared_ptr&lt;const CBlockHeaderAndShortTxIDs&gt; <a class="code" href="net__processing_8cpp.html#a263ae1b219e81c6c3de9b65ee52605a9">most_recent_compact_block</a>;</div><div class="line"><a name="l00784"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">  784</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classuint256.html">uint256</a> <a class="code" href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">most_recent_block_hash</a>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno"><a class="line" href="class_peer_logic_validation.html#a4ed18bc626b7e64f822912cd1057e5cb">  786</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_peer_logic_validation.html#a4ed18bc626b7e64f822912cd1057e5cb">PeerLogicValidation::NewPoWValidBlock</a>(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex, <span class="keyword">const</span> std::shared_ptr&lt;const CBlock&gt;&amp; pblock) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    std::shared_ptr&lt;const CBlockHeaderAndShortTxIDs&gt; pcmpctblock = std::make_shared&lt;const CBlockHeaderAndShortTxIDs&gt; (*pblock);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a> msgMaker(<a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> nHighestFastAnnounce = 0;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &lt;= nHighestFastAnnounce)</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    nHighestFastAnnounce = pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="classuint256.html">uint256</a> hashBlock(pblock-&gt;GetHash());</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <a class="code" href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">most_recent_block_hash</a> = hashBlock;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a> = pblock;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <a class="code" href="net__processing_8cpp.html#a263ae1b219e81c6c3de9b65ee52605a9">most_recent_compact_block</a> = pcmpctblock;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>-&gt;<a class="code" href="class_c_connman.html#a2d665bfdec68f6484b9f0d6760f9efd1">ForEachNode</a>([<span class="keyword">this</span>, &amp;pcmpctblock, pindex, &amp;msgMaker, &amp;hashBlock](<a class="code" href="class_c_node.html">CNode</a>* pnode) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">// TODO: Avoid the repeated-serialization here</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span> (pnode-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a>)</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        ProcessBlockAvailability(pnode-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        CNodeState &amp;state = *State(pnode-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="comment">// If the peer has, or we announced to them the previous block already,</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// but we don&#39;t think they have this one, go ahead and announce it</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">if</span> (state.fPreferHeaderAndIDs &amp;&amp;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                !PeerHasHeader(&amp;state, pindex) &amp;&amp; PeerHasHeader(&amp;state, pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>)) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;%s sending header-and-ids %s to peer=%d\n&quot;</span>, <span class="stringliteral">&quot;PeerLogicValidation::NewPoWValidBlock&quot;</span>,</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    hashBlock.ToString(), pnode-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>-&gt;<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pnode, msgMaker.<a class="code" href="class_c_net_msg_maker.html#ac314ab21062f354bbb885e65060b815f">Make</a>(<a class="code" href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a>, *pcmpctblock));</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            state.pindexBestHeaderSent = pindex;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    });</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;}</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno"><a class="line" href="class_peer_logic_validation.html#a91f72d94f777c7af376dbaddd98aaf3f">  825</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_peer_logic_validation.html#a91f72d94f777c7af376dbaddd98aaf3f">PeerLogicValidation::UpdatedBlockTip</a>(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexNew, <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexFork, <span class="keywordtype">bool</span> fInitialDownload) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> nNewHeight = pindexNew-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>-&gt;<a class="code" href="class_c_connman.html#a36cf799d267785276497583398dfd4cd">SetBestHeight</a>(nNewHeight);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span> (!fInitialDownload) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="comment">// Find the hashes of all blocks that weren&#39;t previously in the best chain.</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        std::vector&lt;uint256&gt; vHashes;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexToAnnounce = pindexNew;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">while</span> (pindexToAnnounce != pindexFork) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            vHashes.push_back(pindexToAnnounce-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>());</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            pindexToAnnounce = pindexToAnnounce-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordflow">if</span> (vHashes.size() == <a class="code" href="validation_8h.html#ad4d4718d1ec747708a31bc47aaa66578">MAX_BLOCKS_TO_ANNOUNCE</a>) {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                <span class="comment">// Limit announcements in case of a huge reorganization.</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                <span class="comment">// Rely on the peer&#39;s synchronization mechanism in that case.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">// Relay inventory, but don&#39;t relay old inventory during initial block download.</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>-&gt;<a class="code" href="class_c_connman.html#a2d665bfdec68f6484b9f0d6760f9efd1">ForEachNode</a>([nNewHeight, &amp;vHashes](<a class="code" href="class_c_node.html">CNode</a>* pnode) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">if</span> (nNewHeight &gt; (pnode-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a> != -1 ? pnode-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a> - 2000 : 0)) {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                BOOST_REVERSE_FOREACH(const uint256&amp; hash, vHashes) {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                    pnode-&gt;PushBlockHash(hash);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        });</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>-&gt;<a class="code" href="class_c_connman.html#a999ec42f1515f77096556c94c29c6538">WakeMessageHandler</a>();</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="net__processing_8cpp.html#a147efbcf1410c50c56547340f1fe1ebd">nTimeBestReceived</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;}</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="class_peer_logic_validation.html#a124965d7310e0df08cc027d4e1cbbe7b">  856</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_peer_logic_validation.html#a124965d7310e0df08cc027d4e1cbbe7b">PeerLogicValidation::BlockChecked</a>(<span class="keyword">const</span> <a class="code" href="class_c_block.html">CBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="class_c_validation_state.html">CValidationState</a>&amp; state) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a> hash(block.<a class="code" href="class_c_block_header.html#af0239f86a13f622a826e9eea66b2d7f3">GetHash</a>());</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    std::map&lt;uint256, std::pair&lt;NodeId, bool&gt; &gt;::iterator it = mapBlockSource.find(hash);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">int</span> nDoS = 0;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDoS)) {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">if</span> (it != mapBlockSource.end() &amp;&amp; State(it-&gt;second.first)) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            assert (state.<a class="code" href="class_c_validation_state.html#a01490c3326ac7d47a64976747060ac46">GetRejectCode</a>() &lt; <a class="code" href="validation_8h.html#ae98e9fff288e3029a25765a7f924d960">REJECT_INTERNAL</a>); <span class="comment">// Blocks are never rejected with internal reject codes</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            CBlockReject reject = {(<span class="keywordtype">unsigned</span> char)state.<a class="code" href="class_c_validation_state.html#a01490c3326ac7d47a64976747060ac46">GetRejectCode</a>(), state.<a class="code" href="class_c_validation_state.html#a8fa9612cb40c3c8592f7cd29b5931ccd">GetRejectReason</a>().substr(0, <a class="code" href="validation_8h.html#af83a9cbb7b3fe9d34a7c4b43f2e040f8">MAX_REJECT_MESSAGE_LENGTH</a>), hash};</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            State(it-&gt;second.first)-&gt;rejects.push_back(reject);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">if</span> (nDoS &gt; 0 &amp;&amp; it-&gt;second.second)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(it-&gt;second.first, nDoS);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Check that:</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// 1. The block is valid</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// 2. We&#39;re not in initial block download</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// 3. This is currently the best block we&#39;re aware of. We haven&#39;t updated</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">//    the tip yet so we have no way to check this directly here. Instead we</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">//    just check that there are currently no other blocks in flight.</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#a7dc31c88ba63ad17a954f247d21b550c">IsValid</a>() &amp;&amp;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;             !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>() &amp;&amp;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;             mapBlocksInFlight.count(hash) == mapBlocksInFlight.size()) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">if</span> (it != mapBlockSource.end()) {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            MaybeSetPeerAsAnnouncingHeaderAndIDs(it-&gt;second.first, *<a class="code" href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">connman</a>);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (it != mapBlockSource.end())</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        mapBlockSource.erase(it);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">// Messages</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">  895</a></span>&#160;<span class="keywordtype">bool</span> <span class="keyword">static</span> <a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(<span class="keyword">const</span> <a class="code" href="class_c_inv.html">CInv</a>&amp; inv) <a class="code" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">switch</span> (inv.type)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>:</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            assert(recentRejects);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>() != hashRecentRejectsChainTip)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <span class="comment">// If the chain tip has changed previously rejected transactions</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                <span class="comment">// might be now valid, e.g. due to a nLockTime&#39;d tx becoming valid,</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                <span class="comment">// or a double-spend. Reset the rejects filter and give those</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                <span class="comment">// txs a second chance.</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                hashRecentRejectsChainTip = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>();</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                recentRejects-&gt;reset();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            }</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="keywordflow">return</span> recentRejects-&gt;contains(inv.hash) ||</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                   <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#a8b7a13b5289ab839d4460f41a7da9789">exists</a>(inv.hash) ||</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                   mapOrphanTransactions.count(inv.hash) ||</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                   <a class="code" href="validation_8cpp.html#a1821834b8f7837b469f7f91a14c20042">pcoinsTip</a>-&gt;<a class="code" href="class_c_coins_view_cache.html#ab2e11ee063c40be4a6bc620fd98149a0">HaveCoinInCache</a>(<a class="code" href="class_c_out_point.html">COutPoint</a>(inv.hash, 0)) || <span class="comment">// Best effort: only try output 0 and 1</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                   <a class="code" href="validation_8cpp.html#a1821834b8f7837b469f7f91a14c20042">pcoinsTip</a>-&gt;<a class="code" href="class_c_coins_view_cache.html#ab2e11ee063c40be4a6bc620fd98149a0">HaveCoinInCache</a>(<a class="code" href="class_c_out_point.html">COutPoint</a>(inv.hash, 1));</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>:</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.count(inv.hash);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="comment">/* </span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">        Dash Related Inventory Messages</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">        --</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">        We shouldn&#39;t update the sync times for each of the messages when we already have it. </span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">        We&#39;re going to be asking many nodes upfront for the full inventory list, so we&#39;ll get duplicates of these.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">        We want to only update the time on new hits, so that we can time out appropriately if needed.</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a802e4d970385efb01469f48db2cf1e06">MSG_TXLOCK_REQUEST</a>:</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a6b323bf35be33468f78b66898344ea6f">AlreadyHave</a>(inv.hash);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a9d087eae96b6c836c7eb63693b8b7483">MSG_TXLOCK_VOTE</a>:</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a6b323bf35be33468f78b66898344ea6f">AlreadyHave</a>(inv.hash);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991abacdb1618207a44c1301ae59acf7f5d8">MSG_SPORK</a>:</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <a class="code" href="class_c_spork_message.html">CSporkMessage</a> <a class="code" href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a>;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="spork_8cpp.html#af6873019c3095ea6b554795e4040395c">sporkManager</a>.<a class="code" href="class_c_spork_manager.html#a9cec53a1eb6335507d5c88a17f293e7f">GetSporkByHash</a>(inv.hash, <a class="code" href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4b07f9302d2d304c1e151bc611d3cd6c">MSG_MASTERNODE_PAYMENT_VOTE</a>:</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a830408cb2635a3e3b4a1c48d1deefb85">mapMasternodePaymentVotes</a>.count(inv.hash);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11b49df4769b3e5c303fbb87ef05c96d">MSG_MASTERNODE_PAYMENT_BLOCK</a>:</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(inv.hash);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">return</span> mi != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() &amp;&amp; <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a6feb2c94183cd649ede84dc38d3ae442">mapMasternodeBlocks</a>.find(mi-&gt;second-&gt;nHeight) != <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a6feb2c94183cd649ede84dc38d3ae442">mapMasternodeBlocks</a>.end();</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a3a28db7deec3a185c981b159a7b235fc">MSG_MASTERNODE_ANNOUNCE</a>:</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#ac5a23d1da696b20b0cd74930d6752e8e">mapSeenMasternodeBroadcast</a>.count(inv.hash) &amp;&amp; !<a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a52f953e116c5b4196b12831354fd0a4d">IsMnbRecoveryRequested</a>(inv.hash);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a50511d9d8e551a2890f09622d82f13f7">MSG_MASTERNODE_PING</a>:</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#acdaf36c846ff68fcdc94785d70237141">mapSeenMasternodePing</a>.count(inv.hash);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ab7e23cc7eff00496b50b04e9e98f1b85">MSG_DSTX</a>: {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(<a class="code" href="class_c_private_send.html#a5ca6361baefaecece1640899f918fd8a">CPrivateSend::GetDSTX</a>(inv.hash));</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae8208d8fb3855c56c3e5befaeb923fa2">MSG_GOVERNANCE_OBJECT</a>:</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2cb5fe00e73ee666aa3daef76b299251">MSG_GOVERNANCE_OBJECT_VOTE</a>:</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">return</span> ! <a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#a5a7e2f9bcf237d99a005dc72d4a6bfac">ConfirmInventoryRequest</a>(inv);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae2eafa466f6492ab207617288629f23c">MSG_MASTERNODE_VERIFY</a>:</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a18a7b718a7d7a7fbb22f8701b0a0b9df">mapSeenMasternodeVerification</a>.count(inv.hash);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ad5de2518f7a7e23590f870cf0c57a188">MSG_QUORUM_FINAL_COMMITMENT</a>:</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellmq.html#a32533f25ea72d1153af50d680a75434d">llmq::quorumBlockProcessor</a>-&gt;<a class="code" href="classllmq_1_1_c_quorum_block_processor.html#a37b9067401b0136f82fa78b80bfe1777">HasMinableCommitment</a>(inv.hash);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a8bad6026f225abcd25d6598d775a13e2">MSG_QUORUM_DUMMY_COMMITMENT</a>:</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a>-&gt;<a class="code" href="classllmq_1_1_c_dummy_d_k_g.html#a3ea4c54cd0e779596732f54df59ba5bd">HasDummyCommitment</a>(inv.hash);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2b879124ab9ed92674b4559f5f7e493f">MSG_QUORUM_DUMMY_CONTRIBUTION</a>:</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a>-&gt;<a class="code" href="classllmq_1_1_c_dummy_d_k_g.html#acbc241cee5cfca4ddea8bf937deaa105">HasDummyContribution</a>(inv.hash);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">// Don&#39;t know what it is, just say we already got one</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;}</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a5de6345878869c44bb12d104fecd55d1">  981</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="net__processing_8cpp.html#a5de6345878869c44bb12d104fecd55d1">RelayAddress</a>(<span class="keyword">const</span> <a class="code" href="class_c_address.html">CAddress</a>&amp; addr, <span class="keywordtype">bool</span> fReachable, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;{</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nRelayNodes = fReachable ? 2 : 1; <span class="comment">// limited relaying of addresses outside our network(s)</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// Relay to a limited number of other nodes</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// Use deterministic randomness to send to the same nodes for 24 hours</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// at a time so the addrKnowns of the chosen nodes prevent repeats</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    uint64_t hashAddr = addr.<a class="code" href="class_c_net_addr.html#a8fae7d32e83e9fbb9ce0216f896133c9">GetHash</a>();</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_sip_hasher.html">CSipHasher</a> hasher = connman.<a class="code" href="class_c_connman.html#a70b9c66fa48a69fed984062c5cfda281">GetDeterministicRandomizer</a>(<a class="code" href="net__processing_8cpp.html#ae091b569e78315bb17c4b0c178aeb3b0">RANDOMIZER_ID_ADDRESS_RELAY</a>).<a class="code" href="class_c_sip_hasher.html#ad922bf75073152ed1a02789a63f38559">Write</a>(hashAddr &lt;&lt; 32).<a class="code" href="class_c_sip_hasher.html#ad922bf75073152ed1a02789a63f38559">Write</a>((<a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>() + hashAddr) / (24*60*60));</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="class_fast_random_context.html">FastRandomContext</a> insecure_rand;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    std::array&lt;std::pair&lt;uint64_t, CNode*&gt;,2&gt; best{{{0, <span class="keyword">nullptr</span>}, {0, <span class="keyword">nullptr</span>}}};</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    assert(nRelayNodes &lt;= best.size());</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keyword">auto</span> sortfunc = [&amp;best, &amp;hasher, nRelayNodes](<a class="code" href="class_c_node.html">CNode</a>* pnode) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> (pnode-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt;= <a class="code" href="version_8h.html#a04ad229ffd8c41a83118551a4d395205">CADDR_TIME_VERSION</a>) {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            uint64_t hashKey = <a class="code" href="class_c_sip_hasher.html">CSipHasher</a>(hasher).<a class="code" href="class_c_sip_hasher.html#ad922bf75073152ed1a02789a63f38559">Write</a>(pnode-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>).<a class="code" href="class_c_sip_hasher.html#a9de97ad61ec6ce18ddc94abe1d5fcdf0">Finalize</a>();</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; nRelayNodes; i++) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                <span class="keywordflow">if</span> (hashKey &gt; best[i].first) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                    <a class="code" href="group__algorithm.html#ga97883642477d6b1e8a2b8525fc113758">std::copy</a>(best.begin() + i, best.begin() + nRelayNodes - 1, best.begin() + i + 1);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    best[i] = std::make_pair(hashKey, pnode);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    };</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keyword">auto</span> pushfunc = [&amp;addr, &amp;best, nRelayNodes, &amp;insecure_rand] {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; nRelayNodes &amp;&amp; best[i].first != 0; i++) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            best[i].second-&gt;PushAddress(addr, insecure_rand);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    };</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    connman.<a class="code" href="class_c_connman.html#a9b7efcca91a687285efcbad17523e0bf">ForEachNodeThen</a>(std::move(sortfunc), std::move(pushfunc));</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;}</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591"> 1017</a></span>&#160;<span class="keywordtype">void</span> <span class="keyword">static</span> <a class="code" href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591">ProcessGetData</a>(<a class="code" href="class_c_node.html">CNode</a>* pfrom, <span class="keyword">const</span> <a class="code" href="struct_consensus_1_1_params.html">Consensus::Params</a>&amp; consensusParams, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman, <span class="keyword">const</span> std::atomic&lt;bool&gt;&amp; interruptMsgProc)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;{</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    std::deque&lt;CInv&gt;::iterator it = pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.begin();</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    std::vector&lt;CInv&gt; vNotFound;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a> msgMaker(pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">while</span> (it != pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.end()) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment">// Don&#39;t bother if send buffer is too full to respond anyway</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a73b323f9e310e3054d909934b37ae671">fPauseSend</a>)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_inv.html">CInv</a> &amp;inv = *it;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessGetData -- inv = %s\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>());</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="keywordflow">if</span> (interruptMsgProc)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            it++;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a> || inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33">MSG_FILTERED_BLOCK</a> || inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc">MSG_CMPCT_BLOCK</a>)</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                <span class="keywordtype">bool</span> send = <span class="keyword">false</span>;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                <span class="keywordflow">if</span> (mi != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end())</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    <span class="keywordflow">if</span> (mi-&gt;second-&gt;nChainTx &amp;&amp; !mi-&gt;second-&gt;IsValid(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada47b28fca76b64d094ddca0a3aa8da230">BLOCK_VALID_SCRIPTS</a>) &amp;&amp;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                            mi-&gt;second-&gt;IsValid(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573">BLOCK_VALID_TREE</a>)) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                        <span class="comment">// If we have the block and all of its parents, but have not yet validated it,</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                        <span class="comment">// we might be in the middle of connecting it (ie in the unlock of cs_main</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                        <span class="comment">// before ActivateBestChain but after AcceptBlock).</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                        <span class="comment">// In this case, we need to run ActivateBestChain prior to checking the relay</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                        <span class="comment">// conditions below.</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                        std::shared_ptr&lt;const CBlock&gt; a_recent_block;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                        {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                            a_recent_block = <a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                        }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                        <a class="code" href="class_c_validation_state.html">CValidationState</a> dummy;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                        <a class="code" href="validation_8cpp.html#a8cfbc84b7aa211f3368d4d3813be276c">ActivateBestChain</a>(dummy, <a class="code" href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a>(), a_recent_block);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#af1786dc229c215dea7f727c11df2c8dc">Contains</a>(mi-&gt;second)) {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                        send = <span class="keyword">true</span>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> nOneMonth = 30 * 24 * 60 * 60;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                        <span class="comment">// To prevent fingerprinting attacks, only send blocks outside of the active</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                        <span class="comment">// chain if they are valid, and no more than a month older (both in time, and in</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                        <span class="comment">// best equivalent proof of work) than the best header chain we know about.</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                        send = mi-&gt;second-&gt;IsValid(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada47b28fca76b64d094ddca0a3aa8da230">BLOCK_VALID_SCRIPTS</a>) &amp;&amp; (<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a> != NULL) &amp;&amp;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                            (<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() - mi-&gt;second-&gt;GetBlockTime() &lt; nOneMonth) &amp;&amp;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                            (<a class="code" href="chain_8cpp.html#abe314b9d901829ab0166322b67cffd70">GetBlockProofEquivalentTime</a>(*<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>, *mi-&gt;second, *<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>, consensusParams) &lt; nOneMonth);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                        <span class="keywordflow">if</span> (!send) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s: ignoring request from peer=%i for old block that isn&#39;t in the main chain\n&quot;</span>, __func__, pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                        }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                    }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                <span class="comment">// disconnect node in case we have reached the outbound limit for serving historical blocks</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                <span class="comment">// never disconnect whitelisted nodes</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> nOneWeek = 7 * 24 * 60 * 60; <span class="comment">// assume &gt; 1 week = historical</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                <span class="keywordflow">if</span> (send &amp;&amp; connman.<a class="code" href="class_c_connman.html#aa12d154df14eef07418a36362d1cb8d7">OutboundTargetReached</a>(<span class="keyword">true</span>) &amp;&amp; ( ((<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a> != NULL) &amp;&amp; (<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() - mi-&gt;second-&gt;GetBlockTime() &gt; nOneWeek)) || inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33">MSG_FILTERED_BLOCK</a>) &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;historical block serving limit reached, disconnect peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                    <span class="comment">//disconnect node</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                    pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                    send = <span class="keyword">false</span>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="comment">// Pruned nodes may have deleted the block, so check whether</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="comment">// it&#39;s available before trying to send.</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                <span class="keywordflow">if</span> (send &amp;&amp; (mi-&gt;second-&gt;nStatus &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a>)) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                    <span class="comment">// Send block from disk</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    <a class="code" href="class_c_block.html">CBlock</a> block;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a578c1df234b05798180f0235d469a5ba">ReadBlockFromDisk</a>(block, (*mi).second, consensusParams))</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                        assert(!<span class="stringliteral">&quot;cannot load block from disk&quot;</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                    <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>)</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a>, block));</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33">MSG_FILTERED_BLOCK</a>)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                    {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                        <span class="keywordtype">bool</span> sendMerkleBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                        <a class="code" href="class_c_merkle_block.html">CMerkleBlock</a> merkleBlock;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                                sendMerkleBlock = <span class="keyword">true</span>;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                                merkleBlock = <a class="code" href="class_c_merkle_block.html">CMerkleBlock</a>(block, *pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                            }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                        }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                        <span class="keywordflow">if</span> (sendMerkleBlock) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ae5af2ea09090341213f7021f7741e929">NetMsgType::MERKLEBLOCK</a>, merkleBlock));</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                            <span class="comment">// CMerkleBlock just contains hashes, so also push any transactions in the block the client did not see</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                            <span class="comment">// This avoids hurting performance by pointlessly requiring a round-trip</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                            <span class="comment">// Note that there is currently no way for a node to request any single transactions we didn&#39;t send here -</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                            <span class="comment">// they must either disconnect and retry or request the full block.</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                            <span class="comment">// Thus, the protocol spec specified allows for us to provide duplicate txn here,</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                            <span class="comment">// however we MUST always provide at least what the remote peer needs</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                            <span class="keyword">typedef</span> std::pair&lt;unsigned int, uint256&gt; PairType;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                            BOOST_FOREACH(PairType&amp; pair, merkleBlock.<a class="code" href="class_c_merkle_block.html#a73bbbdcb5d83588b15461c02d0228999">vMatchedTxn</a>)</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>, *block.<a class="code" href="class_c_block.html#a33fcab2e8b903f5be812c714cee42626">vtx</a>[pair.first]));</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                        }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                        <span class="comment">// else</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                            <span class="comment">// no response</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                    }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc">MSG_CMPCT_BLOCK</a>)</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                    {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                        <span class="comment">// If a peer is asking for old blocks, we&#39;re almost guaranteed</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                        <span class="comment">// they won&#39;t have a useful mempool to match against a compact block,</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                        <span class="comment">// and we don&#39;t feel like constructing the object for them, so</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                        <span class="comment">// instead we respond with the full, non-compact block.</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                         <span class="keywordflow">if</span> (CanDirectFetch(consensusParams) &amp;&amp; mi-&gt;second-&gt;nHeight &gt;= <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#ad4758bc8872ce065a9579f77c3171d40">Height</a>() - <a class="code" href="validation_8h.html#acc576d09fdf7bf11e878a178f15d4a1a">MAX_CMPCTBLOCK_DEPTH</a>) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                            <a class="code" href="class_c_block_header_and_short_tx_i_ds.html">CBlockHeaderAndShortTxIDs</a> cmpctblock(block);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a>, cmpctblock));</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                        } <span class="keywordflow">else</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a>, block));</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                    }</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                    <span class="comment">// Trigger the peer node to send a getblocks request for the next batch of inventory</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                    <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a> == pfrom-&gt;<a class="code" href="class_c_node.html#a1a1c0d94de0197c5c4abf5a8d13364f3">hashContinue</a>)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                    {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                        <span class="comment">// Bypass PushInventory, this must send even if redundant,</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                        <span class="comment">// and we want it right after the last block so they don&#39;t</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                        <span class="comment">// wait for other stuff first.</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                        std::vector&lt;CInv&gt; vInv;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                        vInv.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()));</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                        pfrom-&gt;<a class="code" href="class_c_node.html#a1a1c0d94de0197c5c4abf5a8d13364f3">hashContinue</a>.<a class="code" href="classbase__blob.html#aa340be5328d911272eded433d03f30a3">SetNull</a>();</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            }</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a3da7d96ce51443a1bfe8ce5342d0afbe">IsKnownType</a>())</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            {</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                <span class="comment">// Send stream from relay memory</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                <span class="keywordtype">bool</span> push = <span class="keyword">false</span>;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                <span class="comment">// Only serve MSG_TX from mapRelay.</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                <span class="comment">// Otherwise we may send out a normal TX instead of a IX</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>) {</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    <span class="keyword">auto</span> mi = mapRelay.find(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                    <span class="keywordflow">if</span> (mi != mapRelay.end()) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>, *mi-&gt;second));</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a91ddde2164145c8d4ab033e7b75bbc40">timeLastMempoolReq</a>) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                        <span class="keyword">auto</span> txinfo = <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#acf4bb9f52c40164659f484d45d09ecc4">info</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                        <span class="comment">// To protect privacy, do not answer getdata using the mempool when</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                        <span class="comment">// that TX couldn&#39;t have been INVed in reply to a MEMPOOL request.</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                        <span class="keywordflow">if</span> (txinfo.tx &amp;&amp; txinfo.nTime &lt;= pfrom-&gt;<a class="code" href="class_c_node.html#a91ddde2164145c8d4ab033e7b75bbc40">timeLastMempoolReq</a>) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>, *txinfo.tx));</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                            push = <span class="keyword">true</span>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                        }</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                    }</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a802e4d970385efb01469f48db2cf1e06">MSG_TXLOCK_REQUEST</a>) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                    <a class="code" href="class_c_tx_lock_request.html">CTxLockRequest</a> txLockRequest;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a12b011c3b48d3a3d9a0e71a9e5ed164d">GetTxLockRequest</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, txLockRequest)) {</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a>, txLockRequest));</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                    }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                }</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a9d087eae96b6c836c7eb63693b8b7483">MSG_TXLOCK_VOTE</a>) {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                    <a class="code" href="class_c_tx_lock_vote.html">CTxLockVote</a> vote;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#aa0664a610e280ba5c5630f054e5b7cfd">GetTxLockVote</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, vote)) {</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a8b94e14857fd0ee095d5ebf4e6cb9be4">NetMsgType::TXLOCKVOTE</a>, vote));</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                    }</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                }</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991abacdb1618207a44c1301ae59acf7f5d8">MSG_SPORK</a>) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                    <a class="code" href="class_c_spork_message.html">CSporkMessage</a> <a class="code" href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a>;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="spork_8cpp.html#af6873019c3095ea6b554795e4040395c">sporkManager</a>.<a class="code" href="class_c_spork_manager.html#a9cec53a1eb6335507d5c88a17f293e7f">GetSporkByHash</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, <a class="code" href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a>)) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ae4af19c6d5d69539afe179b84a91cbad">NetMsgType::SPORK</a>, <a class="code" href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a>));</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                    }</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4b07f9302d2d304c1e151bc611d3cd6c">MSG_MASTERNODE_PAYMENT_VOTE</a>) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a>-&gt;<a class="code" href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">IsDeterministicMNsSporkActive</a>()) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a80ea7c9dc244776e5bc55fac7486594c">HasVerifiedPaymentVote</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a52ba4e8bec9f766efd43edac1acf8c9d">NetMsgType::MASTERNODEPAYMENTVOTE</a>, <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a830408cb2635a3e3b4a1c48d1deefb85">mapMasternodePaymentVotes</a>[inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>]));</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                            push = <span class="keyword">true</span>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                        }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                    }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11b49df4769b3e5c303fbb87ef05c96d">MSG_MASTERNODE_PAYMENT_BLOCK</a>) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a>-&gt;<a class="code" href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">IsDeterministicMNsSporkActive</a>()) {</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                        BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="masternode-payments_8cpp.html#aac327e3a251800c22ec67bfa9534c838">cs_mapMasternodeBlocks</a>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                        <span class="keywordflow">if</span> (mi != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() &amp;&amp; <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a6feb2c94183cd649ede84dc38d3ae442">mapMasternodeBlocks</a>.count(mi-&gt;second-&gt;nHeight)) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                            BOOST_FOREACH(<a class="code" href="class_c_masternode_payee.html">CMasternodePayee</a>&amp; payee, <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a6feb2c94183cd649ede84dc38d3ae442">mapMasternodeBlocks</a>[mi-&gt;second-&gt;nHeight].vecPayees) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                std::vector&lt;uint256&gt; vecVoteHashes = payee.<a class="code" href="class_c_masternode_payee.html#af2747237a8d66937df059cf74fcbac92">GetVoteHashes</a>();</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                                BOOST_FOREACH(<a class="code" href="classuint256.html">uint256</a>&amp; hash, vecVoteHashes) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                    <span class="keywordflow">if</span>(<a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a80ea7c9dc244776e5bc55fac7486594c">HasVerifiedPaymentVote</a>(hash)) {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a52ba4e8bec9f766efd43edac1acf8c9d">NetMsgType::MASTERNODEPAYMENTVOTE</a>, <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#a830408cb2635a3e3b4a1c48d1deefb85">mapMasternodePaymentVotes</a>[hash]));</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                    }</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                }</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                            }</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                            push = <span class="keyword">true</span>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                        }</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                    }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a3a28db7deec3a185c981b159a7b235fc">MSG_MASTERNODE_ANNOUNCE</a>) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a>-&gt;<a class="code" href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">IsDeterministicMNsSporkActive</a>()) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#ac5a23d1da696b20b0cd74930d6752e8e">mapSeenMasternodeBroadcast</a>.count(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a22acc167096d6b0ce88c4a09a83988ce">NetMsgType::MNANNOUNCE</a>, <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#ac5a23d1da696b20b0cd74930d6752e8e">mapSeenMasternodeBroadcast</a>[inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>].second));</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                            push = <span class="keyword">true</span>;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                        }</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                    }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a50511d9d8e551a2890f09622d82f13f7">MSG_MASTERNODE_PING</a>) {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a>-&gt;<a class="code" href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">IsDeterministicMNsSporkActive</a>()) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#acdaf36c846ff68fcdc94785d70237141">mapSeenMasternodePing</a>.count(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa5e06959ed73a2a200cce6638102972b">NetMsgType::MNPING</a>, <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#acdaf36c846ff68fcdc94785d70237141">mapSeenMasternodePing</a>[inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>]));</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                            push = <span class="keyword">true</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                        }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                    }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ab7e23cc7eff00496b50b04e9e98f1b85">MSG_DSTX</a>) {</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                    <a class="code" href="class_c_private_send_broadcast_tx.html">CPrivateSendBroadcastTx</a> dstx = <a class="code" href="class_c_private_send.html#a5ca6361baefaecece1640899f918fd8a">CPrivateSend::GetDSTX</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                    <span class="keywordflow">if</span>(dstx) {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a>, dstx));</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                    }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae8208d8fb3855c56c3e5befaeb923fa2">MSG_GOVERNANCE_OBJECT</a>) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessGetData -- MSG_GOVERNANCE_OBJECT: inv = %s\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>());</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                    <a class="code" href="class_c_data_stream.html">CDataStream</a> ss(<a class="code" href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a>, pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                    <span class="keywordtype">bool</span> topush = <span class="keyword">false</span>;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                    {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#a7a205c72456b8abf90143e8425e28f60">HaveObjectForHash</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                            ss.<a class="code" href="class_c_data_stream.html#a5542e71bd7af2ab7cd7be0f381d39cb5">reserve</a>(1000);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                            <span class="keywordflow">if</span>(<a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#a6ec5f16eef458f094696ad59dc8e6f05">SerializeObjectForHash</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, ss)) {</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                topush = <span class="keyword">true</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                            }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        }</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                    }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessGetData -- MSG_GOVERNANCE_OBJECT: topush = %d, inv = %s\n&quot;</span>, topush, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>());</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                    <span class="keywordflow">if</span>(topush) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ab93722c7e784f3a5c110e82eb3c31078">NetMsgType::MNGOVERNANCEOBJECT</a>, ss));</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                    }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                }</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2cb5fe00e73ee666aa3daef76b299251">MSG_GOVERNANCE_OBJECT_VOTE</a>) {</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                    <a class="code" href="class_c_data_stream.html">CDataStream</a> ss(<a class="code" href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a>, pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                    <span class="keywordtype">bool</span> topush = <span class="keyword">false</span>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                    {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#aea859ef7335f27b92e6cb37b30b84b53">HaveVoteForHash</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                            ss.<a class="code" href="class_c_data_stream.html#a5542e71bd7af2ab7cd7be0f381d39cb5">reserve</a>(1000);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                            <span class="keywordflow">if</span>(<a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#a44147b0a9cf22ed16d3411fe119958e0">SerializeVoteForHash</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, ss)) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                topush = <span class="keyword">true</span>;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                            }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                        }</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                    }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                    <span class="keywordflow">if</span>(topush) {</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessGetData -- pushing: inv = %s\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>());</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a4dc585a49c4b1374d2bd49ae4d4569ca">NetMsgType::MNGOVERNANCEOBJECTVOTE</a>, ss));</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                    }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                }</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae2eafa466f6492ab207617288629f23c">MSG_MASTERNODE_VERIFY</a>) {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a18a7b718a7d7a7fbb22f8701b0a0b9df">mapSeenMasternodeVerification</a>.count(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a056ec0899d4010d04c39eaf38cbea56d">NetMsgType::MNVERIFY</a>, <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a18a7b718a7d7a7fbb22f8701b0a0b9df">mapSeenMasternodeVerification</a>[inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>]));</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                    }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                }</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ad5de2518f7a7e23590f870cf0c57a188">MSG_QUORUM_FINAL_COMMITMENT</a>)) {</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                    <a class="code" href="classllmq_1_1_c_final_commitment.html">llmq::CFinalCommitment</a> o;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespacellmq.html#a32533f25ea72d1153af50d680a75434d">llmq::quorumBlockProcessor</a>-&gt;GetMinableCommitmentByHash(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, o)) {</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a0407dddb23706af2320d25a1fb26d4f5">NetMsgType::QFCOMMITMENT</a>, o));</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                    }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2b879124ab9ed92674b4559f5f7e493f">MSG_QUORUM_DUMMY_CONTRIBUTION</a>)) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                    <a class="code" href="classllmq_1_1_c_dummy_contribution.html">llmq::CDummyContribution</a> o;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a>-&gt;GetDummyContribution(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, o)) {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a68df2f22acd8a7d824405c121f6f0708">NetMsgType::QCONTRIB</a>, o));</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                    }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="keywordflow">if</span> (!push &amp;&amp; (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a8bad6026f225abcd25d6598d775a13e2">MSG_QUORUM_DUMMY_COMMITMENT</a>)) {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                    <span class="keywordflow">if</span> (!consensusParams.<a class="code" href="struct_consensus_1_1_params.html#af9b4833ffbbc84640a6264b738202bbd">fLLMQAllowDummyCommitments</a>) {</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                        <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, 100);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                        pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                    }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                    <a class="code" href="classllmq_1_1_c_dummy_commitment.html">llmq::CDummyCommitment</a> o;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a>-&gt;GetDummyCommitment(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>, o)) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a0ae6b5e21db3e4a14210b416eec2b415">NetMsgType::QDCOMMITMENT</a>, o));</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                        push = <span class="keyword">true</span>;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                    }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                <span class="keywordflow">if</span> (!push)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                    vNotFound.push_back(inv);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="comment">// Track requests for our stuff.</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <a class="code" href="validationinterface_8cpp.html#a0aaad62c8654cb1868295e0682b05866">GetMainSignals</a>().<a class="code" href="struct_c_main_signals.html#a2f8f94d91265dc946e97614042698a7b">Inventory</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a> || inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33">MSG_FILTERED_BLOCK</a> || inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc">MSG_CMPCT_BLOCK</a>)</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        }</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    }</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.erase(pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.begin(), it);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">if</span> (!vNotFound.empty()) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="comment">// Let the peer know that we didn&#39;t find what it asked for, so it doesn&#39;t</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="comment">// have to wait around forever. Currently only SPV clients actually care</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="comment">// about this message: it&#39;s needed when they are recursively walking the</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="comment">// dependencies of relevant unconfirmed transactions. SPV clients want to</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="comment">// do that because they want to know about (and store and rebroadcast and</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="comment">// risk analyze) the dependencies of transactions relevant to them, without</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="comment">// having to download the entire memory pool.</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a567653d3f26a7e711889682e7fd1c484">NetMsgType::NOTFOUND</a>, vNotFound));</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    }</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;}</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a4975c8d11415845148babbfd973b34e9"> 1344</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">static</span> <a class="code" href="net__processing_8cpp.html#a4975c8d11415845148babbfd973b34e9">SendBlockTransactions</a>(<span class="keyword">const</span> <a class="code" href="class_c_block.html">CBlock</a>&amp; block, <span class="keyword">const</span> <a class="code" href="class_block_transactions_request.html">BlockTransactionsRequest</a>&amp; req, <a class="code" href="class_c_node.html">CNode</a>* pfrom, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman) {</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="class_block_transactions.html">BlockTransactions</a> resp(req);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; req.<a class="code" href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">indexes</a>.size(); i++) {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <span class="keywordflow">if</span> (req.<a class="code" href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">indexes</a>[i] &gt;= block.<a class="code" href="class_c_block.html#a33fcab2e8b903f5be812c714cee42626">vtx</a>.size()) {</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer %d sent us a getblocktxn with out-of-bounds tx indices&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        }</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        resp.<a class="code" href="class_block_transactions.html#a1a88870022bf6c5d7522689c961fc570">txn</a>[i] = block.<a class="code" href="class_c_block.html#a33fcab2e8b903f5be812c714cee42626">vtx</a>[req.<a class="code" href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">indexes</a>[i]];</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a> msgMaker(pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ac23245c939bfe57d37c0a2db68e05e05">NetMsgType::BLOCKTXN</a>, resp));</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462"> 1360</a></span>&#160;<span class="keywordtype">bool</span> <span class="keyword">static</span> <a class="code" href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462">ProcessMessage</a>(<a class="code" href="class_c_node.html">CNode</a>* pfrom, <span class="keyword">const</span> std::string&amp; strCommand, <a class="code" href="class_c_data_stream.html">CDataStream</a>&amp; vRecv, int64_t nTimeReceived, <span class="keyword">const</span> <a class="code" href="class_c_chain_params.html">CChainParams</a>&amp; chainparams, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman, <span class="keyword">const</span> std::atomic&lt;bool&gt;&amp; interruptMsgProc)</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;{</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received: %s (%u bytes) peer=%d\n&quot;</span>, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), vRecv.<a class="code" href="class_c_data_stream.html#add30f866dd928fc28c47fe79a0a6723a">size</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#ad38f2be538d80fba8e091c64d42405a8">IsArgSet</a>(<span class="stringliteral">&quot;-dropmessagestest&quot;</span>) &amp;&amp; <a class="code" href="random_8cpp.html#a27d9149d522b1fa87d84e5e9ca902aef">GetRand</a>(<a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-dropmessagestest&quot;</span>, 0)) == 0)</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;dropmessagestest DROPPING RECV MESSAGE\n&quot;</span>);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    }</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="comment">// BEGIN TEMPORARY CODE</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keywordtype">bool</span> fDIP0003Active;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        fDIP0003Active = <a class="code" href="versionbits_8cpp.html#a90d3b0a121694c9559dddcdd848757be">VersionBitsState</a>(<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>(), chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>(), <a class="code" href="namespace_consensus.html#ac6c2c4d710cea840f692c6312ec91f69ab2f4dbe4dc6c4d3196697fe29fbb301b">Consensus::DEPLOYMENT_DIP0003</a>, <a class="code" href="validation_8cpp.html#a32c4ae3ae181d8510133629460c2bf20">versionbitscache</a>) == <a class="code" href="versionbits_8h.html#ae7f620361ae33b80687a42adb26fd7a4a5910acba5d13493df2ee6c994c89b098">THRESHOLD_ACTIVE</a>;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="comment">// TODO delete this in next release after v13</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordtype">int</span> nMinPeerProtoVersion = <a class="code" href="version_8h.html#a7ef2601209957b98b7cc1a186f8e6e62">MIN_PEER_PROTO_VERSION</a>;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span> (fDIP0003Active) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        nMinPeerProtoVersion = <a class="code" href="version_8h.html#a943e862a09cbbc7c60e94c4a946fb4d5">MIN_PEER_PROTO_VERSION_DIP3</a>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="comment">// END TEMPORARY CODE</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">if</span> (!(pfrom-&gt;<a class="code" href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">GetLocalServices</a>() &amp; <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9ca74e44e29a412c070750bdbf2380bb">NODE_BLOOM</a>) &amp;&amp;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;              (strCommand == <a class="code" href="namespace_net_msg_type.html#a0e95085c85cbbb8330fa1a5ffe49070f">NetMsgType::FILTERLOAD</a> ||</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;               strCommand == <a class="code" href="namespace_net_msg_type.html#a75c8dba2361ddda663917c27f14c3a16">NetMsgType::FILTERADD</a>))</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    {</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt;= <a class="code" href="version_8h.html#a262584ad779f848883e0cc89ef2781f8">NO_BLOOM_VERSION</a>) {</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>)</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    {</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        std::string strMsg; <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ccode; std::string strReason;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <a class="code" href="classuint256.html">uint256</a> hash;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            vRecv &gt;&gt; <a class="code" href="serialize_8h.html#a78e63691a056ce2368984400605e4f6e">LIMITED_STRING</a>(strMsg, <a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3a8c1bfc0fa6a63c8b73abef30555a5e54">CMessageHeader::COMMAND_SIZE</a>) &gt;&gt; ccode &gt;&gt; <a class="code" href="serialize_8h.html#a78e63691a056ce2368984400605e4f6e">LIMITED_STRING</a>(strReason, <a class="code" href="validation_8h.html#af83a9cbb7b3fe9d34a7c4b43f2e040f8">MAX_REJECT_MESSAGE_LENGTH</a>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;            <span class="keywordflow">if</span> (strMsg == <a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a> || strMsg == <a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>) {</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                vRecv &gt;&gt; hash;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::ios_base::failure&amp;) {</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <span class="comment">// Avoid feedback loops by preventing reject messages from triggering a new reject message.</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Unparseable reject message received\n&quot;</span>);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        }</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="keywordflow">if</span> (strMsg == <a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a>) {</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            <span class="comment">// The node requested a block from us and then rejected it, which indicates that it&#39;s most likely running</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            <span class="comment">// on rules which are incompatible to ours. Better to ban him after some time as it might otherwise keep</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            <span class="comment">// asking for the same block (if -addnode/-connect was used on the other side).</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, 1);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a2ba7badc843121dde40a6f109d224a42">fDebug</a>) {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            std::ostringstream ss;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            ss &lt;&lt; strMsg &lt;&lt; <span class="stringliteral">&quot; code &quot;</span> &lt;&lt; <a class="code" href="utilstrencodings_8cpp.html#a565b3ea015b133d01dc52b4ec6e45f07">itostr</a>(ccode) &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; strReason;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            <span class="keywordflow">if</span> (strMsg == <a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a> || strMsg == <a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;: hash &quot;</span> &lt;&lt; hash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>();</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;            }</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Reject %s\n&quot;</span>, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(ss.str()));</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        }</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a79d16fca661ece8c17e786943721fd34">NetMsgType::VERSION</a>)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        <span class="comment">// Each connection can only send one version message</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> != 0)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, <a class="code" href="consensus_2validation_8h.html#aae810f65f020df86be128d0c026edf44">REJECT_DUPLICATE</a>, std::string(<span class="stringliteral">&quot;Duplicate version message&quot;</span>)));</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 1);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        }</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        int64_t nTime;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <a class="code" href="class_c_address.html">CAddress</a> addrMe;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <a class="code" href="class_c_address.html">CAddress</a> addrFrom;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        uint64_t nNonce = 1;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        uint64_t nServiceInt;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537">ServiceFlags</a> nServices;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="keywordtype">int</span> nVersion;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="keywordtype">int</span> nSendVersion;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        std::string strSubVer;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        std::string cleanSubVer;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="keywordtype">int</span> nStartingHeight = -1;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <span class="keywordtype">bool</span> fRelay = <span class="keyword">true</span>;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        vRecv &gt;&gt; nVersion &gt;&gt; nServiceInt &gt;&gt; nTime &gt;&gt; addrMe;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        nSendVersion = std::min(nVersion, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        nServices = <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537">ServiceFlags</a>(nServiceInt);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        {</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            connman.<a class="code" href="class_c_connman.html#a46915b82dd2183baf2944d74d88a4228">SetServices</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>, nServices);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a395e2ead02225f29423e211aa2108272">nServicesExpected</a> &amp; ~nServices)</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        {</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;peer=%d does not offer the expected services (%08x offered, %08x expected); disconnecting\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, nServices, pfrom-&gt;<a class="code" href="class_c_node.html#a395e2ead02225f29423e211aa2108272">nServicesExpected</a>);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, <a class="code" href="consensus_2validation_8h.html#aaebbd8495fbce589cdf05570198c4240">REJECT_NONSTANDARD</a>,</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                               <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Expected to offer services %08x&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#a395e2ead02225f29423e211aa2108272">nServicesExpected</a>)));</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">if</span> (nVersion &lt; nMinPeerProtoVersion)</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        {</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            <span class="comment">// disconnect from peers older than this proto version</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;peer=%d using obsolete version %i; disconnecting\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, nVersion);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, <a class="code" href="consensus_2validation_8h.html#a33438febc90b2b44c11530b8207d2e0f">REJECT_OBSOLETE</a>,</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                               <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Version must be %d or greater&quot;</span>, nMinPeerProtoVersion)));</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <span class="keywordflow">if</span> (nVersion == 10300)</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            nVersion = 300;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        <span class="keywordflow">if</span> (!vRecv.<a class="code" href="class_c_data_stream.html#ab2633ac67f098dad30d03291741c2e42">empty</a>())</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            vRecv &gt;&gt; addrFrom &gt;&gt; nNonce;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">if</span> (!vRecv.<a class="code" href="class_c_data_stream.html#ab2633ac67f098dad30d03291741c2e42">empty</a>()) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            vRecv &gt;&gt; <a class="code" href="serialize_8h.html#a78e63691a056ce2368984400605e4f6e">LIMITED_STRING</a>(strSubVer, <a class="code" href="net_8h.html#a2f02122aa15cdc5ac394b010f97422e9">MAX_SUBVERSION_LENGTH</a>);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            cleanSubVer = <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strSubVer);</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        }</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <span class="keywordflow">if</span> (!vRecv.<a class="code" href="class_c_data_stream.html#ab2633ac67f098dad30d03291741c2e42">empty</a>()) {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            vRecv &gt;&gt; nStartingHeight;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <span class="keywordflow">if</span> (!vRecv.<a class="code" href="class_c_data_stream.html#ab2633ac67f098dad30d03291741c2e42">empty</a>())</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            vRecv &gt;&gt; fRelay;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="comment">// Disconnect if we connected to ourself</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a> &amp;&amp; !connman.<a class="code" href="class_c_connman.html#ac95687bc3457cbc25a78abcc2a5cc7fc">CheckIncomingNonce</a>(nNonce))</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        {</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;connected to self at %s, disconnecting\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a> &amp;&amp; addrMe.IsRoutable())</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            <a class="code" href="net_8cpp.html#af7487aacfc9d708b3db40c255ec070a8">SeenLocal</a>(addrMe);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        }</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="comment">// Be shy and don&#39;t send version until we hear</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            PushNodeVersion(pfrom, connman, <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>());</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a>().NetworkIDString() == <a class="code" href="class_c_base_chain_params.html#a86abcc91bfa683e47bb113e32ff86dec">CBaseChainParams::DEVNET</a>) {</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            <span class="keywordflow">if</span> (strSubVer.find(<a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;devnet=%s&quot;</span>, <a class="code" href="chainparamsbase_8cpp.html#ac7acb12410650d8f8d037c850d98e764">GetDevNetName</a>())) == std::string::npos) {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;connected to wrong devnet. Reported version is %s, expected devnet name is %s\n&quot;</span>, strSubVer, <a class="code" href="chainparamsbase_8cpp.html#ac7acb12410650d8f8d037c850d98e764">GetDevNetName</a>());</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>)</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100); <span class="comment">// don&#39;t try to connect again</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 1); <span class="comment">// whover connected, might just have made a mistake, don&#39;t ban him immediately</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#aaf8228cc7b3374862bcb3d79f5ff38e6">NetMsgType::VERACK</a>));</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a3d311ea99f2524e5c2cdb9a311725b9f">nServices</a> = nServices;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a331888bc15bb49775451d951735e4b6a">SetAddrLocal</a>(addrMe);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        {</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#acf48a43182292a6636c9de3ea7453d72">cs_SubVer</a>);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#afb24fb33019af5c4085412fe3898cf01">strSubVer</a> = strSubVer;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a05f0401427c5ffebd1ca404848e83ff7">cleanSubVer</a> = cleanSubVer;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a> = nStartingHeight;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a721e2470c2c961b7599768a14be68781">fClient</a> = !(nServices &amp; <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9d1154f0e7e56f183a5c8373abe2e86c">NODE_NETWORK</a>);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        {</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#ab387bb0c4ffd42e3f0aea233dca0e301">fRelayTxes</a> = fRelay; <span class="comment">// set to true after we get the first filter* message</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        }</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="comment">// Change version</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a0a55cea2748b1837610b2caed8069a90">SetSendVersion</a>(nSendVersion);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> = nVersion;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="comment">// Potentially mark this peer as a preferred download peer.</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        {</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        UpdatePreferredDownload(pfrom, State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>()));</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        }</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>)</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        {</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <span class="comment">// Advertise our address</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="net_8cpp.html#a5067f8b9215406011fa3461be92d819c">fListen</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>())</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                <a class="code" href="class_c_address.html">CAddress</a> addr = <a class="code" href="net_8cpp.html#a01304c8caa7997b48da307d19d1d284a">GetLocalAddress</a>(&amp;pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>, pfrom-&gt;<a class="code" href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">GetLocalServices</a>());</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                <a class="code" href="class_fast_random_context.html">FastRandomContext</a> insecure_rand;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                <span class="keywordflow">if</span> (addr.<a class="code" href="class_c_net_addr.html#a4e3b2fea2a6151c76684b3812df4a5c3">IsRoutable</a>())</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                {</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessMessages: advertising address %s\n&quot;</span>, addr.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                    pfrom-&gt;<a class="code" href="class_c_node.html#a1f39037c55bed93b832bcbef00597ca5">PushAddress</a>(addr, insecure_rand);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="net_8cpp.html#a058b75c6fcc94a0643184c237ad6de93">IsPeerAddrLocalGood</a>(pfrom)) {</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                    addr.<a class="code" href="class_c_net_addr.html#a1c6087345e5ca07a151451cd6deb974f">SetIP</a>(addrMe);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ProcessMessages: advertising address %s\n&quot;</span>, addr.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                    pfrom-&gt;<a class="code" href="class_c_node.html#a1f39037c55bed93b832bcbef00597ca5">PushAddress</a>(addr, insecure_rand);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                }</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            }</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            <span class="comment">// Get recent addresses</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">fOneShot</a> || pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt;= <a class="code" href="version_8h.html#a04ad229ffd8c41a83118551a4d395205">CADDR_TIME_VERSION</a> || connman.<a class="code" href="class_c_connman.html#a47a0fe62e6fb1008c77f3b2150214213">GetAddressCount</a>() &lt; 1000)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            {</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(nSendVersion).Make(<a class="code" href="namespace_net_msg_type.html#a4d0f984b71f9e4c4b8b3619cb3f3dadd">NetMsgType::GETADDR</a>));</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#a3da9c559959e182aff8439cd004ff624">fGetAddr</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            }</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            connman.<a class="code" href="class_c_connman.html#a85dedb235a648a1b8370228ba62ebacb">MarkAddressGood</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        }</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <span class="comment">// Relay alerts</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="alert_8cpp.html#a1d336334e6e9fb3e9e0ed1e0ea5688e9">cs_mapAlerts</a>);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            BOOST_FOREACH(<a class="code" href="utilstrencodings_8h.html#aa3052ab82a2ba880ea3e30b3357c8820">PAIRTYPE</a>(<span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>, <a class="code" href="class_c_alert.html">CAlert</a>)&amp; item, <a class="code" href="alert_8cpp.html#a1ee205b1ff06953bc1e60c9f98752999">mapAlerts</a>)</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                item.second.<a class="code" href="class_c_alert.html#a9d582022603b03d52731e2a1427f6355">RelayTo</a>(pfrom, connman);</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        }</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        std::string remoteAddr;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a8e02420c2f7c53579ccb90acf301ae75">fLogIPs</a>)</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            remoteAddr = <span class="stringliteral">&quot;, peeraddr=&quot;</span> + pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>();</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;receive version message: %s: version %d, blocks=%d, us=%s, peer=%d%s\n&quot;</span>,</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                  cleanSubVer, pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a>,</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                  pfrom-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a>, addrMe.ToString(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>,</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                  remoteAddr);</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        int64_t <a class="code" href="timedata_8cpp.html#af9b8f3d7f6fc349e8c8fffb2733896c5">nTimeOffset</a> = nTime - <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a1ab8dcaa79a208ee8b9ce58587b206af">nTimeOffset</a> = <a class="code" href="timedata_8cpp.html#af9b8f3d7f6fc349e8c8fffb2733896c5">nTimeOffset</a>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <a class="code" href="timedata_8cpp.html#ac2624434f4891e8d74f9b13ec91f95d2">AddTimeData</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>, <a class="code" href="timedata_8cpp.html#af9b8f3d7f6fc349e8c8fffb2733896c5">nTimeOffset</a>);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="comment">// Feeler connections exist only to verify if address is online.</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a25c9b62c42159cc94c6e8ede9ad0ed9d">fFeeler</a>) {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;            assert(pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a> == <span class="keyword">false</span>);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    }</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> == 0)</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="comment">// Must have a version message before anything else</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 1);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    }</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="comment">// At this point, the outgoing message serialization version can&#39;t change.</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a> msgMaker(pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="comment">// BEGIN TEMPORARY CODE</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &lt; nMinPeerProtoVersion) {</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="comment">// disconnect from peers with version &lt; 70213 after DIP3 has activated through the BIP9 deployment</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;peer=%d using obsolete version %i after DIP3 activation; disconnecting\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, pfrom-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, <a class="code" href="consensus_2validation_8h.html#a33438febc90b2b44c11530b8207d2e0f">REJECT_OBSOLETE</a>,</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Version must be %d or greater&quot;</span>, nMinPeerProtoVersion)));</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    }</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="comment">// END TEMPORARY CODE</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#aaf8228cc7b3374862bcb3d79f5ff38e6">NetMsgType::VERACK</a>)</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    {</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a94438c6285d1635c62ccff10593780e6">SetRecvVersion</a>(std::min(pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a>.load(), <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>));</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            <span class="comment">// Mark this node as currently connected, so we update its timestamp later.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())-&gt;fCurrentlyConnected = <span class="keyword">true</span>;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        }</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt;= <a class="code" href="version_8h.html#a4e18717137ea36916ec24018040cf954">SENDHEADERS_VERSION</a>) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="comment">// Tell our peer we prefer to receive headers rather than inv&#39;s</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="comment">// We send this to non-NODE NETWORK peers as well, because even</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <span class="comment">// non-NODE NETWORK peers can announce blocks (such as pruning</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            <span class="comment">// nodes)</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a34f999f9e5179be5fc361aaca9c0e5b3">NetMsgType::SENDHEADERS</a>));</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        }</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt;= <a class="code" href="version_8h.html#a43420c87666449f8132e21687abcfda9">SHORT_IDS_BLOCKS_VERSION</a>) {</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            <span class="comment">// Tell our peer we are willing to provide version-1 cmpctblocks</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <span class="comment">// However, we do not request new block announcements using</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            <span class="comment">// cmpctblock messages.</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="comment">// We send this to non-NODE NETWORK peers as well, because</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            <span class="comment">// they may wish to request compact blocks from us</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="keywordtype">bool</span> fAnnounceUsingCMPCTBLOCK = <span class="keyword">false</span>;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            uint64_t nCMPCTBLOCKVersion = 1;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a4cdafba4d585b4699628412c7f1c3d8b">NetMsgType::SENDCMPCT</a>, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        }</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a359647a8e7ad1fc72243b126b35729b6">fSuccessfullyConnected</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    }</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#a359647a8e7ad1fc72243b126b35729b6">fSuccessfullyConnected</a>)</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="comment">// Must have a verack message before anything else</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 1);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a77d83bbf95702906ee01ca4fd934e1c0">NetMsgType::ADDR</a>)</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    {</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        std::vector&lt;CAddress&gt; vAddr;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        vRecv &gt;&gt; vAddr;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="comment">// Don&#39;t want addr from older versions unless seeding</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &lt; <a class="code" href="version_8h.html#a04ad229ffd8c41a83118551a4d395205">CADDR_TIME_VERSION</a> &amp;&amp; connman.<a class="code" href="class_c_connman.html#a47a0fe62e6fb1008c77f3b2150214213">GetAddressCount</a>() &gt; 1000)</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="keywordflow">if</span> (vAddr.size() &gt; 1000)</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        {</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;message addr size() = %u&quot;</span>, vAddr.size());</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="comment">// Store the new addresses</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        std::vector&lt;CAddress&gt; vAddrOk;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        int64_t nNow = <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>();</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        int64_t nSince = nNow - 10 * 60;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        BOOST_FOREACH(<a class="code" href="class_c_address.html">CAddress</a>&amp; addr, vAddr)</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        {</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            <span class="keywordflow">if</span> (interruptMsgProc)</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="keywordflow">if</span> ((addr.<a class="code" href="class_c_address.html#a24e2309d92694a5a234751634bdf0458">nServices</a> &amp; <a class="code" href="net_8h.html#a99a450f0d7268ee95f310f2b78be3370">REQUIRED_SERVICES</a>) != <a class="code" href="net_8h.html#a99a450f0d7268ee95f310f2b78be3370">REQUIRED_SERVICES</a>)</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            <span class="keywordflow">if</span> (addr.<a class="code" href="class_c_address.html#ac1c44aac968b11f90ce529b133ae4e9b">nTime</a> &lt;= 100000000 || addr.<a class="code" href="class_c_address.html#ac1c44aac968b11f90ce529b133ae4e9b">nTime</a> &gt; nNow + 10 * 60)</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                addr.<a class="code" href="class_c_address.html#ac1c44aac968b11f90ce529b133ae4e9b">nTime</a> = nNow - 5 * 24 * 60 * 60;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a923c9640a28f97cf9c23a21ae8e13c97">AddAddressKnown</a>(addr);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            <span class="keywordtype">bool</span> fReachable = <a class="code" href="net_8cpp.html#af6de8e47b01a96206402ddef734114f2">IsReachable</a>(addr);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            <span class="keywordflow">if</span> (addr.<a class="code" href="class_c_address.html#ac1c44aac968b11f90ce529b133ae4e9b">nTime</a> &gt; nSince &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#a3da9c559959e182aff8439cd004ff624">fGetAddr</a> &amp;&amp; vAddr.size() &lt;= 10 &amp;&amp; addr.<a class="code" href="class_c_net_addr.html#a4e3b2fea2a6151c76684b3812df4a5c3">IsRoutable</a>())</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            {</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                <a class="code" href="net__processing_8cpp.html#a5de6345878869c44bb12d104fecd55d1">RelayAddress</a>(addr, fReachable, connman);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            }</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            <span class="comment">// Do not store addresses outside our network</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <span class="keywordflow">if</span> (fReachable)</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                vAddrOk.push_back(addr);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        }</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        connman.<a class="code" href="class_c_connman.html#a47d9024273a8c421fa7de641c30e9081">AddNewAddresses</a>(vAddrOk, pfrom-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>, 2 * 60 * 60);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <span class="keywordflow">if</span> (vAddr.size() &lt; 1000)</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a3da9c559959e182aff8439cd004ff624">fGetAddr</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        if (pfrom-&gt;<a class="code" href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">fOneShot</a>)</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    }</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a34f999f9e5179be5fc361aaca9c0e5b3">NetMsgType::SENDHEADERS</a>)</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())-&gt;fPreferHeaders = <span class="keyword">true</span>;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    }</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a4cdafba4d585b4699628412c7f1c3d8b">NetMsgType::SENDCMPCT</a>)</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    {</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordtype">bool</span> fAnnounceUsingCMPCTBLOCK = <span class="keyword">false</span>;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        uint64_t nCMPCTBLOCKVersion = 1;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        vRecv &gt;&gt; fAnnounceUsingCMPCTBLOCK &gt;&gt; nCMPCTBLOCKVersion;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="keywordflow">if</span> (nCMPCTBLOCKVersion == 1) {</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())-&gt;fProvidesHeaderAndIDs = <span class="keyword">true</span>;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())-&gt;fPreferHeaderAndIDs = fAnnounceUsingCMPCTBLOCK;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())-&gt;fSupportsDesiredCmpctVersion = <span class="keyword">true</span>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        }</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>)</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    {</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        std::vector&lt;CInv&gt; vInv;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        vRecv &gt;&gt; vInv;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="keywordflow">if</span> (vInv.size() &gt; <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>)</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        {</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;message inv size() = %u&quot;</span>, vInv.size());</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        }</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordtype">bool</span> fBlocksOnly = !<a class="code" href="net_8cpp.html#a7935254c613d6f3cdadd3ce45f7efbff">fRelayTxes</a>;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="comment">// Allow whitelisted peers to send data other than blocks in blocks only mode if whitelistrelay is true</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a> &amp;&amp; <a class="code" href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a>(<span class="stringliteral">&quot;-whitelistrelay&quot;</span>, <a class="code" href="validation_8h.html#a5289ed91f1daf187bba005dd54d62649">DEFAULT_WHITELISTRELAY</a>))</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            fBlocksOnly = <span class="keyword">false</span>;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nInv = 0; nInv &lt; vInv.size(); nInv++)</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_c_inv.html">CInv</a> &amp;inv = vInv[nInv];</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;            <span class="keywordflow">if</span>(!inv.<a class="code" href="class_c_inv.html#a3da7d96ce51443a1bfe8ce5342d0afbe">IsKnownType</a>()) {</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;got inv of unknown type %d: %s peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a>, inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            }</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            <span class="keywordflow">if</span> (interruptMsgProc)</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <span class="keywordtype">bool</span> fAlreadyHave = <a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(inv);</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;got inv: %s  %s peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>(), fAlreadyHave ? <span class="stringliteral">&quot;have&quot;</span> : <span class="stringliteral">&quot;new&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <span class="keywordflow">if</span> (inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> == <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>) {</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                UpdateBlockAvailability(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                <span class="keywordflow">if</span> (fAlreadyHave || <a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> || <a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a> || mapBlocksInFlight.count(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>)) {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                }</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                CNodeState *state = State(pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                <span class="keywordflow">if</span> (!state) {</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                }</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                <span class="comment">// Download if this is a nice peer, or we have no nice peers and this one might do.</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                <span class="keywordtype">bool</span> fFetch = state-&gt;fPreferredDownload || (nPreferredDownload == 0 &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">fOneShot</a>);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                <span class="comment">// Only actively request headers from a single peer, unless we&#39;re close to end of initial download.</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                <span class="keywordflow">if</span> ((nSyncStarted == 0 &amp;&amp; fFetch) || <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() &gt; <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - <a class="code" href="validation_8cpp.html#af66174e55ad9bafa7a92e4740db6b575">nMaxTipAge</a>) {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                    <span class="comment">// Make sure to mark this peer as the one we are currently syncing with etc.</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                    state-&gt;fSyncStarted = <span class="keyword">true</span>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                    state-&gt;nHeadersSyncTimeout = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>() + <a class="code" href="net__processing_8h.html#a09ba6681dd87e0136d25acc054a335a0">HEADERS_DOWNLOAD_TIMEOUT_BASE</a> + <a class="code" href="net__processing_8h.html#a8a4d3867ceb626ccda62b3b728425d07">HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER</a> * (<a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>())/(chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>().<a class="code" href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">nPowTargetSpacing</a>);</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                    nSyncStarted++;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                    <span class="comment">// We used to request the full block here, but since headers-announcements are now the</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                    <span class="comment">// primary method of announcement on the network, and since, in the case that a node</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                    <span class="comment">// fell back to inv we probably have a reorg which we should get the headers for first,</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                    <span class="comment">// we now only provide a getheaders response here. When we receive the headers, we will</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                    <span class="comment">// then ask for the blocks we need.</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">GetLocator</a>(<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>), inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>));</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;getheaders (%d) %s to peer=%d\n&quot;</span>, <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                }</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            }</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            {</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                <span class="keyword">static</span> std::set&lt;int&gt; legacyMNObjs = {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4b07f9302d2d304c1e151bc611d3cd6c">MSG_MASTERNODE_PAYMENT_VOTE</a>,</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11b49df4769b3e5c303fbb87ef05c96d">MSG_MASTERNODE_PAYMENT_BLOCK</a>,</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a3a28db7deec3a185c981b159a7b235fc">MSG_MASTERNODE_ANNOUNCE</a>,</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a50511d9d8e551a2890f09622d82f13f7">MSG_MASTERNODE_PING</a>,</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae2eafa466f6492ab207617288629f23c">MSG_MASTERNODE_VERIFY</a>,</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                };</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                <span class="keyword">static</span> std::set&lt;int&gt; allowWhileInIBDObjs = {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                        <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991abacdb1618207a44c1301ae59acf7f5d8">MSG_SPORK</a></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                };</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                <span class="keywordflow">if</span> (legacyMNObjs.count(inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a>) &amp;&amp; <a class="code" href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a>-&gt;<a class="code" href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">IsDeterministicMNsSporkActive</a>()) {</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;ignoring (%s) inv of legacy type %d peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#ac3054eb6ade84e8968f032ce3e700f6a">AddInventoryKnown</a>(inv);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                <span class="keywordflow">if</span> (fBlocksOnly) {</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;transaction (%s) inv sent in violation of protocol peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                             pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fAlreadyHave) {</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                    <span class="keywordtype">bool</span> allowWhileInIBD = allowWhileInIBDObjs.count(inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a>);</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                    <span class="keywordflow">if</span> (allowWhileInIBD || (!<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>())) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                        pfrom-&gt;<a class="code" href="class_c_node.html#ae0def1498409407d1612833a7d38c875">AskFor</a>(inv);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                    }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                }</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            }</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            <span class="comment">// Track requests for our stuff</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            <a class="code" href="validationinterface_8cpp.html#a0aaad62c8654cb1868295e0682b05866">GetMainSignals</a>().<a class="code" href="struct_c_main_signals.html#a2f8f94d91265dc946e97614042698a7b">Inventory</a>(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    }</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>)</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    {</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        std::vector&lt;CInv&gt; vInv;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        vRecv &gt;&gt; vInv;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="keywordflow">if</span> (vInv.size() &gt; <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>)</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        {</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;message getdata size() = %u&quot;</span>, vInv.size());</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="util_8cpp.html#a2ba7badc843121dde40a6f109d224a42">fDebug</a> || (vInv.size() != 1))</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received getdata (%u invsz) peer=%d\n&quot;</span>, vInv.size(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="util_8cpp.html#a2ba7badc843121dde40a6f109d224a42">fDebug</a> &amp;&amp; vInv.size() &gt; 0) || (vInv.size() == 1))</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received getdata for: %s peer=%d\n&quot;</span>, vInv[0].ToString(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.insert(pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.end(), vInv.begin(), vInv.end());</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <a class="code" href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591">ProcessGetData</a>(pfrom, chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>(), connman, interruptMsgProc);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    }</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a7a51f1ef81fa21178b6e241937934fed">NetMsgType::GETBLOCKS</a>)</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    {</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <a class="code" href="struct_c_block_locator.html">CBlockLocator</a> locator;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <a class="code" href="classuint256.html">uint256</a> hashStop;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        vRecv &gt;&gt; locator &gt;&gt; hashStop;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="comment">// We might have announced the currently-being-connected tip using a</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="comment">// compact block, which resulted in the peer sending a getblocks</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <span class="comment">// request, which we would otherwise respond to without the new block.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="comment">// To avoid this situation we simply verify that we are on our best</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="comment">// known chain now. This is super overkill, but we handle it better</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="comment">// for getheaders requests, and there are no known nodes which support</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="comment">// compact blocks but still use getblocks to request blocks.</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        {</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            std::shared_ptr&lt;const CBlock&gt; a_recent_block;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            {</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>);</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                a_recent_block = <a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            }</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            <a class="code" href="class_c_validation_state.html">CValidationState</a> dummy;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;            <a class="code" href="validation_8cpp.html#a8cfbc84b7aa211f3368d4d3813be276c">ActivateBestChain</a>(dummy, <a class="code" href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a>(), a_recent_block);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        }</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="comment">// Find the last block the caller has in the main chain</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex = <a class="code" href="validation_8cpp.html#af43d57aa8b46a53839777e8b670c9d66">FindForkInGlobalIndex</a>(<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>, locator);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="comment">// Send the rest of the chain</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="keywordflow">if</span> (pindex)</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            pindex = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a3077e83c87e8a974765fa76a57fd040b">Next</a>(pindex);</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="keywordtype">int</span> nLimit = 500;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;getblocks %d to %s limit %d from peer=%d\n&quot;</span>, (pindex ? pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> : -1), hashStop.IsNull() ? <span class="stringliteral">&quot;end&quot;</span> : hashStop.ToString(), nLimit, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">for</span> (; pindex; pindex = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a3077e83c87e8a974765fa76a57fd040b">Next</a>(pindex))</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        {</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>() == hashStop)</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;            {</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;  getblocks stopping at %d %s\n&quot;</span>, pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            }</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            <span class="comment">// If pruning, don&#39;t inv blocks unless we have on disk and are likely to still have</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            <span class="comment">// for some reasonable time window (1 hour) that block relay might require.</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> nPrunedBlocksLikelyToHave = <a class="code" href="validation_8h.html#a5caf4122a735df55a443242fa5ccb5cf">MIN_BLOCKS_TO_KEEP</a> - 3600 / chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>().<a class="code" href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">nPowTargetSpacing</a>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#ab3d3252ad7773f86035217d3a08f16ba">fPruneMode</a> &amp;&amp; (!(pindex-&gt;<a class="code" href="class_c_block_index.html#ac5a336b45ca70e3ed2fc090bf2ee3011">nStatus</a> &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a>) || pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &lt;= <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> - nPrunedBlocksLikelyToHave))</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            {</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot; getblocks stopping, pruned or too old block at %d %s\n&quot;</span>, pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            }</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a7cef2333aa8776127a7e7fcab659eb6a">PushInventory</a>(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()));</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="keywordflow">if</span> (--nLimit &lt;= 0)</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            {</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                <span class="comment">// When this block is requested, we&#39;ll send an inv that&#39;ll</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                <span class="comment">// trigger the peer to getblocks the next batch of inventory.</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;  getblocks stopping at limit %d %s\n&quot;</span>, pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#a1a1c0d94de0197c5c4abf5a8d13364f3">hashContinue</a> = pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>();</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        }</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#af9b6c7c7cc77f2f0b6af1949a6ee5920">NetMsgType::GETBLOCKTXN</a>)</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    {</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <a class="code" href="class_block_transactions_request.html">BlockTransactionsRequest</a> req;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        vRecv &gt;&gt; req;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        std::shared_ptr&lt;const CBlock&gt; recent_block;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        {</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>);</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">most_recent_block_hash</a> == req.blockhash)</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                recent_block = <a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a>;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="comment">// Unlock cs_most_recent_block to avoid cs_main lock inversion</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordflow">if</span> (recent_block) {</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            <a class="code" href="net__processing_8cpp.html#a4975c8d11415845148babbfd973b34e9">SendBlockTransactions</a>(*recent_block, req, pfrom, connman);</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        }</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        BlockMap::iterator it = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(req.blockhash);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keywordflow">if</span> (it == <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() || !(it-&gt;second-&gt;nStatus &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a>)) {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer %d sent us a getblocktxn for a block we don&#39;t have&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        }</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="keywordflow">if</span> (it-&gt;second-&gt;nHeight &lt; <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#ad4758bc8872ce065a9579f77c3171d40">Height</a>() - <a class="code" href="validation_8h.html#a6cee75436117a7a79d4e0bc5b87bc2a6">MAX_BLOCKTXN_DEPTH</a>) {</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="comment">// If an older block is requested (should never happen in practice,</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <span class="comment">// but can happen in tests) send a block response instead of a</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <span class="comment">// blocktxn response. Sending a full block response instead of a</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;            <span class="comment">// small blocktxn response is preferable in the case where a peer</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;            <span class="comment">// might maliciously send lots of getblocktxn requests to trigger</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;            <span class="comment">// expensive disk reads, because it will require the peer to</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;            <span class="comment">// actually receive all the data read from disk over the network.</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Peer %d sent us a getblocktxn for a block &gt; %i deep&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, <a class="code" href="validation_8h.html#a6cee75436117a7a79d4e0bc5b87bc2a6">MAX_BLOCKTXN_DEPTH</a>);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;            <a class="code" href="class_c_inv.html">CInv</a> inv;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            inv.<a class="code" href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">type</a> = <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a> = req.blockhash;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.push_back(inv);</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            <a class="code" href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591">ProcessGetData</a>(pfrom, chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>(), connman, interruptMsgProc);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <a class="code" href="class_c_block.html">CBlock</a> block;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <span class="keywordtype">bool</span> ret = <a class="code" href="validation_8cpp.html#a578c1df234b05798180f0235d469a5ba">ReadBlockFromDisk</a>(block, it-&gt;second, chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>());</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        assert(ret);</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <a class="code" href="net__processing_8cpp.html#a4975c8d11415845148babbfd973b34e9">SendBlockTransactions</a>(block, req, pfrom, connman);</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    }</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>)</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <a class="code" href="struct_c_block_locator.html">CBlockLocator</a> locator;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <a class="code" href="classuint256.html">uint256</a> hashStop;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        vRecv &gt;&gt; locator &gt;&gt; hashStop;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>() &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>) {</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Ignoring getheaders from peer=%d because node is in initial block download\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        }</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        CNodeState *nodestate = State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a>* pindex = NULL;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <span class="keywordflow">if</span> (locator.<a class="code" href="struct_c_block_locator.html#a77ebc693cf47cbab5c13777840f6bce1">IsNull</a>())</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            <span class="comment">// If locator is null, return the hashStop block</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(hashStop);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;            <span class="keywordflow">if</span> (mi == <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end())</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;            pindex = (*mi).second;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        }</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        {</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <span class="comment">// Find the last block the caller has in the main chain</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            pindex = <a class="code" href="validation_8cpp.html#af43d57aa8b46a53839777e8b670c9d66">FindForkInGlobalIndex</a>(<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>, locator);</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            <span class="keywordflow">if</span> (pindex)</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                pindex = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a3077e83c87e8a974765fa76a57fd040b">Next</a>(pindex);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        }</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <span class="comment">// we must use CBlocks, as CBlockHeaders won&#39;t include the 0x00 nTx count at the end</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        std::vector&lt;CBlock&gt; vHeaders;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="keywordtype">int</span> nLimit = <a class="code" href="validation_8h.html#ae90d2acb26fa19fdcd983626b0d37d0b">MAX_HEADERS_RESULTS</a>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;getheaders %d to %s from peer=%d\n&quot;</span>, (pindex ? pindex-&gt;nHeight : -1), hashStop.IsNull() ? <span class="stringliteral">&quot;end&quot;</span> : hashStop.ToString(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        <span class="keywordflow">for</span> (; pindex; pindex = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a3077e83c87e8a974765fa76a57fd040b">Next</a>(pindex))</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            vHeaders.push_back(pindex-&gt;GetBlockHeader());</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <span class="keywordflow">if</span> (--nLimit &lt;= 0 || pindex-&gt;<a class="code" href="validation_8cpp.html#a08c25cc0ab8b9731b46a1bfbe6057fca">GetBlockHash</a>() == hashStop)</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        }</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        <span class="comment">// pindex can be NULL either if we sent chainActive.Tip() OR</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        <span class="comment">// if our peer has chainActive.Tip() (and thus we are sending an empty</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="comment">// headers message). In both cases it&#39;s safe to update</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <span class="comment">// pindexBestHeaderSent to be our tip.</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="comment">// It is important that we simply reset the BestHeaderSent value here,</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="comment">// and not max(BestHeaderSent, newHeaderSent). We might have announced</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;        <span class="comment">// the currently-being-connected tip using a compact block, which</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="comment">// resulted in the peer sending a headers request, which we respond to</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="comment">// without the new block. By resetting the BestHeaderSent, we ensure we</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        <span class="comment">// will re-announce the new block via headers (or compact blocks again)</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        <span class="comment">// in the SendMessages logic.</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        nodestate-&gt;pindexBestHeaderSent = pindex ? pindex : <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>();</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a216e35db319a5d508043639fd3170776">NetMsgType::HEADERS</a>, vHeaders));</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    }</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a> || strCommand == <a class="code" href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a> || strCommand == <a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a>)</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    {</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <span class="comment">// Stop processing the transaction early if</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="comment">// We are in blocks only mode and peer is either not whitelisted or whitelistrelay is off</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="net_8cpp.html#a7935254c613d6f3cdadd3ce45f7efbff">fRelayTxes</a> &amp;&amp; (!pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a> || !<a class="code" href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a>(<span class="stringliteral">&quot;-whitelistrelay&quot;</span>, <a class="code" href="validation_8h.html#a5289ed91f1daf187bba005dd54d62649">DEFAULT_WHITELISTRELAY</a>)))</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        {</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;transaction sent in violation of protocol peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        }</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        std::deque&lt;COutPoint&gt; vWorkQueue;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        std::vector&lt;uint256&gt; vEraseQueue;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        <a class="code" href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a> ptx;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <a class="code" href="class_c_tx_lock_request.html">CTxLockRequest</a> txLockRequest;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <a class="code" href="class_c_private_send_broadcast_tx.html">CPrivateSendBroadcastTx</a> dstx;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <span class="keywordtype">int</span> nInvType = <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <span class="keywordtype">bool</span> fCanAutoLock = <span class="keyword">false</span>;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <span class="comment">// Read data and assign inv type</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <span class="keywordflow">if</span>(strCommand == <a class="code" href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a>) {</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            vRecv &gt;&gt; ptx;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            txLockRequest = <a class="code" href="class_c_tx_lock_request.html">CTxLockRequest</a>(ptx);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            fCanAutoLock = <a class="code" href="class_c_instant_send.html#a116be43712370e747337a607486c3e53">CInstantSend::CanAutoLock</a>() &amp;&amp; txLockRequest.<a class="code" href="class_c_tx_lock_request.html#a21e647fb532ddab83d71e6ebae841569">IsSimple</a>();</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strCommand == <a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a>) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;            vRecv &gt;&gt; txLockRequest;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;            ptx = txLockRequest.<a class="code" href="class_c_tx_lock_request.html#a8e1d06cde63b2e16db8e1c18e4e65801">tx</a>;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            nInvType = <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a802e4d970385efb01469f48db2cf1e06">MSG_TXLOCK_REQUEST</a>;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a>) {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            vRecv &gt;&gt; dstx;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            ptx = dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a81c64d79239c3881b8c9131337656ddd">tx</a>;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;            nInvType = <a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ab7e23cc7eff00496b50b04e9e98f1b85">MSG_DSTX</a>;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;        }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; tx = *ptx;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        <a class="code" href="class_c_inv.html">CInv</a> inv(nInvType, tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>());</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#ac3054eb6ade84e8968f032ce3e700f6a">AddInventoryKnown</a>(inv);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        {</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            connman.<a class="code" href="class_c_connman.html#a076197390e42277fcb9affa34ad518c7">RemoveAskFor</a>(inv.hash);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment">// Process custom logic, no matter if tx will be accepted to mempool later or not</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a> || fCanAutoLock) {</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a418ce98b1e4d61b38bd11d02ff36a47d">ProcessTxLockRequest</a>(txLockRequest, connman)) {</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;instantsend&quot;</span>, <span class="stringliteral">&quot;TXLOCKREQUEST -- failed %s\n&quot;</span>, txLockRequest.<a class="code" href="class_c_tx_lock_request.html#a7bd35f1b5d30598b8638a804295dab10">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                <span class="comment">// Should not really happen for &quot;fCanAutoLock == true&quot; but just in case:</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                <span class="keywordflow">if</span> (!fCanAutoLock) {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                    <span class="comment">// Fail only for &quot;true&quot; IS here</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                }</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                <span class="comment">// Fallback for normal txes to process as usual</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                fCanAutoLock = <span class="keyword">false</span>;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;            }</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a>) {</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            <a class="code" href="classuint256.html">uint256</a> hashTx = tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>();</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="class_c_private_send.html#a5ca6361baefaecece1640899f918fd8a">CPrivateSend::GetDSTX</a>(hashTx)) {</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;privatesend&quot;</span>, <span class="stringliteral">&quot;DSTX -- Already have %s, skipping...\n&quot;</span>, hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// not an error</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            }</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            <a class="code" href="class_c_masternode.html">CMasternode</a> mn;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a343f7c30c005af247a0cabbd1d665610">Get</a>(dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a323d1fce5e220f62a20f2619f8627588">masternodeOutpoint</a>, mn)) {</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;privatesend&quot;</span>, <span class="stringliteral">&quot;DSTX -- Can&#39;t find masternode %s to verify %s\n&quot;</span>, dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a323d1fce5e220f62a20f2619f8627588">masternodeOutpoint</a>.<a class="code" href="class_c_out_point.html#a85f13609edc1f66afe82fb68f28fb8b7">ToStringShort</a>(), hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            }</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            <span class="keywordflow">if</span>(!mn.<a class="code" href="class_c_masternode.html#a96e1c84dfca2362c95fef0c2efd372f4">IsValidForMixingTxes</a>()) {</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;privatesend&quot;</span>, <span class="stringliteral">&quot;DSTX -- Masternode %s is sending too many transactions %s\n&quot;</span>, dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a323d1fce5e220f62a20f2619f8627588">masternodeOutpoint</a>.<a class="code" href="class_c_out_point.html#a85f13609edc1f66afe82fb68f28fb8b7">ToStringShort</a>(), hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                <span class="comment">// TODO: Not an error? Could it be that someone is relaying old DSTXes</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                <span class="comment">// we have no idea about (e.g we were offline)? How to handle them?</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            }</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            <span class="keywordflow">if</span> (!dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a34eb23b64782cf8d2120c35deb4aba74">CheckSignature</a>(mn.<a class="code" href="structmasternode__info__t.html#ad62e18817c92474ba10df6de3d042d8b">legacyKeyIDOperator</a>, mn.<a class="code" href="structmasternode__info__t.html#a3f9244ed4560953722ed200c5d49c912">blsPubKeyOperator</a>)) {</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;privatesend&quot;</span>, <span class="stringliteral">&quot;DSTX -- CheckSignature() failed for %s\n&quot;</span>, hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            }</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;DSTX -- Got Masternode transaction %s\n&quot;</span>, hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#a1a0a00279c941051af1b74c5ebeac40d">PrioritiseTransaction</a>(hashTx, hashTx.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), 1000, 0.1*<a class="code" href="amount_8h.html#aed6bcb17bc73a5dcf33250e9c2c023cc">COIN</a>);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;            <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a9021ef50962e58f495dbf125ff243952">DisallowMixing</a>(dstx.<a class="code" href="class_c_private_send_broadcast_tx.html#a323d1fce5e220f62a20f2619f8627588">masternodeOutpoint</a>);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        }</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <span class="keywordtype">bool</span> fMissingInputs = <span class="keyword">false</span>;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        <a class="code" href="class_c_validation_state.html">CValidationState</a> state;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(inv) &amp;&amp; <a class="code" href="validation_8cpp.html#acb44ac0586a5a755f889af3747f31f3b">AcceptToMemoryPool</a>(<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>, state, ptx, <span class="keyword">true</span>, &amp;fMissingInputs)) {</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            <span class="comment">// Process custom txes, this changes AlreadyHave to &quot;true&quot;</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a>) {</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;DSTX -- Masternode transaction accepted, txid=%s, peer=%d\n&quot;</span>,</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                        tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                <a class="code" href="class_c_private_send.html#a34bb28453d0906baa0e63001c502cc30">CPrivateSend::AddDSTX</a>(dstx);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a> || fCanAutoLock) {</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;TXLOCKREQUEST -- Transaction Lock Request accepted, txid=%s, peer=%d\n&quot;</span>,</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                        tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a23845464e9b2f297b675402b6a01da03">AcceptLockRequest</a>(txLockRequest);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a4b27db90b09bb5f7918229ef40985fdd">Vote</a>(tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>(), connman);</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#ab30fadfa811829e79accca41da6a8328">check</a>(<a class="code" href="validation_8cpp.html#a1821834b8f7837b469f7f91a14c20042">pcoinsTip</a>);</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            connman.<a class="code" href="class_c_connman.html#a5fdad96946aa2bc67961ad973bf65fa5">RelayTransaction</a>(tx);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tx.<a class="code" href="class_c_transaction.html#a708645274ddfd83829315ffe5c7c5c3e">vout</a>.size(); i++) {</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                vWorkQueue.emplace_back(inv.hash, i);</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            }</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a973d29d89889cba8fe7909b1b8959592">nLastTXTime</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;AcceptToMemoryPool: peer=%d: accepted %s (poolsz %u txn, %u kB)\n&quot;</span>,</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>,</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#a867f7b452141770f3b2e8697fb3513d8">size</a>(), <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#a4fcf05ad5f15a565c4b43c4b9f29906e">DynamicMemoryUsage</a>() / 1000);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            <span class="comment">// Recursively process any orphan transactions that depended on this one</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            std::set&lt;NodeId&gt; setMisbehaving;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;            <span class="keywordflow">while</span> (!vWorkQueue.empty()) {</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                <span class="keyword">auto</span> itByPrev = mapOrphanTransactionsByPrev.find(vWorkQueue.front());</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                vWorkQueue.pop_front();</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                <span class="keywordflow">if</span> (itByPrev == mapOrphanTransactionsByPrev.end())</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">auto</span> mi = itByPrev-&gt;second.begin();</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                     mi != itByPrev-&gt;second.end();</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                     ++mi)</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                {</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                    <span class="keyword">const</span> <a class="code" href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a>&amp; porphanTx = (*mi)-&gt;second.tx;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                    <span class="keyword">const</span> <a class="code" href="class_c_transaction.html">CTransaction</a>&amp; orphanTx = *porphanTx;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; orphanHash = orphanTx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>();</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                    <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> fromPeer = (*mi)-&gt;second.fromPeer;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                    <span class="keywordtype">bool</span> fMissingInputs2 = <span class="keyword">false</span>;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                    <span class="comment">// Use a dummy CValidationState so someone can&#39;t setup nodes to counter-DoS based on orphan</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                    <span class="comment">// resolution (that is, feeding people an invalid transaction based on LegitTxX in order to get</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                    <span class="comment">// anyone relaying LegitTxX banned)</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                    <a class="code" href="class_c_validation_state.html">CValidationState</a> stateDummy;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                    <span class="keywordflow">if</span> (setMisbehaving.count(fromPeer))</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#acb44ac0586a5a755f889af3747f31f3b">AcceptToMemoryPool</a>(<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>, stateDummy, porphanTx, <span class="keyword">true</span>, &amp;fMissingInputs2)) {</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;   accepted orphan tx %s\n&quot;</span>, orphanHash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                        connman.<a class="code" href="class_c_connman.html#a5fdad96946aa2bc67961ad973bf65fa5">RelayTransaction</a>(orphanTx);</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; orphanTx.<a class="code" href="class_c_transaction.html#a708645274ddfd83829315ffe5c7c5c3e">vout</a>.size(); i++) {</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                            vWorkQueue.emplace_back(orphanHash, i);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                        }</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                        vEraseQueue.push_back(orphanHash);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                    }</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fMissingInputs2)</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                    {</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                        <span class="keywordtype">int</span> nDos = 0;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                        <span class="keywordflow">if</span> (stateDummy.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDos) &amp;&amp; nDos &gt; 0)</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                        {</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                            <span class="comment">// Punish peer that gave us an invalid orphan tx</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(fromPeer, nDos);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                            setMisbehaving.insert(fromPeer);</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;   invalid orphan tx %s\n&quot;</span>, orphanHash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                        }</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                        <span class="comment">// Has inputs but not accepted to mempool</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                        <span class="comment">// Probably non-standard or insufficient fee/priority</span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;   removed orphan tx %s\n&quot;</span>, orphanHash.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                        vEraseQueue.push_back(orphanHash);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                        <span class="keywordflow">if</span> (!stateDummy.<a class="code" href="class_c_validation_state.html#add2b2dc505a8527fda32295b65bb636b">CorruptionPossible</a>()) {</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                            assert(recentRejects);</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                            recentRejects-&gt;insert(orphanHash);</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                        }</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                    }</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                    <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#ab30fadfa811829e79accca41da6a8328">check</a>(<a class="code" href="validation_8cpp.html#a1821834b8f7837b469f7f91a14c20042">pcoinsTip</a>);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                }</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;            }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;            BOOST_FOREACH(<a class="code" href="classuint256.html">uint256</a> hash, vEraseQueue)</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                <a class="code" href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a>(hash);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        }</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fMissingInputs)</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        {</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <span class="keywordtype">bool</span> fRejectedParents = <span class="keyword">false</span>; <span class="comment">// It may be the case that the orphans parents have all been rejected</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a>&amp; txin, tx.<a class="code" href="class_c_transaction.html#ad64447ea044ec850313696fc99412d95">vin</a>) {</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                <span class="keywordflow">if</span> (recentRejects-&gt;contains(txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>)) {</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                    fRejectedParents = <span class="keyword">true</span>;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                }</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            }</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            <span class="keywordflow">if</span> (!fRejectedParents) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_tx_in.html">CTxIn</a>&amp; txin, tx.<a class="code" href="class_c_transaction.html#ad64447ea044ec850313696fc99412d95">vin</a>) {</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                    <a class="code" href="class_c_inv.html">CInv</a> _inv(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>, txin.<a class="code" href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">prevout</a>.<a class="code" href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">hash</a>);</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                    pfrom-&gt;<a class="code" href="class_c_node.html#ac3054eb6ade84e8968f032ce3e700f6a">AddInventoryKnown</a>(_inv);</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(_inv)) pfrom-&gt;<a class="code" href="class_c_node.html#ae0def1498409407d1612833a7d38c875">AskFor</a>(_inv);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                }</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                <a class="code" href="net__processing_8cpp.html#ad5c880181bb5a6df5bf32cf46ba062ad">AddOrphanTx</a>(ptx, pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                <span class="comment">// DoS prevention: do not allow mapOrphanTransactions to grow unbounded</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMaxOrphanTx = (<span class="keywordtype">unsigned</span> int)std::max((int64_t)0, <a class="code" href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a>(<span class="stringliteral">&quot;-maxorphantx&quot;</span>, <a class="code" href="net__processing_8h.html#ab430d75598aeb37ec46ba29381371b50">DEFAULT_MAX_ORPHAN_TRANSACTIONS</a>));</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvicted = <a class="code" href="net__processing_8cpp.html#a8ba236d72126857f35e106fb4ebde610">LimitOrphanTxSize</a>(nMaxOrphanTx);</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                <span class="keywordflow">if</span> (nEvicted &gt; 0)</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;mapOrphan overflow, removed %u tx\n&quot;</span>, nEvicted);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempool&quot;</span>, <span class="stringliteral">&quot;not keeping orphan with rejected parents %s\n&quot;</span>,tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                <span class="comment">// We will continue to reject this tx since it has rejected</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                <span class="comment">// parents so avoid re-requesting it from other peers.</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                recentRejects-&gt;insert(tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>());</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            <span class="keywordflow">if</span> (!state.<a class="code" href="class_c_validation_state.html#add2b2dc505a8527fda32295b65bb636b">CorruptionPossible</a>()) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                assert(recentRejects);</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                recentRejects-&gt;insert(tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>());</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="core__memusage_8h.html#a18e1e611662fcad8ad04ad0a85e84d08">RecursiveDynamicUsage</a>(*ptx) &lt; 100000) {</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a1cb503e00969ffcc1b35a19bceb3d4d6">AddToCompactExtraTransactions</a>(ptx);</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;            }</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;            <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a> &amp;&amp; !<a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(inv)) {</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                <span class="comment">// i.e. AcceptToMemoryPool failed, probably because it&#39;s conflicting</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                <span class="comment">// with existing normal tx or tx lock for another tx. For the same tx lock</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                <span class="comment">// AlreadyHave would have return &quot;true&quot; already.</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                <span class="comment">// It&#39;s the first time we failed for this tx lock request,</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                <span class="comment">// this should switch AlreadyHave to &quot;true&quot;.</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#a26dd2ae8ab875cabe4f5cc6f4ed6e030">RejectLockRequest</a>(txLockRequest);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                <span class="comment">// this lets other nodes to create lock request candidate i.e.</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                <span class="comment">// this allows multiple conflicting lock requests to compete for votes</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                connman.<a class="code" href="class_c_connman.html#a5fdad96946aa2bc67961ad973bf65fa5">RelayTransaction</a>(tx);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            }</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a> &amp;&amp; <a class="code" href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a>(<span class="stringliteral">&quot;-whitelistforcerelay&quot;</span>, <a class="code" href="validation_8h.html#a41af4f24e6f8ec02a4a6fd7e679acf3d">DEFAULT_WHITELISTFORCERELAY</a>)) {</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                <span class="comment">// Always relay transactions received from whitelisted peers, even</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                <span class="comment">// if they were already in the mempool or rejected from it due</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                <span class="comment">// to policy, allowing the node to function as a gateway for</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                <span class="comment">// nodes hidden behind it.</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                <span class="comment">//</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                <span class="comment">// Never relay transactions that we would assign a non-zero DoS</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                <span class="comment">// score for, as we expect peers to do the same with us in that</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                <span class="comment">// case.</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                <span class="keywordtype">int</span> nDoS = 0;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="keywordflow">if</span> (!state.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDoS) || nDoS == 0) {</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                    <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Force relaying tx %s from whitelisted peer=%d\n&quot;</span>, tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                    connman.<a class="code" href="class_c_connman.html#a5fdad96946aa2bc67961ad973bf65fa5">RelayTransaction</a>(tx);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                    <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Not relaying invalid transaction %s from whitelisted peer=%d (%s)\n&quot;</span>, tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, <a class="code" href="validation_8cpp.html#a86ed1d2d0837b905d74c2e4192b6c06a">FormatStateMessage</a>(state));</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                }</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        }</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="keywordtype">int</span> nDoS = 0;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDoS))</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        {</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;mempoolrej&quot;</span>, <span class="stringliteral">&quot;%s from peer=%d was not accepted: %s\n&quot;</span>, tx.<a class="code" href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">GetHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>,</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                <a class="code" href="validation_8cpp.html#a86ed1d2d0837b905d74c2e4192b6c06a">FormatStateMessage</a>(state));</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#a01490c3326ac7d47a64976747060ac46">GetRejectCode</a>() &lt; <a class="code" href="validation_8h.html#ae98e9fff288e3029a25765a7f924d960">REJECT_INTERNAL</a>) <span class="comment">// Never send AcceptToMemoryPool&#39;s internal codes over P2P</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)state.<a class="code" href="class_c_validation_state.html#a01490c3326ac7d47a64976747060ac46">GetRejectCode</a>(),</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                   state.<a class="code" href="class_c_validation_state.html#a8fa9612cb40c3c8592f7cd29b5931ccd">GetRejectReason</a>().substr(0, <a class="code" href="validation_8h.html#af83a9cbb7b3fe9d34a7c4b43f2e040f8">MAX_REJECT_MESSAGE_LENGTH</a>), inv.hash));</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            <span class="keywordflow">if</span> (nDoS &gt; 0) {</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), nDoS);</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;            }</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        }</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    }</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a>) <span class="comment">// Ignore blocks received while importing</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    {</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <a class="code" href="class_c_block_header_and_short_tx_i_ds.html">CBlockHeaderAndShortTxIDs</a> cmpctblock;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        vRecv &gt;&gt; cmpctblock;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        {</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(cmpctblock.header.hashPrevBlock) == <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end()) {</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;            <span class="comment">// Doesn&#39;t connect (or is genesis), instead of DoSing in AcceptBlockHeader, request deeper headers</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>())</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">GetLocator</a>(<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>), <a class="code" href="classuint256.html">uint256</a>()));</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        }</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        }</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex = NULL;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        <a class="code" href="class_c_validation_state.html">CValidationState</a> state;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a3076b81689bbb5e91a4fb30166fed703">ProcessNewBlockHeaders</a>({cmpctblock.header}, state, chainparams, &amp;pindex)) {</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;            <span class="keywordtype">int</span> nDoS;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;            <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDoS)) {</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                <span class="keywordflow">if</span> (nDoS &gt; 0) {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), nDoS);</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer %d sent us invalid header via cmpctblock\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        }</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="comment">// When we succeed in decoding a block&#39;s txids from a cmpctblock</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="comment">// message we typically jump to the BLOCKTXN handling code, with a</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        <span class="comment">// dummy (empty) BLOCKTXN message, to re-use the logic there in</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        <span class="comment">// completing processing of the putative block (without cs_main).</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        <span class="keywordtype">bool</span> fProcessBLOCKTXN = <span class="keyword">false</span>;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> blockTxnMsg(<a class="code" href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a>, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        <span class="comment">// If we end up treating this as a plain headers message, call that as well</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        <span class="comment">// without cs_main.</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        <span class="keywordtype">bool</span> fRevertToHeaderProcessing = <span class="keyword">false</span>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a> vHeadersMsg(<a class="code" href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a>, <a class="code" href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="comment">// Keep a CBlock for &quot;optimistic&quot; compactblock reconstructions (see</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="comment">// below)</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        std::shared_ptr&lt;CBlock&gt; pblock = std::make_shared&lt;CBlock&gt;();</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="keywordtype">bool</span> fBlockReconstructed = <span class="keyword">false</span>;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        {</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="comment">// If AcceptBlockHeader returned true, it set pindex</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        assert(pindex);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        UpdateBlockAvailability(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>());</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        std::map&lt;uint256, std::pair&lt;NodeId, std::list&lt;QueuedBlock&gt;::iterator&gt; &gt;::iterator blockInFlightIt = mapBlocksInFlight.find(pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>());</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <span class="keywordtype">bool</span> fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#ac5a336b45ca70e3ed2fc090bf2ee3011">nStatus</a> &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a>) <span class="comment">// Nothing to do here</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">nChainWork</a> &lt;= <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">nChainWork</a> || <span class="comment">// We know something better</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                pindex-&gt;<a class="code" href="class_c_block_index.html#ac8e219a377839d2f9133a4387f46e44e">nTx</a> != 0) { <span class="comment">// We had this block at some point, but pruned it</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            <span class="keywordflow">if</span> (fAlreadyInFlight) {</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                <span class="comment">// We requested this block for some reason, but our mempool will probably be useless</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                <span class="comment">// so we just grab the block via normal getdata</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                std::vector&lt;CInv&gt; vInv(1);</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                vInv[0] = <a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, cmpctblock.header.GetHash());</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vInv));</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;            }</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;        }</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <span class="comment">// If we&#39;re not close to tip yet, give up and let parallel block fetch work its magic</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;        <span class="keywordflow">if</span> (!fAlreadyInFlight &amp;&amp; !CanDirectFetch(chainparams.GetConsensus()))</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        CNodeState *nodestate = State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        <span class="comment">// We want to be a bit conservative just to be extra careful about DoS</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;        <span class="comment">// possibilities in compact block processing...</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a> &lt;= <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#ad4758bc8872ce065a9579f77c3171d40">Height</a>() + 2) {</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            <span class="keywordflow">if</span> ((!fAlreadyInFlight &amp;&amp; nodestate-&gt;nBlocksInFlight &lt; <a class="code" href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a>) ||</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                 (fAlreadyInFlight &amp;&amp; blockInFlightIt-&gt;second.first == pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>())) {</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                std::list&lt;QueuedBlock&gt;::iterator *queuedBlockIt = NULL;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                <span class="keywordflow">if</span> (!MarkBlockAsInFlight(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>(), chainparams.GetConsensus(), pindex, &amp;queuedBlockIt)) {</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                    <span class="keywordflow">if</span> (!(*queuedBlockIt)-&gt;partialBlock)</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                        (*queuedBlockIt)-&gt;partialBlock.reset(<span class="keyword">new</span> <a class="code" href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a>(&amp;<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>));</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                        <span class="comment">// The block was already in flight using compact blocks from the same peer</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Peer sent us compact block we were already syncing!\n&quot;</span>);</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                    }</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                }</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                <a class="code" href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a>&amp; partialBlock = *(*queuedBlockIt)-&gt;partialBlock;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                <a class="code" href="blockencodings_8h.html#a736e4f9aaa454215e8d1177394e170a6">ReadStatus</a> status = partialBlock.<a class="code" href="class_partially_downloaded_block.html#a04e1b3207e547c972e002c1ec472da1f">InitData</a>(cmpctblock, vExtraTxnForCompact);</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                <span class="keywordflow">if</span> (status == <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea2c4369130f1cab4f039ffe2bf247d812">READ_STATUS_INVALID</a>) {</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                    MarkBlockAsReceived(pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()); <span class="comment">// Reset in-flight state in case of whitelist</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                    <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer %d sent us invalid compact block\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50ceaee0cfe0767680ec8c16bb91d3c1d9b22">READ_STATUS_FAILED</a>) {</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                    <span class="comment">// Duplicate txindexes, the block is now in-flight, so just request it</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                    std::vector&lt;CInv&gt; vInv(1);</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                    vInv[0] = <a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, cmpctblock.header.GetHash());</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vInv));</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                }</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                <a class="code" href="class_block_transactions_request.html">BlockTransactionsRequest</a> req;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; cmpctblock.BlockTxCount(); i++) {</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                    <span class="keywordflow">if</span> (!partialBlock.<a class="code" href="class_partially_downloaded_block.html#ad8f41f80c9aba45402fc1033a478a97b">IsTxAvailable</a>(i))</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                        req.<a class="code" href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">indexes</a>.push_back(i);</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                }</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                <span class="keywordflow">if</span> (req.<a class="code" href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">indexes</a>.empty()) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                    <span class="comment">// Dirty hack to jump to BLOCKTXN code (TODO: move message handling into their own functions)</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                    <a class="code" href="class_block_transactions.html">BlockTransactions</a> txn;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                    txn.<a class="code" href="class_block_transactions.html#a6d42a1840f22d90b000a579db5de490d">blockhash</a> = cmpctblock.header.GetHash();</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                    blockTxnMsg &lt;&lt; txn;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    fProcessBLOCKTXN = <span class="keyword">true</span>;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                    req.<a class="code" href="class_block_transactions_request.html#ac5fd8cb4f31a492d58d6c95dd369852e">blockhash</a> = pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>();</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#af9b6c7c7cc77f2f0b6af1949a6ee5920">NetMsgType::GETBLOCKTXN</a>, req));</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                }</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                <span class="comment">// This block is either already in flight from a different</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                <span class="comment">// peer, or this peer has too many blocks outstanding to</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                <span class="comment">// download from.</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                <span class="comment">// Optimistically try to reconstruct anyway since we might be</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                <span class="comment">// able to without any round trips.</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                <a class="code" href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a> tempBlock(&amp;<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>);</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                <a class="code" href="blockencodings_8h.html#a736e4f9aaa454215e8d1177394e170a6">ReadStatus</a> status = tempBlock.<a class="code" href="class_partially_downloaded_block.html#a04e1b3207e547c972e002c1ec472da1f">InitData</a>(cmpctblock, vExtraTxnForCompact);</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <span class="keywordflow">if</span> (status != <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea105d3aa9ec19f4c060b39c7fafba39ff">READ_STATUS_OK</a>) {</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                    <span class="comment">// TODO: don&#39;t ignore failures</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                std::vector&lt;CTransactionRef&gt; dummy;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                status = tempBlock.<a class="code" href="class_partially_downloaded_block.html#ae31ee4302e77d9757aae8b96df99486a">FillBlock</a>(*pblock, dummy);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                <span class="keywordflow">if</span> (status == <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea105d3aa9ec19f4c060b39c7fafba39ff">READ_STATUS_OK</a>) {</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                    fBlockReconstructed = <span class="keyword">true</span>;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                }</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;            }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;            <span class="keywordflow">if</span> (fAlreadyInFlight) {</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                <span class="comment">// We requested this block, but its far into the future, so our</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                <span class="comment">// mempool will probably be useless - request the block normally</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                std::vector&lt;CInv&gt; vInv(1);</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                vInv[0] = <a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, cmpctblock.header.GetHash());</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vInv));</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                <span class="comment">// If this was an announce-cmpctblock, we want the same treatment as a header message</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <span class="comment">// Dirty hack to process as if it were just a headers message (TODO: move message handling into their own functions)</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                std::vector&lt;CBlock&gt; headers;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                headers.push_back(cmpctblock.header);</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                vHeadersMsg &lt;&lt; headers;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                fRevertToHeaderProcessing = <span class="keyword">true</span>;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            }</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        }</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        } <span class="comment">// cs_main</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;        <span class="keywordflow">if</span> (fProcessBLOCKTXN)</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462">ProcessMessage</a>(pfrom, <a class="code" href="namespace_net_msg_type.html#ac23245c939bfe57d37c0a2db68e05e05">NetMsgType::BLOCKTXN</a>, blockTxnMsg, nTimeReceived, chainparams, connman, interruptMsgProc);</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="keywordflow">if</span> (fRevertToHeaderProcessing)</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462">ProcessMessage</a>(pfrom, <a class="code" href="namespace_net_msg_type.html#a216e35db319a5d508043639fd3170776">NetMsgType::HEADERS</a>, vHeadersMsg, nTimeReceived, chainparams, connman, interruptMsgProc);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <span class="keywordflow">if</span> (fBlockReconstructed) {</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;            <span class="comment">// If we got here, we were able to optimistically reconstruct a</span></div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;            <span class="comment">// block that is in flight from some other peer.</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            {</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                mapBlockSource.emplace(pblock-&gt;GetHash(), std::make_pair(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), <span class="keyword">false</span>));</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            }</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;            <span class="keywordtype">bool</span> fNewBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;            <a class="code" href="validation_8cpp.html#a290fce59049c0951b8eb73f0129bf6f0">ProcessNewBlock</a>(chainparams, pblock, <span class="keyword">true</span>, &amp;fNewBlock);</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            <span class="keywordflow">if</span> (fNewBlock)</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#ad253434141efcbca34150864069aee7e">nLastBlockTime</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>); <span class="comment">// hold cs_main for CBlockIndex::IsValid()</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;            <span class="keywordflow">if</span> (pindex-&gt;<a class="code" href="class_c_block_index.html#ad8b5a6560e7c0d4222066e2922178683">IsValid</a>(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada3eef30f876594ac79b888b7d1ff6c66c">BLOCK_VALID_TRANSACTIONS</a>)) {</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                <span class="comment">// Clear download state for this block, which is in</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                <span class="comment">// process from some other peer.  We do this after calling</span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                <span class="comment">// ProcessNewBlock so that a malleated cmpctblock announcement</span></div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                <span class="comment">// can&#39;t be used to interfere with block relay.</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                MarkBlockAsReceived(pblock-&gt;GetHash());</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;            }</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        }</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    }</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#ac23245c939bfe57d37c0a2db68e05e05">NetMsgType::BLOCKTXN</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a>) <span class="comment">// Ignore blocks received while importing</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    {</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        <a class="code" href="class_block_transactions.html">BlockTransactions</a> resp;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        vRecv &gt;&gt; resp;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        std::shared_ptr&lt;CBlock&gt; pblock = std::make_shared&lt;CBlock&gt;();</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        <span class="keywordtype">bool</span> fBlockRead = <span class="keyword">false</span>;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            std::map&lt;uint256, std::pair&lt;NodeId, std::list&lt;QueuedBlock&gt;::iterator&gt; &gt;::iterator it = mapBlocksInFlight.find(resp.blockhash);</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;            <span class="keywordflow">if</span> (it == mapBlocksInFlight.end() || !it-&gt;second.second-&gt;partialBlock ||</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                    it-&gt;second.first != pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>()) {</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Peer %d sent us block transactions for block we weren&#39;t expecting\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;            }</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;            <a class="code" href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a>&amp; partialBlock = *it-&gt;second.second-&gt;partialBlock;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;            <a class="code" href="blockencodings_8h.html#a736e4f9aaa454215e8d1177394e170a6">ReadStatus</a> status = partialBlock.<a class="code" href="class_partially_downloaded_block.html#ae31ee4302e77d9757aae8b96df99486a">FillBlock</a>(*pblock, resp.txn);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            <span class="keywordflow">if</span> (status == <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea2c4369130f1cab4f039ffe2bf247d812">READ_STATUS_INVALID</a>) {</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                MarkBlockAsReceived(resp.blockhash); <span class="comment">// Reset in-flight state in case of whitelist</span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer %d sent us invalid compact block/non-matching block transactions\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == <a class="code" href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50ceaee0cfe0767680ec8c16bb91d3c1d9b22">READ_STATUS_FAILED</a>) {</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                <span class="comment">// Might have collided, fall back to getdata now :(</span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                std::vector&lt;CInv&gt; invs;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                invs.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, resp.blockhash));</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, invs));</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                <span class="comment">// Block is either okay, or possibly we received</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                <span class="comment">// READ_STATUS_CHECKBLOCK_FAILED.</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                <span class="comment">// Note that CheckBlock can only fail for one of a few reasons:</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                <span class="comment">// 1. bad-proof-of-work (impossible here, because we&#39;ve already</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                <span class="comment">//    accepted the header)</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                <span class="comment">// 2. merkleroot doesn&#39;t match the transactions given (already</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                <span class="comment">//    caught in FillBlock with READ_STATUS_FAILED, so</span></div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                <span class="comment">//    impossible here)</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                <span class="comment">// 3. the block is otherwise invalid (eg invalid coinbase,</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                <span class="comment">//    block is too big, too many legacy sigops, etc).</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                <span class="comment">// So if CheckBlock failed, #3 is the only possibility.</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                <span class="comment">// Under BIP 152, we don&#39;t DoS-ban unless proof of work is</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                <span class="comment">// invalid (we don&#39;t require all the stateless checks to have</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                <span class="comment">// been run).  This is handled below, so just treat this as</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                <span class="comment">// though the block was successfully read, and rely on the</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                <span class="comment">// handling in ProcessNewBlock to ensure the block index is</span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                <span class="comment">// updated, reject messages go out, etc.</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                MarkBlockAsReceived(resp.blockhash); <span class="comment">// it is now an empty pointer</span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                fBlockRead = <span class="keyword">true</span>;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                <span class="comment">// mapBlockSource is only used for sending reject messages and DoS scores,</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                <span class="comment">// so the race between here and cs_main in ProcessNewBlock is fine.</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                <span class="comment">// BIP 152 permits peers to relay compact blocks after validating</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                <span class="comment">// the header only; we should not punish peers if the block turns</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                <span class="comment">// out to be invalid.</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                mapBlockSource.emplace(resp.blockhash, std::make_pair(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), <span class="keyword">false</span>));</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;            }</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        } <span class="comment">// Don&#39;t hold cs_main when we call into ProcessNewBlock</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        <span class="keywordflow">if</span> (fBlockRead) {</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            <span class="keywordtype">bool</span> fNewBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <span class="comment">// Since we requested this block (it was in mapBlocksInFlight), force it to be processed,</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            <span class="comment">// even if it would not be a candidate for new tip (missing previous block, chain not long enough, etc)</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;            <a class="code" href="validation_8cpp.html#a290fce59049c0951b8eb73f0129bf6f0">ProcessNewBlock</a>(chainparams, pblock, <span class="keyword">true</span>, &amp;fNewBlock);</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;            <span class="keywordflow">if</span> (fNewBlock)</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#ad253434141efcbca34150864069aee7e">nLastBlockTime</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        }</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    }</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a216e35db319a5d508043639fd3170776">NetMsgType::HEADERS</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a>) <span class="comment">// Ignore headers received while importing</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        std::vector&lt;CBlockHeader&gt; headers;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="comment">// Bypass the normal CBlock deserialization, as we don&#39;t want to risk deserializing 2000 full blocks.</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCount = <a class="code" href="serialize_8h.html#ae3fd928949b7361accfec79c314aa90f">ReadCompactSize</a>(vRecv);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="keywordflow">if</span> (nCount &gt; <a class="code" href="validation_8h.html#ae90d2acb26fa19fdcd983626b0d37d0b">MAX_HEADERS_RESULTS</a>) {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;headers message size = %u&quot;</span>, nCount);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        headers.resize(nCount);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0; n &lt; nCount; n++) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            vRecv &gt;&gt; headers[n];</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            <a class="code" href="serialize_8h.html#ae3fd928949b7361accfec79c314aa90f">ReadCompactSize</a>(vRecv); <span class="comment">// ignore tx count; assume it is 0.</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        }</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        <span class="keywordflow">if</span> (nCount == 0) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;            <span class="comment">// Nothing interesting. Stop asking this peers for more headers.</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        }</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexLast = NULL;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        {</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        CNodeState *nodestate = State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        <span class="comment">// If this looks like it could be a block announcement (nCount &lt;</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <span class="comment">// MAX_BLOCKS_TO_ANNOUNCE), use special logic for handling headers that</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <span class="comment">// don&#39;t connect:</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        <span class="comment">// - Send a getheaders message in response to try to connect the chain.</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <span class="comment">// - The peer can send up to MAX_UNCONNECTING_HEADERS in a row that</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        <span class="comment">//   don&#39;t connect before giving DoS points</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        <span class="comment">// - Once a headers message is received that is valid and does connect,</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="comment">//   nUnconnectingHeaders gets reset back to 0.</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(headers[0].hashPrevBlock) == <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end() &amp;&amp; nCount &lt; <a class="code" href="validation_8h.html#ad4d4718d1ec747708a31bc47aaa66578">MAX_BLOCKS_TO_ANNOUNCE</a>) {</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            nodestate-&gt;nUnconnectingHeaders++;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">GetLocator</a>(<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>), <a class="code" href="classuint256.html">uint256</a>()));</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received header %s: missing prev block %s, sending getheaders (%d) to end (peer=%d, nUnconnectingHeaders=%d)\n&quot;</span>,</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                    headers[0].GetHash().ToString(),</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                    headers[0].hashPrevBlock.ToString(),</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                    <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>,</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                    pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, nodestate-&gt;nUnconnectingHeaders);</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            <span class="comment">// Set hashLastUnknownBlock for this peer, so that if we</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="comment">// eventually get the headers - even from a different peer -</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <span class="comment">// we can use this peer to download.</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            UpdateBlockAvailability(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), headers.back().GetHash());</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            <span class="keywordflow">if</span> (nodestate-&gt;nUnconnectingHeaders % <a class="code" href="validation_8h.html#a42afcf61a20d8754d8285f6a1f958134">MAX_UNCONNECTING_HEADERS</a> == 0) {</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;            }</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;        }</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        <a class="code" href="classuint256.html">uint256</a> hashLastBlock;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="class_c_block_header.html">CBlockHeader</a>&amp; header : headers) {</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            <span class="keywordflow">if</span> (!hashLastBlock.<a class="code" href="classbase__blob.html#aba89c6722866a5850882a509d27d7bbd">IsNull</a>() &amp;&amp; header.hashPrevBlock != hashLastBlock) {</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 20);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;non-continuous headers sequence&quot;</span>);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;            }</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            hashLastBlock = header.GetHash();</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        }</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        }</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <a class="code" href="class_c_validation_state.html">CValidationState</a> state;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a3076b81689bbb5e91a4fb30166fed703">ProcessNewBlockHeaders</a>(headers, state, chainparams, &amp;pindexLast)) {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <span class="keywordtype">int</span> nDoS;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <span class="keywordflow">if</span> (state.<a class="code" href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">IsInvalid</a>(nDoS)) {</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                <span class="keywordflow">if</span> (nDoS &gt; 0) {</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                    <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                    <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), nDoS);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                }</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a>(<span class="stringliteral">&quot;invalid header received&quot;</span>);</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;            }</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;        }</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;        {</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;        CNodeState *nodestate = State(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;        <span class="keywordflow">if</span> (nodestate-&gt;nUnconnectingHeaders &gt; 0) {</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;peer=%d: resetting nUnconnectingHeaders (%d -&gt; 0)\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, nodestate-&gt;nUnconnectingHeaders);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        }</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        nodestate-&gt;nUnconnectingHeaders = 0;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        assert(pindexLast);</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        UpdateBlockAvailability(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), pindexLast-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>());</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        <span class="keywordflow">if</span> (nCount == <a class="code" href="validation_8h.html#ae90d2acb26fa19fdcd983626b0d37d0b">MAX_HEADERS_RESULTS</a>) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            <span class="comment">// Headers message had its maximum size; the peer may have more headers.</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;            <span class="comment">// TODO: optimize: if pindexLast is an ancestor of chainActive.Tip or pindexBestHeader, continue</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;            <span class="comment">// from there instead.</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;more getheaders (%d) to end to peer=%d (startheight:%d)\n&quot;</span>, pindexLast-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, pfrom-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a>);</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">GetLocator</a>(pindexLast), <a class="code" href="classuint256.html">uint256</a>()));</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        }</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <span class="keywordtype">bool</span> fCanDirectFetch = CanDirectFetch(chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>());</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <span class="comment">// If this set of headers is valid and ends in a block with at least as</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="comment">// much work as our tip, download as much as possible.</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        <span class="keywordflow">if</span> (fCanDirectFetch &amp;&amp; pindexLast-&gt;<a class="code" href="class_c_block_index.html#ad8b5a6560e7c0d4222066e2922178683">IsValid</a>(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573">BLOCK_VALID_TREE</a>) &amp;&amp; <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">nChainWork</a> &lt;= pindexLast-&gt;<a class="code" href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">nChainWork</a>) {</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;            std::vector&lt;const CBlockIndex *&gt; vToFetch;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexWalk = pindexLast;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            <span class="comment">// Calculate all the blocks we&#39;d need to switch to pindexLast, up to a limit.</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            <span class="keywordflow">while</span> (pindexWalk &amp;&amp; !<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#af1786dc229c215dea7f727c11df2c8dc">Contains</a>(pindexWalk) &amp;&amp; vToFetch.size() &lt;= <a class="code" href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a>) {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                <span class="keywordflow">if</span> (!(pindexWalk-&gt;<a class="code" href="class_c_block_index.html#ac5a336b45ca70e3ed2fc090bf2ee3011">nStatus</a> &amp; <a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a>) &amp;&amp;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                        !mapBlocksInFlight.count(pindexWalk-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>())) {</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                    <span class="comment">// We don&#39;t have this block, and it&#39;s not yet in flight.</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                    vToFetch.push_back(pindexWalk);</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                }</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                pindexWalk = pindexWalk-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            }</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;            <span class="comment">// If pindexWalk still isn&#39;t on our main chain, we&#39;re looking at a</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;            <span class="comment">// very large reorg at a time we think we&#39;re close to caught up to</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;            <span class="comment">// the main chain -- this shouldn&#39;t really happen.  Bail out on the</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;            <span class="comment">// direct fetch and rely on parallel download instead.</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#af1786dc229c215dea7f727c11df2c8dc">Contains</a>(pindexWalk)) {</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Large reorg, won&#39;t direct fetch to %s (%d)\n&quot;</span>,</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                        pindexLast-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                        pindexLast-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                std::vector&lt;CInv&gt; vGetData;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                <span class="comment">// Download as much as possible, from earliest to latest.</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                BOOST_REVERSE_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex, vToFetch) {</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                    <span class="keywordflow">if</span> (nodestate-&gt;nBlocksInFlight &gt;= <a class="code" href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a>) {</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                        <span class="comment">// Can&#39;t download any more from this peer</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                    }</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                    vGetData.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()));</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                    MarkBlockAsInFlight(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>(), chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>(), pindex);</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Requesting block %s from  peer=%d\n&quot;</span>,</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                            pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                }</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                <span class="keywordflow">if</span> (vGetData.size() &gt; 1) {</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Downloading blocks toward %s (%d) via headers direct fetch\n&quot;</span>,</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                            pindexLast-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), pindexLast-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>);</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                }</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                <span class="keywordflow">if</span> (vGetData.size() &gt; 0) {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                    <span class="keywordflow">if</span> (nodestate-&gt;fSupportsDesiredCmpctVersion &amp;&amp; vGetData.size() == 1 &amp;&amp; mapBlocksInFlight.size() == 1 &amp;&amp; pindexLast-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>-&gt;<a class="code" href="class_c_block_index.html#ad8b5a6560e7c0d4222066e2922178683">IsValid</a>(<a class="code" href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada00332fcf52dbd55990d8ff86b616bc65">BLOCK_VALID_CHAIN</a>)) {</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                        <span class="comment">// In any case, we want to download using a compact block, not a regular one</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                        vGetData[0] = <a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc">MSG_CMPCT_BLOCK</a>, vGetData[0].hash);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                    }</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vGetData));</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            }</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        }</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        }</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    }</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a>) <span class="comment">// Ignore blocks received while importing</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    {</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        std::shared_ptr&lt;CBlock&gt; pblock = std::make_shared&lt;CBlock&gt;();</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        vRecv &gt;&gt; *pblock;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received block %s peer=%d\n&quot;</span>, pblock-&gt;GetHash().ToString(), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        <span class="comment">// Process all blocks from whitelisted peers, even if not requested,</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="comment">// unless we&#39;re still syncing with the network.</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;        <span class="comment">// Such an unrequested block may still be processed, subject to the</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        <span class="comment">// conditions in AcceptBlock().</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        <span class="keywordtype">bool</span> forceProcessing = pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>();</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a> hash(pblock-&gt;GetHash());</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;            <span class="comment">// Also always process if we requested the block explicitly, as we may</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;            <span class="comment">// need it even though it is not a candidate for a new best tip.</span></div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            forceProcessing |= MarkBlockAsReceived(hash);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;            <span class="comment">// mapBlockSource is only used for sending reject messages and DoS scores,</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            <span class="comment">// so the race between here and cs_main in ProcessNewBlock is fine.</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;            mapBlockSource.emplace(hash, std::make_pair(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), <span class="keyword">true</span>));</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        }</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        <span class="keywordtype">bool</span> fNewBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;        <a class="code" href="validation_8cpp.html#a290fce59049c0951b8eb73f0129bf6f0">ProcessNewBlock</a>(chainparams, pblock, forceProcessing, &amp;fNewBlock);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        <span class="keywordflow">if</span> (fNewBlock)</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#ad253434141efcbca34150864069aee7e">nLastBlockTime</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    }</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a4d0f984b71f9e4c4b8b3619cb3f3dadd">NetMsgType::GETADDR</a>)</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    {</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        <span class="comment">// This asymmetric behavior for inbound and outbound connections was introduced</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;        <span class="comment">// to prevent a fingerprinting attack: an attacker can send specific fake addresses</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        <span class="comment">// to users&#39; AddrMan and later request them by sending getaddr messages.</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;        <span class="comment">// Making nodes which are behind NAT and can only make outgoing connections ignore</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        <span class="comment">// the getaddr message mitigates the attack.</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a>) {</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Ignoring \&quot;getaddr\&quot; from outbound connection. peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        }</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        <span class="comment">// Only send one GetAddr response per connection to reduce resource waste</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="comment">//  and discourage addr stamping of INV announcements.</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#aa8d520199b103410958ba9ce4412cf61">fSentAddr</a>) {</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Ignoring repeated \&quot;getaddr\&quot;. peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        }</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#aa8d520199b103410958ba9ce4412cf61">fSentAddr</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>.clear();</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        std::vector&lt;CAddress&gt; vAddr = connman.<a class="code" href="class_c_connman.html#a4ba34cd3557ab0ba1cfcbe7c18bf1199">GetAddresses</a>();</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <a class="code" href="class_fast_random_context.html">FastRandomContext</a> insecure_rand;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;        BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_address.html">CAddress</a> &amp;addr, vAddr)</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a1f39037c55bed93b832bcbef00597ca5">PushAddress</a>(addr, insecure_rand);</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    }</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a68c340a8ef4f949cfd06c19a620aa32c">NetMsgType::MEMPOOL</a>)</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    {</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="keywordflow">if</span> (!(pfrom-&gt;<a class="code" href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">GetLocalServices</a>() &amp; <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9ca74e44e29a412c070750bdbf2380bb">NODE_BLOOM</a>) &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>)</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;mempool request with bloom filters disabled, disconnect peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        }</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        <span class="keywordflow">if</span> (connman.<a class="code" href="class_c_connman.html#aa12d154df14eef07418a36362d1cb8d7">OutboundTargetReached</a>(<span class="keyword">false</span>) &amp;&amp; !pfrom-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>)</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        {</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;mempool request with bandwidth limit reached, disconnect peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a1e8b0784cc82f33edc2dc4e2834d1ff0">cs_inventory</a>);</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#ac6dfcb66887b3d26d58e25e7d3397016">fSendMempool</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    }</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#ad9a2ba0319f01bf1c26f5206b5156496">NetMsgType::PING</a>)</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    {</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt; <a class="code" href="version_8h.html#aa3feca3b6094096fa1b660159bdcb04a">BIP0031_VERSION</a>)</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        {</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            uint64_t nonce = 0;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;            vRecv &gt;&gt; nonce;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;            <span class="comment">// Echo the message back with the nonce. This allows for two useful features:</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;            <span class="comment">// 1) A remote node can quickly check if the connection is operational</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;            <span class="comment">// 2) Remote nodes can measure the latency of the network thread. If this node</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;            <span class="comment">//    is overloaded it won&#39;t respond to pings quickly and the remote node can</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;            <span class="comment">//    avoid sending us more work, like chain download requests.</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;            <span class="comment">// The nonce stops the remote getting confused between different pings: without</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;            <span class="comment">// it, if the remote node sends a ping once per second and this node takes 5</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;            <span class="comment">// seconds to respond to each, the 5th ping the remote sends would appear to</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;            <span class="comment">// return very quickly.</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a395de13511c6ef9946844ee280b8f08e">NetMsgType::PONG</a>, nonce));</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        }</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    }</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a395de13511c6ef9946844ee280b8f08e">NetMsgType::PONG</a>)</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    {</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        int64_t pingUsecEnd = nTimeReceived;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        uint64_t nonce = 0;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        <span class="keywordtype">size_t</span> nAvail = vRecv.<a class="code" href="class_c_data_stream.html#a0483fe7bccf16aa88bf7272f18a0a7b0">in_avail</a>();</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        <span class="keywordtype">bool</span> bPingFinished = <span class="keyword">false</span>;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        std::string sProblem;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        <span class="keywordflow">if</span> (nAvail &gt;= <span class="keyword">sizeof</span>(nonce)) {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;            vRecv &gt;&gt; nonce;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            <span class="comment">// Only process pong message if there is an outstanding ping (old ping without nonce should never pong)</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a> != 0) {</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                <span class="keywordflow">if</span> (nonce == pfrom-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a>) {</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                    <span class="comment">// Matching pong received, this ping is no longer outstanding</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                    bPingFinished = <span class="keyword">true</span>;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                    int64_t pingUsecTime = pingUsecEnd - pfrom-&gt;<a class="code" href="class_c_node.html#a9f0b0d22b190db2f74afd1b24cff47a1">nPingUsecStart</a>;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                    <span class="keywordflow">if</span> (pingUsecTime &gt; 0) {</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                        <span class="comment">// Successful ping time measurement, replace previous</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                        pfrom-&gt;<a class="code" href="class_c_node.html#ab7986845edae94a0aa0d64b6fcf51a38">nPingUsecTime</a> = pingUsecTime;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                        pfrom-&gt;<a class="code" href="class_c_node.html#a99add23b72cd7eae9ea5c7d16b0fe259">nMinPingUsecTime</a> = std::min(pfrom-&gt;<a class="code" href="class_c_node.html#a99add23b72cd7eae9ea5c7d16b0fe259">nMinPingUsecTime</a>.load(), pingUsecTime);</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                        <span class="comment">// This should never happen</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                        sProblem = <span class="stringliteral">&quot;Timing mishap&quot;</span>;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                    }</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                    <span class="comment">// Nonce mismatches are normal when pings are overlapping</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                    sProblem = <span class="stringliteral">&quot;Nonce mismatch&quot;</span>;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                    <span class="keywordflow">if</span> (nonce == 0) {</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                        <span class="comment">// This is most likely a bug in another implementation somewhere; cancel this ping</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                        bPingFinished = <span class="keyword">true</span>;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                        sProblem = <span class="stringliteral">&quot;Nonce zero&quot;</span>;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                    }</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                }</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                sProblem = <span class="stringliteral">&quot;Unsolicited pong without ping&quot;</span>;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            }</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <span class="comment">// This is most likely a bug in another implementation somewhere; cancel this ping</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            bPingFinished = <span class="keyword">true</span>;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            sProblem = <span class="stringliteral">&quot;Short payload&quot;</span>;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        }</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;        <span class="keywordflow">if</span> (!(sProblem.empty())) {</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;pong peer=%d: %s, %x expected, %x received, %u bytes\n&quot;</span>,</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>,</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                sProblem,</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a>,</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                nonce,</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                nAvail);</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        }</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;        <span class="keywordflow">if</span> (bPingFinished) {</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a> = 0;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;        }</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    }</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#a2d079acb26b8ce9590c977bf923d9037">fAlerts</a> &amp;&amp; strCommand == <a class="code" href="namespace_net_msg_type.html#ac993eb54177079f7a0e8c0c1ad657c6f">NetMsgType::ALERT</a>)</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    {</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        <a class="code" href="class_c_alert.html">CAlert</a> alert;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        vRecv &gt;&gt; alert;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        <a class="code" href="classuint256.html">uint256</a> alertHash = alert.GetHash();</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#ab1b30fa8e48005752f6b0bcf43eca478">setKnown</a>.count(alertHash) == 0)</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        {</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            <span class="keywordflow">if</span> (alert.ProcessAlert(chainparams.<a class="code" href="class_c_chain_params.html#a8ca8fe289d1c3d5851d6aebaf28db22f">AlertKey</a>()))</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            {</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                <span class="comment">// Relay</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#ab1b30fa8e48005752f6b0bcf43eca478">setKnown</a>.insert(alertHash);</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                {</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                    connman.<a class="code" href="class_c_connman.html#a2d665bfdec68f6484b9f0d6760f9efd1">ForEachNode</a>([&amp;alert, &amp;connman](<a class="code" href="class_c_node.html">CNode</a>* pnode) {</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                        alert.RelayTo(pnode, connman);</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                    });</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            }</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                <span class="comment">// Small DoS penalty so peers that send us lots of</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                <span class="comment">// duplicate/expired/invalid-signature/whatever alerts</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                <span class="comment">// eventually get banned.</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                <span class="comment">// This isn&#39;t a Misbehaving(100) (immediate ban) because the</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                <span class="comment">// peer might be an older or different implementation with</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                <span class="comment">// a different signature key, etc.</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 10);</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;            }</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        }</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    }</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a0e95085c85cbbb8330fa1a5ffe49070f">NetMsgType::FILTERLOAD</a>)</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    {</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        <a class="code" href="class_c_bloom_filter.html">CBloomFilter</a> filter;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;        vRecv &gt;&gt; filter;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        <span class="keywordflow">if</span> (!filter.IsWithinSizeConstraints())</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            <span class="comment">// There is no excuse for sending a too-large filter</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        }</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        {</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;            <span class="keyword">delete</span> pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a> = <span class="keyword">new</span> <a class="code" href="class_c_bloom_filter.html">CBloomFilter</a>(filter);</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>-&gt;<a class="code" href="class_c_bloom_filter.html#af98b43e91c82a1e4afc7454e8c5672c2">UpdateEmptyFull</a>();</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#ab387bb0c4ffd42e3f0aea233dca0e301">fRelayTxes</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        }</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    }</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a75c8dba2361ddda663917c27f14c3a16">NetMsgType::FILTERADD</a>)</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    {</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        std::vector&lt;unsigned char&gt; vData;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        vRecv &gt;&gt; vData;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="comment">// Nodes must NEVER send a data item &gt; 520 bytes (the max size for a script data object,</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        <span class="comment">// and thus, the maximum size any matched object can have) in a filteradd message</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="keywordtype">bool</span> bad = <span class="keyword">false</span>;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <span class="keywordflow">if</span> (vData.size() &gt; <a class="code" href="script_8h.html#a4e2e7158597de76ecbb03d866ec4c693">MAX_SCRIPT_ELEMENT_SIZE</a>) {</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;            bad = <span class="keyword">true</span>;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>) {</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>-&gt;<a class="code" href="class_c_bloom_filter.html#abba52843c7c691ef7deb07d9a645dcc2">insert</a>(vData);</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                bad = <span class="keyword">true</span>;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;            }</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        }</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <span class="keywordflow">if</span> (bad) {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), 100);</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        }</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    }</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a1ef3ccc1966cb35a59882fb97c15a30e">NetMsgType::FILTERCLEAR</a>)</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    {</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">GetLocalServices</a>() &amp; <a class="code" href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9ca74e44e29a412c070750bdbf2380bb">NODE_BLOOM</a>) {</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;            <span class="keyword">delete</span> pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a> = <span class="keyword">new</span> <a class="code" href="class_c_bloom_filter.html">CBloomFilter</a>();</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        }</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        pfrom-&gt;<a class="code" href="class_c_node.html#ab387bb0c4ffd42e3f0aea233dca0e301">fRelayTxes</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    }</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a1a6d457786a36cd01e8688d356883a47">NetMsgType::GETMNLISTDIFF</a>) {</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        <a class="code" href="class_c_get_simplified_m_n_list_diff.html">CGetSimplifiedMNListDiff</a> cmd;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        vRecv &gt;&gt; cmd;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <a class="code" href="class_c_simplified_m_n_list_diff.html">CSimplifiedMNListDiff</a> mnListDiff;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;        std::string strError;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="simplifiedmns_8cpp.html#a1478cfcf5bfe0b6bf12e2c7bb628dc40">BuildSimplifiedMNListDiff</a>(cmd.baseBlockHash, cmd.blockHash, mnListDiff, strError)) {</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ac4299daf3e1b6b047287708f3894113e">NetMsgType::MNLISTDIFF</a>, mnListDiff));</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;getmnlistdiff failed for baseBlockHash=%s, blockHash=%s. error=%s\n&quot;</span>, cmd.baseBlockHash.ToString(), cmd.blockHash.ToString(), strError);</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;            <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, 1);</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        }</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    }</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#ac4299daf3e1b6b047287708f3894113e">NetMsgType::MNLISTDIFF</a>) {</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        <span class="comment">// we have never requested this</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <a class="code" href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a>(pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, 100);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;received not-requested mnlistdiff. peer=%d\n&quot;</span>, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    }</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strCommand == <a class="code" href="namespace_net_msg_type.html#a567653d3f26a7e711889682e7fd1c484">NetMsgType::NOTFOUND</a>) {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        <span class="comment">// We do not care about the NOTFOUND message, but logging an Unknown Command</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="comment">// message would be undesirable as we transmit it ourselves.</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    }</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;allMessages = <a class="code" href="protocol_8cpp.html#a5f8d18ec9217ffee378339dc22ebe20d">getAllNetMessageTypes</a>();</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        BOOST_FOREACH(<span class="keyword">const</span> std::string msg, allMessages) {</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;            <span class="keywordflow">if</span>(msg == strCommand) {</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                found = <span class="keyword">true</span>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;            }</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        }</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <span class="keywordflow">if</span> (found)</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        {</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            <span class="comment">//probably one the extensions</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="preprocessor">#ifdef ENABLE_WALLET</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;            <a class="code" href="privatesend-client_8cpp.html#ad3fbbb845524ff48bd48ca41ea5e51a8">privateSendClient</a>.<a class="code" href="class_c_private_send_client_manager.html#a5ffa7ec563a356049bd99301b1d7e55f">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="preprocessor">#endif // ENABLE_WALLET</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;            <a class="code" href="privatesend-server_8cpp.html#a1b2b9915fc9328ffcd70517e5c6d649a">privateSendServer</a>.<a class="code" href="class_c_private_send_server.html#a66c38d7af845bab8e22c37e2165fd5f9">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;            <a class="code" href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a>.<a class="code" href="class_c_masternode_man.html#a0a0dbdc4874b7e92247b89c4b421a32d">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            <a class="code" href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a>.<a class="code" href="class_c_masternode_payments.html#afead8c7f19dfe473ca63e7473ec6ce62">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;            <a class="code" href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a>.<a class="code" href="class_c_instant_send.html#ae5ca0556a65952de6214de498d5f4b4a">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;            <a class="code" href="spork_8cpp.html#af6873019c3095ea6b554795e4040395c">sporkManager</a>.<a class="code" href="class_c_spork_manager.html#a27d0be91a9dac781937ba3656870170e">ProcessSpork</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;            <a class="code" href="masternode-sync_8cpp.html#a9807e6586e8a7cb25799ea4150520448">masternodeSync</a>.<a class="code" href="class_c_masternode_sync.html#aa61c8de4587e4135e08cf860da991542">ProcessMessage</a>(pfrom, strCommand, vRecv);</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;            <a class="code" href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a>.<a class="code" href="class_c_governance_manager.html#a2b6e0b1cc473ed34714723422e0b8ae8">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;            <a class="code" href="namespacellmq.html#a32533f25ea72d1153af50d680a75434d">llmq::quorumBlockProcessor</a>-&gt;<a class="code" href="classllmq_1_1_c_quorum_block_processor.html#aa95f97977868b55a6616b54392d265f4">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;            <a class="code" href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a>-&gt;<a class="code" href="classllmq_1_1_c_dummy_d_k_g.html#a9893bce557af51cf492d7ea3f3d34dcb">ProcessMessage</a>(pfrom, strCommand, vRecv, connman);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        }</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        {</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;            <span class="comment">// Ignore unknown commands for extensibility</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Unknown command \&quot;%s\&quot; from peer=%d\n&quot;</span>, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        }</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;}</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;</div><div class="line"><a name="l02996"></a><span class="lineno"><a class="line" href="net__processing_8cpp.html#a830e1075ea8faa4e48eeec9cef234aa5"> 2996</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="net__processing_8cpp.html#a830e1075ea8faa4e48eeec9cef234aa5">SendRejectsAndCheckIfBanned</a>(<a class="code" href="class_c_node.html">CNode</a>* pnode, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman)</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;{</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <a class="code" href="sync_8h.html#acd61d0cb3b49f367728193720014aed0">AssertLockHeld</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    CNodeState &amp;state = *State(pnode-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    BOOST_FOREACH(<span class="keyword">const</span> CBlockReject&amp; reject, state.rejects) {</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pnode, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, (std::string)<a class="code" href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a>, reject.chRejectCode, reject.strRejectReason, reject.hashBlock));</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    }</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    state.rejects.clear();</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">if</span> (state.fShouldBan) {</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        state.fShouldBan = <span class="keyword">false</span>;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="keywordflow">if</span> (pnode-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>)</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Warning: not punishing whitelisted peer %s!\n&quot;</span>, pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pnode-&gt;<a class="code" href="class_c_node.html#a0496683f25f18d2a12c42083e2ba1d7f">fAddnode</a>)</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Warning: not punishing addnoded peer %s!\n&quot;</span>, pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;            pnode-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;            <span class="keywordflow">if</span> (pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_net_addr.html#a857bfcf95814b7d6ef4db309c84f179d">IsLocal</a>())</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Warning: not banning local peer %s!\n&quot;</span>, pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>.<a class="code" href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">ToString</a>());</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            {</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                connman.<a class="code" href="class_c_connman.html#ac57208a8ea613f814aaf1c5c5e5394a4">Ban</a>(pnode-&gt;<a class="code" href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">addr</a>, <a class="code" href="addrdb_8h.html#ae79eefa5f9d20b9761dfc7a41123e668ae46a4491319b620067723c12d5ba3c7a">BanReasonNodeMisbehaving</a>);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;            }</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        }</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    }</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;}</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"><a class="line" href="net__processing_8h.html#a4d63623e09b10ed9e137471507545fe2"> 3026</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="net__processing_8cpp.html#ab6b29c6674d192d8d881ccf2c0b5e545">ProcessMessages</a>(<a class="code" href="class_c_node.html">CNode</a>* pfrom, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman, <span class="keyword">const</span> std::atomic&lt;bool&gt;&amp; interruptMsgProc)</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;{</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    <span class="keyword">const</span> <a class="code" href="class_c_chain_params.html">CChainParams</a>&amp; chainparams = <a class="code" href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a>();</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="comment">// Message format</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    <span class="comment">//  (4) message start</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="comment">//  (12) command</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    <span class="comment">//  (4) size</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    <span class="comment">//  (4) checksum</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    <span class="comment">//  (x) data</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <span class="keywordtype">bool</span> fMoreWork = <span class="keyword">false</span>;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.empty())</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        <a class="code" href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591">ProcessGetData</a>(pfrom, chainparams.<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>(), connman, interruptMsgProc);</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a>)</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    <span class="comment">// this maintains the order of responses</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.empty()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;        <span class="comment">// Don&#39;t bother if send buffer is too full to respond anyway</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;        <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#a73b323f9e310e3054d909934b37ae671">fPauseSend</a>)</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        std::list&lt;CNetMessage&gt; msgs;</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        {</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a81d6deb661c7386a453e0966d2dbc36f">cs_vProcessMsg</a>);</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;            <span class="keywordflow">if</span> (pfrom-&gt;<a class="code" href="class_c_node.html#aca90abe62ee91e752d59981dd7c4f9ed">vProcessMsg</a>.empty())</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            <span class="comment">// Just take one message</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;            msgs.splice(msgs.begin(), pfrom-&gt;<a class="code" href="class_c_node.html#aca90abe62ee91e752d59981dd7c4f9ed">vProcessMsg</a>, pfrom-&gt;<a class="code" href="class_c_node.html#aca90abe62ee91e752d59981dd7c4f9ed">vProcessMsg</a>.begin());</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a30f76a69e956d342bdbb400541c98ccb">nProcessQueueSize</a> -= msgs.front().vRecv.size() + <a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3add8582d526addef583c978e5261dfec1">CMessageHeader::HEADER_SIZE</a>;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#a108e17226d76c85c89f7d057dad2b088">fPauseRecv</a> = pfrom-&gt;<a class="code" href="class_c_node.html#a30f76a69e956d342bdbb400541c98ccb">nProcessQueueSize</a> &gt; connman.<a class="code" href="class_c_connman.html#a30095fabc2e1727514ad2f2d530a496d">GetReceiveFloodSize</a>();</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;            fMoreWork = !pfrom-&gt;<a class="code" href="class_c_node.html#aca90abe62ee91e752d59981dd7c4f9ed">vProcessMsg</a>.empty();</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;        }</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        <a class="code" href="class_c_net_message.html">CNetMessage</a>&amp; msg(msgs.front());</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        msg.<a class="code" href="class_c_net_message.html#a63b9f2351d5e92126cacacd51d9e16b6">SetVersion</a>(pfrom-&gt;<a class="code" href="class_c_node.html#a82a03d43590c06f85f8fbcf08427674e">GetRecvVersion</a>());</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        <span class="comment">// Scan for message start</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="keywordflow">if</span> (memcmp(msg.hdr.pchMessageStart, chainparams.<a class="code" href="class_c_chain_params.html#a42f81df0a4f3494e3fc83ab53049fdd9">MessageStart</a>(), <a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3a2f7ce2c4181b62b0325854a2b7c392e0">CMessageHeader::MESSAGE_START_SIZE</a>) != 0) {</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;PROCESSMESSAGE: INVALID MESSAGESTART %s peer=%d\n&quot;</span>, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(msg.hdr.GetCommand()), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;            pfrom-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        }</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;        <span class="comment">// Read header</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <a class="code" href="class_c_message_header.html">CMessageHeader</a>&amp; hdr = msg.hdr;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        <span class="keywordflow">if</span> (!hdr.<a class="code" href="class_c_message_header.html#a759db7100358ba4a44bf6dee757ffe51">IsValid</a>(chainparams.<a class="code" href="class_c_chain_params.html#a42f81df0a4f3494e3fc83ab53049fdd9">MessageStart</a>()))</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;        {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;PROCESSMESSAGE: ERRORS IN HEADER %s peer=%d\n&quot;</span>, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(hdr.<a class="code" href="class_c_message_header.html#ab5b3807481d4b918527b86523f1efee2">GetCommand</a>()), pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            <span class="keywordflow">return</span> fMoreWork;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        }</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        std::string strCommand = hdr.<a class="code" href="class_c_message_header.html#ab5b3807481d4b918527b86523f1efee2">GetCommand</a>();</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <span class="comment">// Message size</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMessageSize = hdr.<a class="code" href="class_c_message_header.html#aebbc26feb23d551467ebd58b509204d0">nMessageSize</a>;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        <span class="comment">// Checksum</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <a class="code" href="class_c_data_stream.html">CDataStream</a>&amp; vRecv = msg.vRecv;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash = msg.GetMessageHash();</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="keywordflow">if</span> (memcmp(hash.<a class="code" href="classbase__blob.html#aeee68e00ceeacf49086e98b661e017ff">begin</a>(), hdr.<a class="code" href="class_c_message_header.html#aa0da43a88e43c6ac575b8b3af98b8107">pchChecksum</a>, <a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3ac92b66287a05d5c96bf494ff5a48e726">CMessageHeader::CHECKSUM_SIZE</a>) != 0)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        {</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s(%s, %u bytes): CHECKSUM ERROR expected %s was %s\n&quot;</span>, __func__,</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;               <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), nMessageSize,</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;               <a class="code" href="utilstrencodings_8h.html#ace13a819ca4e98c22847d26b3b357e75">HexStr</a>(hash.<a class="code" href="classbase__blob.html#aeee68e00ceeacf49086e98b661e017ff">begin</a>(), hash.<a class="code" href="classbase__blob.html#aeee68e00ceeacf49086e98b661e017ff">begin</a>()+<a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3ac92b66287a05d5c96bf494ff5a48e726">CMessageHeader::CHECKSUM_SIZE</a>),</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;               <a class="code" href="utilstrencodings_8h.html#ace13a819ca4e98c22847d26b3b357e75">HexStr</a>(hdr.<a class="code" href="class_c_message_header.html#aa0da43a88e43c6ac575b8b3af98b8107">pchChecksum</a>, hdr.<a class="code" href="class_c_message_header.html#aa0da43a88e43c6ac575b8b3af98b8107">pchChecksum</a>+<a class="code" href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3ac92b66287a05d5c96bf494ff5a48e726">CMessageHeader::CHECKSUM_SIZE</a>));</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            <span class="keywordflow">return</span> fMoreWork;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="comment">// Process message</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        <span class="keywordtype">bool</span> fRet = <span class="keyword">false</span>;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="keywordflow">try</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        {</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;            fRet = <a class="code" href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462">ProcessMessage</a>(pfrom, strCommand, vRecv, msg.nTime, chainparams, connman, interruptMsgProc);</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            <span class="keywordflow">if</span> (interruptMsgProc)</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            <span class="keywordflow">if</span> (!pfrom-&gt;<a class="code" href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">vRecvGetData</a>.empty())</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                fMoreWork = <span class="keyword">true</span>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        }</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::ios_base::failure&amp; e)</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        {</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pfrom, <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a>(<a class="code" href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a>).Make(<a class="code" href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a>, strCommand, <a class="code" href="consensus_2validation_8h.html#ae08e367e8cda26747c749b3b313a47a1">REJECT_MALFORMED</a>, std::string(<span class="stringliteral">&quot;error parsing message&quot;</span>)));</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            <span class="keywordflow">if</span> (strstr(e.what(), <span class="stringliteral">&quot;end of data&quot;</span>))</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;            {</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;                <span class="comment">// Allow exceptions from under-length message on vRecv</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s(%s, %u bytes): Exception &#39;%s&#39; caught, normally caused by a message being shorter than its stated length\n&quot;</span>, __func__, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), nMessageSize, e.what());</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            }</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(e.what(), <span class="stringliteral">&quot;size too large&quot;</span>))</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;            {</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                <span class="comment">// Allow exceptions from over-long size</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s(%s, %u bytes): Exception &#39;%s&#39; caught\n&quot;</span>, __func__, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), nMessageSize, e.what());</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;            }</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(e.what(), <span class="stringliteral">&quot;non-canonical ReadCompactSize()&quot;</span>))</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;            {</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;                <span class="comment">// Allow exceptions from non-canonical encoding</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s(%s, %u bytes): Exception &#39;%s&#39; caught\n&quot;</span>, __func__, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), nMessageSize, e.what());</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;            }</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;            {</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;                <a class="code" href="util_8cpp.html#aaada8c5faa502eb0c33fc01294955db8">PrintExceptionContinue</a>(&amp;e, <span class="stringliteral">&quot;ProcessMessages()&quot;</span>);</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;            }</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;        }</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            <a class="code" href="util_8cpp.html#aaada8c5faa502eb0c33fc01294955db8">PrintExceptionContinue</a>(&amp;e, <span class="stringliteral">&quot;ProcessMessages()&quot;</span>);</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;            <a class="code" href="util_8cpp.html#aaada8c5faa502eb0c33fc01294955db8">PrintExceptionContinue</a>(NULL, <span class="stringliteral">&quot;ProcessMessages()&quot;</span>);</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        }</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;        <span class="keywordflow">if</span> (!fRet) {</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;%s(%s, %u bytes) FAILED peer=%d\n&quot;</span>, __func__, <a class="code" href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a>(strCommand), nMessageSize, pfrom-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        }</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>);</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <a class="code" href="net__processing_8cpp.html#a830e1075ea8faa4e48eeec9cef234aa5">SendRejectsAndCheckIfBanned</a>(pfrom, connman);</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="keywordflow">return</span> fMoreWork;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;}</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"><a class="line" href="class_compare_inv_mempool_order.html"> 3146</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_compare_inv_mempool_order.html">CompareInvMempoolOrder</a></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;{</div><div class="line"><a name="l03148"></a><span class="lineno"><a class="line" href="class_compare_inv_mempool_order.html#ad6211dc6a6928d8499d5b58babe95ddd"> 3148</a></span>&#160;    <a class="code" href="class_c_tx_mem_pool.html">CTxMemPool</a> *<a class="code" href="class_compare_inv_mempool_order.html#ad6211dc6a6928d8499d5b58babe95ddd">mp</a>;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l03150"></a><span class="lineno"><a class="line" href="class_compare_inv_mempool_order.html#ab81595ec0e2a66d6be86c893e309a975"> 3150</a></span>&#160;    <a class="code" href="class_compare_inv_mempool_order.html#ab81595ec0e2a66d6be86c893e309a975">CompareInvMempoolOrder</a>(<a class="code" href="class_c_tx_mem_pool.html">CTxMemPool</a> *_mempool)</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    {</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        <a class="code" href="class_compare_inv_mempool_order.html#ad6211dc6a6928d8499d5b58babe95ddd">mp</a> = _mempool;</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    }</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"><a class="line" href="class_compare_inv_mempool_order.html#a1cd3da690b8741dcc21d415f5d8d006f"> 3155</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_compare_inv_mempool_order.html#a1cd3da690b8741dcc21d415f5d8d006f">operator()</a>(std::set&lt;uint256&gt;::iterator a, std::set&lt;uint256&gt;::iterator b)</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    {</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        <span class="comment">/* As std::make_heap produces a max-heap, we want the entries with the</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;<span class="comment">         * fewest ancestors/highest fee to sort later. */</span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_compare_inv_mempool_order.html#ad6211dc6a6928d8499d5b58babe95ddd">mp</a>-&gt;<a class="code" href="class_c_tx_mem_pool.html#a8544d756fb965d312077e9feccb0f4a4">CompareDepthAndScore</a>(*b, *a);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    }</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;};</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div><div class="line"><a name="l03163"></a><span class="lineno"><a class="line" href="net__processing_8h.html#ab46d99ec607ab3015c57a661d0ae3620"> 3163</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="net__processing_8cpp.html#ad0cf88373f93a6b6e3936999e4212643">SendMessages</a>(<a class="code" href="class_c_node.html">CNode</a>* pto, <a class="code" href="class_c_connman.html">CConnman</a>&amp; connman, <span class="keyword">const</span> std::atomic&lt;bool&gt;&amp; interruptMsgProc)</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;{</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_consensus_1_1_params.html">Consensus::Params</a>&amp; consensusParams = <a class="code" href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a>().<a class="code" href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">GetConsensus</a>();</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    {</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        <span class="comment">// Don&#39;t send anything until the version handshake is complete</span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;        <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#a359647a8e7ad1fc72243b126b35729b6">fSuccessfullyConnected</a> || pto-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a>)</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        <span class="comment">// If we get here, the outgoing message serialization version is set and can&#39;t change.</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_c_net_msg_maker.html">CNetMsgMaker</a> msgMaker(pto-&gt;<a class="code" href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">GetSendVersion</a>());</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        <span class="comment">// Message: ping</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        <span class="keywordtype">bool</span> pingSend = <span class="keyword">false</span>;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a2349010606131fe65879e5a44d9ab37e">fPingQueued</a>) {</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;            <span class="comment">// RPC ping request by user</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;            pingSend = <span class="keyword">true</span>;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        }</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a> == 0 &amp;&amp; pto-&gt;<a class="code" href="class_c_node.html#a9f0b0d22b190db2f74afd1b24cff47a1">nPingUsecStart</a> + <a class="code" href="net_8h.html#a24ecbac59f1e63af4c4c8c112f00468d">PING_INTERVAL</a> * 1000000 &lt; <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>()) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;            <span class="comment">// Ping automatically sent as a latency probe &amp; keepalive.</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;            pingSend = <span class="keyword">true</span>;</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        }</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="keywordflow">if</span> (pingSend) {</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;            uint64_t nonce = 0;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;            <span class="keywordflow">while</span> (nonce == 0) {</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;                <a class="code" href="random_8cpp.html#ada0c29949c4d1ac0cc027d93c4771423">GetRandBytes</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;nonce, <span class="keyword">sizeof</span>(nonce));</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;            }</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#a2349010606131fe65879e5a44d9ab37e">fPingQueued</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#a9f0b0d22b190db2f74afd1b24cff47a1">nPingUsecStart</a> = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>();</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;            <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">nVersion</a> &gt; <a class="code" href="version_8h.html#aa3feca3b6094096fa1b660159bdcb04a">BIP0031_VERSION</a>) {</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a> = nonce;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ad9a2ba0319f01bf1c26f5206b5156496">NetMsgType::PING</a>, nonce));</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                <span class="comment">// Peer is too old to support ping command with nonce, pong will never arrive.</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">nPingNonceSent</a> = 0;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#ad9a2ba0319f01bf1c26f5206b5156496">NetMsgType::PING</a>));</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;            }</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;        }</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <a class="code" href="sync_8h.html#aca08e7299069c2d60b8aa726fc550612">TRY_LOCK</a>(<a class="code" href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a>, lockMain); <span class="comment">// Acquire cs_main for IsInitialBlockDownload() and CNodeState()</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        <span class="keywordflow">if</span> (!lockMain)</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="net__processing_8cpp.html#a830e1075ea8faa4e48eeec9cef234aa5">SendRejectsAndCheckIfBanned</a>(pto, connman))</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        CNodeState &amp;state = *State(pto-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="comment">// Address refresh broadcast</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        int64_t nNow = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>();</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>() &amp;&amp; pto-&gt;<a class="code" href="class_c_node.html#af627cc9fe0654487aed7b4224d78ad24">nNextLocalAddrSend</a> &lt; nNow) {</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;            <a class="code" href="net_8cpp.html#a0cde2b3256757536c42c0bd3037847d1">AdvertiseLocal</a>(pto);</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#af627cc9fe0654487aed7b4224d78ad24">nNextLocalAddrSend</a> = <a class="code" href="net_8cpp.html#a66c6216d339978932308c2d68edd5338">PoissonNextSend</a>(nNow, <a class="code" href="validation_8h.html#af818478a7d4382f2527722894fb2e2a4">AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL</a>);</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        }</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        <span class="comment">// Message: addr</span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#aff4b68eeeee9bf1e27e14f2436a07556">nNextAddrSend</a> &lt; nNow) {</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#aff4b68eeeee9bf1e27e14f2436a07556">nNextAddrSend</a> = <a class="code" href="net_8cpp.html#a66c6216d339978932308c2d68edd5338">PoissonNextSend</a>(nNow, <a class="code" href="validation_8h.html#a7ec45a20c72f5a43ec54d6cc213b229d">AVG_ADDRESS_BROADCAST_INTERVAL</a>);</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;            std::vector&lt;CAddress&gt; vAddr;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;            vAddr.reserve(pto-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>.size());</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_address.html">CAddress</a>&amp; addr, pto-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>)</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;            {</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#a3f3a08b1a2c85b1c6cf975b2bdb53171">addrKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a4f7d6161274b03c63be50aadb1fe46b7">contains</a>(addr.<a class="code" href="class_c_service.html#af21ea7db4318330b337c8bfdcc55aff0">GetKey</a>()))</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                {</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                    pto-&gt;<a class="code" href="class_c_node.html#a3f3a08b1a2c85b1c6cf975b2bdb53171">addrKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a0fedbf0cf38c9070a30c7c5f8299f5d7">insert</a>(addr.<a class="code" href="class_c_service.html#af21ea7db4318330b337c8bfdcc55aff0">GetKey</a>());</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                    vAddr.push_back(addr);</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                    <span class="comment">// receiver rejects addr messages larger than 1000</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                    <span class="keywordflow">if</span> (vAddr.size() &gt;= 1000)</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                    {</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a77d83bbf95702906ee01ca4fd934e1c0">NetMsgType::ADDR</a>, vAddr));</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                        vAddr.clear();</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;                    }</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;                }</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            }</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>.clear();</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;            <span class="keywordflow">if</span> (!vAddr.empty())</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a77d83bbf95702906ee01ca4fd934e1c0">NetMsgType::ADDR</a>, vAddr));</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;            <span class="comment">// we only send the big addr message once</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>.capacity() &gt; 40)</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">vAddrToSend</a>.shrink_to_fit();</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        }</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <span class="comment">// Start block sync</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a> == NULL)</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a> = <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>();</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <span class="keywordtype">bool</span> fFetch = state.fPreferredDownload || (nPreferredDownload == 0 &amp;&amp; !pto-&gt;<a class="code" href="class_c_node.html#a721e2470c2c961b7599768a14be68781">fClient</a> &amp;&amp; !pto-&gt;<a class="code" href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">fOneShot</a>); <span class="comment">// Download if this is a nice peer, or we have no nice peers and this one might do.</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        <span class="keywordflow">if</span> (!state.fSyncStarted &amp;&amp; !pto-&gt;<a class="code" href="class_c_node.html#a721e2470c2c961b7599768a14be68781">fClient</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a>) {</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;            <span class="comment">// Only actively request headers from a single peer, unless we&#39;re close to end of initial download.</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;            <span class="keywordflow">if</span> ((nSyncStarted == 0 &amp;&amp; fFetch) || <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() &gt; <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - <a class="code" href="validation_8cpp.html#af66174e55ad9bafa7a92e4740db6b575">nMaxTipAge</a>) {</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                state.fSyncStarted = <span class="keyword">true</span>;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                state.nHeadersSyncTimeout = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>() + <a class="code" href="net__processing_8h.html#a09ba6681dd87e0136d25acc054a335a0">HEADERS_DOWNLOAD_TIMEOUT_BASE</a> + <a class="code" href="net__processing_8h.html#a8a4d3867ceb626ccda62b3b728425d07">HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER</a> * (<a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>())/(consensusParams.<a class="code" href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">nPowTargetSpacing</a>);</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                nSyncStarted++;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindexStart = <a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                <span class="comment">/* If possible, start at the block preceding the currently</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="comment">                   best known header.  This ensures that we always get a</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="comment">                   non-empty list of headers back as long as the peer</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;<span class="comment">                   is up-to-date.  With a non-empty response, we can initialise</span></div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;<span class="comment">                   the peer&#39;s known best block.  This wouldn&#39;t be possible</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;<span class="comment">                   if we requested starting at pindexBestHeader and</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;<span class="comment">                   got back an empty response.  */</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;                <span class="keywordflow">if</span> (pindexStart-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>)</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;                    pindexStart = pindexStart-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a>;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;initial getheaders (%d) to peer=%d (startheight:%d)\n&quot;</span>, pindexStart-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, pto-&gt;<a class="code" href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">nStartingHeight</a>);</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;                connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a>, <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">GetLocator</a>(pindexStart), <a class="code" href="classuint256.html">uint256</a>()));</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;            }</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;        }</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        <span class="comment">// Resend wallet transactions that haven&#39;t gotten in a block yet</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;        <span class="comment">// Except during reindex, importing and IBD, when old wallet</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;        <span class="comment">// transactions become unconfirmed and spams other nodes.</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a> &amp;&amp; !<a class="code" href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a> &amp;&amp; !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>())</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        {</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;            <a class="code" href="validationinterface_8cpp.html#a0aaad62c8654cb1868295e0682b05866">GetMainSignals</a>().<a class="code" href="struct_c_main_signals.html#aa57644d82a75031db4c7436a080d5f92">Broadcast</a>(<a class="code" href="net__processing_8cpp.html#a147efbcf1410c50c56547340f1fe1ebd">nTimeBestReceived</a>, &amp;connman);</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        }</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <span class="comment">// Try sending block announcements via headers</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        {</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            <span class="comment">// If we have less than MAX_BLOCKS_TO_ANNOUNCE in our</span></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;            <span class="comment">// list of block hashes we&#39;re relaying, and our peer wants</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;            <span class="comment">// headers announcements, then find the first header</span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;            <span class="comment">// not yet known to our peer but would connect, and send.</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            <span class="comment">// If no header would connect, or if we have too many</span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;            <span class="comment">// blocks, or if the peer doesn&#39;t want headers, just</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;            <span class="comment">// add all to the inv queue.</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pto-&gt;<a class="code" href="class_c_node.html#a1e8b0784cc82f33edc2dc4e2834d1ff0">cs_inventory</a>);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;            std::vector&lt;CBlock&gt; vHeaders;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;            <span class="keywordtype">bool</span> fRevertToInv = ((!state.fPreferHeaders &amp;&amp;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                                 (!state.fPreferHeaderAndIDs || pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>.size() &gt; 1)) ||</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                                 pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>.size() &gt; <a class="code" href="validation_8h.html#ad4d4718d1ec747708a31bc47aaa66578">MAX_BLOCKS_TO_ANNOUNCE</a>);</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pBestIndex = NULL; <span class="comment">// last header queued for delivery</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            ProcessBlockAvailability(pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>); <span class="comment">// ensure pindexBestKnownBlock is up-to-date</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            <span class="keywordflow">if</span> (!fRevertToInv) {</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                <span class="keywordtype">bool</span> fFoundStartingHeader = <span class="keyword">false</span>;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                <span class="comment">// Try to find first header that our peer doesn&#39;t have, and</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                <span class="comment">// then send all headers past that one.  If we come across any</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                <span class="comment">// headers that aren&#39;t on chainActive, give up.</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a> &amp;hash, pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>) {</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                    BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(hash);</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                    assert(mi != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end());</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex = mi-&gt;second;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>[pindex-&gt;nHeight] != pindex) {</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;                        <span class="comment">// Bail out if we reorged away from this block</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                        fRevertToInv = <span class="keyword">true</span>;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                    }</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                    <span class="keywordflow">if</span> (pBestIndex != NULL &amp;&amp; pindex-&gt;<a class="code" href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">pprev</a> != pBestIndex) {</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;                        <span class="comment">// This means that the list of blocks to announce don&#39;t</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;                        <span class="comment">// connect to each other.</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;                        <span class="comment">// This shouldn&#39;t really be possible to hit during</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;                        <span class="comment">// regular operation (because reorgs should take us to</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;                        <span class="comment">// a chain that has some block not on the prior chain,</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;                        <span class="comment">// which should be caught by the prior check), but one</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;                        <span class="comment">// way this could happen is by using invalidateblock /</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                        <span class="comment">// reconsiderblock repeatedly on the tip, causing it to</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                        <span class="comment">// be added multiple times to vBlockHashesToAnnounce.</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                        <span class="comment">// Robustly deal with this rare situation by reverting</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                        <span class="comment">// to an inv.</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;                        fRevertToInv = <span class="keyword">true</span>;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;                    }</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                    pBestIndex = pindex;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;                    <span class="keywordtype">bool</span> isPrevDevnetGenesisBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;                    <span class="keywordflow">if</span> (!consensusParams.<a class="code" href="struct_consensus_1_1_params.html#ad909dd557f5bf211649f95e0d6d3cbd0">hashDevnetGenesisBlock</a>.<a class="code" href="classbase__blob.html#aba89c6722866a5850882a509d27d7bbd">IsNull</a>() &amp;&amp;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                        pindex-&gt;pprev != <span class="keyword">nullptr</span> &amp;&amp;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                        pindex-&gt;pprev-&gt;GetBlockHash() == consensusParams.<a class="code" href="struct_consensus_1_1_params.html#ad909dd557f5bf211649f95e0d6d3cbd0">hashDevnetGenesisBlock</a>) {</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                        <span class="comment">// even though the devnet genesis block was never transferred through the wire and thus not</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                        <span class="comment">// appear anywhere in the node state where we track what other nodes have or not have, we can</span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                        <span class="comment">// assume that the other node already knows the devnet genesis block</span></div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                        isPrevDevnetGenesisBlock = <span class="keyword">true</span>;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;                    }</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;                    <span class="keywordflow">if</span> (fFoundStartingHeader) {</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;                        <span class="comment">// add this to the headers message</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;                        vHeaders.push_back(pindex-&gt;GetBlockHeader());</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PeerHasHeader(&amp;state, pindex)) {</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                        <span class="keywordflow">continue</span>; <span class="comment">// keep looking for the first new block</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pindex-&gt;pprev == NULL || PeerHasHeader(&amp;state, pindex-&gt;pprev) || isPrevDevnetGenesisBlock) {</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;                        <span class="comment">// Peer doesn&#39;t have this header but they do have the prior one.</span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                        <span class="comment">// Start sending headers.</span></div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                        fFoundStartingHeader = <span class="keyword">true</span>;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;                        vHeaders.push_back(pindex-&gt;GetBlockHeader());</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;                        <span class="comment">// Peer doesn&#39;t have this header or the prior one -- nothing will</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;                        <span class="comment">// connect, so bail out.</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                        fRevertToInv = <span class="keyword">true</span>;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;                    }</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                }</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;            }</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            <span class="keywordflow">if</span> (!fRevertToInv &amp;&amp; !vHeaders.empty()) {</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                <span class="keywordflow">if</span> (vHeaders.size() == 1 &amp;&amp; state.fPreferHeaderAndIDs) {</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;                    <span class="comment">// We only send up to 1 block as header-and-ids, as otherwise</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;                    <span class="comment">// probably means we&#39;re doing an initial-ish-sync or they&#39;re slow</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;%s sending header-and-ids %s to peer=%d\n&quot;</span>, __func__,</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;                            vHeaders.front().GetHash().ToString(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;                    <span class="keywordtype">bool</span> fGotBlockFromCache = <span class="keyword">false</span>;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                    {</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                        <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a>);</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">most_recent_block_hash</a> == pBestIndex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()) {</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                            <a class="code" href="class_c_block_header_and_short_tx_i_ds.html">CBlockHeaderAndShortTxIDs</a> cmpctblock(*<a class="code" href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a>);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a>, cmpctblock));</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                            fGotBlockFromCache = <span class="keyword">true</span>;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;                        }</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;                    }</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;                    <span class="keywordflow">if</span> (!fGotBlockFromCache) {</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;                        <a class="code" href="class_c_block.html">CBlock</a> block;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;                        <span class="keywordtype">bool</span> ret = <a class="code" href="validation_8cpp.html#a578c1df234b05798180f0235d469a5ba">ReadBlockFromDisk</a>(block, pBestIndex, consensusParams);</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;                        assert(ret);</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                        <a class="code" href="class_c_block_header_and_short_tx_i_ds.html">CBlockHeaderAndShortTxIDs</a> cmpctblock(block);</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a>, cmpctblock));</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                    }</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;                    state.pindexBestHeaderSent = pBestIndex;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state.fPreferHeaders) {</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;                    <span class="keywordflow">if</span> (vHeaders.size() &gt; 1) {</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;%s: %u headers, range (%s, %s), to peer=%d\n&quot;</span>, __func__,</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;                                vHeaders.size(),</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;                                vHeaders.front().GetHash().ToString(),</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                                vHeaders.back().GetHash().ToString(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;%s: sending header %s to peer=%d\n&quot;</span>, __func__,</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                                vHeaders.front().GetHash().ToString(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;                    }</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#a216e35db319a5d508043639fd3170776">NetMsgType::HEADERS</a>, vHeaders));</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;                    state.pindexBestHeaderSent = pBestIndex;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;                } <span class="keywordflow">else</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;                    fRevertToInv = <span class="keyword">true</span>;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;            }</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;            <span class="keywordflow">if</span> (fRevertToInv) {</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;                <span class="comment">// If falling back to using an inv, just try to inv the tip.</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;                <span class="comment">// The last entry in vBlockHashesToAnnounce was our tip at some point</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;                <span class="comment">// in the past.</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;                <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>.empty()) {</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a> &amp;hashToAnnounce = pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>.back();</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;                    BlockMap::iterator mi = <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.find(hashToAnnounce);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;                    assert(mi != <a class="code" href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a>.end());</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;                    <span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex = mi-&gt;second;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;                    <span class="comment">// Warn if we&#39;re announcing a block that is not on the main chain.</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;                    <span class="comment">// This should be very rare and could be optimized out.</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                    <span class="comment">// Just log for now.</span></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>[pindex-&gt;nHeight] != pindex) {</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Announcing block %s not on main chain (tip=%s)\n&quot;</span>,</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;                            hashToAnnounce.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(), <a class="code" href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a>.<a class="code" href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">Tip</a>()-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;                    }</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;                    <span class="comment">// If the peer&#39;s chain has this block, don&#39;t inv it back.</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                    <span class="keywordflow">if</span> (!PeerHasHeader(&amp;state, pindex)) {</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;                        pto-&gt;<a class="code" href="class_c_node.html#a7cef2333aa8776127a7e7fcab659eb6a">PushInventory</a>(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, hashToAnnounce));</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;%s: sending inv peer=%d hash=%s\n&quot;</span>, __func__,</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;                            pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>, hashToAnnounce.<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>());</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                    }</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;                }</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;            }</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">vBlockHashesToAnnounce</a>.clear();</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        }</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        <span class="comment">// Message: inventory</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        std::vector&lt;CInv&gt; vInv;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        {</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;            <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pto-&gt;<a class="code" href="class_c_node.html#a1e8b0784cc82f33edc2dc4e2834d1ff0">cs_inventory</a>);</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;            vInv.reserve(std::max&lt;size_t&gt;(pto-&gt;<a class="code" href="class_c_node.html#a0c940addacc47f19170b460b03068fac">vInventoryBlockToSend</a>.size(), <a class="code" href="validation_8h.html#a056ffe69f04e219f29370df9bfc8ee1b">INVENTORY_BROADCAST_MAX_PER_1MB_BLOCK</a> * <a class="code" href="consensus_8h.html#aa372df0d6494f4aaca5ecf5a5a9d4406">MaxBlockSize</a>(<span class="keyword">true</span>) / 1000000));</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;            <span class="comment">// Add blocks</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash, pto-&gt;<a class="code" href="class_c_node.html#a0c940addacc47f19170b460b03068fac">vInventoryBlockToSend</a>) {</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;                vInv.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, hash));</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                <span class="keywordflow">if</span> (vInv.size() == <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>) {</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                    vInv.clear();</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                }</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;            }</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#a0c940addacc47f19170b460b03068fac">vInventoryBlockToSend</a>.clear();</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;            <span class="comment">// Check whether periodic sends should happen</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;            <span class="comment">// Note: If this node is running in a Masternode mode, it makes no sense to delay outgoing txes</span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;            <span class="comment">// because we never produce any txes ourselves i.e. no privacy is lost in this case.</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;            <span class="keywordtype">bool</span> fSendTrickle = pto-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a> || <a class="code" href="util_8cpp.html#aab0b2c1be849102968dfee289f3b3e2a">fMasternodeMode</a>;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;            <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a89226be680d821f4eef8fa391f4b4b6a">nNextInvSend</a> &lt; nNow) {</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                fSendTrickle = <span class="keyword">true</span>;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;                <span class="comment">// Use half the delay for regular outbound peers, as there is less privacy concern for them,</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                <span class="comment">// and quarter the delay for Masternode outbound peers, as there is even less privacy concern in this case.</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a89226be680d821f4eef8fa391f4b4b6a">nNextInvSend</a> = <a class="code" href="net_8cpp.html#a66c6216d339978932308c2d68edd5338">PoissonNextSend</a>(nNow, <a class="code" href="validation_8h.html#aad50a92403104f85b18da00f816ce475">INVENTORY_BROADCAST_INTERVAL</a> &gt;&gt; !pto-&gt;<a class="code" href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">fInbound</a> &gt;&gt; pto-&gt;<a class="code" href="class_c_node.html#a119824dcaebcd3c8e272a68f19a60c43">fMasternode</a>);</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;            }</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;            <span class="comment">// Time to send but the peer has requested we not relay transactions.</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            <span class="keywordflow">if</span> (fSendTrickle) {</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pto-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#ab387bb0c4ffd42e3f0aea233dca0e301">fRelayTxes</a>) pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.clear();</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            }</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;            <span class="comment">// Respond to BIP35 mempool requests</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;            <span class="keywordflow">if</span> (fSendTrickle &amp;&amp; pto-&gt;<a class="code" href="class_c_node.html#ac6dfcb66887b3d26d58e25e7d3397016">fSendMempool</a>) {</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;                <span class="keyword">auto</span> vtxinfo = <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#a53f08d964e4fdf9c70e89bb9719d7d64">infoAll</a>();</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#ac6dfcb66887b3d26d58e25e7d3397016">fSendMempool</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pto-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; txinfo : vtxinfo) {</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classuint256.html">uint256</a>&amp; hash = txinfo.tx-&gt;GetHash();</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                    <a class="code" href="class_c_inv.html">CInv</a> inv(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>, hash);</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;                    pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.erase(hash);</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                    <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>) {</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;                        <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>-&gt;<a class="code" href="class_c_bloom_filter.html#aec420a9b66ab133090c2b4b8ed286f79">IsRelevantAndUpdate</a>(*txinfo.tx)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                    }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                    pto-&gt;<a class="code" href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">filterInventoryKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a0fedbf0cf38c9070a30c7c5f8299f5d7">insert</a>(hash);</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- queued inv: %s  index=%d peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>(), vInv.size(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;                    vInv.push_back(inv);</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;                    <span class="keywordflow">if</span> (vInv.size() == <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>) {</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                        <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- pushing inv&#39;s: count=%d peer=%d\n&quot;</span>, vInv.size(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                        vInv.clear();</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                    }</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                }</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a91ddde2164145c8d4ab033e7b75bbc40">timeLastMempoolReq</a> = <a class="code" href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>();</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;            }</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;            <span class="comment">// Determine transactions to relay</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            <span class="keywordflow">if</span> (fSendTrickle) {</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                <span class="comment">// Produce a vector with all candidates for sending</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                std::vector&lt;std::set&lt;uint256&gt;::iterator&gt; vInvTx;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                vInvTx.reserve(pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.size());</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                <span class="keywordflow">for</span> (std::set&lt;uint256&gt;::iterator it = pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.begin(); it != pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.end(); it++) {</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                    vInvTx.push_back(it);</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                }</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                <span class="comment">// Topologically and fee-rate sort the inventory we send for privacy and priority reasons.</span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;                <span class="comment">// A heap is used so that not all items need sorting if only a few are being sent.</span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;                <a class="code" href="class_compare_inv_mempool_order.html">CompareInvMempoolOrder</a> compareInvMempoolOrder(&amp;<a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>);</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;                std::make_heap(vInvTx.begin(), vInvTx.end(), compareInvMempoolOrder);</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;                <span class="comment">// No reason to drain out at many times the network&#39;s capacity,</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;                <span class="comment">// especially since we have many peers and some will draw much shorter delays.</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nRelayedTransactions = 0;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;                <a class="code" href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(pto-&gt;<a class="code" href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">cs_filter</a>);</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;                <span class="keywordflow">while</span> (!vInvTx.empty() &amp;&amp; nRelayedTransactions &lt; <a class="code" href="validation_8h.html#a056ffe69f04e219f29370df9bfc8ee1b">INVENTORY_BROADCAST_MAX_PER_1MB_BLOCK</a> * <a class="code" href="consensus_8h.html#aa372df0d6494f4aaca5ecf5a5a9d4406">MaxBlockSize</a>(<span class="keyword">true</span>) / 1000000) {</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                    <span class="comment">// Fetch the top element from the heap</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;                    std::pop_heap(vInvTx.begin(), vInvTx.end(), compareInvMempoolOrder);</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;                    std::set&lt;uint256&gt;::iterator it = vInvTx.back();</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;                    vInvTx.pop_back();</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;                    <a class="code" href="classuint256.html">uint256</a> hash = *it;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;                    <span class="comment">// Remove it from the to-be-sent set</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;                    pto-&gt;<a class="code" href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">setInventoryTxToSend</a>.erase(it);</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                    <span class="comment">// Check if not in the filter already</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;                    <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">filterInventoryKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a4f7d6161274b03c63be50aadb1fe46b7">contains</a>(hash)) {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                    }</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                    <span class="comment">// Not in the mempool anymore? don&#39;t bother sending it.</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;                    <span class="keyword">auto</span> txinfo = <a class="code" href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a>.<a class="code" href="class_c_tx_mem_pool.html#acf4bb9f52c40164659f484d45d09ecc4">info</a>(hash);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;                    <span class="keywordflow">if</span> (!txinfo.tx) {</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;                    }</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;                    <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a> &amp;&amp; !pto-&gt;<a class="code" href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">pfilter</a>-&gt;<a class="code" href="class_c_bloom_filter.html#aec420a9b66ab133090c2b4b8ed286f79">IsRelevantAndUpdate</a>(*txinfo.tx)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;                    <span class="comment">// Send</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                    vInv.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a>, hash));</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                    nRelayedTransactions++;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;                    {</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;                        <span class="comment">// Expire old relay messages</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;                        <span class="keywordflow">while</span> (!vRelayExpiration.empty() &amp;&amp; vRelayExpiration.front().first &lt; nNow)</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;                        {</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;                            mapRelay.erase(vRelayExpiration.front().second);</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;                            vRelayExpiration.pop_front();</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;                        }</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                        <span class="keyword">auto</span> ret = mapRelay.insert(std::make_pair(hash, std::move(txinfo.tx)));</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;                        <span class="keywordflow">if</span> (ret.second) {</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;                            vRelayExpiration.push_back(std::make_pair(nNow + 15 * 60 * 1000000, ret.first));</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;                        }</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                    }</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                    <span class="keywordflow">if</span> (vInv.size() == <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>) {</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;                        connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;                        vInv.clear();</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;                    }</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                    pto-&gt;<a class="code" href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">filterInventoryKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a0fedbf0cf38c9070a30c7c5f8299f5d7">insert</a>(hash);</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;                }</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;            }</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;            <span class="comment">// Send non-tx/non-block inventory items</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; inv : pto-&gt;<a class="code" href="class_c_node.html#aca9fdf7c1fa23060ef2769cc4ec85423">vInventoryOtherToSend</a>) {</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;                <span class="keywordflow">if</span> (pto-&gt;<a class="code" href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">filterInventoryKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a4f7d6161274b03c63be50aadb1fe46b7">contains</a>(inv.hash)) {</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;                }</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                vInv.push_back(inv);</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">filterInventoryKnown</a>.<a class="code" href="class_c_rolling_bloom_filter.html#a0fedbf0cf38c9070a30c7c5f8299f5d7">insert</a>(inv.hash);</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                <span class="keywordflow">if</span> (vInv.size() == <a class="code" href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a>) {</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;                    vInv.clear();</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;                }</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;            }</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#aca9fdf7c1fa23060ef2769cc4ec85423">vInventoryOtherToSend</a>.clear();</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;        }</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;        <span class="keywordflow">if</span> (!vInv.empty())</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a>, vInv));</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;        <span class="comment">// Detect whether we&#39;re stalling</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;        nNow = <a class="code" href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a>();</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        <span class="keywordflow">if</span> (state.nStallingSince &amp;&amp; state.nStallingSince &lt; nNow - 1000000 * <a class="code" href="validation_8h.html#a0a0634a396d3b8ca22455aa4158daf48">BLOCK_STALLING_TIMEOUT</a>) {</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;            <span class="comment">// Stalling only triggers when the block download window cannot move. During normal steady state,</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;            <span class="comment">// the download window should be much larger than the to-be-downloaded set of blocks, so disconnection</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;            <span class="comment">// should only happen during initial block download.</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;            <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Peer=%d is stalling block download, disconnecting\n&quot;</span>, pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        }</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        <span class="comment">// In case there is a block that has been in flight from this peer for 2 + 0.5 * N times the block interval</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        <span class="comment">// (with N the number of peers from which we&#39;re downloading validated blocks), disconnect due to timeout.</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        <span class="comment">// We compensate for other peers to prevent killing off peers due to our own downstream link</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;        <span class="comment">// being saturated. We only count validated in-flight blocks so peers can&#39;t advertise non-existing block hashes</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;        <span class="comment">// to unreasonably increase our timeout.</span></div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        <span class="keywordflow">if</span> (state.vBlocksInFlight.size() &gt; 0) {</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;            QueuedBlock &amp;queuedBlock = state.vBlocksInFlight.front();</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;            <span class="keywordtype">int</span> nOtherPeersWithValidatedDownloads = nPeersWithValidatedDownloads - (state.nBlocksInFlightValidHeaders &gt; 0);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;            <span class="keywordflow">if</span> (nNow &gt; state.nDownloadingSince + consensusParams.<a class="code" href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">nPowTargetSpacing</a> * (<a class="code" href="validation_8h.html#a8483db75666c2a1d231108b125b0b3bf">BLOCK_DOWNLOAD_TIMEOUT_BASE</a> + <a class="code" href="validation_8h.html#a98597d505d0e8c99870eeda3db92f42f">BLOCK_DOWNLOAD_TIMEOUT_PER_PEER</a> * nOtherPeersWithValidatedDownloads)) {</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;                <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Timeout downloading block %s from peer=%d, disconnecting\n&quot;</span>, queuedBlock.hash.ToString(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;            }</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        }</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        <span class="comment">// Check for headers sync timeouts</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        <span class="keywordflow">if</span> (state.fSyncStarted &amp;&amp; state.nHeadersSyncTimeout &lt; std::numeric_limits&lt;int64_t&gt;::max()) {</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;            <span class="comment">// Detect whether this is a stalling initial-headers-sync peer</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a>-&gt;<a class="code" href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">GetBlockTime</a>() &lt;= <a class="code" href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a>() - <a class="code" href="validation_8cpp.html#af66174e55ad9bafa7a92e4740db6b575">nMaxTipAge</a>) {</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                <span class="keywordflow">if</span> (nNow &gt; state.nHeadersSyncTimeout &amp;&amp; nSyncStarted == 1 &amp;&amp; (nPreferredDownload - state.fPreferredDownload &gt;= 1)) {</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                    <span class="comment">// Disconnect a (non-whitelisted) peer if it is our only sync peer,</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;                    <span class="comment">// and we have others we could be using instead.</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;                    <span class="comment">// Note: If all our peers are inbound, then we won&#39;t</span></div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;                    <span class="comment">// disconnect our sync peer for stalling; we have bigger</span></div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                    <span class="comment">// problems if we can&#39;t get any outbound peers.</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;                    <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">fWhitelisted</a>) {</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Timeout downloading headers from peer=%d, disconnecting\n&quot;</span>, pto-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                        pto-&gt;<a class="code" href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">fDisconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                        <a class="code" href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a>(<span class="stringliteral">&quot;Timeout downloading headers from whitelisted peer=%d, not disconnecting\n&quot;</span>, pto-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>());</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                        <span class="comment">// Reset the headers sync state so that we have a</span></div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                        <span class="comment">// chance to try downloading from a different peer.</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                        <span class="comment">// Note: this will also result in at least one more</span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                        <span class="comment">// getheaders message to be sent to</span></div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                        <span class="comment">// this peer (eventually).</span></div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;                        state.fSyncStarted = <span class="keyword">false</span>;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;                        nSyncStarted--;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                        state.nHeadersSyncTimeout = 0;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                    }</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;                }</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                <span class="comment">// After we&#39;ve caught up once, reset the timeout so we can&#39;t trigger</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                <span class="comment">// disconnect later.</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                state.nHeadersSyncTimeout = std::numeric_limits&lt;int64_t&gt;::max();</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;            }</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;        }</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;        <span class="comment">// Message: getdata (blocks)</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;        std::vector&lt;CInv&gt; vGetData;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;        <span class="keywordflow">if</span> (!pto-&gt;<a class="code" href="class_c_node.html#a721e2470c2c961b7599768a14be68781">fClient</a> &amp;&amp; (fFetch || !<a class="code" href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a>()) &amp;&amp; state.nBlocksInFlight &lt; <a class="code" href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a>) {</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;            std::vector&lt;const CBlockIndex*&gt; vToDownload;</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;            <a class="code" href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a> staller = -1;</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;            FindNextBlocksToDownload(pto-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), <a class="code" href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a> - state.nBlocksInFlight, vToDownload, staller, consensusParams);</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;            BOOST_FOREACH(<span class="keyword">const</span> <a class="code" href="class_c_block_index.html">CBlockIndex</a> *pindex, vToDownload) {</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                vGetData.push_back(<a class="code" href="class_c_inv.html">CInv</a>(<a class="code" href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>()));</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                MarkBlockAsInFlight(pto-&gt;<a class="code" href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">GetId</a>(), pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>(), consensusParams, pindex);</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Requesting block %s (%d) peer=%d\n&quot;</span>, pindex-&gt;<a class="code" href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">GetBlockHash</a>().<a class="code" href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">ToString</a>(),</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                    pindex-&gt;<a class="code" href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">nHeight</a>, pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;            }</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;            <span class="keywordflow">if</span> (state.nBlocksInFlight == 0 &amp;&amp; staller != -1) {</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                <span class="keywordflow">if</span> (State(staller)-&gt;nStallingSince == 0) {</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;                    State(staller)-&gt;nStallingSince = nNow;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;Stall started peer=%d\n&quot;</span>, staller);</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;                }</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;            }</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;        }</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;        <span class="comment">// Message: getdata (non-blocks)</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        <span class="keywordflow">while</span> (!pto-&gt;<a class="code" href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">mapAskFor</a>.empty() &amp;&amp; (*pto-&gt;<a class="code" href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">mapAskFor</a>.begin()).first &lt;= nNow)</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;        {</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_c_inv.html">CInv</a>&amp; inv = (*pto-&gt;<a class="code" href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">mapAskFor</a>.begin()).second;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a>(inv))</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;            {</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- GETDATA -- requesting inv = %s peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                vGetData.push_back(inv);</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                <span class="keywordflow">if</span> (vGetData.size() &gt;= 1000)</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                {</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                    connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vGetData));</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                    <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- GETDATA -- pushed size = %lu peer=%d\n&quot;</span>, vGetData.size(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                    vGetData.clear();</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                }</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                <span class="comment">//If we&#39;re not going to ask, don&#39;t expect a response.</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- GETDATA -- already have inv = %s peer=%d\n&quot;</span>, inv.<a class="code" href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">ToString</a>(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                pto-&gt;<a class="code" href="class_c_node.html#a9c8fd0d0ef6e26896c53380e6d6bf331">setAskFor</a>.erase(inv.<a class="code" href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">hash</a>);</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;            }</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;            pto-&gt;<a class="code" href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">mapAskFor</a>.erase(pto-&gt;<a class="code" href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">mapAskFor</a>.begin());</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        }</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keywordflow">if</span> (!vGetData.empty()) {</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;            connman.<a class="code" href="class_c_connman.html#adc69330bc472e50487030c031d5063db">PushMessage</a>(pto, msgMaker.Make(<a class="code" href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a>, vGetData));</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;            <a class="code" href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a>(<span class="stringliteral">&quot;net&quot;</span>, <span class="stringliteral">&quot;SendMessages -- GETDATA -- pushed size = %lu peer=%d\n&quot;</span>, vGetData.size(), pto-&gt;<a class="code" href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">id</a>);</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        }</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    }</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;}</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div><div class="line"><a name="l03673"></a><span class="lineno"><a class="line" href="class_c_net_processing_cleanup.html"> 3673</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_c_net_processing_cleanup.html">CNetProcessingCleanup</a></div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;{</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l03676"></a><span class="lineno"><a class="line" href="class_c_net_processing_cleanup.html#a95f2af12fa0b9c384a80511f4b21090c"> 3676</a></span>&#160;    <a class="code" href="class_c_net_processing_cleanup.html#a95f2af12fa0b9c384a80511f4b21090c">CNetProcessingCleanup</a>() {}</div><div class="line"><a name="l03677"></a><span class="lineno"><a class="line" href="class_c_net_processing_cleanup.html#a110dfb98118bb2377fc7662fd05e4269"> 3677</a></span>&#160;    <a class="code" href="class_c_net_processing_cleanup.html#a110dfb98118bb2377fc7662fd05e4269">~CNetProcessingCleanup</a>() {</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;        <span class="comment">// orphan transactions</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;        mapOrphanTransactions.clear();</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;        mapOrphanTransactionsByPrev.clear();</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;    }</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;} <a class="code" href="net__processing_8cpp.html#a450d2be8350b29dcb4f3adc3325f56b2">instance_of_cnetprocessingcleanup</a>;</div><div class="ttc" id="class_c_connman_html_a9b7efcca91a687285efcbad17523e0bf"><div class="ttname"><a href="class_c_connman.html#a9b7efcca91a687285efcbad17523e0bf">CConnman::ForEachNodeThen</a></div><div class="ttdeci">void ForEachNodeThen(const Condition &amp;cond, Callable &amp;&amp;pre, CallableAfter &amp;&amp;post)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00272">net.h:272</a></div></div>
<div class="ttc" id="class_c_block_index_html_a31e65c1f491d438dfdcd8d92bdfa73a1"><div class="ttname"><a href="class_c_block_index.html#a31e65c1f491d438dfdcd8d92bdfa73a1">CBlockIndex::nChainWork</a></div><div class="ttdeci">arith_uint256 nChainWork</div><div class="ttdoc">(memory only) Total amount of work (expected number of hashes) in the chain up to and including this ...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00179">chain.h:179</a></div></div>
<div class="ttc" id="struct_c_node_signals_html_a1ce7c2d878dee3b81732b8ded51a7d6a"><div class="ttname"><a href="struct_c_node_signals.html#a1ce7c2d878dee3b81732b8ded51a7d6a">CNodeSignals::InitializeNode</a></div><div class="ttdeci">boost::signals2::signal&lt; void(CNode *, CConnman &amp;)&gt; InitializeNode</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00550">net.h:550</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a8b94e14857fd0ee095d5ebf4e6cb9be4"><div class="ttname"><a href="namespace_net_msg_type.html#a8b94e14857fd0ee095d5ebf4e6cb9be4">NetMsgType::TXLOCKVOTE</a></div><div class="ttdeci">const char * TXLOCKVOTE</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00044">protocol.cpp:44</a></div></div>
<div class="ttc" id="blockencodings_8h_html_a736e4f9aaa454215e8d1177394e170a6"><div class="ttname"><a href="blockencodings_8h.html#a736e4f9aaa454215e8d1177394e170a6">ReadStatus</a></div><div class="ttdeci">enum ReadStatus_t ReadStatus</div></div>
<div class="ttc" id="namespace_net_msg_type_html_ad9a2ba0319f01bf1c26f5206b5156496"><div class="ttname"><a href="namespace_net_msg_type.html#ad9a2ba0319f01bf1c26f5206b5156496">NetMsgType::PING</a></div><div class="ttdeci">const char * PING</div><div class="ttdoc">The ping message is sent periodically to help confirm that the receiving peer is still connected...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00029">protocol.cpp:29</a></div></div>
<div class="ttc" id="validation_8cpp_html_a08c25cc0ab8b9731b46a1bfbe6057fca"><div class="ttname"><a href="validation_8cpp.html#a08c25cc0ab8b9731b46a1bfbe6057fca">GetBlockHash</a></div><div class="ttdeci">bool GetBlockHash(uint256 &amp;hashRet, int nBlockHeight)</div><div class="ttdoc">Return true if hash can be found in chainActive at nBlockHeight height. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l01872">validation.cpp:1872</a></div></div>
<div class="ttc" id="net__processing_8h_html"><div class="ttname"><a href="net__processing_8h.html">net_processing.h</a></div></div>
<div class="ttc" id="privatesend-client_8h_html"><div class="ttname"><a href="privatesend-client_8h.html">privatesend-client.h</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a8ba236d72126857f35e106fb4ebde610"><div class="ttname"><a href="net__processing_8cpp.html#a8ba236d72126857f35e106fb4ebde610">LimitOrphanTxSize</a></div><div class="ttdeci">unsigned int LimitOrphanTxSize(unsigned int nMaxOrphans) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00680">net_processing.cpp:680</a></div></div>
<div class="ttc" id="class_c_node_html_a99f92c681f695eb637e0ffa050559b46"><div class="ttname"><a href="class_c_node.html#a99f92c681f695eb637e0ffa050559b46">CNode::nPingNonceSent</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; nPingNonceSent</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00792">net.h:792</a></div></div>
<div class="ttc" id="group__algorithm_html_ga97883642477d6b1e8a2b8525fc113758"><div class="ttname"><a href="group__algorithm.html#ga97883642477d6b1e8a2b8525fc113758">immer::copy</a></div><div class="ttdeci">OutIter copy(Range &amp;&amp;r, OutIter out)</div><div class="ttdef"><b>Definition:</b> <a href="algorithm_8hpp_source.html#l00168">algorithm.hpp:168</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a0e95085c85cbbb8330fa1a5ffe49070f"><div class="ttname"><a href="namespace_net_msg_type.html#a0e95085c85cbbb8330fa1a5ffe49070f">NetMsgType::FILTERLOAD</a></div><div class="ttdeci">const char * FILTERLOAD</div><div class="ttdoc">The filterload message tells the receiving peer to filter all relayed transactions and requested merk...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00033">protocol.cpp:33</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ae5af2ea09090341213f7021f7741e929"><div class="ttname"><a href="namespace_net_msg_type.html#ae5af2ea09090341213f7021f7741e929">NetMsgType::MERKLEBLOCK</a></div><div class="ttdeci">const char * MERKLEBLOCK</div><div class="ttdoc">The merkleblock message is a reply to a getdata message which requested a block using the inventory t...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00021">protocol.cpp:21</a></div></div>
<div class="ttc" id="class_c_node_html_a73b323f9e310e3054d909934b37ae671"><div class="ttname"><a href="class_c_node.html#a73b323f9e310e3054d909934b37ae671">CNode::fPauseSend</a></div><div class="ttdeci">std::atomic_bool fPauseSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00745">net.h:745</a></div></div>
<div class="ttc" id="masternodeman_8cpp_html_a2e783a9a58e9d1ee1535c9890ff48693"><div class="ttname"><a href="masternodeman_8cpp.html#a2e783a9a58e9d1ee1535c9890ff48693">mnodeman</a></div><div class="ttdeci">CMasternodeMan mnodeman</div><div class="ttdoc">Masternode manager. </div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8cpp_source.html#l00029">masternodeman.cpp:29</a></div></div>
<div class="ttc" id="class_c_message_header_html_aa0da43a88e43c6ac575b8b3af98b8107"><div class="ttname"><a href="class_c_message_header.html#aa0da43a88e43c6ac575b8b3af98b8107">CMessageHeader::pchChecksum</a></div><div class="ttdeci">uint8_t pchChecksum[CHECKSUM_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00062">protocol.h:62</a></div></div>
<div class="ttc" id="validation_8h_html_a6cee75436117a7a79d4e0bc5b87bc2a6"><div class="ttname"><a href="validation_8h.html#a6cee75436117a7a79d4e0bc5b87bc2a6">MAX_BLOCKTXN_DEPTH</a></div><div class="ttdeci">static const int MAX_BLOCKTXN_DEPTH</div><div class="ttdoc">Maximum depth of blocks we&amp;#39;re willing to respond to GETBLOCKTXN requests for. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00098">validation.h:98</a></div></div>
<div class="ttc" id="class_c_masternode_payee_html"><div class="ttname"><a href="class_c_masternode_payee.html">CMasternodePayee</a></div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8h_source.html#l00040">masternode-payments.h:40</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a263ae1b219e81c6c3de9b65ee52605a9"><div class="ttname"><a href="net__processing_8cpp.html#a263ae1b219e81c6c3de9b65ee52605a9">most_recent_compact_block</a></div><div class="ttdeci">static std::shared_ptr&lt; const CBlockHeaderAndShortTxIDs &gt; most_recent_compact_block</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00783">net_processing.cpp:783</a></div></div>
<div class="ttc" id="masternode-sync_8cpp_html_a9807e6586e8a7cb25799ea4150520448"><div class="ttname"><a href="masternode-sync_8cpp.html#a9807e6586e8a7cb25799ea4150520448">masternodeSync</a></div><div class="ttdeci">CMasternodeSync masternodeSync</div><div class="ttdef"><b>Definition:</b> <a href="masternode-sync_8cpp_source.html#l00017">masternode-sync.cpp:17</a></div></div>
<div class="ttc" id="class_c_alert_html_a9d582022603b03d52731e2a1427f6355"><div class="ttname"><a href="class_c_alert.html#a9d582022603b03d52731e2a1427f6355">CAlert::RelayTo</a></div><div class="ttdeci">bool RelayTo(CNode *pnode, CConnman &amp;connman) const</div><div class="ttdef"><b>Definition:</b> <a href="alert_8cpp_source.html#l00126">alert.cpp:126</a></div></div>
<div class="ttc" id="class_c_node_html_a253ceac237f69cc1155bfb71acd0c48f"><div class="ttname"><a href="class_c_node.html#a253ceac237f69cc1155bfb71acd0c48f">CNode::GetSendVersion</a></div><div class="ttdeci">int GetSendVersion() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00762">net.cpp:762</a></div></div>
<div class="ttc" id="class_c_message_header_html_a02dcbb01fac09d6a8b223df5c38b9eb3a2f7ce2c4181b62b0325854a2b7c392e0"><div class="ttname"><a href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3a2f7ce2c4181b62b0325854a2b7c392e0">CMessageHeader::MESSAGE_START_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00031">protocol.h:31</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ac23245c939bfe57d37c0a2db68e05e05"><div class="ttname"><a href="namespace_net_msg_type.html#ac23245c939bfe57d37c0a2db68e05e05">NetMsgType::BLOCKTXN</a></div><div class="ttdeci">const char * BLOCKTXN</div><div class="ttdoc">Contains a BlockTransactions. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00041">protocol.cpp:41</a></div></div>
<div class="ttc" id="validation_8cpp_html_ab3d3252ad7773f86035217d3a08f16ba"><div class="ttname"><a href="validation_8cpp.html#ab3d3252ad7773f86035217d3a08f16ba">fPruneMode</a></div><div class="ttdeci">bool fPruneMode</div><div class="ttdoc">True if we&amp;#39;re running in -prune mode. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00084">validation.cpp:84</a></div></div>
<div class="ttc" id="privatesend-server_8cpp_html_a1b2b9915fc9328ffcd70517e5c6d649a"><div class="ttname"><a href="privatesend-server_8cpp.html#a1b2b9915fc9328ffcd70517e5c6d649a">privateSendServer</a></div><div class="ttdeci">CPrivateSendServer privateSendServer</div><div class="ttdef"><b>Definition:</b> <a href="privatesend-server_8cpp_source.html#l00019">privatesend-server.cpp:19</a></div></div>
<div class="ttc" id="class_c_masternode_payee_html_af2747237a8d66937df059cf74fcbac92"><div class="ttname"><a href="class_c_masternode_payee.html#af2747237a8d66937df059cf74fcbac92">CMasternodePayee::GetVoteHashes</a></div><div class="ttdeci">std::vector&lt; uint256 &gt; GetVoteHashes() const</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8h_source.html#l00070">masternode-payments.h:70</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_aa5e06959ed73a2a200cce6638102972b"><div class="ttname"><a href="namespace_net_msg_type.html#aa5e06959ed73a2a200cce6638102972b">NetMsgType::MNPING</a></div><div class="ttdeci">const char * MNPING</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00057">protocol.cpp:57</a></div></div>
<div class="ttc" id="random_8cpp_html_af3aedae75efabb170337a497457f7ecf"><div class="ttname"><a href="random_8cpp.html#af3aedae75efabb170337a497457f7ecf">GetRandHash</a></div><div class="ttdeci">uint256 GetRandHash()</div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00173">random.cpp:173</a></div></div>
<div class="ttc" id="class_c_tx_lock_request_html_a21e647fb532ddab83d71e6ebae841569"><div class="ttname"><a href="class_c_tx_lock_request.html#a21e647fb532ddab83d71e6ebae841569">CTxLockRequest::IsSimple</a></div><div class="ttdeci">bool IsSimple() const</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l01021">instantx.cpp:1021</a></div></div>
<div class="ttc" id="classllmq_1_1_c_final_commitment_html"><div class="ttname"><a href="classllmq_1_1_c_final_commitment.html">llmq::CFinalCommitment</a></div><div class="ttdef"><b>Definition:</b> <a href="quorums__commitment_8h_source.html#l00020">quorums_commitment.h:20</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a2cb5fe00e73ee666aa3daef76b299251"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2cb5fe00e73ee666aa3daef76b299251">MSG_GOVERNANCE_OBJECT_VOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00372">protocol.h:372</a></div></div>
<div class="ttc" id="class_c_net_processing_cleanup_html_a95f2af12fa0b9c384a80511f4b21090c"><div class="ttname"><a href="class_c_net_processing_cleanup.html#a95f2af12fa0b9c384a80511f4b21090c">CNetProcessingCleanup::CNetProcessingCleanup</a></div><div class="ttdeci">CNetProcessingCleanup()</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03676">net_processing.cpp:3676</a></div></div>
<div class="ttc" id="class_partially_downloaded_block_html_ae31ee4302e77d9757aae8b96df99486a"><div class="ttname"><a href="class_partially_downloaded_block.html#ae31ee4302e77d9757aae8b96df99486a">PartiallyDownloadedBlock::FillBlock</a></div><div class="ttdeci">ReadStatus FillBlock(CBlock &amp;block, const std::vector&lt; CTransactionRef &gt; &amp;vtx_missing)</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8cpp_source.html#l00178">blockencodings.cpp:178</a></div></div>
<div class="ttc" id="protocol_8h_html_ad131f3177584caea787cdbf6f85a9537"><div class="ttname"><a href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537">ServiceFlags</a></div><div class="ttdeci">ServiceFlags</div><div class="ttdoc">nServices flags </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00282">protocol.h:282</a></div></div>
<div class="ttc" id="class_c_service_html_ae274e8b6fc38955d74044d326a405024"><div class="ttname"><a href="class_c_service.html#ae274e8b6fc38955d74044d326a405024">CService::ToString</a></div><div class="ttdeci">std::string ToString(bool fUseGetnameinfo=true) const</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00578">netaddress.cpp:578</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a857bfcf95814b7d6ef4db309c84f179d"><div class="ttname"><a href="class_c_net_addr.html#a857bfcf95814b7d6ef4db309c84f179d">CNetAddr::IsLocal</a></div><div class="ttdeci">bool IsLocal() const</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00171">netaddress.cpp:171</a></div></div>
<div class="ttc" id="class_c_simplified_m_n_list_diff_html"><div class="ttname"><a href="class_c_simplified_m_n_list_diff.html">CSimplifiedMNListDiff</a></div><div class="ttdef"><b>Definition:</b> <a href="simplifiedmns_8h_source.html#l00100">simplifiedmns.h:100</a></div></div>
<div class="ttc" id="class_c_node_html_a66aeed3b6534635d031dff3eee9538de"><div class="ttname"><a href="class_c_node.html#a66aeed3b6534635d031dff3eee9538de">CNode::cs_filter</a></div><div class="ttdeci">CCriticalSection cs_filter</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00737">net.h:737</a></div></div>
<div class="ttc" id="simplifiedmns_8cpp_html_a1478cfcf5bfe0b6bf12e2c7bb628dc40"><div class="ttname"><a href="simplifiedmns_8cpp.html#a1478cfcf5bfe0b6bf12e2c7bb628dc40">BuildSimplifiedMNListDiff</a></div><div class="ttdeci">bool BuildSimplifiedMNListDiff(const uint256 &amp;baseBlockHash, const uint256 &amp;blockHash, CSimplifiedMNListDiff &amp;mnListDiffRet, std::string &amp;errorRet)</div><div class="ttdef"><b>Definition:</b> <a href="simplifiedmns_8cpp_source.html#l00117">simplifiedmns.cpp:117</a></div></div>
<div class="ttc" id="init_8h_html"><div class="ttname"><a href="init_8h.html">init.h</a></div></div>
<div class="ttc" id="classbase__blob_html_aa340be5328d911272eded433d03f30a3"><div class="ttname"><a href="classbase__blob.html#aa340be5328d911272eded433d03f30a3">base_blob::SetNull</a></div><div class="ttdeci">void SetNull()</div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00041">uint256.h:41</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ab02615ff65f91d69f8d786ec900baa8a"><div class="ttname"><a href="net__processing_8cpp.html#ab02615ff65f91d69f8d786ec900baa8a">RegisterNodeSignals</a></div><div class="ttdeci">void RegisterNodeSignals(CNodeSignals &amp;nodeSignals)</div><div class="ttdoc">Register with a network node to receive its signals. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00581">net_processing.cpp:581</a></div></div>
<div class="ttc" id="class_c_block_index_html_a9fe0d4463c07c466f66252e8eec25f5c"><div class="ttname"><a href="class_c_block_index.html#a9fe0d4463c07c466f66252e8eec25f5c">CBlockIndex::GetBlockTime</a></div><div class="ttdeci">int64_t GetBlockTime() const</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00281">chain.h:281</a></div></div>
<div class="ttc" id="validation_8h_html_a7ec45a20c72f5a43ec54d6cc213b229d"><div class="ttname"><a href="validation_8h.html#a7ec45a20c72f5a43ec54d6cc213b229d">AVG_ADDRESS_BROADCAST_INTERVAL</a></div><div class="ttdeci">static const unsigned int AVG_ADDRESS_BROADCAST_INTERVAL</div><div class="ttdoc">Average delay between peer address broadcasts in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00113">validation.h:113</a></div></div>
<div class="ttc" id="class_c_chain_html_a03e98bebe804bfba219b4e6a2b858d9f"><div class="ttname"><a href="class_c_chain.html#a03e98bebe804bfba219b4e6a2b858d9f">CChain::GetLocator</a></div><div class="ttdeci">CBlockLocator GetLocator(const CBlockIndex *pindex=NULL) const</div><div class="ttdoc">Return a CBlockLocator that refers to a block in this chain (by default the tip). ...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8cpp_source.html#l00023">chain.cpp:23</a></div></div>
<div class="ttc" id="class_block_transactions_html"><div class="ttname"><a href="class_block_transactions.html">BlockTransactions</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00071">blockencodings.h:71</a></div></div>
<div class="ttc" id="struct_c_block_locator_html"><div class="ttname"><a href="struct_c_block_locator.html">CBlockLocator</a></div><div class="ttdoc">Describes a place in the block chain to another node such that if the other node doesn&amp;#39;t have the sam...</div><div class="ttdef"><b>Definition:</b> <a href="block_8h_source.html#l00127">block.h:127</a></div></div>
<div class="ttc" id="class_c_block_index_html_a1ef11137155df1dd5c81491630cece39"><div class="ttname"><a href="class_c_block_index.html#a1ef11137155df1dd5c81491630cece39">CBlockIndex::pprev</a></div><div class="ttdeci">CBlockIndex * pprev</div><div class="ttdoc">pointer to the index of the predecessor of this block </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00161">chain.h:161</a></div></div>
<div class="ttc" id="struct_iterator_comparator_html_a3117b367674b069df7676416050e10c7"><div class="ttname"><a href="struct_iterator_comparator.html#a3117b367674b069df7676416050e10c7">IteratorComparator::operator()</a></div><div class="ttdeci">bool operator()(const I &amp;a, const I &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00062">net_processing.cpp:62</a></div></div>
<div class="ttc" id="class_compare_inv_mempool_order_html_a1cd3da690b8741dcc21d415f5d8d006f"><div class="ttname"><a href="class_compare_inv_mempool_order.html#a1cd3da690b8741dcc21d415f5d8d006f">CompareInvMempoolOrder::operator()</a></div><div class="ttdeci">bool operator()(std::set&lt; uint256 &gt;::iterator a, std::set&lt; uint256 &gt;::iterator b)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03155">net_processing.cpp:3155</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a53f08d964e4fdf9c70e89bb9719d7d64"><div class="ttname"><a href="class_c_tx_mem_pool.html#a53f08d964e4fdf9c70e89bb9719d7d64">CTxMemPool::infoAll</a></div><div class="ttdeci">std::vector&lt; TxMempoolInfo &gt; infoAll() const</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01221">txmempool.cpp:1221</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a802e4d970385efb01469f48db2cf1e06"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a802e4d970385efb01469f48db2cf1e06">MSG_TXLOCK_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00358">protocol.h:358</a></div></div>
<div class="ttc" id="class_c_sip_hasher_html_ad922bf75073152ed1a02789a63f38559"><div class="ttname"><a href="class_c_sip_hasher.html#ad922bf75073152ed1a02789a63f38559">CSipHasher::Write</a></div><div class="ttdeci">CSipHasher &amp; Write(uint64_t data)</div><div class="ttdoc">Hash a 64-bit integer worth of data It is treated as if this was the little-endian interpretation of ...</div><div class="ttdef"><b>Definition:</b> <a href="hash_8cpp_source.html#l00106">hash.cpp:106</a></div></div>
<div class="ttc" id="sync_8h_html_aca08e7299069c2d60b8aa726fc550612"><div class="ttname"><a href="sync_8h.html#aca08e7299069c2d60b8aa726fc550612">TRY_LOCK</a></div><div class="ttdeci">#define TRY_LOCK(cs, name)</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00179">sync.h:179</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_aaf5ed9b7e5e4fbf9830be4d0a8fde2ba"><div class="ttname"><a href="net__processing_8cpp.html#aaf5ed9b7e5e4fbf9830be4d0a8fde2ba">most_recent_block</a></div><div class="ttdeci">static std::shared_ptr&lt; const CBlock &gt; most_recent_block</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00782">net_processing.cpp:782</a></div></div>
<div class="ttc" id="class_c_connman_html_a47a0fe62e6fb1008c77f3b2150214213"><div class="ttname"><a href="class_c_connman.html#a47a0fe62e6fb1008c77f3b2150214213">CConnman::GetAddressCount</a></div><div class="ttdeci">size_t GetAddressCount() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02510">net.cpp:2510</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a1c6087345e5ca07a151451cd6deb974f"><div class="ttname"><a href="class_c_net_addr.html#a1c6087345e5ca07a151451cd6deb974f">CNetAddr::SetIP</a></div><div class="ttdeci">void SetIP(const CNetAddr &amp;ip)</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00027">netaddress.cpp:27</a></div></div>
<div class="ttc" id="struct_c_node_state_stats_html_a62c2243d09166c1daaad84519700da3c"><div class="ttname"><a href="struct_c_node_state_stats.html#a62c2243d09166c1daaad84519700da3c">CNodeStateStats::nMisbehavior</a></div><div class="ttdeci">int nMisbehavior</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00046">net_processing.h:46</a></div></div>
<div class="ttc" id="class_c_connman_html_a999ec42f1515f77096556c94c29c6538"><div class="ttname"><a href="class_c_connman.html#a999ec42f1515f77096556c94c29c6538">CConnman::WakeMessageHandler</a></div><div class="ttdeci">void WakeMessageHandler()</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l01420">net.cpp:1420</a></div></div>
<div class="ttc" id="net_8h_html"><div class="ttname"><a href="net_8h.html">net.h</a></div></div>
<div class="ttc" id="struct_c_main_signals_html_aa57644d82a75031db4c7436a080d5f92"><div class="ttname"><a href="struct_c_main_signals.html#aa57644d82a75031db4c7436a080d5f92">CMainSignals::Broadcast</a></div><div class="ttdeci">boost::signals2::signal&lt; void(int64_t nBestBlockTime, CConnman *connman)&gt; Broadcast</div><div class="ttdoc">Tells listeners to broadcast their data. </div><div class="ttdef"><b>Definition:</b> <a href="validationinterface_8h_source.html#l00090">validationinterface.h:90</a></div></div>
<div class="ttc" id="class_c_connman_html_a46915b82dd2183baf2944d74d88a4228"><div class="ttname"><a href="class_c_connman.html#a46915b82dd2183baf2944d74d88a4228">CConnman::SetServices</a></div><div class="ttdeci">void SetServices(const CService &amp;addr, ServiceFlags nServices)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02515">net.cpp:2515</a></div></div>
<div class="ttc" id="validation_8h_html_af818478a7d4382f2527722894fb2e2a4"><div class="ttname"><a href="validation_8h.html#af818478a7d4382f2527722894fb2e2a4">AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL</a></div><div class="ttdeci">static const unsigned int AVG_LOCAL_ADDRESS_BROADCAST_INTERVAL</div><div class="ttdoc">Average delay between local address broadcasts in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00111">validation.h:111</a></div></div>
<div class="ttc" id="class_c_inv_html_a5bf13e9595035d2155b04cceb848c37d"><div class="ttname"><a href="class_c_inv.html#a5bf13e9595035d2155b04cceb848c37d">CInv::ToString</a></div><div class="ttdeci">std::string ToString() const</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00288">protocol.cpp:288</a></div></div>
<div class="ttc" id="net_8h_html_a99a450f0d7268ee95f310f2b78be3370"><div class="ttname"><a href="net_8h.html#a99a450f0d7268ee95f310f2b78be3370">REQUIRED_SERVICES</a></div><div class="ttdeci">static const ServiceFlags REQUIRED_SERVICES</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00094">net.h:94</a></div></div>
<div class="ttc" id="class_c_node_html_aca90abe62ee91e752d59981dd7c4f9ed"><div class="ttname"><a href="class_c_node.html#aca90abe62ee91e752d59981dd7c4f9ed">CNode::vProcessMsg</a></div><div class="ttdeci">std::list&lt; CNetMessage &gt; vProcessMsg</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00696">net.h:696</a></div></div>
<div class="ttc" id="class_c_block_html"><div class="ttname"><a href="class_c_block.html">CBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="block_8h_source.html#l00072">block.h:72</a></div></div>
<div class="ttc" id="util_8cpp_html_a2ba7badc843121dde40a6f109d224a42"><div class="ttname"><a href="util_8cpp.html#a2ba7badc843121dde40a6f109d224a42">fDebug</a></div><div class="ttdeci">bool fDebug</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00131">util.cpp:131</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a0407dddb23706af2320d25a1fb26d4f5"><div class="ttname"><a href="namespace_net_msg_type.html#a0407dddb23706af2320d25a1fb26d4f5">NetMsgType::QFCOMMITMENT</a></div><div class="ttdeci">const char * QFCOMMITMENT</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00074">protocol.cpp:74</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_aea859ef7335f27b92e6cb37b30b84b53"><div class="ttname"><a href="class_c_governance_manager.html#aea859ef7335f27b92e6cb37b30b84b53">CGovernanceManager::HaveVoteForHash</a></div><div class="ttdeci">bool HaveVoteForHash(const uint256 &amp;nHash) const</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00066">governance.cpp:66</a></div></div>
<div class="ttc" id="serialize_8h_html_ae3fd928949b7361accfec79c314aa90f"><div class="ttname"><a href="serialize_8h.html#ae3fd928949b7361accfec79c314aa90f">ReadCompactSize</a></div><div class="ttdeci">uint64_t ReadCompactSize(Stream &amp;is)</div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00257">serialize.h:257</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a52ba4e8bec9f766efd43edac1acf8c9d"><div class="ttname"><a href="namespace_net_msg_type.html#a52ba4e8bec9f766efd43edac1acf8c9d">NetMsgType::MASTERNODEPAYMENTVOTE</a></div><div class="ttdeci">const char * MASTERNODEPAYMENTVOTE</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00047">protocol.cpp:47</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a4d0f984b71f9e4c4b8b3619cb3f3dadd"><div class="ttname"><a href="namespace_net_msg_type.html#a4d0f984b71f9e4c4b8b3619cb3f3dadd">NetMsgType::GETADDR</a></div><div class="ttdeci">const char * GETADDR</div><div class="ttdoc">The getaddr message requests an addr message from the receiving node, preferably one with lots of IP ...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00027">protocol.cpp:27</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_a91f72d94f777c7af376dbaddd98aaf3f"><div class="ttname"><a href="class_peer_logic_validation.html#a91f72d94f777c7af376dbaddd98aaf3f">PeerLogicValidation::UpdatedBlockTip</a></div><div class="ttdeci">virtual void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) override</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00825">net_processing.cpp:825</a></div></div>
<div class="ttc" id="struct_c_orphan_tx_html_a09fd824b19c2e8433b44145b7b64f010"><div class="ttname"><a href="struct_c_orphan_tx.html#a09fd824b19c2e8433b44145b7b64f010">COrphanTx::nTimeExpire</a></div><div class="ttdeci">int64_t nTimeExpire</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00072">net_processing.cpp:72</a></div></div>
<div class="ttc" id="consensus_8h_html_aa372df0d6494f4aaca5ecf5a5a9d4406"><div class="ttname"><a href="consensus_8h.html#aa372df0d6494f4aaca5ecf5a5a9d4406">MaxBlockSize</a></div><div class="ttdeci">unsigned int MaxBlockSize(bool fDIP0001Active)</div><div class="ttdef"><b>Definition:</b> <a href="consensus_8h_source.html#l00012">consensus.h:12</a></div></div>
<div class="ttc" id="struct_c_node_signals_html_adbe101522cf1fd496a8fdf2667744f0f"><div class="ttname"><a href="struct_c_node_signals.html#adbe101522cf1fd496a8fdf2667744f0f">CNodeSignals::ProcessMessages</a></div><div class="ttdeci">boost::signals2::signal&lt; bool(CNode *, CConnman &amp;, std::atomic&lt; bool &gt; &amp;), CombinerAll &gt; ProcessMessages</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00548">net.h:548</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a78b9ead22ca5cae07b98370ffab06abc">MSG_CMPCT_BLOCK</a></div><div class="ttdoc">Defined in BIP152. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00376">protocol.h:376</a></div></div>
<div class="ttc" id="class_block_transactions_request_html_a731bbcec34e4ebd932f2d4cc840abab5"><div class="ttname"><a href="class_block_transactions_request.html#a731bbcec34e4ebd932f2d4cc840abab5">BlockTransactionsRequest::indexes</a></div><div class="ttdeci">std::vector&lt; uint16_t &gt; indexes</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00033">blockencodings.h:33</a></div></div>
<div class="ttc" id="tinyformat_8h_html_a56c674871a61baaad36ad52238c08857"><div class="ttname"><a href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a></div><div class="ttdeci">#define strprintf</div><div class="ttdef"><b>Definition:</b> <a href="tinyformat_8h_source.html#l01047">tinyformat.h:1047</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a5a4ed6e4ae53db779fa322f356f9babf"><div class="ttname"><a href="net__processing_8cpp.html#a5a4ed6e4ae53db779fa322f356f9babf">AlreadyHave</a></div><div class="ttdeci">static bool AlreadyHave(const CInv &amp;inv) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00895">net_processing.cpp:895</a></div></div>
<div class="ttc" id="class_c_rolling_bloom_filter_html_a0fedbf0cf38c9070a30c7c5f8299f5d7"><div class="ttname"><a href="class_c_rolling_bloom_filter.html#a0fedbf0cf38c9070a30c7c5f8299f5d7">CRollingBloomFilter::insert</a></div><div class="ttdeci">void insert(const std::vector&lt; unsigned char &gt; &amp;vKey)</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cpp_source.html#l00249">bloom.cpp:249</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_af0793c7c14e94d2d642f4ac89067a429"><div class="ttname"><a href="net__processing_8cpp.html#af0793c7c14e94d2d642f4ac89067a429">GetNodeStateStats</a></div><div class="ttdeci">bool GetNodeStateStats(NodeId nodeid, CNodeStateStats &amp;stats)</div><div class="ttdoc">Get statistics from node state. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00566">net_processing.cpp:566</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a50511d9d8e551a2890f09622d82f13f7"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a50511d9d8e551a2890f09622d82f13f7">MSG_MASTERNODE_PING</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00369">protocol.h:369</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a4fcf05ad5f15a565c4b43c4b9f29906e"><div class="ttname"><a href="class_c_tx_mem_pool.html#a4fcf05ad5f15a565c4b43c4b9f29906e">CTxMemPool::DynamicMemoryUsage</a></div><div class="ttdeci">size_t DynamicMemoryUsage() const</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01470">txmempool.cpp:1470</a></div></div>
<div class="ttc" id="quorums__commitment_8h_html"><div class="ttname"><a href="quorums__commitment_8h.html">quorums_commitment.h</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a0494732fc92c975f58783e224585c473">MSG_TX</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00352">protocol.h:352</a></div></div>
<div class="ttc" id="class_c_inv_html"><div class="ttname"><a href="class_c_inv.html">CInv</a></div><div class="ttdoc">inv message data </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00383">protocol.h:383</a></div></div>
<div class="ttc" id="validation_8h_html_a8483db75666c2a1d231108b125b0b3bf"><div class="ttname"><a href="validation_8h.html#a8483db75666c2a1d231108b125b0b3bf">BLOCK_DOWNLOAD_TIMEOUT_BASE</a></div><div class="ttdeci">static const int64_t BLOCK_DOWNLOAD_TIMEOUT_BASE</div><div class="ttdoc">Block download timeout base, expressed in millionths of the block interval (i.e. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00123">validation.h:123</a></div></div>
<div class="ttc" id="struct_c_node_state_stats_html"><div class="ttname"><a href="struct_c_node_state_stats.html">CNodeStateStats</a></div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00045">net_processing.h:45</a></div></div>
<div class="ttc" id="namespacellmq_html_a32533f25ea72d1153af50d680a75434d"><div class="ttname"><a href="namespacellmq.html#a32533f25ea72d1153af50d680a75434d">llmq::quorumBlockProcessor</a></div><div class="ttdeci">CQuorumBlockProcessor * quorumBlockProcessor</div><div class="ttdef"><b>Definition:</b> <a href="quorums__blockprocessor_8cpp_source.html#l00022">quorums_blockprocessor.cpp:22</a></div></div>
<div class="ttc" id="governance_8h_html"><div class="ttname"><a href="governance_8h.html">governance.h</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_a18a7b718a7d7a7fbb22f8701b0a0b9df"><div class="ttname"><a href="class_c_masternode_man.html#a18a7b718a7d7a7fbb22f8701b0a0b9df">CMasternodeMan::mapSeenMasternodeVerification</a></div><div class="ttdeci">std::map&lt; uint256, CMasternodeVerification &gt; mapSeenMasternodeVerification</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8h_source.html#l00096">masternodeman.h:96</a></div></div>
<div class="ttc" id="net__processing_8h_html_a8a4d3867ceb626ccda62b3b728425d07"><div class="ttname"><a href="net__processing_8h.html#a8a4d3867ceb626ccda62b3b728425d07">HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER</a></div><div class="ttdeci">static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_PER_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00022">net_processing.h:22</a></div></div>
<div class="ttc" id="serialize_8h_html_aeb209536f7b746673a9c3fba8651b0e5"><div class="ttname"><a href="serialize_8h.html#aeb209536f7b746673a9c3fba8651b0e5">GetSerializeSize</a></div><div class="ttdeci">size_t GetSerializeSize(const T &amp;t, int nType, int nVersion=0)</div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l01096">serialize.h:1096</a></div></div>
<div class="ttc" id="class_c_bloom_filter_html_aec420a9b66ab133090c2b4b8ed286f79"><div class="ttname"><a href="class_c_bloom_filter.html#aec420a9b66ab133090c2b4b8ed286f79">CBloomFilter::IsRelevantAndUpdate</a></div><div class="ttdeci">bool IsRelevantAndUpdate(const CTransaction &amp;tx)</div><div class="ttdoc">Also adds any outputs which match the filter to the filter (to match their spending txes) ...</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cpp_source.html#l00134">bloom.cpp:134</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a4cdafba4d585b4699628412c7f1c3d8b"><div class="ttname"><a href="namespace_net_msg_type.html#a4cdafba4d585b4699628412c7f1c3d8b">NetMsgType::SENDCMPCT</a></div><div class="ttdeci">const char * SENDCMPCT</div><div class="ttdoc">Contains a 1-byte bool and 8-byte LE version number. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00038">protocol.cpp:38</a></div></div>
<div class="ttc" id="amount_8h_html_aed6bcb17bc73a5dcf33250e9c2c023cc"><div class="ttname"><a href="amount_8h.html#aed6bcb17bc73a5dcf33250e9c2c023cc">COIN</a></div><div class="ttdeci">static const CAmount COIN</div><div class="ttdef"><b>Definition:</b> <a href="amount_8h_source.html#l00017">amount.h:17</a></div></div>
<div class="ttc" id="class_c_masternode_html"><div class="ttname"><a href="class_c_masternode.html">CMasternode</a></div><div class="ttdef"><b>Definition:</b> <a href="masternode_8h_source.html#l00150">masternode.h:150</a></div></div>
<div class="ttc" id="struct_c_orphan_tx_html"><div class="ttname"><a href="struct_c_orphan_tx.html">COrphanTx</a></div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00068">net_processing.cpp:68</a></div></div>
<div class="ttc" id="validation_8h_html_a5caf4122a735df55a443242fa5ccb5cf"><div class="ttname"><a href="validation_8h.html#a5caf4122a735df55a443242fa5ccb5cf">MIN_BLOCKS_TO_KEEP</a></div><div class="ttdeci">static const unsigned int MIN_BLOCKS_TO_KEEP</div><div class="ttdoc">Block files containing a block-height within MIN_BLOCKS_TO_KEEP of chainActive.Tip() will not be prun...</div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00208">validation.h:208</a></div></div>
<div class="ttc" id="classllmq_1_1_c_dummy_d_k_g_html_a9893bce557af51cf492d7ea3f3d34dcb"><div class="ttname"><a href="classllmq_1_1_c_dummy_d_k_g.html#a9893bce557af51cf492d7ea3f3d34dcb">llmq::CDummyDKG::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8cpp_source.html#l00028">quorums_dummydkg.cpp:28</a></div></div>
<div class="ttc" id="class_c_masternode_payments_html_a830408cb2635a3e3b4a1c48d1deefb85"><div class="ttname"><a href="class_c_masternode_payments.html#a830408cb2635a3e3b4a1c48d1deefb85">CMasternodePayments::mapMasternodePaymentVotes</a></div><div class="ttdeci">std::map&lt; uint256, CMasternodePaymentVote &gt; mapMasternodePaymentVotes</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8h_source.html#l00175">masternode-payments.h:175</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_acf4bb9f52c40164659f484d45d09ecc4"><div class="ttname"><a href="class_c_tx_mem_pool.html#acf4bb9f52c40164659f484d45d09ecc4">CTxMemPool::info</a></div><div class="ttdeci">TxMempoolInfo info(const uint256 &amp;hash) const</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01244">txmempool.cpp:1244</a></div></div>
<div class="ttc" id="chain_8h_html_a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573"><div class="ttname"><a href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada67f3a88eeb793cc62f427f87ae830573">BLOCK_VALID_TREE</a></div><div class="ttdoc">All parent headers found, difficulty matches, timestamp &gt;= median previous, checkpoint. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00120">chain.h:120</a></div></div>
<div class="ttc" id="validation_8h_html_af83a9cbb7b3fe9d34a7c4b43f2e040f8"><div class="ttname"><a href="validation_8h.html#af83a9cbb7b3fe9d34a7c4b43f2e040f8">MAX_REJECT_MESSAGE_LENGTH</a></div><div class="ttdeci">static const unsigned int MAX_REJECT_MESSAGE_LENGTH</div><div class="ttdoc">Maximum length of reject messages. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00109">validation.h:109</a></div></div>
<div class="ttc" id="class_c_node_html_a0c940addacc47f19170b460b03068fac"><div class="ttname"><a href="class_c_node.html#a0c940addacc47f19170b460b03068fac">CNode::vInventoryBlockToSend</a></div><div class="ttdeci">std::vector&lt; uint256 &gt; vInventoryBlockToSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00771">net.h:771</a></div></div>
<div class="ttc" id="class_c_node_html_ae0def1498409407d1612833a7d38c875"><div class="ttname"><a href="class_c_node.html#ae0def1498409407d1612833a7d38c875">CNode::AskFor</a></div><div class="ttdeci">void AskFor(const CInv &amp;inv)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02894">net.cpp:2894</a></div></div>
<div class="ttc" id="class_c_chain_html_ad4758bc8872ce065a9579f77c3171d40"><div class="ttname"><a href="class_c_chain.html#ad4758bc8872ce065a9579f77c3171d40">CChain::Height</a></div><div class="ttdeci">int Height() const</div><div class="ttdoc">Return the maximal height in the chain. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00465">chain.h:465</a></div></div>
<div class="ttc" id="classllmq_1_1_c_dummy_commitment_html"><div class="ttname"><a href="classllmq_1_1_c_dummy_commitment.html">llmq::CDummyCommitment</a></div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8h_source.html#l00081">quorums_dummydkg.h:81</a></div></div>
<div class="ttc" id="validation_8cpp_html_a1ed8285f0fe3c6799c53265ce72552c8"><div class="ttname"><a href="validation_8cpp.html#a1ed8285f0fe3c6799c53265ce72552c8">cs_main</a></div><div class="ttdeci">CCriticalSection cs_main</div><div class="ttdoc">Global state. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00069">validation.cpp:69</a></div></div>
<div class="ttc" id="class_c_validation_state_html_a7dc31c88ba63ad17a954f247d21b550c"><div class="ttname"><a href="class_c_validation_state.html#a7dc31c88ba63ad17a954f247d21b550c">CValidationState::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00061">validation.h:61</a></div></div>
<div class="ttc" id="class_c_bloom_filter_html"><div class="ttname"><a href="class_c_bloom_filter.html">CBloomFilter</a></div><div class="ttdoc">BloomFilter is a probabilistic filter which SPV clients provide so that we can filter the transaction...</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8h_source.html#l00044">bloom.h:44</a></div></div>
<div class="ttc" id="validation_8cpp_html_a8e0eca589b2d4254a65f04c5d91888b2"><div class="ttname"><a href="validation_8cpp.html#a8e0eca589b2d4254a65f04c5d91888b2">fReindex</a></div><div class="ttdeci">bool fReindex</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00078">validation.cpp:78</a></div></div>
<div class="ttc" id="class_c_masternode_html_a96e1c84dfca2362c95fef0c2efd372f4"><div class="ttname"><a href="class_c_masternode.html#a96e1c84dfca2362c95fef0c2efd372f4">CMasternode::IsValidForMixingTxes</a></div><div class="ttdeci">bool IsValidForMixingTxes() const</div><div class="ttdef"><b>Definition:</b> <a href="masternode_8h_source.html#l00279">masternode.h:279</a></div></div>
<div class="ttc" id="class_c_node_html_ac6dfcb66887b3d26d58e25e7d3397016"><div class="ttname"><a href="class_c_node.html#ac6dfcb66887b3d26d58e25e7d3397016">CNode::fSendMempool</a></div><div class="ttdeci">bool fSendMempool</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00782">net.h:782</a></div></div>
<div class="ttc" id="utilstrencodings_8h_html_ace13a819ca4e98c22847d26b3b357e75"><div class="ttname"><a href="utilstrencodings_8h.html#ace13a819ca4e98c22847d26b3b357e75">HexStr</a></div><div class="ttdeci">std::string HexStr(const T itbegin, const T itend, bool fSpaces=false)</div><div class="ttdef"><b>Definition:</b> <a href="utilstrencodings_8h_source.html#l00095">utilstrencodings.h:95</a></div></div>
<div class="ttc" id="protocol_8h_html_ad131f3177584caea787cdbf6f85a9537a9d1154f0e7e56f183a5c8373abe2e86c"><div class="ttname"><a href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9d1154f0e7e56f183a5c8373abe2e86c">NODE_NETWORK</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00288">protocol.h:288</a></div></div>
<div class="ttc" id="class_c_node_html_acf48a43182292a6636c9de3ea7453d72"><div class="ttname"><a href="class_c_node.html#acf48a43182292a6636c9de3ea7453d72">CNode::cs_SubVer</a></div><div class="ttdeci">CCriticalSection cs_SubVer</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00718">net.h:718</a></div></div>
<div class="ttc" id="struct_c_orphan_tx_html_abe878e681f993451d5433d3e12261cb4"><div class="ttname"><a href="struct_c_orphan_tx.html#abe878e681f993451d5433d3e12261cb4">COrphanTx::tx</a></div><div class="ttdeci">CTransactionRef tx</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00070">net_processing.cpp:70</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ae091b569e78315bb17c4b0c178aeb3b0"><div class="ttname"><a href="net__processing_8cpp.html#ae091b569e78315bb17c4b0c178aeb3b0">RANDOMIZER_ID_ADDRESS_RELAY</a></div><div class="ttdeci">static const uint64_t RANDOMIZER_ID_ADDRESS_RELAY</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00081">net_processing.cpp:81</a></div></div>
<div class="ttc" id="timedata_8cpp_html_af9b8f3d7f6fc349e8c8fffb2733896c5"><div class="ttname"><a href="timedata_8cpp.html#af9b8f3d7f6fc349e8c8fffb2733896c5">nTimeOffset</a></div><div class="ttdeci">static int64_t nTimeOffset</div><div class="ttdef"><b>Definition:</b> <a href="timedata_8cpp_source.html#l00021">timedata.cpp:21</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a3a28db7deec3a185c981b159a7b235fc"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a3a28db7deec3a185c981b159a7b235fc">MSG_MASTERNODE_ANNOUNCE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00368">protocol.h:368</a></div></div>
<div class="ttc" id="class_c_message_header_html_a02dcbb01fac09d6a8b223df5c38b9eb3a8c1bfc0fa6a63c8b73abef30555a5e54"><div class="ttname"><a href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3a8c1bfc0fa6a63c8b73abef30555a5e54">CMessageHeader::COMMAND_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00032">protocol.h:32</a></div></div>
<div class="ttc" id="class_c_coins_view_cache_html_ab2e11ee063c40be4a6bc620fd98149a0"><div class="ttname"><a href="class_c_coins_view_cache.html#ab2e11ee063c40be4a6bc620fd98149a0">CCoinsViewCache::HaveCoinInCache</a></div><div class="ttdeci">bool HaveCoinInCache(const COutPoint &amp;outpoint) const</div><div class="ttdoc">Check if we have the given utxo already loaded in this cache. </div><div class="ttdef"><b>Definition:</b> <a href="coins_8cpp_source.html#l00131">coins.cpp:131</a></div></div>
<div class="ttc" id="chain_8h_html_a0d8c285f70a59a32f4f6ab41b78f93ada3eef30f876594ac79b888b7d1ff6c66c"><div class="ttname"><a href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada3eef30f876594ac79b888b7d1ff6c66c">BLOCK_VALID_TRANSACTIONS</a></div><div class="ttdoc">Only first tx is coinbase, 2 &lt;= coinbase input script length &lt;= 100, transactions valid...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00127">chain.h:127</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_a87704cec2345954fd7d138f3e8330247"><div class="ttname"><a href="class_peer_logic_validation.html#a87704cec2345954fd7d138f3e8330247">PeerLogicValidation::SyncTransaction</a></div><div class="ttdeci">virtual void SyncTransaction(const CTransaction &amp;tx, const CBlockIndex *pindex, int nPosInBlock) override</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00753">net_processing.cpp:753</a></div></div>
<div class="ttc" id="version_8h_html_aa3feca3b6094096fa1b660159bdcb04a"><div class="ttname"><a href="version_8h.html#aa3feca3b6094096fa1b660159bdcb04a">BIP0031_VERSION</a></div><div class="ttdeci">static const int BIP0031_VERSION</div><div class="ttdoc">BIP 0031, pong message, is enabled for all versions AFTER this one. </div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00033">version.h:33</a></div></div>
<div class="ttc" id="class_c_instant_send_html_aa0664a610e280ba5c5630f054e5b7cfd"><div class="ttname"><a href="class_c_instant_send.html#aa0664a610e280ba5c5630f054e5b7cfd">CInstantSend::GetTxLockVote</a></div><div class="ttdeci">bool GetTxLockVote(const uint256 &amp;hash, CTxLockVote &amp;txLockVoteRet)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00782">instantx.cpp:782</a></div></div>
<div class="ttc" id="class_c_connman_html_adc69330bc472e50487030c031d5063db"><div class="ttname"><a href="class_c_connman.html#adc69330bc472e50487030c031d5063db">CConnman::PushMessage</a></div><div class="ttdeci">void PushMessage(CNode *pnode, CSerializedNetMsg &amp;&amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02957">net.cpp:2957</a></div></div>
<div class="ttc" id="chainparams_8h_html"><div class="ttname"><a href="chainparams_8h.html">chainparams.h</a></div></div>
<div class="ttc" id="class_c_net_message_html_a63b9f2351d5e92126cacacd51d9e16b6"><div class="ttname"><a href="class_c_net_message.html#a63b9f2351d5e92126cacacd51d9e16b6">CNetMessage::SetVersion</a></div><div class="ttdeci">void SetVersion(int nVersionIn)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00667">net.h:667</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a418ce98b1e4d61b38bd11d02ff36a47d"><div class="ttname"><a href="class_c_instant_send.html#a418ce98b1e4d61b38bd11d02ff36a47d">CInstantSend::ProcessTxLockRequest</a></div><div class="ttdeci">bool ProcessTxLockRequest(const CTxLockRequest &amp;txLockRequest, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00097">instantx.cpp:97</a></div></div>
<div class="ttc" id="class_c_spork_manager_html_a27d0be91a9dac781937ba3656870170e"><div class="ttname"><a href="class_c_spork_manager.html#a27d0be91a9dac781937ba3656870170e">CSporkManager::ProcessSpork</a></div><div class="ttdeci">void ProcessSpork(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdoc">ProcessSpork is used to handle the &amp;#39;getsporks&amp;#39; and &amp;#39;spork&amp;#39; p2p messages. </div><div class="ttdef"><b>Definition:</b> <a href="spork_8cpp_source.html#l00113">spork.cpp:113</a></div></div>
<div class="ttc" id="quorums__blockprocessor_8h_html"><div class="ttname"><a href="quorums__blockprocessor_8h.html">quorums_blockprocessor.h</a></div></div>
<div class="ttc" id="class_c_rolling_bloom_filter_html"><div class="ttname"><a href="class_c_rolling_bloom_filter.html">CRollingBloomFilter</a></div><div class="ttdoc">RollingBloomFilter is a probabilistic &quot;keep track of most recently inserted&quot; set. ...</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8h_source.html#l00119">bloom.h:119</a></div></div>
<div class="ttc" id="util_8cpp_html_aaada8c5faa502eb0c33fc01294955db8"><div class="ttname"><a href="util_8cpp.html#aaada8c5faa502eb0c33fc01294955db8">PrintExceptionContinue</a></div><div class="ttdeci">void PrintExceptionContinue(const std::exception *pex, const char *pszThread)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00549">util.cpp:549</a></div></div>
<div class="ttc" id="spork_8h_html"><div class="ttname"><a href="spork_8h.html">spork.h</a></div></div>
<div class="ttc" id="class_c_node_html_a9f0b0d22b190db2f74afd1b24cff47a1"><div class="ttname"><a href="class_c_node.html#a9f0b0d22b190db2f74afd1b24cff47a1">CNode::nPingUsecStart</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nPingUsecStart</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00794">net.h:794</a></div></div>
<div class="ttc" id="hash_8h_html"><div class="ttname"><a href="hash_8h.html">hash.h</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a830e1075ea8faa4e48eeec9cef234aa5"><div class="ttname"><a href="net__processing_8cpp.html#a830e1075ea8faa4e48eeec9cef234aa5">SendRejectsAndCheckIfBanned</a></div><div class="ttdeci">static bool SendRejectsAndCheckIfBanned(CNode *pnode, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l02996">net_processing.cpp:2996</a></div></div>
<div class="ttc" id="net_8cpp_html_a01304c8caa7997b48da307d19d1d284a"><div class="ttname"><a href="net_8cpp.html#a01304c8caa7997b48da307d19d1d284a">GetLocalAddress</a></div><div class="ttdeci">CAddress GetLocalAddress(const CNetAddr *paddrPeer, ServiceFlags nLocalServices)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00154">net.cpp:154</a></div></div>
<div class="ttc" id="version_8h_html_a4e18717137ea36916ec24018040cf954"><div class="ttname"><a href="version_8h.html#a4e18717137ea36916ec24018040cf954">SENDHEADERS_VERSION</a></div><div class="ttdeci">static const int SENDHEADERS_VERSION</div><div class="ttdoc">&quot;sendheaders&quot; command and announcing blocks with headers starts with this version ...</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00042">version.h:42</a></div></div>
<div class="ttc" id="utiltime_8cpp_html_a0c5a06b50cd805b1923552114494c029"><div class="ttname"><a href="utiltime_8cpp.html#a0c5a06b50cd805b1923552114494c029">GetTimeMicros</a></div><div class="ttdeci">int64_t GetTimeMicros()</div><div class="ttdef"><b>Definition:</b> <a href="utiltime_8cpp_source.html#l00040">utiltime.cpp:40</a></div></div>
<div class="ttc" id="protocol_8h_html_ad131f3177584caea787cdbf6f85a9537a9ca74e44e29a412c070750bdbf2380bb"><div class="ttname"><a href="protocol_8h.html#ad131f3177584caea787cdbf6f85a9537a9ca74e44e29a412c070750bdbf2380bb">NODE_BLOOM</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00296">protocol.h:296</a></div></div>
<div class="ttc" id="class_c_chain_params_html"><div class="ttname"><a href="class_c_chain_params.html">CChainParams</a></div><div class="ttdoc">CChainParams defines various tweakable parameters of a given instance of the Dash system...</div><div class="ttdef"><b>Definition:</b> <a href="chainparams_8h_source.html#l00046">chainparams.h:46</a></div></div>
<div class="ttc" id="class_c_node_html_a82a03d43590c06f85f8fbcf08427674e"><div class="ttname"><a href="class_c_node.html#a82a03d43590c06f85f8fbcf08427674e">CNode::GetRecvVersion</a></div><div class="ttdeci">int GetRecvVersion()</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00848">net.h:848</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_a7a205c72456b8abf90143e8425e28f60"><div class="ttname"><a href="class_c_governance_manager.html#a7a205c72456b8abf90143e8425e28f60">CGovernanceManager::HaveObjectForHash</a></div><div class="ttdeci">bool HaveObjectForHash(const uint256 &amp;nHash) const</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00047">governance.cpp:47</a></div></div>
<div class="ttc" id="struct_c_block_locator_html_a77ebc693cf47cbab5c13777840f6bce1"><div class="ttname"><a href="struct_c_block_locator.html#a77ebc693cf47cbab5c13777840f6bce1">CBlockLocator::IsNull</a></div><div class="ttdeci">bool IsNull() const</div><div class="ttdef"><b>Definition:</b> <a href="block_8h_source.html#l00153">block.h:153</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a5de6345878869c44bb12d104fecd55d1"><div class="ttname"><a href="net__processing_8cpp.html#a5de6345878869c44bb12d104fecd55d1">RelayAddress</a></div><div class="ttdeci">static void RelayAddress(const CAddress &amp;addr, bool fReachable, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00981">net_processing.cpp:981</a></div></div>
<div class="ttc" id="class_c_data_stream_html"><div class="ttname"><a href="class_c_data_stream.html">CDataStream</a></div><div class="ttdoc">Double ended buffer combining vector and stream-like interfaces. </div><div class="ttdef"><b>Definition:</b> <a href="streams_8h_source.html#l00103">streams.h:103</a></div></div>
<div class="ttc" id="class_c_tx_lock_request_html"><div class="ttname"><a href="class_c_tx_lock_request.html">CTxLockRequest</a></div><div class="ttdoc">An InstantSend transaction lock request. </div><div class="ttdef"><b>Definition:</b> <a href="instantx_8h_source.html#l00167">instantx.h:167</a></div></div>
<div class="ttc" id="class_c_data_stream_html_ab2633ac67f098dad30d03291741c2e42"><div class="ttname"><a href="class_c_data_stream.html#ab2633ac67f098dad30d03291741c2e42">CDataStream::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="streams_8h_source.html#l00195">streams.h:195</a></div></div>
<div class="ttc" id="class_c_message_header_html_aebbc26feb23d551467ebd58b509204d0"><div class="ttname"><a href="class_c_message_header.html#aebbc26feb23d551467ebd58b509204d0">CMessageHeader::nMessageSize</a></div><div class="ttdeci">uint32_t nMessageSize</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00061">protocol.h:61</a></div></div>
<div class="ttc" id="struct_c_node_state_stats_html_a7646deac801098e973a5bc50202f92cd"><div class="ttname"><a href="struct_c_node_state_stats.html#a7646deac801098e973a5bc50202f92cd">CNodeStateStats::nSyncHeight</a></div><div class="ttdeci">int nSyncHeight</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00047">net_processing.h:47</a></div></div>
<div class="ttc" id="alert_8h_html"><div class="ttname"><a href="alert_8h.html">alert.h</a></div></div>
<div class="ttc" id="class_c_node_html_a1e8b0784cc82f33edc2dc4e2834d1ff0"><div class="ttname"><a href="class_c_node.html#a1e8b0784cc82f33edc2dc4e2834d1ff0">CNode::cs_inventory</a></div><div class="ttdeci">CCriticalSection cs_inventory</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00774">net.h:774</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ad5c880181bb5a6df5bf32cf46ba062ad"><div class="ttname"><a href="net__processing_8cpp.html#ad5c880181bb5a6df5bf32cf46ba062ad">AddOrphanTx</a></div><div class="ttdeci">bool AddOrphanTx(const CTransactionRef &amp;tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00613">net_processing.cpp:613</a></div></div>
<div class="ttc" id="class_c_node_html_a3c5bbe8733398b4d14ce05d30aced57e"><div class="ttname"><a href="class_c_node.html#a3c5bbe8733398b4d14ce05d30aced57e">CNode::GetLocalNonce</a></div><div class="ttdeci">uint64_t GetLocalNonce() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00828">net.h:828</a></div></div>
<div class="ttc" id="net_8cpp_html_af7487aacfc9d708b3db40c255ec070a8"><div class="ttname"><a href="net_8cpp.html#af7487aacfc9d708b3db40c255ec070a8">SeenLocal</a></div><div class="ttdeci">bool SeenLocal(const CService &amp;addr)</div><div class="ttdoc">vote for a local address </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00266">net.cpp:266</a></div></div>
<div class="ttc" id="class_c_node_html_af17190ecdeab1d68c55090ef17dcd65c"><div class="ttname"><a href="class_c_node.html#af17190ecdeab1d68c55090ef17dcd65c">CNode::setInventoryTxToSend</a></div><div class="ttdeci">std::set&lt; uint256 &gt; setInventoryTxToSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00767">net.h:767</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a6b323bf35be33468f78b66898344ea6f"><div class="ttname"><a href="class_c_instant_send.html#a6b323bf35be33468f78b66898344ea6f">CInstantSend::AlreadyHave</a></div><div class="ttdeci">bool AlreadyHave(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00745">instantx.cpp:745</a></div></div>
<div class="ttc" id="class_c_node_html_a119824dcaebcd3c8e272a68f19a60c43"><div class="ttname"><a href="class_c_node.html#a119824dcaebcd3c8e272a68f19a60c43">CNode::fMasternode</a></div><div class="ttdeci">bool fMasternode</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00734">net.h:734</a></div></div>
<div class="ttc" id="class_c_node_html_a9b2d9b9182ff111c79f704594c4aa2e1"><div class="ttname"><a href="class_c_node.html#a9b2d9b9182ff111c79f704594c4aa2e1">CNode::vAddrToSend</a></div><div class="ttdeci">std::vector&lt; CAddress &gt; vAddrToSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00756">net.h:756</a></div></div>
<div class="ttc" id="utilmoneystr_8h_html"><div class="ttname"><a href="utilmoneystr_8h.html">utilmoneystr.h</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a056ec0899d4010d04c39eaf38cbea56d"><div class="ttname"><a href="namespace_net_msg_type.html#a056ec0899d4010d04c39eaf38cbea56d">NetMsgType::MNVERIFY</a></div><div class="ttdeci">const char * MNVERIFY</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00071">protocol.cpp:71</a></div></div>
<div class="ttc" id="class_c_bloom_filter_html_abba52843c7c691ef7deb07d9a645dcc2"><div class="ttname"><a href="class_c_bloom_filter.html#abba52843c7c691ef7deb07d9a645dcc2">CBloomFilter::insert</a></div><div class="ttdeci">void insert(const std::vector&lt; unsigned char &gt; &amp;vKey)</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cpp_source.html#l00059">bloom.cpp:59</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4cae15fd207d555331995cd5c57689c1">MSG_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00353">protocol.h:353</a></div></div>
<div class="ttc" id="class_c_node_html_a6cb90622e50c1c9b1aa3dc4e81838747"><div class="ttname"><a href="class_c_node.html#a6cb90622e50c1c9b1aa3dc4e81838747">CNode::nStartingHeight</a></div><div class="ttdeci">std::atomic&lt; int &gt; nStartingHeight</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00753">net.h:753</a></div></div>
<div class="ttc" id="script_8h_html_a4e2e7158597de76ecbb03d866ec4c693"><div class="ttname"><a href="script_8h.html#a4e2e7158597de76ecbb03d866ec4c693">MAX_SCRIPT_ELEMENT_SIZE</a></div><div class="ttdeci">static const unsigned int MAX_SCRIPT_ELEMENT_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="script_8h_source.html#l00022">script.h:22</a></div></div>
<div class="ttc" id="class_c_node_html_a05f0401427c5ffebd1ca404848e83ff7"><div class="ttname"><a href="class_c_node.html#a05f0401427c5ffebd1ca404848e83ff7">CNode::cleanSubVer</a></div><div class="ttdeci">std::string cleanSubVer</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00717">net.h:717</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a450d2be8350b29dcb4f3adc3325f56b2"><div class="ttname"><a href="net__processing_8cpp.html#a450d2be8350b29dcb4f3adc3325f56b2">instance_of_cnetprocessingcleanup</a></div><div class="ttdeci">class CNetProcessingCleanup instance_of_cnetprocessingcleanup</div></div>
<div class="ttc" id="class_c_node_html_a1f39037c55bed93b832bcbef00597ca5"><div class="ttname"><a href="class_c_node.html#a1f39037c55bed93b832bcbef00597ca5">CNode::PushAddress</a></div><div class="ttdeci">void PushAddress(const CAddress &amp;_addr, FastRandomContext &amp;insecure_rand)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00877">net.h:877</a></div></div>
<div class="ttc" id="validation_8cpp_html_a290fce59049c0951b8eb73f0129bf6f0"><div class="ttname"><a href="validation_8cpp.html#a290fce59049c0951b8eb73f0129bf6f0">ProcessNewBlock</a></div><div class="ttdeci">bool ProcessNewBlock(const CChainParams &amp;chainparams, const std::shared_ptr&lt; const CBlock &gt; pblock, bool fForceProcessing, bool *fNewBlock)</div><div class="ttdoc">Process an incoming block. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l03585">validation.cpp:3585</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_af8e00fc92c92380006abda55135417c7"><div class="ttname"><a href="net__processing_8cpp.html#af8e00fc92c92380006abda55135417c7">cs_most_recent_block</a></div><div class="ttdeci">static CCriticalSection cs_most_recent_block</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00781">net_processing.cpp:781</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a5f18fbc4522a5c49d0c8ebbd15ecf2c0"><div class="ttname"><a href="net__processing_8cpp.html#a5f18fbc4522a5c49d0c8ebbd15ecf2c0">EraseOrphansFor</a></div><div class="ttdeci">void EraseOrphansFor(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00664">net_processing.cpp:664</a></div></div>
<div class="ttc" id="class_c_message_header_html_ab5b3807481d4b918527b86523f1efee2"><div class="ttname"><a href="class_c_message_header.html#ab5b3807481d4b918527b86523f1efee2">CMessageHeader::GetCommand</a></div><div class="ttdeci">std::string GetCommand() const</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00189">protocol.cpp:189</a></div></div>
<div class="ttc" id="masternode-payments_8cpp_html_aac327e3a251800c22ec67bfa9534c838"><div class="ttname"><a href="masternode-payments_8cpp.html#aac327e3a251800c22ec67bfa9534c838">cs_mapMasternodeBlocks</a></div><div class="ttdeci">CCriticalSection cs_mapMasternodeBlocks</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8cpp_source.html#l00026">masternode-payments.cpp:26</a></div></div>
<div class="ttc" id="class_c_node_html_a94438c6285d1635c62ccff10593780e6"><div class="ttname"><a href="class_c_node.html#a94438c6285d1635c62ccff10593780e6">CNode::SetRecvVersion</a></div><div class="ttdeci">void SetRecvVersion(int nVersionIn)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00844">net.h:844</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a395de13511c6ef9946844ee280b8f08e"><div class="ttname"><a href="namespace_net_msg_type.html#a395de13511c6ef9946844ee280b8f08e">NetMsgType::PONG</a></div><div class="ttdeci">const char * PONG</div><div class="ttdoc">The pong message replies to a ping message, proving to the pinging node that the ponging node is stil...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00030">protocol.cpp:30</a></div></div>
<div class="ttc" id="classbase__blob_html_aeee68e00ceeacf49086e98b661e017ff"><div class="ttname"><a href="classbase__blob.html#aeee68e00ceeacf49086e98b661e017ff">base_blob::begin</a></div><div class="ttdeci">unsigned char * begin()</div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00057">uint256.h:57</a></div></div>
<div class="ttc" id="transaction_8h_html_ae462b4b8f07705a82bf11cf361959b97"><div class="ttname"><a href="transaction_8h.html#ae462b4b8f07705a82bf11cf361959b97">CTransactionRef</a></div><div class="ttdeci">std::shared_ptr&lt; const CTransaction &gt; CTransactionRef</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00372">transaction.h:372</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a2b879124ab9ed92674b4559f5f7e493f"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a2b879124ab9ed92674b4559f5f7e493f">MSG_QUORUM_DUMMY_CONTRIBUTION</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00379">protocol.h:379</a></div></div>
<div class="ttc" id="class_c_node_html_a91ddde2164145c8d4ab033e7b75bbc40"><div class="ttname"><a href="class_c_node.html#a91ddde2164145c8d4ab033e7b75bbc40">CNode::timeLastMempoolReq</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; timeLastMempoolReq</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00789">net.h:789</a></div></div>
<div class="ttc" id="class_c_message_header_html_a759db7100358ba4a44bf6dee757ffe51"><div class="ttname"><a href="class_c_message_header.html#a759db7100358ba4a44bf6dee757ffe51">CMessageHeader::IsValid</a></div><div class="ttdeci">bool IsValid(const MessageStartChars &amp;messageStart) const</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00194">protocol.cpp:194</a></div></div>
<div class="ttc" id="consensus_2validation_8h_html_a33438febc90b2b44c11530b8207d2e0f"><div class="ttname"><a href="consensus_2validation_8h.html#a33438febc90b2b44c11530b8207d2e0f">REJECT_OBSOLETE</a></div><div class="ttdeci">static const unsigned char REJECT_OBSOLETE</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00014">validation.h:14</a></div></div>
<div class="ttc" id="masternodeman_8h_html"><div class="ttname"><a href="masternodeman_8h.html">masternodeman.h</a></div></div>
<div class="ttc" id="classbase__blob_html_aba89c6722866a5850882a509d27d7bbd"><div class="ttname"><a href="classbase__blob.html#aba89c6722866a5850882a509d27d7bbd">base_blob::IsNull</a></div><div class="ttdeci">bool IsNull() const</div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00033">uint256.h:33</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a216e35db319a5d508043639fd3170776"><div class="ttname"><a href="namespace_net_msg_type.html#a216e35db319a5d508043639fd3170776">NetMsgType::HEADERS</a></div><div class="ttdeci">const char * HEADERS</div><div class="ttdoc">The headers message sends one or more block headers to a node which previously requested certain head...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00025">protocol.cpp:25</a></div></div>
<div class="ttc" id="class_c_block_index_html_af3c6d6dd8a7579e5ce516d94b98d2db5"><div class="ttname"><a href="class_c_block_index.html#af3c6d6dd8a7579e5ce516d94b98d2db5">CBlockIndex::nChainTx</a></div><div class="ttdeci">unsigned int nChainTx</div><div class="ttdoc">(memory only) Number of transactions in the chain up to and including this block. ...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00188">chain.h:188</a></div></div>
<div class="ttc" id="class_c_node_html_a7cef2333aa8776127a7e7fcab659eb6a"><div class="ttname"><a href="class_c_node.html#a7cef2333aa8776127a7e7fcab659eb6a">CNode::PushInventory</a></div><div class="ttdeci">void PushInventory(const CInv &amp;inv)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00905">net.h:905</a></div></div>
<div class="ttc" id="class_c_spork_message_html"><div class="ttname"><a href="class_c_spork_message.html">CSporkMessage</a></div><div class="ttdoc">Sporks are network parameters used primarily to prevent forking and turn on/off certain features...</div><div class="ttdef"><b>Definition:</b> <a href="spork_8h_source.html#l00057">spork.h:57</a></div></div>
<div class="ttc" id="class_compare_inv_mempool_order_html"><div class="ttname"><a href="class_compare_inv_mempool_order.html">CompareInvMempoolOrder</a></div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03146">net_processing.cpp:3146</a></div></div>
<div class="ttc" id="validation_8cpp_html_a8cfbc84b7aa211f3368d4d3813be276c"><div class="ttname"><a href="validation_8cpp.html#a8cfbc84b7aa211f3368d4d3813be276c">ActivateBestChain</a></div><div class="ttdeci">bool ActivateBestChain(CValidationState &amp;state, const CChainParams &amp;chainparams, std::shared_ptr&lt; const CBlock &gt; pblock)</div><div class="ttdoc">Make the best chain active, in multiple steps. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l02879">validation.cpp:2879</a></div></div>
<div class="ttc" id="class_c_node_html_a3d311ea99f2524e5c2cdb9a311725b9f"><div class="ttname"><a href="class_c_node.html#a3d311ea99f2524e5c2cdb9a311725b9f">CNode::nServices</a></div><div class="ttdeci">std::atomic&lt; ServiceFlags &gt; nServices</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00684">net.h:684</a></div></div>
<div class="ttc" id="class_c_transaction_html_ad64447ea044ec850313696fc99412d95"><div class="ttname"><a href="class_c_transaction.html#ad64447ea044ec850313696fc99412d95">CTransaction::vin</a></div><div class="ttdeci">const std::vector&lt; CTxIn &gt; vin</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00238">transaction.h:238</a></div></div>
<div class="ttc" id="class_c_node_html_a331888bc15bb49775451d951735e4b6a"><div class="ttname"><a href="class_c_node.html#a331888bc15bb49775451d951735e4b6a">CNode::SetAddrLocal</a></div><div class="ttdeci">void SetAddrLocal(const CService &amp;addrLocalIn)</div><div class="ttdoc">May not be called more than once. </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00629">net.cpp:629</a></div></div>
<div class="ttc" id="class_c_node_html_a395e2ead02225f29423e211aa2108272"><div class="ttname"><a href="class_c_node.html#a395e2ead02225f29423e211aa2108272">CNode::nServicesExpected</a></div><div class="ttdeci">ServiceFlags nServicesExpected</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00685">net.h:685</a></div></div>
<div class="ttc" id="class_c_node_html_af627cc9fe0654487aed7b4224d78ad24"><div class="ttname"><a href="class_c_node.html#af627cc9fe0654487aed7b4224d78ad24">CNode::nNextLocalAddrSend</a></div><div class="ttdeci">int64_t nNextLocalAddrSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00761">net.h:761</a></div></div>
<div class="ttc" id="class_c_node_html_a9649c1f27ff0d8f0ba89eb1ea5bee139"><div class="ttname"><a href="class_c_node.html#a9649c1f27ff0d8f0ba89eb1ea5bee139">CNode::vRecvGetData</a></div><div class="ttdeci">std::deque&lt; CInv &gt; vRecvGetData</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00701">net.h:701</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_afabe3cd738cb766597ff4c1ee1e47cbd"><div class="ttname"><a href="namespace_net_msg_type.html#afabe3cd738cb766597ff4c1ee1e47cbd">NetMsgType::INV</a></div><div class="ttdeci">const char * INV</div><div class="ttdoc">The inv message (inventory message) transmits one or more inventories of objects known to the transmi...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00019">protocol.cpp:19</a></div></div>
<div class="ttc" id="arith__uint256_8cpp_html_a6a6e0e2e41ba7e31c4a741eb2426a516"><div class="ttname"><a href="arith__uint256_8cpp.html#a6a6e0e2e41ba7e31c4a741eb2426a516">UintToArith256</a></div><div class="ttdeci">arith_uint256 UintToArith256(const uint256 &amp;a)</div><div class="ttdef"><b>Definition:</b> <a href="arith__uint256_8cpp_source.html#l00254">arith_uint256.cpp:254</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a9cbbaf26471c2acdf38b1e2536bf4462"><div class="ttname"><a href="net__processing_8cpp.html#a9cbbaf26471c2acdf38b1e2536bf4462">ProcessMessage</a></div><div class="ttdeci">static bool ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, int64_t nTimeReceived, const CChainParams &amp;chainparams, CConnman &amp;connman, const std::atomic&lt; bool &gt; &amp;interruptMsgProc)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l01360">net_processing.cpp:1360</a></div></div>
<div class="ttc" id="class_c_connman_html_a2d665bfdec68f6484b9f0d6760f9efd1"><div class="ttname"><a href="class_c_connman.html#a2d665bfdec68f6484b9f0d6760f9efd1">CConnman::ForEachNode</a></div><div class="ttdeci">void ForEachNode(const Condition &amp;cond, Callable &amp;&amp;func)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00240">net.h:240</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a11b49df4769b3e5c303fbb87ef05c96d"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11b49df4769b3e5c303fbb87ef05c96d">MSG_MASTERNODE_PAYMENT_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00362">protocol.h:362</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_ac5a23d1da696b20b0cd74930d6752e8e"><div class="ttname"><a href="class_c_masternode_man.html#ac5a23d1da696b20b0cd74930d6752e8e">CMasternodeMan::mapSeenMasternodeBroadcast</a></div><div class="ttdeci">std::map&lt; uint256, std::pair&lt; int64_t, CMasternodeBroadcast &gt; &gt; mapSeenMasternodeBroadcast</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8h_source.html#l00092">masternodeman.h:92</a></div></div>
<div class="ttc" id="class_c_deterministic_m_n_manager_html_a9a6874a65486f4297bfcbd06e52e5eb7"><div class="ttname"><a href="class_c_deterministic_m_n_manager.html#a9a6874a65486f4297bfcbd06e52e5eb7">CDeterministicMNManager::IsDeterministicMNsSporkActive</a></div><div class="ttdeci">bool IsDeterministicMNsSporkActive(int nHeight=-1)</div><div class="ttdef"><b>Definition:</b> <a href="deterministicmns_8cpp_source.html#l00878">deterministicmns.cpp:878</a></div></div>
<div class="ttc" id="class_c_rolling_bloom_filter_html_a4f7d6161274b03c63be50aadb1fe46b7"><div class="ttname"><a href="class_c_rolling_bloom_filter.html#a4f7d6161274b03c63be50aadb1fe46b7">CRollingBloomFilter::contains</a></div><div class="ttdeci">bool contains(const std::vector&lt; unsigned char &gt; &amp;vKey) const</div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cpp_source.html#l00285">bloom.cpp:285</a></div></div>
<div class="ttc" id="validation_8h_html_ae98e9fff288e3029a25765a7f924d960"><div class="ttname"><a href="validation_8h.html#ae98e9fff288e3029a25765a7f924d960">REJECT_INTERNAL</a></div><div class="ttdeci">static const unsigned int REJECT_INTERNAL</div><div class="ttdoc">Reject codes greater or equal to this can be returned by AcceptToMemPool for transactions, to signal internal conditions. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00560">validation.h:560</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_ab30fadfa811829e79accca41da6a8328"><div class="ttname"><a href="class_c_tx_mem_pool.html#ab30fadfa811829e79accca41da6a8328">CTxMemPool::check</a></div><div class="ttdeci">void check(const CCoinsViewCache *pcoins) const</div><div class="ttdoc">If sanity-checking is turned on, check makes sure the pool is consistent (does not contain two transa...</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01030">txmempool.cpp:1030</a></div></div>
<div class="ttc" id="class_c_node_html_ab1b30fa8e48005752f6b0bcf43eca478"><div class="ttname"><a href="class_c_node.html#ab1b30fa8e48005752f6b0bcf43eca478">CNode::setKnown</a></div><div class="ttdeci">std::set&lt; uint256 &gt; setKnown</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00759">net.h:759</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a22acc167096d6b0ce88c4a09a83988ce"><div class="ttname"><a href="namespace_net_msg_type.html#a22acc167096d6b0ce88c4a09a83988ce">NetMsgType::MNANNOUNCE</a></div><div class="ttdeci">const char * MNANNOUNCE</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00056">protocol.cpp:56</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a23845464e9b2f297b675402b6a01da03"><div class="ttname"><a href="class_c_instant_send.html#a23845464e9b2f297b675402b6a01da03">CInstantSend::AcceptLockRequest</a></div><div class="ttdeci">void AcceptLockRequest(const CTxLockRequest &amp;txLockRequest)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00753">instantx.cpp:753</a></div></div>
<div class="ttc" id="util_8cpp_html_ad38f2be538d80fba8e091c64d42405a8"><div class="ttname"><a href="util_8cpp.html#ad38f2be538d80fba8e091c64d42405a8">IsArgSet</a></div><div class="ttdeci">bool IsArgSet(const std::string &amp;strArg)</div><div class="ttdoc">Return true if the given argument has been manually set. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00452">util.cpp:452</a></div></div>
<div class="ttc" id="class_c_block_index_html_a98490a2788c65cdd6ae9002b004dd74c"><div class="ttname"><a href="class_c_block_index.html#a98490a2788c65cdd6ae9002b004dd74c">CBlockIndex::GetBlockHash</a></div><div class="ttdeci">uint256 GetBlockHash() const</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00276">chain.h:276</a></div></div>
<div class="ttc" id="class_c_block_index_html_ad8b5a6560e7c0d4222066e2922178683"><div class="ttname"><a href="class_c_block_index.html#ad8b5a6560e7c0d4222066e2922178683">CBlockIndex::IsValid</a></div><div class="ttdeci">bool IsValid(enum BlockStatus nUpTo=BLOCK_VALID_TRANSACTIONS) const</div><div class="ttdoc">Check whether this block index entry is valid up to the passed validity level. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00316">chain.h:316</a></div></div>
<div class="ttc" id="sync_8h_html_acd61d0cb3b49f367728193720014aed0"><div class="ttname"><a href="sync_8h.html#acd61d0cb3b49f367728193720014aed0">AssertLockHeld</a></div><div class="ttdeci">#define AssertLockHeld(cs)</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00086">sync.h:86</a></div></div>
<div class="ttc" id="class_c_node_html_aa8d520199b103410958ba9ce4412cf61"><div class="ttname"><a href="class_c_node.html#aa8d520199b103410958ba9ce4412cf61">CNode::fSentAddr</a></div><div class="ttdeci">bool fSentAddr</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00732">net.h:732</a></div></div>
<div class="ttc" id="class_c_private_send_broadcast_tx_html_a323d1fce5e220f62a20f2619f8627588"><div class="ttname"><a href="class_c_private_send_broadcast_tx.html#a323d1fce5e220f62a20f2619f8627588">CPrivateSendBroadcastTx::masternodeOutpoint</a></div><div class="ttdeci">COutPoint masternodeOutpoint</div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8h_source.html#l00258">privatesend.h:258</a></div></div>
<div class="ttc" id="masternode-payments_8h_html"><div class="ttname"><a href="masternode-payments_8h.html">masternode-payments.h</a></div></div>
<div class="ttc" id="class_c_node_html_ab7986845edae94a0aa0d64b6fcf51a38"><div class="ttname"><a href="class_c_node.html#ab7986845edae94a0aa0d64b6fcf51a38">CNode::nPingUsecTime</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nPingUsecTime</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00796">net.h:796</a></div></div>
<div class="ttc" id="struct_c_node_state_stats_html_a67c910a57285a63bbf0bb88ea7a9ca05"><div class="ttname"><a href="struct_c_node_state_stats.html#a67c910a57285a63bbf0bb88ea7a9ca05">CNodeStateStats::nCommonHeight</a></div><div class="ttdeci">int nCommonHeight</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00048">net_processing.h:48</a></div></div>
<div class="ttc" id="util_8cpp_html_aab0b2c1be849102968dfee289f3b3e2a"><div class="ttname"><a href="util_8cpp.html#aab0b2c1be849102968dfee289f3b3e2a">fMasternodeMode</a></div><div class="ttdeci">bool fMasternodeMode</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00113">util.cpp:113</a></div></div>
<div class="ttc" id="addrdb_8h_html_ae79eefa5f9d20b9761dfc7a41123e668ae46a4491319b620067723c12d5ba3c7a"><div class="ttname"><a href="addrdb_8h.html#ae79eefa5f9d20b9761dfc7a41123e668ae46a4491319b620067723c12d5ba3c7a">BanReasonNodeMisbehaving</a></div><div class="ttdef"><b>Definition:</b> <a href="addrdb_8h_source.html#l00022">addrdb.h:22</a></div></div>
<div class="ttc" id="utilstrencodings_8h_html"><div class="ttname"><a href="utilstrencodings_8h.html">utilstrencodings.h</a></div></div>
<div class="ttc" id="class_c_node_html_a99add23b72cd7eae9ea5c7d16b0fe259"><div class="ttname"><a href="class_c_node.html#a99add23b72cd7eae9ea5c7d16b0fe259">CNode::nMinPingUsecTime</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nMinPingUsecTime</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00798">net.h:798</a></div></div>
<div class="ttc" id="class_c_node_html_a62937ed6238077e4c6e4364d75b4c0b7"><div class="ttname"><a href="class_c_node.html#a62937ed6238077e4c6e4364d75b4c0b7">CNode::GetMyStartingHeight</a></div><div class="ttdeci">int GetMyStartingHeight() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00832">net.h:832</a></div></div>
<div class="ttc" id="validation_8cpp_html_a1821834b8f7837b469f7f91a14c20042"><div class="ttname"><a href="validation_8cpp.html#a1821834b8f7837b469f7f91a14c20042">pcoinsTip</a></div><div class="ttdeci">CCoinsViewCache * pcoinsTip</div><div class="ttdoc">Global variable that points to the active CCoinsView (protected by cs_main) </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00227">validation.cpp:227</a></div></div>
<div class="ttc" id="class_c_connman_html_ac57208a8ea613f814aaf1c5c5e5394a4"><div class="ttname"><a href="class_c_connman.html#ac57208a8ea613f814aaf1c5c5e5394a4">CConnman::Ban</a></div><div class="ttdeci">void Ban(const CNetAddr &amp;netAddr, const BanReason &amp;reason, int64_t bantimeoffset=0, bool sinceUnixEpoch=false)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00495">net.cpp:495</a></div></div>
<div class="ttc" id="class_c_node_html_aaa7ed919e1ed445dd9589b984231ba46"><div class="ttname"><a href="class_c_node.html#aaa7ed919e1ed445dd9589b984231ba46">CNode::GetLocalServices</a></div><div class="ttdeci">ServiceFlags GetLocalServices() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00941">net.h:941</a></div></div>
<div class="ttc" id="namespacellmq_html_a7c384d41a5924c92a2374e0b99a3bdc0"><div class="ttname"><a href="namespacellmq.html#a7c384d41a5924c92a2374e0b99a3bdc0">llmq::quorumDummyDKG</a></div><div class="ttdeci">CDummyDKG * quorumDummyDKG</div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8cpp_source.html#l00026">quorums_dummydkg.cpp:26</a></div></div>
<div class="ttc" id="chain_8h_html_a0d8c285f70a59a32f4f6ab41b78f93ada00332fcf52dbd55990d8ff86b616bc65"><div class="ttname"><a href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada00332fcf52dbd55990d8ff86b616bc65">BLOCK_VALID_CHAIN</a></div><div class="ttdoc">Outputs do not overspend inputs, no double spends, coinbase output ok, no immature coinbase spends...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00131">chain.h:131</a></div></div>
<div class="ttc" id="validation_8h_html_a98597d505d0e8c99870eeda3db92f42f"><div class="ttname"><a href="validation_8h.html#a98597d505d0e8c99870eeda3db92f42f">BLOCK_DOWNLOAD_TIMEOUT_PER_PEER</a></div><div class="ttdeci">static const int64_t BLOCK_DOWNLOAD_TIMEOUT_PER_PEER</div><div class="ttdoc">Additional block download timeout per parallel downloading peer (i.e. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00125">validation.h:125</a></div></div>
<div class="ttc" id="class_c_node_html_a721e2470c2c961b7599768a14be68781"><div class="ttname"><a href="class_c_node.html#a721e2470c2c961b7599768a14be68781">CNode::fClient</a></div><div class="ttdeci">bool fClient</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00723">net.h:723</a></div></div>
<div class="ttc" id="class_c_connman_html_a28701e595fcd7dd71791f105457db034"><div class="ttname"><a href="class_c_connman.html#a28701e595fcd7dd71791f105457db034">CConnman::ForNode</a></div><div class="ttdeci">bool ForNode(NodeId id, std::function&lt; bool(const CNode *pnode)&gt; cond, std::function&lt; bool(CNode *pnode)&gt; func)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l03007">net.cpp:3007</a></div></div>
<div class="ttc" id="net_8cpp_html_a7935254c613d6f3cdadd3ce45f7efbff"><div class="ttname"><a href="net_8cpp.html#a7935254c613d6f3cdadd3ce45f7efbff">fRelayTxes</a></div><div class="ttdeci">bool fRelayTxes</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00081">net.cpp:81</a></div></div>
<div class="ttc" id="class_c_node_html_afb24fb33019af5c4085412fe3898cf01"><div class="ttname"><a href="class_c_node.html#afb24fb33019af5c4085412fe3898cf01">CNode::strSubVer</a></div><div class="ttdeci">std::string strSubVer</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00717">net.h:717</a></div></div>
<div class="ttc" id="class_c_merkle_block_html"><div class="ttname"><a href="class_c_merkle_block.html">CMerkleBlock</a></div><div class="ttdoc">Used to relay blocks as header + vector&lt;merkle branch&gt; to filtered nodes. </div><div class="ttdef"><b>Definition:</b> <a href="merkleblock_8h_source.html#l00125">merkleblock.h:125</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a9f6abd72d04b4128a949c0c4db11d883"><div class="ttname"><a href="namespace_net_msg_type.html#a9f6abd72d04b4128a949c0c4db11d883">NetMsgType::GETHEADERS</a></div><div class="ttdeci">const char * GETHEADERS</div><div class="ttdoc">The getheaders message requests a headers message that provides block headers starting from a particu...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00023">protocol.cpp:23</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a387fdffa0ff52dde6b7d1c2991a9bdac"><div class="ttname"><a href="net__processing_8cpp.html#a387fdffa0ff52dde6b7d1c2991a9bdac">Misbehaving</a></div><div class="ttdeci">void Misbehaving(NodeId pnode, int howmuch)</div><div class="ttdoc">Increase a node&amp;#39;s misbehavior score. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00717">net_processing.cpp:717</a></div></div>
<div class="ttc" id="misc_8cpp_html_ae0a67d7e5c7e47430e8b4b4438087c54"><div class="ttname"><a href="misc_8cpp.html#ae0a67d7e5c7e47430e8b4b4438087c54">spork</a></div><div class="ttdeci">UniValue spork(const JSONRPCRequest &amp;request)</div><div class="ttdef"><b>Definition:</b> <a href="misc_8cpp_source.html#l00225">misc.cpp:225</a></div></div>
<div class="ttc" id="util_8cpp_html_a64d956f1dda7f9a80ab5d594532b906d"><div class="ttname"><a href="util_8cpp.html#a64d956f1dda7f9a80ab5d594532b906d">GetBoolArg</a></div><div class="ttdeci">bool GetBoolArg(const std::string &amp;strArg, bool fDefault)</div><div class="ttdoc">Return boolean argument or default value. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00474">util.cpp:474</a></div></div>
<div class="ttc" id="util_8h_html_afc02c0a4258fedfb316be612bb659ba8"><div class="ttname"><a href="util_8h.html#afc02c0a4258fedfb316be612bb659ba8">LogPrintf</a></div><div class="ttdeci">#define LogPrintf(...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00116">util.h:116</a></div></div>
<div class="ttc" id="txmempool_8h_html"><div class="ttname"><a href="txmempool_8h.html">txmempool.h</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a8bad6026f225abcd25d6598d775a13e2"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a8bad6026f225abcd25d6598d775a13e2">MSG_QUORUM_DUMMY_COMMITMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00378">protocol.h:378</a></div></div>
<div class="ttc" id="struct_c_main_signals_html_a6144f532a3944d55a9c0a4fe2e9283c5"><div class="ttname"><a href="struct_c_main_signals.html#a6144f532a3944d55a9c0a4fe2e9283c5">CMainSignals::SYNC_TRANSACTION_NOT_IN_BLOCK</a></div><div class="ttdeci">static const int SYNC_TRANSACTION_NOT_IN_BLOCK</div><div class="ttdoc">A posInBlock value for SyncTransaction calls for tranactions not included in connected blocks such as...</div><div class="ttdef"><b>Definition:</b> <a href="validationinterface_8h_source.html#l00067">validationinterface.h:67</a></div></div>
<div class="ttc" id="validation_8h_html_a5289ed91f1daf187bba005dd54d62649"><div class="ttname"><a href="validation_8h.html#a5289ed91f1daf187bba005dd54d62649">DEFAULT_WHITELISTRELAY</a></div><div class="ttdeci">static const bool DEFAULT_WHITELISTRELAY</div><div class="ttdoc">Default for DEFAULT_WHITELISTRELAY. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00055">validation.h:55</a></div></div>
<div class="ttc" id="class_c_block_index_html_ac5a336b45ca70e3ed2fc090bf2ee3011"><div class="ttname"><a href="class_c_block_index.html#ac5a336b45ca70e3ed2fc090bf2ee3011">CBlockIndex::nStatus</a></div><div class="ttdeci">unsigned int nStatus</div><div class="ttdoc">Verification status of this block. See enum BlockStatus. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00191">chain.h:191</a></div></div>
<div class="ttc" id="class_c_data_stream_html_add30f866dd928fc28c47fe79a0a6723a"><div class="ttname"><a href="class_c_data_stream.html#add30f866dd928fc28c47fe79a0a6723a">CDataStream::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="streams_8h_source.html#l00194">streams.h:194</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ac4299daf3e1b6b047287708f3894113e"><div class="ttname"><a href="namespace_net_msg_type.html#ac4299daf3e1b6b047287708f3894113e">NetMsgType::MNLISTDIFF</a></div><div class="ttdeci">const char * MNLISTDIFF</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00073">protocol.cpp:73</a></div></div>
<div class="ttc" id="class_c_node_html_a30f76a69e956d342bdbb400541c98ccb"><div class="ttname"><a href="class_c_node.html#a30f76a69e956d342bdbb400541c98ccb">CNode::nProcessQueueSize</a></div><div class="ttdeci">size_t nProcessQueueSize</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00697">net.h:697</a></div></div>
<div class="ttc" id="chain_8h_html_a0d8c285f70a59a32f4f6ab41b78f93ada47b28fca76b64d094ddca0a3aa8da230"><div class="ttname"><a href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada47b28fca76b64d094ddca0a3aa8da230">BLOCK_VALID_SCRIPTS</a></div><div class="ttdoc">Scripts &amp; signatures ok. Implies all parents are also at least SCRIPTS. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00134">chain.h:134</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a867f7b452141770f3b2e8697fb3513d8"><div class="ttname"><a href="class_c_tx_mem_pool.html#a867f7b452141770f3b2e8697fb3513d8">CTxMemPool::size</a></div><div class="ttdeci">unsigned long size()</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8h_source.html#l00674">txmempool.h:674</a></div></div>
<div class="ttc" id="class_c_validation_state_html_ace1d536f4003d3a6689fccd0f496c977"><div class="ttname"><a href="class_c_validation_state.html#ace1d536f4003d3a6689fccd0f496c977">CValidationState::IsInvalid</a></div><div class="ttdeci">bool IsInvalid() const</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00064">validation.h:64</a></div></div>
<div class="ttc" id="class_compare_inv_mempool_order_html_ad6211dc6a6928d8499d5b58babe95ddd"><div class="ttname"><a href="class_compare_inv_mempool_order.html#ad6211dc6a6928d8499d5b58babe95ddd">CompareInvMempoolOrder::mp</a></div><div class="ttdeci">CTxMemPool * mp</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03148">net_processing.cpp:3148</a></div></div>
<div class="ttc" id="masternode-payments_8cpp_html_ab15235ecb957ac017b2a372923b90765"><div class="ttname"><a href="masternode-payments_8cpp.html#ab15235ecb957ac017b2a372923b90765">mnpayments</a></div><div class="ttdeci">CMasternodePayments mnpayments</div><div class="ttdoc">Object for who&amp;#39;s going to get paid on which blocks. </div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8cpp_source.html#l00023">masternode-payments.cpp:23</a></div></div>
<div class="ttc" id="classllmq_1_1_c_dummy_d_k_g_html_acbc241cee5cfca4ddea8bf937deaa105"><div class="ttname"><a href="classllmq_1_1_c_dummy_d_k_g.html#acbc241cee5cfca4ddea8bf937deaa105">llmq::CDummyDKG::HasDummyContribution</a></div><div class="ttdeci">bool HasDummyContribution(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8cpp_source.html#l00558">quorums_dummydkg.cpp:558</a></div></div>
<div class="ttc" id="validation_8cpp_html_acfbdea59afc1824d0d1c1ff10f17fd53"><div class="ttname"><a href="validation_8cpp.html#acfbdea59afc1824d0d1c1ff10f17fd53">pindexBestHeader</a></div><div class="ttdeci">CBlockIndex * pindexBestHeader</div><div class="ttdoc">Best header we&amp;#39;ve seen so far (used for getheaders queries&amp;#39; starting points). </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00073">validation.cpp:73</a></div></div>
<div class="ttc" id="class_block_transactions_html_a1a88870022bf6c5d7522689c961fc570"><div class="ttname"><a href="class_block_transactions.html#a1a88870022bf6c5d7522689c961fc570">BlockTransactions::txn</a></div><div class="ttdeci">std::vector&lt; CTransactionRef &gt; txn</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00075">blockencodings.h:75</a></div></div>
<div class="ttc" id="class_c_node_html_a2bb91c9968a9f855c05b1121100a8797"><div class="ttname"><a href="class_c_node.html#a2bb91c9968a9f855c05b1121100a8797">CNode::fOneShot</a></div><div class="ttdeci">bool fOneShot</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00721">net.h:721</a></div></div>
<div class="ttc" id="class_c_tx_in_html"><div class="ttname"><a href="class_c_tx_in.html">CTxIn</a></div><div class="ttdoc">An input of a transaction. </div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00070">transaction.h:70</a></div></div>
<div class="ttc" id="class_c_alert_html"><div class="ttname"><a href="class_c_alert.html">CAlert</a></div><div class="ttdoc">An alert is a combination of a serialized CUnsignedAlert and a signature. </div><div class="ttdef"><b>Definition:</b> <a href="alert_8h_source.html#l00076">alert.h:76</a></div></div>
<div class="ttc" id="class_c_get_simplified_m_n_list_diff_html"><div class="ttname"><a href="class_c_get_simplified_m_n_list_diff.html">CGetSimplifiedMNListDiff</a></div><div class="ttdoc">P2P messages. </div><div class="ttdef"><b>Definition:</b> <a href="simplifiedmns_8h_source.html#l00083">simplifiedmns.h:83</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a50b18ddc7e34b513251de461a3858177"><div class="ttname"><a href="net__processing_8cpp.html#a50b18ddc7e34b513251de461a3858177">vExtraTxnForCompactIt</a></div><div class="ttdeci">static size_t vExtraTxnForCompactIt</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00078">net_processing.cpp:78</a></div></div>
<div class="ttc" id="class_c_private_send_html_a5ca6361baefaecece1640899f918fd8a"><div class="ttname"><a href="class_c_private_send.html#a5ca6361baefaecece1640899f918fd8a">CPrivateSend::GetDSTX</a></div><div class="ttdeci">static CPrivateSendBroadcastTx GetDSTX(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8cpp_source.html#l00552">privatesend.cpp:552</a></div></div>
<div class="ttc" id="sync_8h_html_a911fe23f057c2fe5aad629162d6c99d0"><div class="ttname"><a href="sync_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a></div><div class="ttdeci">#define LOCK(cs)</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00177">sync.h:177</a></div></div>
<div class="ttc" id="rest_8cpp_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="rest_8cpp.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="rest_8cpp_source.html#l00034">rest.cpp:34</a></div></div>
<div class="ttc" id="validation_8h_html_a276b0b56a72df733dda86cfe6322f604"><div class="ttname"><a href="validation_8h.html#a276b0b56a72df733dda86cfe6322f604">MAX_BLOCKS_IN_TRANSIT_PER_PEER</a></div><div class="ttdeci">static const int MAX_BLOCKS_IN_TRANSIT_PER_PEER</div><div class="ttdoc">Number of blocks that can be requested at any given time from a single peer. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00088">validation.h:88</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a3ef0cc6e9d9d6435ee2a5569244d6ebd"><div class="ttname"><a href="net__processing_8cpp.html#a3ef0cc6e9d9d6435ee2a5569244d6ebd">UnregisterNodeSignals</a></div><div class="ttdeci">void UnregisterNodeSignals(CNodeSignals &amp;nodeSignals)</div><div class="ttdoc">Unregister a network node. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00589">net_processing.cpp:589</a></div></div>
<div class="ttc" id="class_c_transaction_html_a7efd1379de830341417c0bfa23a149aa"><div class="ttname"><a href="class_c_transaction.html#a7efd1379de830341417c0bfa23a149aa">CTransaction::GetHash</a></div><div class="ttdeci">const uint256 &amp; GetHash() const</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00277">transaction.h:277</a></div></div>
<div class="ttc" id="classllmq_1_1_c_quorum_block_processor_html_aa95f97977868b55a6616b54392d265f4"><div class="ttname"><a href="classllmq_1_1_c_quorum_block_processor.html#aa95f97977868b55a6616b54392d265f4">llmq::CQuorumBlockProcessor::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="quorums__blockprocessor_8cpp_source.html#l00026">quorums_blockprocessor.cpp:26</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991ad5de2518f7a7e23590f870cf0c57a188"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ad5de2518f7a7e23590f870cf0c57a188">MSG_QUORUM_FINAL_COMMITMENT</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00377">protocol.h:377</a></div></div>
<div class="ttc" id="net_8cpp_html_a058b75c6fcc94a0643184c237ad6de93"><div class="ttname"><a href="net_8cpp.html#a058b75c6fcc94a0643184c237ad6de93">IsPeerAddrLocalGood</a></div><div class="ttdeci">bool IsPeerAddrLocalGood(CNode *pnode)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00175">net.cpp:175</a></div></div>
<div class="ttc" id="class_c_inv_html_a2da8a26c6b8824011e3144459d278c75"><div class="ttname"><a href="class_c_inv.html#a2da8a26c6b8824011e3144459d278c75">CInv::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00407">protocol.h:407</a></div></div>
<div class="ttc" id="version_8h_html_a2c4c900f5bd0c956cc1a64cd0cc1c318"><div class="ttname"><a href="version_8h.html#a2c4c900f5bd0c956cc1a64cd0cc1c318">INIT_PROTO_VERSION</a></div><div class="ttdeci">static const int INIT_PROTO_VERSION</div><div class="ttdoc">initial proto version, to be increased after version/verack negotiation </div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00017">version.h:17</a></div></div>
<div class="ttc" id="netmessagemaker_8h_html"><div class="ttname"><a href="netmessagemaker_8h.html">netmessagemaker.h</a></div></div>
<div class="ttc" id="namespace_consensus_html_ac6c2c4d710cea840f692c6312ec91f69ab2f4dbe4dc6c4d3196697fe29fbb301b"><div class="ttname"><a href="namespace_consensus.html#ac6c2c4d710cea840f692c6312ec91f69ab2f4dbe4dc6c4d3196697fe29fbb301b">Consensus::DEPLOYMENT_DIP0003</a></div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00021">params.h:21</a></div></div>
<div class="ttc" id="instantx_8h_html"><div class="ttname"><a href="instantx_8h.html">instantx.h</a></div></div>
<div class="ttc" id="class_c_chain_html_af1786dc229c215dea7f727c11df2c8dc"><div class="ttname"><a href="class_c_chain.html#af1786dc229c215dea7f727c11df2c8dc">CChain::Contains</a></div><div class="ttdeci">bool Contains(const CBlockIndex *pindex) const</div><div class="ttdoc">Efficiently check whether a block is present in this chain. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00452">chain.h:452</a></div></div>
<div class="ttc" id="class_c_service_html"><div class="ttname"><a href="class_c_service.html">CService</a></div><div class="ttdoc">A combination of a network address (CNetAddr) and a (TCP) port. </div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8h_source.html#l00135">netaddress.h:135</a></div></div>
<div class="ttc" id="class_c_tx_lock_request_html_a8e1d06cde63b2e16db8e1c18e4e65801"><div class="ttname"><a href="class_c_tx_lock_request.html#a8e1d06cde63b2e16db8e1c18e4e65801">CTxLockRequest::tx</a></div><div class="ttdeci">CTransactionRef tx</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8h_source.html#l00180">instantx.h:180</a></div></div>
<div class="ttc" id="class_fast_random_context_html"><div class="ttname"><a href="class_fast_random_context.html">FastRandomContext</a></div><div class="ttdoc">Fast randomness source. </div><div class="ttdef"><b>Definition:</b> <a href="random_8h_source.html#l00035">random.h:35</a></div></div>
<div class="ttc" id="class_c_net_message_html"><div class="ttname"><a href="class_c_net_message.html">CNetMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00634">net.h:634</a></div></div>
<div class="ttc" id="policy_8h_html"><div class="ttname"><a href="policy_8h.html">policy.h</a></div></div>
<div class="ttc" id="consensus_2validation_8h_html"><div class="ttname"><a href="consensus_2validation_8h.html">validation.h</a></div></div>
<div class="ttc" id="class_c_connman_html_aa12d154df14eef07418a36362d1cb8d7"><div class="ttname"><a href="class_c_connman.html#aa12d154df14eef07418a36362d1cb8d7">CConnman::OutboundTargetReached</a></div><div class="ttdeci">bool OutboundTargetReached(bool historicalBlockServingLimit)</div><div class="ttdoc">check if the outbound target is reached </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02756">net.cpp:2756</a></div></div>
<div class="ttc" id="validation_8h_html_ae90d2acb26fa19fdcd983626b0d37d0b"><div class="ttname"><a href="validation_8h.html#ae90d2acb26fa19fdcd983626b0d37d0b">MAX_HEADERS_RESULTS</a></div><div class="ttdeci">static const unsigned int MAX_HEADERS_RESULTS</div><div class="ttdoc">Number of headers sent in one getheaders result. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00093">validation.h:93</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a116be43712370e747337a607486c3e53"><div class="ttname"><a href="class_c_instant_send.html#a116be43712370e747337a607486c3e53">CInstantSend::CanAutoLock</a></div><div class="ttdeci">static bool CanAutoLock()</div><div class="ttdoc">checks if we can automatically lock &quot;simple&quot; transactions </div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00937">instantx.cpp:937</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a9d087eae96b6c836c7eb63693b8b7483"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a9d087eae96b6c836c7eb63693b8b7483">MSG_TXLOCK_VOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00359">protocol.h:359</a></div></div>
<div class="ttc" id="consensus_2validation_8h_html_aaebbd8495fbce589cdf05570198c4240"><div class="ttname"><a href="consensus_2validation_8h.html#aaebbd8495fbce589cdf05570198c4240">REJECT_NONSTANDARD</a></div><div class="ttdeci">static const unsigned char REJECT_NONSTANDARD</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00016">validation.h:16</a></div></div>
<div class="ttc" id="struct_consensus_1_1_params_html_aea6ebb563ceffd026cc7c11d3e9b192e"><div class="ttname"><a href="struct_consensus_1_1_params.html#aea6ebb563ceffd026cc7c11d3e9b192e">Consensus::Params::nPowTargetSpacing</a></div><div class="ttdeci">int64_t nPowTargetSpacing</div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00146">params.h:146</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ac993eb54177079f7a0e8c0c1ad657c6f"><div class="ttname"><a href="namespace_net_msg_type.html#ac993eb54177079f7a0e8c0c1ad657c6f">NetMsgType::ALERT</a></div><div class="ttdeci">const char * ALERT</div><div class="ttdoc">The alert message warns nodes of problems that may affect them or the rest of the network...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00031">protocol.cpp:31</a></div></div>
<div class="ttc" id="class_c_connman_html_a4ba34cd3557ab0ba1cfcbe7c18bf1199"><div class="ttname"><a href="class_c_connman.html#a4ba34cd3557ab0ba1cfcbe7c18bf1199">CConnman::GetAddresses</a></div><div class="ttdeci">std::vector&lt; CAddress &gt; GetAddresses()</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02535">net.cpp:2535</a></div></div>
<div class="ttc" id="class_c_node_html_a09fbd8c77f6be2b8d4b309c703ce2e13"><div class="ttname"><a href="class_c_node.html#a09fbd8c77f6be2b8d4b309c703ce2e13">CNode::filterInventoryKnown</a></div><div class="ttdeci">CRollingBloomFilter filterInventoryKnown</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00764">net.h:764</a></div></div>
<div class="ttc" id="class_c_chain_html_a3077e83c87e8a974765fa76a57fd040b"><div class="ttname"><a href="class_c_chain.html#a3077e83c87e8a974765fa76a57fd040b">CChain::Next</a></div><div class="ttdeci">CBlockIndex * Next(const CBlockIndex *pindex) const</div><div class="ttdoc">Find the successor of a block in this chain, or NULL if the given index is not found or is the tip...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00457">chain.h:457</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a34f999f9e5179be5fc361aaca9c0e5b3"><div class="ttname"><a href="namespace_net_msg_type.html#a34f999f9e5179be5fc361aaca9c0e5b3">NetMsgType::SENDHEADERS</a></div><div class="ttdeci">const char * SENDHEADERS</div><div class="ttdoc">Indicates that a node prefers to receive new block announcements via a &quot;headers&quot; message rather than ...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00037">protocol.cpp:37</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a68c340a8ef4f949cfd06c19a620aa32c"><div class="ttname"><a href="namespace_net_msg_type.html#a68c340a8ef4f949cfd06c19a620aa32c">NetMsgType::MEMPOOL</a></div><div class="ttdeci">const char * MEMPOOL</div><div class="ttdoc">The mempool message requests the TXIDs of transactions that the receiving node has verified as valid ...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00028">protocol.cpp:28</a></div></div>
<div class="ttc" id="struct_c_orphan_tx_html_a06fa313a474fd4e6d0ed20bda7cbe69c"><div class="ttname"><a href="struct_c_orphan_tx.html#a06fa313a474fd4e6d0ed20bda7cbe69c">COrphanTx::fromPeer</a></div><div class="ttdeci">NodeId fromPeer</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00071">net_processing.cpp:71</a></div></div>
<div class="ttc" id="version_8h_html_a43420c87666449f8132e21687abcfda9"><div class="ttname"><a href="version_8h.html#a43420c87666449f8132e21687abcfda9">SHORT_IDS_BLOCKS_VERSION</a></div><div class="ttdeci">static const int SHORT_IDS_BLOCKS_VERSION</div><div class="ttdoc">short-id-based block download starts with this version </div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00048">version.h:48</a></div></div>
<div class="ttc" id="class_c_validation_state_html_a8fa9612cb40c3c8592f7cd29b5931ccd"><div class="ttname"><a href="class_c_validation_state.html#a8fa9612cb40c3c8592f7cd29b5931ccd">CValidationState::GetRejectReason</a></div><div class="ttdeci">std::string GetRejectReason() const</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00081">validation.h:81</a></div></div>
<div class="ttc" id="net__processing_8h_html_a50cdb9bf0105f8f39008a7ec09909336"><div class="ttname"><a href="net__processing_8h.html#a50cdb9bf0105f8f39008a7ec09909336">ORPHAN_TX_EXPIRE_INTERVAL</a></div><div class="ttdeci">static const int64_t ORPHAN_TX_EXPIRE_INTERVAL</div><div class="ttdoc">Minimum time between orphan transactions expire time checks in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00017">net_processing.h:17</a></div></div>
<div class="ttc" id="netbase_8cpp_html_aef250c1632d217d8f3b752ddeacc0368"><div class="ttname"><a href="netbase_8cpp.html#aef250c1632d217d8f3b752ddeacc0368">IsProxy</a></div><div class="ttdeci">bool IsProxy(const CNetAddr &amp;addr)</div><div class="ttdef"><b>Definition:</b> <a href="netbase_8cpp_source.html#l00528">netbase.cpp:528</a></div></div>
<div class="ttc" id="simplifiedmns_8h_html"><div class="ttname"><a href="simplifiedmns_8h.html">simplifiedmns.h</a></div></div>
<div class="ttc" id="class_c_transaction_html_a708645274ddfd83829315ffe5c7c5c3e"><div class="ttname"><a href="class_c_transaction.html#a708645274ddfd83829315ffe5c7c5c3e">CTransaction::vout</a></div><div class="ttdeci">const std::vector&lt; CTxOut &gt; vout</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00239">transaction.h:239</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_a2b6e0b1cc473ed34714723422e0b8ae8"><div class="ttname"><a href="class_c_governance_manager.html#a2b6e0b1cc473ed34714723422e0b8ae8">CGovernanceManager::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00088">governance.cpp:88</a></div></div>
<div class="ttc" id="class_c_address_html"><div class="ttname"><a href="class_c_address.html">CAddress</a></div><div class="ttdoc">A CService with information about it as peer. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00311">protocol.h:311</a></div></div>
<div class="ttc" id="class_c_tx_lock_request_html_a7bd35f1b5d30598b8638a804295dab10"><div class="ttname"><a href="class_c_tx_lock_request.html#a7bd35f1b5d30598b8638a804295dab10">CTxLockRequest::GetHash</a></div><div class="ttdeci">const uint256 &amp; GetHash() const</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8h_source.html#l00200">instantx.h:200</a></div></div>
<div class="ttc" id="deterministicmns_8cpp_html_a27187a671f64a49af40318989046650f"><div class="ttname"><a href="deterministicmns_8cpp.html#a27187a671f64a49af40318989046650f">deterministicMNManager</a></div><div class="ttdeci">CDeterministicMNManager * deterministicMNManager</div><div class="ttdef"><b>Definition:</b> <a href="deterministicmns_8cpp_source.html#l00024">deterministicmns.cpp:24</a></div></div>
<div class="ttc" id="validation_8cpp_html_a5edcd96316574fd4a7f3ae0922a5cfd6"><div class="ttname"><a href="validation_8cpp.html#a5edcd96316574fd4a7f3ae0922a5cfd6">IsInitialBlockDownload</a></div><div class="ttdeci">bool IsInitialBlockDownload()</div><div class="ttdoc">Check whether we are doing an initial block download (synchronizing from disk or network) ...</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l01220">validation.cpp:1220</a></div></div>
<div class="ttc" id="class_c_service_html_af21ea7db4318330b337c8bfdcc55aff0"><div class="ttname"><a href="class_c_service.html#af21ea7db4318330b337c8bfdcc55aff0">CService::GetKey</a></div><div class="ttdeci">std::vector&lt; unsigned char &gt; GetKey() const</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00554">netaddress.cpp:554</a></div></div>
<div class="ttc" id="serialize_8h_html_aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c"><div class="ttname"><a href="serialize_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a652754eeaf79fba4fcf4c18597a6961c">SER_NETWORK</a></div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00158">serialize.h:158</a></div></div>
<div class="ttc" id="class_c_message_header_html_a02dcbb01fac09d6a8b223df5c38b9eb3ac92b66287a05d5c96bf494ff5a48e726"><div class="ttname"><a href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3ac92b66287a05d5c96bf494ff5a48e726">CMessageHeader::CHECKSUM_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00034">protocol.h:34</a></div></div>
<div class="ttc" id="protocol_8cpp_html_a5f8d18ec9217ffee378339dc22ebe20d"><div class="ttname"><a href="protocol_8cpp.html#a5f8d18ec9217ffee378339dc22ebe20d">getAllNetMessageTypes</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; &amp; getAllNetMessageTypes()</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00297">protocol.cpp:297</a></div></div>
<div class="ttc" id="class_c_inv_html_abfa04c38e9c0def9a2b09a9c43929744"><div class="ttname"><a href="class_c_inv.html#abfa04c38e9c0def9a2b09a9c43929744">CInv::hash</a></div><div class="ttdeci">uint256 hash</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00408">protocol.h:408</a></div></div>
<div class="ttc" id="instantx_8cpp_html_a6ed4b104bfd9f775e0c0a3524a6b4955"><div class="ttname"><a href="instantx_8cpp.html#a6ed4b104bfd9f775e0c0a3524a6b4955">instantsend</a></div><div class="ttdeci">CInstantSend instantsend</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00042">instantx.cpp:42</a></div></div>
<div class="ttc" id="net__processing_8h_html_a1ca092f66c0d0ea7ea0e930b5a72c500"><div class="ttname"><a href="net__processing_8h.html#a1ca092f66c0d0ea7ea0e930b5a72c500">ORPHAN_TX_EXPIRE_TIME</a></div><div class="ttdeci">static const int64_t ORPHAN_TX_EXPIRE_TIME</div><div class="ttdoc">Expiration time for orphan transactions in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00015">net_processing.h:15</a></div></div>
<div class="ttc" id="tinyformat_8h_html"><div class="ttname"><a href="tinyformat_8h.html">tinyformat.h</a></div></div>
<div class="ttc" id="validationinterface_8cpp_html_a0aaad62c8654cb1868295e0682b05866"><div class="ttname"><a href="validationinterface_8cpp.html#a0aaad62c8654cb1868295e0682b05866">GetMainSignals</a></div><div class="ttdeci">CMainSignals &amp; GetMainSignals()</div><div class="ttdef"><b>Definition:</b> <a href="validationinterface_8cpp_source.html#l00010">validationinterface.cpp:10</a></div></div>
<div class="ttc" id="blockencodings_8h_html"><div class="ttname"><a href="blockencodings_8h.html">blockencodings.h</a></div></div>
<div class="ttc" id="class_c_spork_manager_html_a9cec53a1eb6335507d5c88a17f293e7f"><div class="ttname"><a href="class_c_spork_manager.html#a9cec53a1eb6335507d5c88a17f293e7f">CSporkManager::GetSporkByHash</a></div><div class="ttdeci">bool GetSporkByHash(const uint256 &amp;hash, CSporkMessage &amp;sporkRet)</div><div class="ttdoc">GetSporkByHash returns a spork message given a hash of the spork message. </div><div class="ttdef"><b>Definition:</b> <a href="spork_8cpp_source.html#l00322">spork.cpp:322</a></div></div>
<div class="ttc" id="class_c_node_html_ad47e8171d8a114592e90d7d83ee62875"><div class="ttname"><a href="class_c_node.html#ad47e8171d8a114592e90d7d83ee62875">CNode::vBlockHashesToAnnounce</a></div><div class="ttdeci">std::vector&lt; uint256 &gt; vBlockHashesToAnnounce</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00780">net.h:780</a></div></div>
<div class="ttc" id="util_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="validation_8h_html_aad50a92403104f85b18da00f816ce475"><div class="ttname"><a href="validation_8h.html#aad50a92403104f85b18da00f816ce475">INVENTORY_BROADCAST_INTERVAL</a></div><div class="ttdeci">static const unsigned int INVENTORY_BROADCAST_INTERVAL</div><div class="ttdoc">Average delay between trickled inventory transmissions in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00117">validation.h:117</a></div></div>
<div class="ttc" id="class_c_instant_send_html_ae5ca0556a65952de6214de498d5f4b4a"><div class="ttname"><a href="class_c_instant_send.html#ae5ca0556a65952de6214de498d5f4b4a">CInstantSend::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00056">instantx.cpp:56</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a1a6d457786a36cd01e8688d356883a47"><div class="ttname"><a href="namespace_net_msg_type.html#a1a6d457786a36cd01e8688d356883a47">NetMsgType::GETMNLISTDIFF</a></div><div class="ttdeci">const char * GETMNLISTDIFF</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00072">protocol.cpp:72</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a77d83bbf95702906ee01ca4fd934e1c0"><div class="ttname"><a href="namespace_net_msg_type.html#a77d83bbf95702906ee01ca4fd934e1c0">NetMsgType::ADDR</a></div><div class="ttdeci">const char * ADDR</div><div class="ttdoc">The addr (IP address) message relays connection information for peers on the network. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00018">protocol.cpp:18</a></div></div>
<div class="ttc" id="alert_8cpp_html_a1d336334e6e9fb3e9e0ed1e0ea5688e9"><div class="ttname"><a href="alert_8cpp.html#a1d336334e6e9fb3e9e0ed1e0ea5688e9">cs_mapAlerts</a></div><div class="ttdeci">CCriticalSection cs_mapAlerts</div><div class="ttdef"><b>Definition:</b> <a href="alert_8cpp_source.html#l00027">alert.cpp:27</a></div></div>
<div class="ttc" id="deterministicmns_8h_html"><div class="ttname"><a href="deterministicmns_8h.html">deterministicmns.h</a></div></div>
<div class="ttc" id="class_c_masternode_payments_html_a80ea7c9dc244776e5bc55fac7486594c"><div class="ttname"><a href="class_c_masternode_payments.html#a80ea7c9dc244776e5bc55fac7486594c">CMasternodePayments::HasVerifiedPaymentVote</a></div><div class="ttdeci">bool HasVerifiedPaymentVote(const uint256 &amp;hashIn) const</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8cpp_source.html#l00698">masternode-payments.cpp:698</a></div></div>
<div class="ttc" id="class_c_chain_params_html_a42f81df0a4f3494e3fc83ab53049fdd9"><div class="ttname"><a href="class_c_chain_params.html#a42f81df0a4f3494e3fc83ab53049fdd9">CChainParams::MessageStart</a></div><div class="ttdeci">const CMessageHeader::MessageStartChars &amp; MessageStart() const</div><div class="ttdef"><b>Definition:</b> <a href="chainparams_8h_source.html#l00060">chainparams.h:60</a></div></div>
<div class="ttc" id="net_8h_html_aa637b11e18b77724b35db2229cd12788"><div class="ttname"><a href="net_8h.html#aa637b11e18b77724b35db2229cd12788">NodeId</a></div><div class="ttdeci">int64_t NodeId</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00099">net.h:99</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a147efbcf1410c50c56547340f1fe1ebd"><div class="ttname"><a href="net__processing_8cpp.html#a147efbcf1410c50c56547340f1fe1ebd">nTimeBestReceived</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nTimeBestReceived(0)</div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a8b7a13b5289ab839d4460f41a7da9789"><div class="ttname"><a href="class_c_tx_mem_pool.html#a8b7a13b5289ab839d4460f41a7da9789">CTxMemPool::exists</a></div><div class="ttdeci">bool exists(uint256 hash) const</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8h_source.html#l00686">txmempool.h:686</a></div></div>
<div class="ttc" id="class_c_connman_html"><div class="ttname"><a href="class_c_connman.html">CConnman</a></div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00127">net.h:127</a></div></div>
<div class="ttc" id="struct_consensus_1_1_params_html_af9b4833ffbbc84640a6264b738202bbd"><div class="ttname"><a href="struct_consensus_1_1_params.html#af9b4833ffbbc84640a6264b738202bbd">Consensus::Params::fLLMQAllowDummyCommitments</a></div><div class="ttdeci">bool fLLMQAllowDummyCommitments</div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00160">params.h:160</a></div></div>
<div class="ttc" id="class_c_connman_html_a47d9024273a8c421fa7de641c30e9081"><div class="ttname"><a href="class_c_connman.html#a47d9024273a8c421fa7de641c30e9081">CConnman::AddNewAddresses</a></div><div class="ttdeci">void AddNewAddresses(const std::vector&lt; CAddress &gt; &amp;vAddr, const CAddress &amp;addrFrom, int64_t nTimePenalty=0)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02530">net.cpp:2530</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_a806fa20043b60e1ea5773cd8fb908f0c"><div class="ttname"><a href="class_peer_logic_validation.html#a806fa20043b60e1ea5773cd8fb908f0c">PeerLogicValidation::PeerLogicValidation</a></div><div class="ttdeci">PeerLogicValidation(CConnman *connmanIn)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00748">net_processing.cpp:748</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ab6b29c6674d192d8d881ccf2c0b5e545"><div class="ttname"><a href="net__processing_8cpp.html#ab6b29c6674d192d8d881ccf2c0b5e545">ProcessMessages</a></div><div class="ttdeci">bool ProcessMessages(CNode *pfrom, CConnman &amp;connman, const std::atomic&lt; bool &gt; &amp;interruptMsgProc)</div><div class="ttdoc">Process protocol messages received from a given node. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03026">net_processing.cpp:3026</a></div></div>
<div class="ttc" id="validation_8cpp_html_adb31995c443ae2aef1d2f1c350de0419"><div class="ttname"><a href="validation_8cpp.html#adb31995c443ae2aef1d2f1c350de0419">chainActive</a></div><div class="ttdeci">CChain chainActive</div><div class="ttdoc">The currently-connected chain of blocks (protected by cs_main). </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00072">validation.cpp:72</a></div></div>
<div class="ttc" id="class_c_sip_hasher_html_a9de97ad61ec6ce18ddc94abe1d5fcdf0"><div class="ttname"><a href="class_c_sip_hasher.html#a9de97ad61ec6ce18ddc94abe1d5fcdf0">CSipHasher::Finalize</a></div><div class="ttdeci">uint64_t Finalize() const</div><div class="ttdoc">Compute the 64-bit SipHash-2-4 of the data written so far. </div><div class="ttdef"><b>Definition:</b> <a href="hash_8cpp_source.html#l00154">hash.cpp:154</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a1ef3ccc1966cb35a59882fb97c15a30e"><div class="ttname"><a href="namespace_net_msg_type.html#a1ef3ccc1966cb35a59882fb97c15a30e">NetMsgType::FILTERCLEAR</a></div><div class="ttdeci">const char * FILTERCLEAR</div><div class="ttdoc">The filterclear message tells the receiving peer to remove a previously-set bloom filter...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00035">protocol.cpp:35</a></div></div>
<div class="ttc" id="class_c_node_html_a3da9c559959e182aff8439cd004ff624"><div class="ttname"><a href="class_c_node.html#a3da9c559959e182aff8439cd004ff624">CNode::fGetAddr</a></div><div class="ttdeci">bool fGetAddr</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00758">net.h:758</a></div></div>
<div class="ttc" id="validation_8h_html_a4757562fa889f0f4f7e88e096d724adb"><div class="ttname"><a href="validation_8h.html#a4757562fa889f0f4f7e88e096d724adb">fImporting</a></div><div class="ttdeci">std::atomic_bool fImporting</div></div>
<div class="ttc" id="classbase__blob_html_a7a0d25782830d8b087c4da839f3ccdeb"><div class="ttname"><a href="classbase__blob.html#a7a0d25782830d8b087c4da839f3ccdeb">base_blob::ToString</a></div><div class="ttdeci">std::string ToString() const</div><div class="ttdef"><b>Definition:</b> <a href="uint256_8cpp_source.html#l00065">uint256.cpp:65</a></div></div>
<div class="ttc" id="class_partially_downloaded_block_html"><div class="ttname"><a href="class_partially_downloaded_block.html">PartiallyDownloadedBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00194">blockencodings.h:194</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_a6ec5f16eef458f094696ad59dc8e6f05"><div class="ttname"><a href="class_c_governance_manager.html#a6ec5f16eef458f094696ad59dc8e6f05">CGovernanceManager::SerializeObjectForHash</a></div><div class="ttdeci">bool SerializeObjectForHash(const uint256 &amp;nHash, CDataStream &amp;ss) const</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00053">governance.cpp:53</a></div></div>
<div class="ttc" id="class_c_node_html_a157903f7830c0dfbf6a93852066f0b8f"><div class="ttname"><a href="class_c_node.html#a157903f7830c0dfbf6a93852066f0b8f">CNode::GetId</a></div><div class="ttdeci">NodeId GetId() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00824">net.h:824</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a567653d3f26a7e711889682e7fd1c484"><div class="ttname"><a href="namespace_net_msg_type.html#a567653d3f26a7e711889682e7fd1c484">NetMsgType::NOTFOUND</a></div><div class="ttdeci">const char * NOTFOUND</div><div class="ttdoc">The notfound message is a reply to a getdata message which requested an object the receiving node doe...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00032">protocol.cpp:32</a></div></div>
<div class="ttc" id="class_c_connman_html_a70b9c66fa48a69fed984062c5cfda281"><div class="ttname"><a href="class_c_connman.html#a70b9c66fa48a69fed984062c5cfda281">CConnman::GetDeterministicRandomizer</a></div><div class="ttdeci">CSipHasher GetDeterministicRandomizer(uint64_t id) const</div><div class="ttdoc">Get a unique deterministic randomizer. </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l03058">net.cpp:3058</a></div></div>
<div class="ttc" id="class_c_base_chain_params_html_a86abcc91bfa683e47bb113e32ff86dec"><div class="ttname"><a href="class_c_base_chain_params.html#a86abcc91bfa683e47bb113e32ff86dec">CBaseChainParams::DEVNET</a></div><div class="ttdeci">static const std::string DEVNET</div><div class="ttdef"><b>Definition:</b> <a href="chainparamsbase_8h_source.html#l00021">chainparamsbase.h:21</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_a5a7e2f9bcf237d99a005dc72d4a6bfac"><div class="ttname"><a href="class_c_governance_manager.html#a5a7e2f9bcf237d99a005dc72d4a6bfac">CGovernanceManager::ConfirmInventoryRequest</a></div><div class="ttdeci">bool ConfirmInventoryRequest(const CInv &amp;inv)</div><div class="ttdoc">This is called by AlreadyHave in net_processing.cpp as part of the inventory retrieval process...</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00598">governance.cpp:598</a></div></div>
<div class="ttc" id="struct_consensus_1_1_params_html"><div class="ttname"><a href="struct_consensus_1_1_params.html">Consensus::Params</a></div><div class="ttdoc">Parameters that influence chain consensus. </div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00105">params.h:105</a></div></div>
<div class="ttc" id="class_c_net_processing_cleanup_html"><div class="ttname"><a href="class_c_net_processing_cleanup.html">CNetProcessingCleanup</a></div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03673">net_processing.cpp:3673</a></div></div>
<div class="ttc" id="class_c_private_send_html_a34bb28453d0906baa0e63001c502cc30"><div class="ttname"><a href="class_c_private_send.html#a34bb28453d0906baa0e63001c502cc30">CPrivateSend::AddDSTX</a></div><div class="ttdeci">static void AddDSTX(const CPrivateSendBroadcastTx &amp;dstx)</div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8cpp_source.html#l00546">privatesend.cpp:546</a></div></div>
<div class="ttc" id="class_c_out_point_html"><div class="ttname"><a href="class_c_out_point.html">COutPoint</a></div><div class="ttdoc">An outpoint - a combination of a transaction hash and an index n into its vout. </div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00026">transaction.h:26</a></div></div>
<div class="ttc" id="class_c_private_send_server_html_a66c38d7af845bab8e22c37e2165fd5f9"><div class="ttname"><a href="class_c_private_send_server.html#a66c38d7af845bab8e22c37e2165fd5f9">CPrivateSendServer::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="privatesend-server_8cpp_source.html#l00021">privatesend-server.cpp:21</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a1842ab3e065d8bc5180974b9e3f44377"><div class="ttname"><a href="namespace_net_msg_type.html#a1842ab3e065d8bc5180974b9e3f44377">NetMsgType::BLOCK</a></div><div class="ttdeci">const char * BLOCK</div><div class="ttdoc">The block message transmits a single serialized block. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00026">protocol.cpp:26</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a0ae6b5e21db3e4a14210b416eec2b415"><div class="ttname"><a href="namespace_net_msg_type.html#a0ae6b5e21db3e4a14210b416eec2b415">NetMsgType::QDCOMMITMENT</a></div><div class="ttdeci">const char * QDCOMMITMENT</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00075">protocol.cpp:75</a></div></div>
<div class="ttc" id="class_c_node_html_adebd9bb3224ed2c5ab63fdfd9c6e9074"><div class="ttname"><a href="class_c_node.html#adebd9bb3224ed2c5ab63fdfd9c6e9074">CNode::fDisconnect</a></div><div class="ttdeci">std::atomic_bool fDisconnect</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00726">net.h:726</a></div></div>
<div class="ttc" id="net_8cpp_html_a6c58f8ccc4c93105a44caf588562d609"><div class="ttname"><a href="net_8cpp.html#a6c58f8ccc4c93105a44caf588562d609">strSubVersion</a></div><div class="ttdeci">std::string strSubVersion</div><div class="ttdoc">Subversion as sent to the P2P network in version messages. </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00085">net.cpp:85</a></div></div>
<div class="ttc" id="consensus_2validation_8h_html_aae810f65f020df86be128d0c026edf44"><div class="ttname"><a href="consensus_2validation_8h.html#aae810f65f020df86be128d0c026edf44">REJECT_DUPLICATE</a></div><div class="ttdeci">static const unsigned char REJECT_DUPLICATE</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00015">validation.h:15</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_a343f7c30c005af247a0cabbd1d665610"><div class="ttname"><a href="class_c_masternode_man.html#a343f7c30c005af247a0cabbd1d665610">CMasternodeMan::Get</a></div><div class="ttdeci">bool Get(const COutPoint &amp;outpoint, CMasternode &amp;masternodeRet)</div><div class="ttdoc">Versions of Find that are safe to use from outside the class. </div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8cpp_source.html#l00564">masternodeman.cpp:564</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991abacdb1618207a44c1301ae59acf7f5d8"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991abacdb1618207a44c1301ae59acf7f5d8">MSG_SPORK</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00360">protocol.h:360</a></div></div>
<div class="ttc" id="structmasternode__info__t_html_a3f9244ed4560953722ed200c5d49c912"><div class="ttname"><a href="structmasternode__info__t.html#a3f9244ed4560953722ed200c5d49c912">masternode_info_t::blsPubKeyOperator</a></div><div class="ttdeci">CBLSPublicKey blsPubKeyOperator</div><div class="ttdef"><b>Definition:</b> <a href="masternode_8h_source.html#l00136">masternode.h:136</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a4e3b2fea2a6151c76684b3812df4a5c3"><div class="ttname"><a href="class_c_net_addr.html#a4e3b2fea2a6151c76684b3812df4a5c3">CNetAddr::IsRoutable</a></div><div class="ttdeci">bool IsRoutable() const</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00227">netaddress.cpp:227</a></div></div>
<div class="ttc" id="validation_8cpp_html_af66174e55ad9bafa7a92e4740db6b575"><div class="ttname"><a href="validation_8cpp.html#af66174e55ad9bafa7a92e4740db6b575">nMaxTipAge</a></div><div class="ttdeci">int64_t nMaxTipAge</div><div class="ttdoc">If the tip is older than this (in seconds), the node is considered to be in initial block download...</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00093">validation.cpp:93</a></div></div>
<div class="ttc" id="net__processing_8h_html_a09ba6681dd87e0136d25acc054a335a0"><div class="ttname"><a href="net__processing_8h.html#a09ba6681dd87e0136d25acc054a335a0">HEADERS_DOWNLOAD_TIMEOUT_BASE</a></div><div class="ttdeci">static constexpr int64_t HEADERS_DOWNLOAD_TIMEOUT_BASE</div><div class="ttdoc">Headers download timeout expressed in microseconds Timeout = base + per_header * (expected number of ...</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00021">net_processing.h:21</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a8fae7d32e83e9fbb9ce0216f896133c9"><div class="ttname"><a href="class_c_net_addr.html#a8fae7d32e83e9fbb9ce0216f896133c9">CNetAddr::GetHash</a></div><div class="ttdeci">uint64_t GetHash() const</div><div class="ttdef"><b>Definition:</b> <a href="netaddress_8cpp_source.html#l00378">netaddress.cpp:378</a></div></div>
<div class="ttc" id="netbase_8h_html"><div class="ttname"><a href="netbase_8h.html">netbase.h</a></div></div>
<div class="ttc" id="class_c_node_html_a3f3a08b1a2c85b1c6cf975b2bdb53171"><div class="ttname"><a href="class_c_node.html#a3f3a08b1a2c85b1c6cf975b2bdb53171">CNode::addrKnown</a></div><div class="ttdeci">CRollingBloomFilter addrKnown</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00757">net.h:757</a></div></div>
<div class="ttc" id="validation_8cpp_html_a32c4ae3ae181d8510133629460c2bf20"><div class="ttname"><a href="validation_8cpp.html#a32c4ae3ae181d8510133629460c2bf20">versionbitscache</a></div><div class="ttdeci">VersionBitsCache versionbitscache</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l01822">validation.cpp:1822</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a4b07f9302d2d304c1e151bc611d3cd6c"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a4b07f9302d2d304c1e151bc611d3cd6c">MSG_MASTERNODE_PAYMENT_VOTE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00361">protocol.h:361</a></div></div>
<div class="ttc" id="class_c_connman_html_a30095fabc2e1727514ad2f2d530a496d"><div class="ttname"><a href="class_c_connman.html#a30095fabc2e1727514ad2f2d530a496d">CConnman::GetReceiveFloodSize</a></div><div class="ttdeci">unsigned int GetReceiveFloodSize() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02812">net.cpp:2812</a></div></div>
<div class="ttc" id="blockencodings_8h_html_a2454e2824c9d3db86bf62fbc974f50ceaee0cfe0767680ec8c16bb91d3c1d9b22"><div class="ttname"><a href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50ceaee0cfe0767680ec8c16bb91d3c1d9b22">READ_STATUS_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00126">blockencodings.h:126</a></div></div>
<div class="ttc" id="class_c_governance_manager_html_a44147b0a9cf22ed16d3411fe119958e0"><div class="ttname"><a href="class_c_governance_manager.html#a44147b0a9cf22ed16d3411fe119958e0">CGovernanceManager::SerializeVoteForHash</a></div><div class="ttdeci">bool SerializeVoteForHash(const uint256 &amp;nHash, CDataStream &amp;ss) const</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00080">governance.cpp:80</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_af659195932e1bac2ed2bdd1cda6d2e2b"><div class="ttname"><a href="namespace_net_msg_type.html#af659195932e1bac2ed2bdd1cda6d2e2b">NetMsgType::REJECT</a></div><div class="ttdeci">const char * REJECT</div><div class="ttdoc">The reject message informs the receiving node that one of its previous messages has been rejected...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00036">protocol.cpp:36</a></div></div>
<div class="ttc" id="class_c_block_header_and_short_tx_i_ds_html"><div class="ttname"><a href="class_c_block_header_and_short_tx_i_ds.html">CBlockHeaderAndShortTxIDs</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00131">blockencodings.h:131</a></div></div>
<div class="ttc" id="validation_8cpp_html_acb44ac0586a5a755f889af3747f31f3b"><div class="ttname"><a href="validation_8cpp.html#acb44ac0586a5a755f889af3747f31f3b">AcceptToMemoryPool</a></div><div class="ttdeci">bool AcceptToMemoryPool(CTxMemPool &amp;pool, CValidationState &amp;state, const CTransactionRef &amp;tx, bool fLimitFree, bool *pfMissingInputs, bool fOverrideMempoolLimit, const CAmount nAbsurdFee, bool fDryRun)</div><div class="ttdoc">(try to) add transaction to memory pool </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00944">validation.cpp:944</a></div></div>
<div class="ttc" id="validation_8h_html_a42afcf61a20d8754d8285f6a1f958134"><div class="ttname"><a href="validation_8h.html#a42afcf61a20d8754d8285f6a1f958134">MAX_UNCONNECTING_HEADERS</a></div><div class="ttdeci">static const int MAX_UNCONNECTING_HEADERS</div><div class="ttdoc">Maximum number of unconnecting headers announcements before DoS score. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00147">validation.h:147</a></div></div>
<div class="ttc" id="class_c_connman_html_ac95687bc3457cbc25a78abcc2a5cc7fc"><div class="ttname"><a href="class_c_connman.html#ac95687bc3457cbc25a78abcc2a5cc7fc">CConnman::CheckIncomingNonce</a></div><div class="ttdeci">bool CheckIncomingNonce(uint64_t nonce)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00338">net.cpp:338</a></div></div>
<div class="ttc" id="class_block_transactions_request_html"><div class="ttname"><a href="class_block_transactions_request.html">BlockTransactionsRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00029">blockencodings.h:29</a></div></div>
<div class="ttc" id="class_c_node_html_a44bf609f563467f4998510c0b2a51951"><div class="ttname"><a href="class_c_node.html#a44bf609f563467f4998510c0b2a51951">CNode::addr</a></div><div class="ttdeci">const CAddress addr</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00710">net.h:710</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_a0a0dbdc4874b7e92247b89c4b421a32d"><div class="ttname"><a href="class_c_masternode_man.html#a0a0dbdc4874b7e92247b89c4b421a32d">CMasternodeMan::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8cpp_source.html#l00989">masternodeman.cpp:989</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a7a51f1ef81fa21178b6e241937934fed"><div class="ttname"><a href="namespace_net_msg_type.html#a7a51f1ef81fa21178b6e241937934fed">NetMsgType::GETBLOCKS</a></div><div class="ttdeci">const char * GETBLOCKS</div><div class="ttdoc">The getblocks message requests an inv message that provides block header hashes starting from a parti...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00022">protocol.cpp:22</a></div></div>
<div class="ttc" id="versionbits_8h_html_ae7f620361ae33b80687a42adb26fd7a4a5910acba5d13493df2ee6c994c89b098"><div class="ttname"><a href="versionbits_8h.html#ae7f620361ae33b80687a42adb26fd7a4a5910acba5d13493df2ee6c994c89b098">THRESHOLD_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="versionbits_8h_source.html#l00024">versionbits.h:24</a></div></div>
<div class="ttc" id="spork_8cpp_html_af6873019c3095ea6b554795e4040395c"><div class="ttname"><a href="spork_8cpp.html#af6873019c3095ea6b554795e4040395c">sporkManager</a></div><div class="ttdeci">CSporkManager sporkManager</div><div class="ttdef"><b>Definition:</b> <a href="spork_8cpp_source.html#l00016">spork.cpp:16</a></div></div>
<div class="ttc" id="classllmq_1_1_c_quorum_block_processor_html_a37b9067401b0136f82fa78b80bfe1777"><div class="ttname"><a href="classllmq_1_1_c_quorum_block_processor.html#a37b9067401b0136f82fa78b80bfe1777">llmq::CQuorumBlockProcessor::HasMinableCommitment</a></div><div class="ttdeci">bool HasMinableCommitment(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="quorums__blockprocessor_8cpp_source.html#l00308">quorums_blockprocessor.cpp:308</a></div></div>
<div class="ttc" id="util_8h_html_a44920f41b96476395cffed459d0c8835"><div class="ttname"><a href="util_8h.html#a44920f41b96476395cffed459d0c8835">LogPrint</a></div><div class="ttdeci">#define LogPrint(category,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00110">util.h:110</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_aaf8228cc7b3374862bcb3d79f5ff38e6"><div class="ttname"><a href="namespace_net_msg_type.html#aaf8228cc7b3374862bcb3d79f5ff38e6">NetMsgType::VERACK</a></div><div class="ttdeci">const char * VERACK</div><div class="ttdoc">The verack message acknowledges a previously-received version message, informing the connecting node ...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00017">protocol.cpp:17</a></div></div>
<div class="ttc" id="class_c_block_header_html_af0239f86a13f622a826e9eea66b2d7f3"><div class="ttname"><a href="class_c_block_header.html#af0239f86a13f622a826e9eea66b2d7f3">CBlockHeader::GetHash</a></div><div class="ttdeci">uint256 GetHash() const</div><div class="ttdef"><b>Definition:</b> <a href="block_8cpp_source.html#l00014">block.cpp:14</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_a52f953e116c5b4196b12831354fd0a4d"><div class="ttname"><a href="class_c_masternode_man.html#a52f953e116c5b4196b12831354fd0a4d">CMasternodeMan::IsMnbRecoveryRequested</a></div><div class="ttdeci">bool IsMnbRecoveryRequested(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8h_source.html#l00214">masternodeman.h:214</a></div></div>
<div class="ttc" id="util_8cpp_html_a8e02420c2f7c53579ccb90acf301ae75"><div class="ttname"><a href="util_8cpp.html#a8e02420c2f7c53579ccb90acf301ae75">fLogIPs</a></div><div class="ttdeci">bool fLogIPs</div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00138">util.cpp:138</a></div></div>
<div class="ttc" id="class_c_masternode_sync_html_aa61c8de4587e4135e08cf860da991542"><div class="ttname"><a href="class_c_masternode_sync.html#aa61c8de4587e4135e08cf860da991542">CMasternodeSync::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv)</div><div class="ttdef"><b>Definition:</b> <a href="masternode-sync_8cpp_source.html#l00124">masternode-sync.cpp:124</a></div></div>
<div class="ttc" id="class_c_validation_state_html"><div class="ttname"><a href="class_c_validation_state.html">CValidationState</a></div><div class="ttdoc">Capture information about block/transaction validation. </div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00022">validation.h:22</a></div></div>
<div class="ttc" id="class_c_node_html_a2349010606131fe65879e5a44d9ab37e"><div class="ttname"><a href="class_c_node.html#a2349010606131fe65879e5a44d9ab37e">CNode::fPingQueued</a></div><div class="ttdeci">std::atomic&lt; bool &gt; fPingQueued</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00800">net.h:800</a></div></div>
<div class="ttc" id="class_c_masternode_payments_html_a6feb2c94183cd649ede84dc38d3ae442"><div class="ttname"><a href="class_c_masternode_payments.html#a6feb2c94183cd649ede84dc38d3ae442">CMasternodePayments::mapMasternodeBlocks</a></div><div class="ttdeci">std::map&lt; int, CMasternodeBlockPayees &gt; mapMasternodeBlocks</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8h_source.html#l00176">masternode-payments.h:176</a></div></div>
<div class="ttc" id="classuint256_html"><div class="ttname"><a href="classuint256.html">uint256</a></div><div class="ttdoc">256-bit opaque blob. </div><div class="ttdef"><b>Definition:</b> <a href="uint256_8h_source.html#l00124">uint256.h:124</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_acdaf36c846ff68fcdc94785d70237141"><div class="ttname"><a href="class_c_masternode_man.html#acdaf36c846ff68fcdc94785d70237141">CMasternodeMan::mapSeenMasternodePing</a></div><div class="ttdeci">std::map&lt; uint256, CMasternodePing &gt; mapSeenMasternodePing</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8h_source.html#l00094">masternodeman.h:94</a></div></div>
<div class="ttc" id="class_c_node_html_ac3054eb6ade84e8968f032ce3e700f6a"><div class="ttname"><a href="class_c_node.html#ac3054eb6ade84e8968f032ce3e700f6a">CNode::AddInventoryKnown</a></div><div class="ttdeci">void AddInventoryKnown(const CInv &amp;inv)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00892">net.h:892</a></div></div>
<div class="ttc" id="class_c_address_html_ac1c44aac968b11f90ce529b133ae4e9b"><div class="ttname"><a href="class_c_address.html#ac1c44aac968b11f90ce529b133ae4e9b">CAddress::nTime</a></div><div class="ttdeci">unsigned int nTime</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00343">protocol.h:343</a></div></div>
<div class="ttc" id="net_8cpp_html_af6de8e47b01a96206402ddef734114f2"><div class="ttname"><a href="net_8cpp.html#af6de8e47b01a96206402ddef734114f2">IsReachable</a></div><div class="ttdeci">bool IsReachable(enum Network net)</div><div class="ttdoc">check whether a given network is one we can probably connect to </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00286">net.cpp:286</a></div></div>
<div class="ttc" id="validation_8cpp_html_a2d079acb26b8ce9590c977bf923d9037"><div class="ttname"><a href="validation_8cpp.html#a2d079acb26b8ce9590c977bf923d9037">fAlerts</a></div><div class="ttdeci">bool fAlerts</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00092">validation.cpp:92</a></div></div>
<div class="ttc" id="struct_consensus_1_1_params_html_a85eafe7f37215d1b228b47d75e534cef"><div class="ttname"><a href="struct_consensus_1_1_params.html#a85eafe7f37215d1b228b47d75e534cef">Consensus::Params::nMinimumChainWork</a></div><div class="ttdeci">uint256 nMinimumChainWork</div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00151">params.h:151</a></div></div>
<div class="ttc" id="net_8cpp_html_a66c6216d339978932308c2d68edd5338"><div class="ttname"><a href="net_8cpp.html#a66c6216d339978932308c2d68edd5338">PoissonNextSend</a></div><div class="ttdeci">int64_t PoissonNextSend(int64_t nNow, int average_interval_seconds)</div><div class="ttdoc">Return a timestamp in the future (in microseconds) for exponentially distributed events. </div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l03026">net.cpp:3026</a></div></div>
<div class="ttc" id="class_c_address_html_a24e2309d92694a5a234751634bdf0458"><div class="ttname"><a href="class_c_address.html#a24e2309d92694a5a234751634bdf0458">CAddress::nServices</a></div><div class="ttdeci">ServiceFlags nServices</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00340">protocol.h:340</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_a4ed18bc626b7e64f822912cd1057e5cb"><div class="ttname"><a href="class_peer_logic_validation.html#a4ed18bc626b7e64f822912cd1057e5cb">PeerLogicValidation::NewPoWValidBlock</a></div><div class="ttdeci">virtual void NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr&lt; const CBlock &gt; &amp;pblock) override</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00786">net_processing.cpp:786</a></div></div>
<div class="ttc" id="threadsafety_8h_html_a0e2e86b0f11d9778240b0a0b263047b1"><div class="ttname"><a href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a></div><div class="ttdeci">#define EXCLUSIVE_LOCKS_REQUIRED(...)</div><div class="ttdef"><b>Definition:</b> <a href="threadsafety_8h_source.html#l00050">threadsafety.h:50</a></div></div>
<div class="ttc" id="class_c_block_html_a33fcab2e8b903f5be812c714cee42626"><div class="ttname"><a href="class_c_block.html#a33fcab2e8b903f5be812c714cee42626">CBlock::vtx</a></div><div class="ttdeci">std::vector&lt; CTransactionRef &gt; vtx</div><div class="ttdef"><b>Definition:</b> <a href="block_8h_source.html#l00076">block.h:76</a></div></div>
<div class="ttc" id="validation_8cpp_html_a86ed1d2d0837b905d74c2e4192b6c06a"><div class="ttname"><a href="validation_8cpp.html#a86ed1d2d0837b905d74c2e4192b6c06a">FormatStateMessage</a></div><div class="ttdeci">std::string FormatStateMessage(const CValidationState &amp;state)</div><div class="ttdoc">Convert CValidationState to a human-readable message for logging. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00618">validation.cpp:618</a></div></div>
<div class="ttc" id="class_c_connman_html_a076197390e42277fcb9affa34ad518c7"><div class="ttname"><a href="class_c_connman.html#a076197390e42277fcb9affa34ad518c7">CConnman::RemoveAskFor</a></div><div class="ttdeci">void RemoveAskFor(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02679">net.cpp:2679</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_aa3a81f44cff26dfccfc39a8ce01c1ae3"><div class="ttname"><a href="net__processing_8cpp.html#aa3a81f44cff26dfccfc39a8ce01c1ae3">GUARDED_BY</a></div><div class="ttdeci">std::map&lt; uint256, COrphanTx &gt; mapOrphanTransactions GUARDED_BY(cs_main)</div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991ab7e23cc7eff00496b50b04e9e98f1b85"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ab7e23cc7eff00496b50b04e9e98f1b85">MSG_DSTX</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00370">protocol.h:370</a></div></div>
<div class="ttc" id="class_compare_inv_mempool_order_html_ab81595ec0e2a66d6be86c893e309a975"><div class="ttname"><a href="class_compare_inv_mempool_order.html#ab81595ec0e2a66d6be86c893e309a975">CompareInvMempoolOrder::CompareInvMempoolOrder</a></div><div class="ttdeci">CompareInvMempoolOrder(CTxMemPool *_mempool)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03150">net_processing.cpp:3150</a></div></div>
<div class="ttc" id="class_c_tx_lock_vote_html"><div class="ttname"><a href="class_c_tx_lock_vote.html">CTxLockVote</a></div><div class="ttdoc">An InstantSend transaction lock vote. </div><div class="ttdef"><b>Definition:</b> <a href="instantx_8h_source.html#l00231">instantx.h:231</a></div></div>
<div class="ttc" id="instantx_8cpp_html_abc71256f703e47c9254093e32ed2994c"><div class="ttname"><a href="instantx_8cpp.html#abc71256f703e47c9254093e32ed2994c">mempool</a></div><div class="ttdeci">CTxMemPool mempool</div></div>
<div class="ttc" id="namespace_net_msg_type_html_a5b20d74bd9d268e7d73be293bfe68b8a"><div class="ttname"><a href="namespace_net_msg_type.html#a5b20d74bd9d268e7d73be293bfe68b8a">NetMsgType::CMPCTBLOCK</a></div><div class="ttdeci">const char * CMPCTBLOCK</div><div class="ttdoc">Contains a CBlockHeaderAndShortTxIDs object - providing a header and list of &quot;short txids&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00039">protocol.cpp:39</a></div></div>
<div class="ttc" id="class_c_node_html_a0496683f25f18d2a12c42083e2ba1d7f"><div class="ttname"><a href="class_c_node.html#a0496683f25f18d2a12c42083e2ba1d7f">CNode::fAddnode</a></div><div class="ttdeci">bool fAddnode</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00722">net.h:722</a></div></div>
<div class="ttc" id="addrman_8h_html"><div class="ttname"><a href="addrman_8h.html">addrman.h</a></div></div>
<div class="ttc" id="class_c_node_html_a25c9b62c42159cc94c6e8ede9ad0ed9d"><div class="ttname"><a href="class_c_node.html#a25c9b62c42159cc94c6e8ede9ad0ed9d">CNode::fFeeler</a></div><div class="ttdeci">bool fFeeler</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00720">net.h:720</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html"><div class="ttname"><a href="class_c_tx_mem_pool.html">CTxMemPool</a></div><div class="ttdoc">CTxMemPool stores valid-according-to-the-current-best-chain transactions that may be included in the ...</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8h_source.html#l00451">txmempool.h:451</a></div></div>
<div class="ttc" id="class_c_node_html_a973d29d89889cba8fe7909b1b8959592"><div class="ttname"><a href="class_c_node.html#a973d29d89889cba8fe7909b1b8959592">CNode::nLastTXTime</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nLastTXTime</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00786">net.h:786</a></div></div>
<div class="ttc" id="alert_8cpp_html_a1ee205b1ff06953bc1e60c9f98752999"><div class="ttname"><a href="alert_8cpp.html#a1ee205b1ff06953bc1e60c9f98752999">mapAlerts</a></div><div class="ttdeci">std::map&lt; uint256, CAlert &gt; mapAlerts</div><div class="ttdef"><b>Definition:</b> <a href="alert_8cpp_source.html#l00026">alert.cpp:26</a></div></div>
<div class="ttc" id="class_c_private_send_broadcast_tx_html"><div class="ttname"><a href="class_c_private_send_broadcast_tx.html">CPrivateSendBroadcastTx</a></div><div class="ttdoc">Helper class to store mixing transaction (tx) information. </div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8h_source.html#l00249">privatesend.h:249</a></div></div>
<div class="ttc" id="class_c_node_html_addb44bcf6a96b3e18ef617b77caf6654"><div class="ttname"><a href="class_c_node.html#addb44bcf6a96b3e18ef617b77caf6654">CNode::fInbound</a></div><div class="ttdeci">const bool fInbound</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00724">net.h:724</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a8544d756fb965d312077e9feccb0f4a4"><div class="ttname"><a href="class_c_tx_mem_pool.html#a8544d756fb965d312077e9feccb0f4a4">CTxMemPool::CompareDepthAndScore</a></div><div class="ttdeci">bool CompareDepthAndScore(const uint256 &amp;hasha, const uint256 &amp;hashb)</div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01159">txmempool.cpp:1159</a></div></div>
<div class="ttc" id="privatesend-client_8cpp_html_ad3fbbb845524ff48bd48ca41ea5e51a8"><div class="ttname"><a href="privatesend-client_8cpp.html#ad3fbbb845524ff48bd48ca41ea5e51a8">privateSendClient</a></div><div class="ttdeci">CPrivateSendClientManager privateSendClient</div><div class="ttdef"><b>Definition:</b> <a href="privatesend-client_8cpp_source.html#l00022">privatesend-client.cpp:22</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_aea310a1f96ba98722807b9cfeb8fdfb9"><div class="ttname"><a href="net__processing_8cpp.html#aea310a1f96ba98722807b9cfeb8fdfb9">EraseOrphanTx</a></div><div class="ttdeci">static int EraseOrphanTx(uint256 hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00646">net_processing.cpp:646</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a79d16fca661ece8c17e786943721fd34"><div class="ttname"><a href="namespace_net_msg_type.html#a79d16fca661ece8c17e786943721fd34">NetMsgType::VERSION</a></div><div class="ttdeci">const char * VERSION</div><div class="ttdoc">The version message provides information about the transmitting node to the receiving node at the beg...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00016">protocol.cpp:16</a></div></div>
<div class="ttc" id="class_c_data_stream_html_a5542e71bd7af2ab7cd7be0f381d39cb5"><div class="ttname"><a href="class_c_data_stream.html#a5542e71bd7af2ab7cd7be0f381d39cb5">CDataStream::reserve</a></div><div class="ttdeci">void reserve(size_type n)</div><div class="ttdef"><b>Definition:</b> <a href="streams_8h_source.html#l00197">streams.h:197</a></div></div>
<div class="ttc" id="class_c_merkle_block_html_a73bbbdcb5d83588b15461c02d0228999"><div class="ttname"><a href="class_c_merkle_block.html#a73bbbdcb5d83588b15461c02d0228999">CMerkleBlock::vMatchedTxn</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; unsigned int, uint256 &gt; &gt; vMatchedTxn</div><div class="ttdoc">Public only for unit testing and relay testing (not relayed) </div><div class="ttdef"><b>Definition:</b> <a href="merkleblock_8h_source.html#l00134">merkleblock.h:134</a></div></div>
<div class="ttc" id="class_c_block_index_html"><div class="ttname"><a href="class_c_block_index.html">CBlockIndex</a></div><div class="ttdoc">The block chain is a tree shaped structure starting with the genesis block at the root...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00154">chain.h:154</a></div></div>
<div class="ttc" id="chainparams_8cpp_html_ace5c5b706d71a324a417dd2db394fd4a"><div class="ttname"><a href="chainparams_8cpp.html#ace5c5b706d71a324a417dd2db394fd4a">Params</a></div><div class="ttdeci">const CChainParams &amp; Params()</div><div class="ttdoc">Return the currently selected parameters. </div><div class="ttdef"><b>Definition:</b> <a href="chainparams_8cpp_source.html#l00774">chainparams.cpp:774</a></div></div>
<div class="ttc" id="class_c_tx_mem_pool_html_a1a0a00279c941051af1b74c5ebeac40d"><div class="ttname"><a href="class_c_tx_mem_pool.html#a1a0a00279c941051af1b74c5ebeac40d">CTxMemPool::PrioritiseTransaction</a></div><div class="ttdeci">void PrioritiseTransaction(const uint256 hash, const std::string strHash, double dPriorityDelta, const CAmount &amp;nFeeDelta)</div><div class="ttdoc">Affect CreateNewBlock prioritisation of transactions. </div><div class="ttdef"><b>Definition:</b> <a href="txmempool_8cpp_source.html#l01396">txmempool.cpp:1396</a></div></div>
<div class="ttc" id="class_c_node_html_a1a1c0d94de0197c5c4abf5a8d13364f3"><div class="ttname"><a href="class_c_node.html#a1a1c0d94de0197c5c4abf5a8d13364f3">CNode::hashContinue</a></div><div class="ttdeci">uint256 hashContinue</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00752">net.h:752</a></div></div>
<div class="ttc" id="class_c_node_html_ad3096c14b54aa39a02edb63a4a734c3e"><div class="ttname"><a href="class_c_node.html#ad3096c14b54aa39a02edb63a4a734c3e">CNode::fWhitelisted</a></div><div class="ttdeci">bool fWhitelisted</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00719">net.h:719</a></div></div>
<div class="ttc" id="version_8h_html_a7ef2601209957b98b7cc1a186f8e6e62"><div class="ttname"><a href="version_8h.html#a7ef2601209957b98b7cc1a186f8e6e62">MIN_PEER_PROTO_VERSION</a></div><div class="ttdeci">static const int MIN_PEER_PROTO_VERSION</div><div class="ttdoc">disconnect from peers older than this proto version </div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00023">version.h:23</a></div></div>
<div class="ttc" id="version_8h_html_a4e2497f7c9c4319adcaf945159ec63f4"><div class="ttname"><a href="version_8h.html#a4e2497f7c9c4319adcaf945159ec63f4">PROTOCOL_VERSION</a></div><div class="ttdeci">static const int PROTOCOL_VERSION</div><div class="ttdoc">network protocol versioning </div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00014">version.h:14</a></div></div>
<div class="ttc" id="class_c_node_html_abbaade0659a56ac50a68ba947eff40bc"><div class="ttname"><a href="class_c_node.html#abbaade0659a56ac50a68ba947eff40bc">CNode::id</a></div><div class="ttdeci">const NodeId id</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00740">net.h:740</a></div></div>
<div class="ttc" id="class_c_net_processing_cleanup_html_a110dfb98118bb2377fc7662fd05e4269"><div class="ttname"><a href="class_c_net_processing_cleanup.html#a110dfb98118bb2377fc7662fd05e4269">CNetProcessingCleanup::~CNetProcessingCleanup</a></div><div class="ttdeci">~CNetProcessingCleanup()</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03677">net_processing.cpp:3677</a></div></div>
<div class="ttc" id="class_partially_downloaded_block_html_ad8f41f80c9aba45402fc1033a478a97b"><div class="ttname"><a href="class_partially_downloaded_block.html#ad8f41f80c9aba45402fc1033a478a97b">PartiallyDownloadedBlock::IsTxAvailable</a></div><div class="ttdeci">bool IsTxAvailable(size_t index) const</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8cpp_source.html#l00172">blockencodings.cpp:172</a></div></div>
<div class="ttc" id="net__processing_8h_html_a9d3753f6b45e9bc12172e63922e704fd"><div class="ttname"><a href="net__processing_8h.html#a9d3753f6b45e9bc12172e63922e704fd">DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN</a></div><div class="ttdeci">static const unsigned int DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN</div><div class="ttdoc">Default number of orphan+recently-replaced txn to keep around for block reconstruction. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00025">net_processing.h:25</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991ae2eafa466f6492ab207617288629f23c"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae2eafa466f6492ab207617288629f23c">MSG_MASTERNODE_VERIFY</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00373">protocol.h:373</a></div></div>
<div class="ttc" id="validation_8cpp_html_af43d57aa8b46a53839777e8b670c9d66"><div class="ttname"><a href="validation_8cpp.html#af43d57aa8b46a53839777e8b670c9d66">FindForkInGlobalIndex</a></div><div class="ttdeci">CBlockIndex * FindForkInGlobalIndex(const CChain &amp;chain, const CBlockLocator &amp;locator)</div><div class="ttdoc">Find the last common block between the parameter chain and a locator. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00211">validation.cpp:211</a></div></div>
<div class="ttc" id="timedata_8cpp_html_a09f81b9c7650f898cf3cf305b87547e6"><div class="ttname"><a href="timedata_8cpp.html#a09f81b9c7650f898cf3cf305b87547e6">GetAdjustedTime</a></div><div class="ttdeci">int64_t GetAdjustedTime()</div><div class="ttdef"><b>Definition:</b> <a href="timedata_8cpp_source.html#l00036">timedata.cpp:36</a></div></div>
<div class="ttc" id="structmasternode__info__t_html_ad62e18817c92474ba10df6de3d042d8b"><div class="ttname"><a href="structmasternode__info__t.html#ad62e18817c92474ba10df6de3d042d8b">masternode_info_t::legacyKeyIDOperator</a></div><div class="ttdeci">CKeyID legacyKeyIDOperator</div><div class="ttdef"><b>Definition:</b> <a href="masternode_8h_source.html#l00135">masternode.h:135</a></div></div>
<div class="ttc" id="class_c_node_html_a81d6deb661c7386a453e0966d2dbc36f"><div class="ttname"><a href="class_c_node.html#a81d6deb661c7386a453e0966d2dbc36f">CNode::cs_vProcessMsg</a></div><div class="ttdeci">CCriticalSection cs_vProcessMsg</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00695">net.h:695</a></div></div>
<div class="ttc" id="class_c_node_html_a0a55cea2748b1837610b2caed8069a90"><div class="ttname"><a href="class_c_node.html#a0a55cea2748b1837610b2caed8069a90">CNode::SetSendVersion</a></div><div class="ttdeci">void SetSendVersion(int nVersionIn)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00748">net.cpp:748</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a26dd2ae8ab875cabe4f5cc6f4ed6e030"><div class="ttname"><a href="class_c_instant_send.html#a26dd2ae8ab875cabe4f5cc6f4ed6e030">CInstantSend::RejectLockRequest</a></div><div class="ttdeci">void RejectLockRequest(const CTxLockRequest &amp;txLockRequest)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00759">instantx.cpp:759</a></div></div>
<div class="ttc" id="validationinterface_8h_html"><div class="ttname"><a href="validationinterface_8h.html">validationinterface.h</a></div></div>
<div class="ttc" id="privatesend-server_8h_html"><div class="ttname"><a href="privatesend-server_8h.html">privatesend-server.h</a></div></div>
<div class="ttc" id="class_c_chain_html_a578545bde95163bee37b1be28e7b2755"><div class="ttname"><a href="class_c_chain.html#a578545bde95163bee37b1be28e7b2755">CChain::Tip</a></div><div class="ttdeci">CBlockIndex * Tip() const</div><div class="ttdoc">Returns the index entry for the tip of this chain, or NULL if none. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00434">chain.h:434</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_a124965d7310e0df08cc027d4e1cbbe7b"><div class="ttname"><a href="class_peer_logic_validation.html#a124965d7310e0df08cc027d4e1cbbe7b">PeerLogicValidation::BlockChecked</a></div><div class="ttdeci">virtual void BlockChecked(const CBlock &amp;block, const CValidationState &amp;state) override</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00856">net_processing.cpp:856</a></div></div>
<div class="ttc" id="class_c_connman_html_a36cf799d267785276497583398dfd4cd"><div class="ttname"><a href="class_c_connman.html#a36cf799d267785276497583398dfd4cd">CConnman::SetBestHeight</a></div><div class="ttdeci">void SetBestHeight(int height)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02802">net.cpp:2802</a></div></div>
<div class="ttc" id="serialize_8h_html_a78e63691a056ce2368984400605e4f6e"><div class="ttname"><a href="serialize_8h.html#a78e63691a056ce2368984400605e4f6e">LIMITED_STRING</a></div><div class="ttdeci">#define LIMITED_STRING(obj, n)</div><div class="ttdef"><b>Definition:</b> <a href="serialize_8h_source.html#l00364">serialize.h:364</a></div></div>
<div class="ttc" id="blockencodings_8h_html_a2454e2824c9d3db86bf62fbc974f50cea105d3aa9ec19f4c060b39c7fafba39ff"><div class="ttname"><a href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea105d3aa9ec19f4c060b39c7fafba39ff">READ_STATUS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00124">blockencodings.h:124</a></div></div>
<div class="ttc" id="version_8h_html_a04ad229ffd8c41a83118551a4d395205"><div class="ttname"><a href="version_8h.html#a04ad229ffd8c41a83118551a4d395205">CADDR_TIME_VERSION</a></div><div class="ttdeci">static const int CADDR_TIME_VERSION</div><div class="ttdoc">nTime field added to CAddress, starting with this version; if possible, avoid requesting addresses no...</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00030">version.h:30</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a13eac32e61d992756b94e714fa24e182"><div class="ttname"><a href="namespace_net_msg_type.html#a13eac32e61d992756b94e714fa24e182">NetMsgType::TXLOCKREQUEST</a></div><div class="ttdeci">const char * TXLOCKREQUEST</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00043">protocol.cpp:43</a></div></div>
<div class="ttc" id="class_c_node_html_a1ab8dcaa79a208ee8b9ce58587b206af"><div class="ttname"><a href="class_c_node.html#a1ab8dcaa79a208ee8b9ce58587b206af">CNode::nTimeOffset</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nTimeOffset</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00708">net.h:708</a></div></div>
<div class="ttc" id="validation_8h_html_ad4d4718d1ec747708a31bc47aaa66578"><div class="ttname"><a href="validation_8h.html#ad4d4718d1ec747708a31bc47aaa66578">MAX_BLOCKS_TO_ANNOUNCE</a></div><div class="ttdeci">static const unsigned int MAX_BLOCKS_TO_ANNOUNCE</div><div class="ttdoc">Maximum number of headers to announce when relaying blocks with headers message. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00144">validation.h:144</a></div></div>
<div class="ttc" id="class_c_private_send_broadcast_tx_html_a34eb23b64782cf8d2120c35deb4aba74"><div class="ttname"><a href="class_c_private_send_broadcast_tx.html#a34eb23b64782cf8d2120c35deb4aba74">CPrivateSendBroadcastTx::CheckSignature</a></div><div class="ttdeci">bool CheckSignature(const CKeyID &amp;keyIDOperator, const CBLSPublicKey &amp;blsPubKey) const</div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8cpp_source.html#l00187">privatesend.cpp:187</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_aa53772dc0dfe3dc5a6ac2c99444a2afe"><div class="ttname"><a href="namespace_net_msg_type.html#aa53772dc0dfe3dc5a6ac2c99444a2afe">NetMsgType::GETDATA</a></div><div class="ttdeci">const char * GETDATA</div><div class="ttdoc">The getdata message requests one or more data objects from another node. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00020">protocol.cpp:20</a></div></div>
<div class="ttc" id="net_8cpp_html_a5067f8b9215406011fa3461be92d819c"><div class="ttname"><a href="net_8cpp.html#a5067f8b9215406011fa3461be92d819c">fListen</a></div><div class="ttdeci">bool fListen</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00080">net.cpp:80</a></div></div>
<div class="ttc" id="classllmq_1_1_c_dummy_contribution_html"><div class="ttname"><a href="classllmq_1_1_c_dummy_contribution.html">llmq::CDummyContribution</a></div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8h_source.html#l00049">quorums_dummydkg.h:49</a></div></div>
<div class="ttc" id="class_block_transactions_request_html_ac5fd8cb4f31a492d58d6c95dd369852e"><div class="ttname"><a href="class_block_transactions_request.html#ac5fd8cb4f31a492d58d6c95dd369852e">BlockTransactionsRequest::blockhash</a></div><div class="ttdeci">uint256 blockhash</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00032">blockencodings.h:32</a></div></div>
<div class="ttc" id="class_c_node_html_a359647a8e7ad1fc72243b126b35729b6"><div class="ttname"><a href="class_c_node.html#a359647a8e7ad1fc72243b126b35729b6">CNode::fSuccessfullyConnected</a></div><div class="ttdeci">std::atomic_bool fSuccessfullyConnected</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00725">net.h:725</a></div></div>
<div class="ttc" id="class_c_sip_hasher_html"><div class="ttname"><a href="class_c_sip_hasher.html">CSipHasher</a></div><div class="ttdoc">SipHash-2-4. </div><div class="ttdef"><b>Definition:</b> <a href="hash_8h_source.html#l00280">hash.h:280</a></div></div>
<div class="ttc" id="class_c_net_msg_maker_html"><div class="ttname"><a href="class_c_net_msg_maker.html">CNetMsgMaker</a></div><div class="ttdef"><b>Definition:</b> <a href="netmessagemaker_8h_source.html#l00012">netmessagemaker.h:12</a></div></div>
<div class="ttc" id="class_c_inv_html_a3da7d96ce51443a1bfe8ce5342d0afbe"><div class="ttname"><a href="class_c_inv.html#a3da7d96ce51443a1bfe8ce5342d0afbe">CInv::IsKnownType</a></div><div class="ttdeci">bool IsKnownType() const</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00276">protocol.cpp:276</a></div></div>
<div class="ttc" id="validation_8h_html_a056ffe69f04e219f29370df9bfc8ee1b"><div class="ttname"><a href="validation_8h.html#a056ffe69f04e219f29370df9bfc8ee1b">INVENTORY_BROADCAST_MAX_PER_1MB_BLOCK</a></div><div class="ttdeci">static const unsigned int INVENTORY_BROADCAST_MAX_PER_1MB_BLOCK</div><div class="ttdoc">Maximum number of inventory items to send per transmission. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00121">validation.h:121</a></div></div>
<div class="ttc" id="random_8cpp_html_ada0c29949c4d1ac0cc027d93c4771423"><div class="ttname"><a href="random_8cpp.html#ada0c29949c4d1ac0cc027d93c4771423">GetRandBytes</a></div><div class="ttdeci">void GetRandBytes(unsigned char *buf, int num)</div><div class="ttdoc">Functions to gather random data via the OpenSSL PRNG. </div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00125">random.cpp:125</a></div></div>
<div class="ttc" id="tests_8c_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="tests_8c.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a></div><div class="ttdeci">static int count</div><div class="ttdef"><b>Definition:</b> <a href="tests_8c_source.html#l00041">tests.c:41</a></div></div>
<div class="ttc" id="class_block_transactions_html_a6d42a1840f22d90b000a579db5de490d"><div class="ttname"><a href="class_block_transactions.html#a6d42a1840f22d90b000a579db5de490d">BlockTransactions::blockhash</a></div><div class="ttdeci">uint256 blockhash</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00074">blockencodings.h:74</a></div></div>
<div class="ttc" id="net_8h_html_a2f02122aa15cdc5ac394b010f97422e9"><div class="ttname"><a href="net_8h.html#a2f02122aa15cdc5ac394b010f97422e9">MAX_SUBVERSION_LENGTH</a></div><div class="ttdeci">static const unsigned int MAX_SUBVERSION_LENGTH</div><div class="ttdoc">Maximum length of strSubVer in version message. </div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00062">net.h:62</a></div></div>
<div class="ttc" id="struct_c_node_signals_html_afeb0f429de9477d8e7c003d44050bf00"><div class="ttname"><a href="struct_c_node_signals.html#afeb0f429de9477d8e7c003d44050bf00">CNodeSignals::FinalizeNode</a></div><div class="ttdeci">boost::signals2::signal&lt; void(NodeId, bool &amp;)&gt; FinalizeNode</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00551">net.h:551</a></div></div>
<div class="ttc" id="struct_c_node_signals_html"><div class="ttname"><a href="struct_c_node_signals.html">CNodeSignals</a></div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00546">net.h:546</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a0138bc5c11da6ec5f5890a53ef15ca0c"><div class="ttname"><a href="namespace_net_msg_type.html#a0138bc5c11da6ec5f5890a53ef15ca0c">NetMsgType::DSTX</a></div><div class="ttdeci">const char * DSTX</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00064">protocol.cpp:64</a></div></div>
<div class="ttc" id="util_8h_html_a96c5fc7111f69f7dcaba992d95d13e03"><div class="ttname"><a href="util_8h.html#a96c5fc7111f69f7dcaba992d95d13e03">error</a></div><div class="ttdeci">bool error(const char *fmt, const Args &amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00121">util.h:121</a></div></div>
<div class="ttc" id="class_c_node_html_a0a2cdd01cb730536adf1780c3df66430"><div class="ttname"><a href="class_c_node.html#a0a2cdd01cb730536adf1780c3df66430">CNode::nVersion</a></div><div class="ttdeci">std::atomic&lt; int &gt; nVersion</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00712">net.h:712</a></div></div>
<div class="ttc" id="class_c_message_header_html_a02dcbb01fac09d6a8b223df5c38b9eb3add8582d526addef583c978e5261dfec1"><div class="ttname"><a href="class_c_message_header.html#a02dcbb01fac09d6a8b223df5c38b9eb3add8582d526addef583c978e5261dfec1">CMessageHeader::HEADER_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00038">protocol.h:38</a></div></div>
<div class="ttc" id="class_c_node_html_ab387bb0c4ffd42e3f0aea233dca0e301"><div class="ttname"><a href="class_c_node.html#ab387bb0c4ffd42e3f0aea233dca0e301">CNode::fRelayTxes</a></div><div class="ttdeci">bool fRelayTxes</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00731">net.h:731</a></div></div>
<div class="ttc" id="class_c_data_stream_html_a0483fe7bccf16aa88bf7272f18a0a7b0"><div class="ttname"><a href="class_c_data_stream.html#a0483fe7bccf16aa88bf7272f18a0a7b0">CDataStream::in_avail</a></div><div class="ttdeci">int in_avail()</div><div class="ttdef"><b>Definition:</b> <a href="streams_8h_source.html#l00292">streams.h:292</a></div></div>
<div class="ttc" id="class_c_validation_state_html_a01490c3326ac7d47a64976747060ac46"><div class="ttname"><a href="class_c_validation_state.html#a01490c3326ac7d47a64976747060ac46">CValidationState::GetRejectCode</a></div><div class="ttdeci">unsigned int GetRejectCode() const</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00080">validation.h:80</a></div></div>
<div class="ttc" id="chainparamsbase_8cpp_html_ac7acb12410650d8f8d037c850d98e764"><div class="ttname"><a href="chainparamsbase_8cpp.html#ac7acb12410650d8f8d037c850d98e764">GetDevNetName</a></div><div class="ttdeci">std::string GetDevNetName()</div><div class="ttdef"><b>Definition:</b> <a href="chainparamsbase_8cpp_source.html#l00140">chainparamsbase.cpp:140</a></div></div>
<div class="ttc" id="core__memusage_8h_html_a18e1e611662fcad8ad04ad0a85e84d08"><div class="ttname"><a href="core__memusage_8h.html#a18e1e611662fcad8ad04ad0a85e84d08">RecursiveDynamicUsage</a></div><div class="ttdeci">static size_t RecursiveDynamicUsage(const CScript &amp;script)</div><div class="ttdef"><b>Definition:</b> <a href="core__memusage_8h_source.html#l00012">core_memusage.h:12</a></div></div>
<div class="ttc" id="class_partially_downloaded_block_html_a04e1b3207e547c972e002c1ec472da1f"><div class="ttname"><a href="class_partially_downloaded_block.html#a04e1b3207e547c972e002c1ec472da1f">PartiallyDownloadedBlock::InitData</a></div><div class="ttdeci">ReadStatus InitData(const CBlockHeaderAndShortTxIDs &amp;cmpctblock, const std::vector&lt; std::pair&lt; uint256, CTransactionRef &gt;&gt; &amp;extra_txn)</div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8cpp_source.html#l00050">blockencodings.cpp:50</a></div></div>
<div class="ttc" id="class_c_bloom_filter_html_af98b43e91c82a1e4afc7454e8c5672c2"><div class="ttname"><a href="class_c_bloom_filter.html#af98b43e91c82a1e4afc7454e8c5672c2">CBloomFilter::UpdateEmptyFull</a></div><div class="ttdeci">void UpdateEmptyFull()</div><div class="ttdoc">Checks for empty and full filters to avoid wasting cpu. </div><div class="ttdef"><b>Definition:</b> <a href="bloom_8cpp_source.html#l00204">bloom.cpp:204</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a68df2f22acd8a7d824405c121f6f0708"><div class="ttname"><a href="namespace_net_msg_type.html#a68df2f22acd8a7d824405c121f6f0708">NetMsgType::QCONTRIB</a></div><div class="ttdeci">const char * QCONTRIB</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00076">protocol.cpp:76</a></div></div>
<div class="ttc" id="masternode-sync_8h_html"><div class="ttname"><a href="masternode-sync_8h.html">masternode-sync.h</a></div></div>
<div class="ttc" id="net_8h_html_a24ecbac59f1e63af4c4c8c112f00468d"><div class="ttname"><a href="net_8h.html#a24ecbac59f1e63af4c4c8c112f00468d">PING_INTERVAL</a></div><div class="ttdeci">static const int PING_INTERVAL</div><div class="ttdoc">Time between pings automatically sent out for latency probing and keepalive (in seconds). </div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00048">net.h:48</a></div></div>
<div class="ttc" id="struct_iterator_comparator_html"><div class="ttname"><a href="struct_iterator_comparator.html">IteratorComparator</a></div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00059">net_processing.cpp:59</a></div></div>
<div class="ttc" id="version_8h_html_a262584ad779f848883e0cc89ef2781f8"><div class="ttname"><a href="version_8h.html#a262584ad779f848883e0cc89ef2781f8">NO_BLOOM_VERSION</a></div><div class="ttdeci">static const int NO_BLOOM_VERSION</div><div class="ttdoc">&quot;filter*&quot; commands are disabled without NODE_BLOOM after and including this version ...</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00039">version.h:39</a></div></div>
<div class="ttc" id="ui__interface_8h_html"><div class="ttname"><a href="ui__interface_8h.html">ui_interface.h</a></div></div>
<div class="ttc" id="class_c_validation_state_html_add2b2dc505a8527fda32295b65bb636b"><div class="ttname"><a href="class_c_validation_state.html#add2b2dc505a8527fda32295b65bb636b">CValidationState::CorruptionPossible</a></div><div class="ttdeci">bool CorruptionPossible() const</div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00077">validation.h:77</a></div></div>
<div class="ttc" id="validation_8h_html_ae034ec95ea656e6d994828c1f5d7d596"><div class="ttname"><a href="validation_8h.html#ae034ec95ea656e6d994828c1f5d7d596">DEFAULT_BANSCORE_THRESHOLD</a></div><div class="ttdeci">static const unsigned int DEFAULT_BANSCORE_THRESHOLD</div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00141">validation.h:141</a></div></div>
<div class="ttc" id="util_8cpp_html_a24f685720bf40370e5bd2a192ad50cd8"><div class="ttname"><a href="util_8cpp.html#a24f685720bf40370e5bd2a192ad50cd8">GetArg</a></div><div class="ttdeci">std::string GetArg(const std::string &amp;strArg, const std::string &amp;strDefault)</div><div class="ttdoc">Return string argument or default value. </div><div class="ttdef"><b>Definition:</b> <a href="util_8cpp_source.html#l00458">util.cpp:458</a></div></div>
<div class="ttc" id="random_8h_html"><div class="ttname"><a href="random_8h.html">random.h</a></div></div>
<div class="ttc" id="validation_8h_html_a0a0634a396d3b8ca22455aa4158daf48"><div class="ttname"><a href="validation_8h.html#a0a0634a396d3b8ca22455aa4158daf48">BLOCK_STALLING_TIMEOUT</a></div><div class="ttdeci">static const unsigned int BLOCK_STALLING_TIMEOUT</div><div class="ttdoc">Timeout in seconds during which a peer must stall block download progress before being disconnected...</div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00090">validation.h:90</a></div></div>
<div class="ttc" id="validation_8h_html_acc576d09fdf7bf11e878a178f15d4a1a"><div class="ttname"><a href="validation_8h.html#acc576d09fdf7bf11e878a178f15d4a1a">MAX_CMPCTBLOCK_DEPTH</a></div><div class="ttdeci">static const int MAX_CMPCTBLOCK_DEPTH</div><div class="ttdoc">Maximum depth of blocks we&amp;#39;re willing to serve as compact blocks to peers when requested. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00096">validation.h:96</a></div></div>
<div class="ttc" id="utiltime_8cpp_html_a46fac5fba8ba905b5f9acb364f5d8c6f"><div class="ttname"><a href="utiltime_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a></div><div class="ttdeci">int64_t GetTime()</div><div class="ttdoc">GetTimeMicros() and GetTimeMillis() both return the system time, but in different units...</div><div class="ttdef"><b>Definition:</b> <a href="utiltime_8cpp_source.html#l00018">utiltime.cpp:18</a></div></div>
<div class="ttc" id="class_c_node_html_a2e28bf088e56fc9d30e99e9de6587743"><div class="ttname"><a href="class_c_node.html#a2e28bf088e56fc9d30e99e9de6587743">CNode::pfilter</a></div><div class="ttdeci">CBloomFilter * pfilter</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00738">net.h:738</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a1cb503e00969ffcc1b35a19bceb3d4d6"><div class="ttname"><a href="net__processing_8cpp.html#a1cb503e00969ffcc1b35a19bceb3d4d6">AddToCompactExtraTransactions</a></div><div class="ttdeci">void AddToCompactExtraTransactions(const CTransactionRef &amp;tx)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00602">net_processing.cpp:602</a></div></div>
<div class="ttc" id="struct_consensus_1_1_params_html_ad909dd557f5bf211649f95e0d6d3cbd0"><div class="ttname"><a href="struct_consensus_1_1_params.html#ad909dd557f5bf211649f95e0d6d3cbd0">Consensus::Params::hashDevnetGenesisBlock</a></div><div class="ttdeci">uint256 hashDevnetGenesisBlock</div><div class="ttdef"><b>Definition:</b> <a href="params_8h_source.html#l00107">params.h:107</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ab93722c7e784f3a5c110e82eb3c31078"><div class="ttname"><a href="namespace_net_msg_type.html#ab93722c7e784f3a5c110e82eb3c31078">NetMsgType::MNGOVERNANCEOBJECT</a></div><div class="ttdeci">const char * MNGOVERNANCEOBJECT</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00069">protocol.cpp:69</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a4dc585a49c4b1374d2bd49ae4d4569ca"><div class="ttname"><a href="namespace_net_msg_type.html#a4dc585a49c4b1374d2bd49ae4d4569ca">NetMsgType::MNGOVERNANCEOBJECTVOTE</a></div><div class="ttdeci">const char * MNGOVERNANCEOBJECTVOTE</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00070">protocol.cpp:70</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a75ab96e2e9fa2a1b1655f0034667604d"><div class="ttname"><a href="namespace_net_msg_type.html#a75ab96e2e9fa2a1b1655f0034667604d">NetMsgType::TX</a></div><div class="ttdeci">const char * TX</div><div class="ttdoc">The tx message transmits a single transaction. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00024">protocol.cpp:24</a></div></div>
<div class="ttc" id="class_c_transaction_html"><div class="ttname"><a href="class_c_transaction.html">CTransaction</a></div><div class="ttdoc">The basic transaction that is broadcasted on the network and contained in blocks. ...</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00219">transaction.h:219</a></div></div>
<div class="ttc" id="class_c_connman_html_a85dedb235a648a1b8370228ba62ebacb"><div class="ttname"><a href="class_c_connman.html#a85dedb235a648a1b8370228ba62ebacb">CConnman::MarkAddressGood</a></div><div class="ttdeci">void MarkAddressGood(const CAddress &amp;addr)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02520">net.cpp:2520</a></div></div>
<div class="ttc" id="class_c_block_index_html_aebfc8d6b95852546760e742553d7bfd5"><div class="ttname"><a href="class_c_block_index.html#aebfc8d6b95852546760e742553d7bfd5">CBlockIndex::nHeight</a></div><div class="ttdeci">int nHeight</div><div class="ttdoc">height of the entry in the chain. The genesis block has height 0 </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00167">chain.h:167</a></div></div>
<div class="ttc" id="governance_8cpp_html_a45f086f57868174ccf2cee5e7d968d8f"><div class="ttname"><a href="governance_8cpp.html#a45f086f57868174ccf2cee5e7d968d8f">governance</a></div><div class="ttdeci">CGovernanceManager governance</div><div class="ttdef"><b>Definition:</b> <a href="governance_8cpp_source.html#l00022">governance.cpp:22</a></div></div>
<div class="ttc" id="class_c_transaction_html_afcc5960eab9d35f10c6f8e6675bf2a93"><div class="ttname"><a href="class_c_transaction.html#afcc5960eab9d35f10c6f8e6675bf2a93">CTransaction::CURRENT_VERSION</a></div><div class="ttdeci">static const int32_t CURRENT_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00223">transaction.h:223</a></div></div>
<div class="ttc" id="class_c_node_html"><div class="ttname"><a href="class_c_node.html">CNode</a></div><div class="ttdoc">Information about a peer. </div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00679">net.h:679</a></div></div>
<div class="ttc" id="class_c_chain_params_html_aa366d4f63c8d16d625336dca61ca65e5"><div class="ttname"><a href="class_c_chain_params.html#aa366d4f63c8d16d625336dca61ca65e5">CChainParams::GetConsensus</a></div><div class="ttdeci">const Consensus::Params &amp; GetConsensus() const</div><div class="ttdef"><b>Definition:</b> <a href="chainparams_8h_source.html#l00059">chainparams.h:59</a></div></div>
<div class="ttc" id="struct_c_node_state_stats_html_a4b03fd8ecaa9268f7eca836e5e79c35a"><div class="ttname"><a href="struct_c_node_state_stats.html#a4b03fd8ecaa9268f7eca836e5e79c35a">CNodeStateStats::vHeightInFlight</a></div><div class="ttdeci">std::vector&lt; int &gt; vHeightInFlight</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00049">net_processing.h:49</a></div></div>
<div class="ttc" id="validation_8cpp_html_a578c1df234b05798180f0235d469a5ba"><div class="ttname"><a href="validation_8cpp.html#a578c1df234b05798180f0235d469a5ba">ReadBlockFromDisk</a></div><div class="ttdeci">bool ReadBlockFromDisk(CBlock &amp;block, const CDiskBlockPos &amp;pos, const Consensus::Params &amp;consensusParams)</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l01089">validation.cpp:1089</a></div></div>
<div class="ttc" id="class_c_node_html_a89226be680d821f4eef8fa391f4b4b6a"><div class="ttname"><a href="class_c_node.html#a89226be680d821f4eef8fa391f4b4b6a">CNode::nNextInvSend</a></div><div class="ttdeci">int64_t nNextInvSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00777">net.h:777</a></div></div>
<div class="ttc" id="class_c_block_index_html_ae1f702384690c6b8302e026a84172ef3"><div class="ttname"><a href="class_c_block_index.html#ae1f702384690c6b8302e026a84172ef3">CBlockIndex::GetAncestor</a></div><div class="ttdeci">CBlockIndex * GetAncestor(int height)</div><div class="ttdoc">Efficiently find an ancestor of this block. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8cpp_source.html#l00083">chain.cpp:83</a></div></div>
<div class="ttc" id="chain_8h_html_a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15"><div class="ttname"><a href="chain_8h.html#a0d8c285f70a59a32f4f6ab41b78f93ada77d49f747f3df764efac2d3f4522bb15">BLOCK_HAVE_DATA</a></div><div class="ttdoc">full block available in blk*.dat </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00140">chain.h:140</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991ae8208d8fb3855c56c3e5befaeb923fa2"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991ae8208d8fb3855c56c3e5befaeb923fa2">MSG_GOVERNANCE_OBJECT</a></div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00371">protocol.h:371</a></div></div>
<div class="ttc" id="validation_8cpp_html_a3076b81689bbb5e91a4fb30166fed703"><div class="ttname"><a href="validation_8cpp.html#a3076b81689bbb5e91a4fb30166fed703">ProcessNewBlockHeaders</a></div><div class="ttdeci">bool ProcessNewBlockHeaders(const std::vector&lt; CBlockHeader &gt; &amp;headers, CValidationState &amp;state, const CChainParams &amp;chainparams, const CBlockIndex **ppindex)</div><div class="ttdoc">Process incoming block headers. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l03487">validation.cpp:3487</a></div></div>
<div class="ttc" id="consensus_2validation_8h_html_ae08e367e8cda26747c749b3b313a47a1"><div class="ttname"><a href="consensus_2validation_8h.html#ae08e367e8cda26747c749b3b313a47a1">REJECT_MALFORMED</a></div><div class="ttdeci">static const unsigned char REJECT_MALFORMED</div><div class="ttdoc">&quot;reject&quot; message codes </div><div class="ttdef"><b>Definition:</b> <a href="consensus_2validation_8h_source.html#l00012">validation.h:12</a></div></div>
<div class="ttc" id="class_c_node_html_a4f5e98d3083fe8359d4c27d97eb0dcbb"><div class="ttname"><a href="class_c_node.html#a4f5e98d3083fe8359d4c27d97eb0dcbb">CNode::GetAddrName</a></div><div class="ttdeci">std::string GetAddrName() const</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00612">net.cpp:612</a></div></div>
<div class="ttc" id="timedata_8cpp_html_ac2624434f4891e8d74f9b13ec91f95d2"><div class="ttname"><a href="timedata_8cpp.html#ac2624434f4891e8d74f9b13ec91f95d2">AddTimeData</a></div><div class="ttdeci">void AddTimeData(const CNetAddr &amp;ip, int64_t nOffsetSample)</div><div class="ttdef"><b>Definition:</b> <a href="timedata_8cpp_source.html#l00048">timedata.cpp:48</a></div></div>
<div class="ttc" id="merkleblock_8h_html"><div class="ttname"><a href="merkleblock_8h.html">merkleblock.h</a></div></div>
<div class="ttc" id="class_c_node_html_aff4b68eeeee9bf1e27e14f2436a07556"><div class="ttname"><a href="class_c_node.html#aff4b68eeeee9bf1e27e14f2436a07556">CNode::nNextAddrSend</a></div><div class="ttdeci">int64_t nNextAddrSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00760">net.h:760</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_ae4af19c6d5d69539afe179b84a91cbad"><div class="ttname"><a href="namespace_net_msg_type.html#ae4af19c6d5d69539afe179b84a91cbad">NetMsgType::SPORK</a></div><div class="ttdeci">const char * SPORK</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00045">protocol.cpp:45</a></div></div>
<div class="ttc" id="class_c_net_msg_maker_html_ac314ab21062f354bbb885e65060b815f"><div class="ttname"><a href="class_c_net_msg_maker.html#ac314ab21062f354bbb885e65060b815f">CNetMsgMaker::Make</a></div><div class="ttdeci">CSerializedNetMsg Make(int nFlags, std::string sCommand, Args &amp;&amp;... args) const</div><div class="ttdef"><b>Definition:</b> <a href="netmessagemaker_8h_source.html#l00018">netmessagemaker.h:18</a></div></div>
<div class="ttc" id="class_c_connman_html_a5fdad96946aa2bc67961ad973bf65fa5"><div class="ttname"><a href="class_c_connman.html#a5fdad96946aa2bc67961ad973bf65fa5">CConnman::RelayTransaction</a></div><div class="ttdeci">void RelayTransaction(const CTransaction &amp;tx)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l02623">net.cpp:2623</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ad0cf88373f93a6b6e3936999e4212643"><div class="ttname"><a href="net__processing_8cpp.html#ad0cf88373f93a6b6e3936999e4212643">SendMessages</a></div><div class="ttdeci">bool SendMessages(CNode *pto, CConnman &amp;connman, const std::atomic&lt; bool &gt; &amp;interruptMsgProc)</div><div class="ttdoc">Send queued protocol messages to be sent to a give node. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l03163">net_processing.cpp:3163</a></div></div>
<div class="ttc" id="class_c_private_send_broadcast_tx_html_a81c64d79239c3881b8c9131337656ddd"><div class="ttname"><a href="class_c_private_send_broadcast_tx.html#a81c64d79239c3881b8c9131337656ddd">CPrivateSendBroadcastTx::tx</a></div><div class="ttdeci">CTransactionRef tx</div><div class="ttdef"><b>Definition:</b> <a href="privatesend_8h_source.html#l00257">privatesend.h:257</a></div></div>
<div class="ttc" id="class_peer_logic_validation_html_ab508aba46338b243f90ddbba6919bee5"><div class="ttname"><a href="class_peer_logic_validation.html#ab508aba46338b243f90ddbba6919bee5">PeerLogicValidation::connman</a></div><div class="ttdeci">CConnman * connman</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00034">net_processing.h:34</a></div></div>
<div class="ttc" id="classllmq_1_1_c_dummy_d_k_g_html_a3ea4c54cd0e779596732f54df59ba5bd"><div class="ttname"><a href="classllmq_1_1_c_dummy_d_k_g.html#a3ea4c54cd0e779596732f54df59ba5bd">llmq::CDummyDKG::HasDummyCommitment</a></div><div class="ttdeci">bool HasDummyCommitment(const uint256 &amp;hash)</div><div class="ttdef"><b>Definition:</b> <a href="quorums__dummydkg_8cpp_source.html#l00583">quorums_dummydkg.cpp:583</a></div></div>
<div class="ttc" id="class_c_node_html_a923c9640a28f97cf9c23a21ae8e13c97"><div class="ttname"><a href="class_c_node.html#a923c9640a28f97cf9c23a21ae8e13c97">CNode::AddAddressKnown</a></div><div class="ttdeci">void AddAddressKnown(const CAddress &amp;_addr)</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00872">net.h:872</a></div></div>
<div class="ttc" id="arith__uint256_8h_html"><div class="ttname"><a href="arith__uint256_8h.html">arith_uint256.h</a></div></div>
<div class="ttc" id="net__processing_8h_html_ab430d75598aeb37ec46ba29381371b50"><div class="ttname"><a href="net__processing_8h.html#ab430d75598aeb37ec46ba29381371b50">DEFAULT_MAX_ORPHAN_TRANSACTIONS</a></div><div class="ttdeci">static const unsigned int DEFAULT_MAX_ORPHAN_TRANSACTIONS</div><div class="ttdoc">Default for -maxorphantx, maximum number of orphan transactions kept in memory. </div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8h_source.html#l00013">net_processing.h:13</a></div></div>
<div class="ttc" id="utilstrencodings_8cpp_html_aa179dc54b52ee4d555344dd5472ccb6b"><div class="ttname"><a href="utilstrencodings_8cpp.html#aa179dc54b52ee4d555344dd5472ccb6b">SanitizeString</a></div><div class="ttdeci">std::string SanitizeString(const std::string &amp;str, int rule)</div><div class="ttdoc">Remove unsafe chars. </div><div class="ttdef"><b>Definition:</b> <a href="utilstrencodings_8cpp_source.html#l00023">utilstrencodings.cpp:23</a></div></div>
<div class="ttc" id="class_c_tx_in_html_aed9312051a25380cbd7f123408ab7c20"><div class="ttname"><a href="class_c_tx_in.html#aed9312051a25380cbd7f123408ab7c20">CTxIn::prevout</a></div><div class="ttdeci">COutPoint prevout</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00073">transaction.h:73</a></div></div>
<div class="ttc" id="class_c_node_html_a108e17226d76c85c89f7d057dad2b088"><div class="ttname"><a href="class_c_node.html#a108e17226d76c85c89f7d057dad2b088">CNode::fPauseRecv</a></div><div class="ttdeci">std::atomic_bool fPauseRecv</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00744">net.h:744</a></div></div>
<div class="ttc" id="versionbits_8cpp_html_a90d3b0a121694c9559dddcdd848757be"><div class="ttname"><a href="versionbits_8cpp.html#a90d3b0a121694c9559dddcdd848757be">VersionBitsState</a></div><div class="ttdeci">ThresholdState VersionBitsState(const CBlockIndex *pindexPrev, const Consensus::Params &amp;params, Consensus::DeploymentPos pos, VersionBitsCache &amp;cache)</div><div class="ttdef"><b>Definition:</b> <a href="versionbits_8cpp_source.html#l00193">versionbits.cpp:193</a></div></div>
<div class="ttc" id="blockencodings_8h_html_a2454e2824c9d3db86bf62fbc974f50cea2c4369130f1cab4f039ffe2bf247d812"><div class="ttname"><a href="blockencodings_8h.html#a2454e2824c9d3db86bf62fbc974f50cea2c4369130f1cab4f039ffe2bf247d812">READ_STATUS_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="blockencodings_8h_source.html#l00125">blockencodings.h:125</a></div></div>
<div class="ttc" id="validation_8h_html_a41af4f24e6f8ec02a4a6fd7e679acf3d"><div class="ttname"><a href="validation_8h.html#a41af4f24e6f8ec02a4a6fd7e679acf3d">DEFAULT_WHITELISTFORCERELAY</a></div><div class="ttdeci">static const bool DEFAULT_WHITELISTFORCERELAY</div><div class="ttdoc">Default for DEFAULT_WHITELISTFORCERELAY. </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00057">validation.h:57</a></div></div>
<div class="ttc" id="transaction_8h_html"><div class="ttname"><a href="transaction_8h.html">transaction.h</a></div></div>
<div class="ttc" id="net_8h_html_af677dfc85dddc429fe0303f338878ec0"><div class="ttname"><a href="net_8h.html#af677dfc85dddc429fe0303f338878ec0">MAX_INV_SZ</a></div><div class="ttdeci">static const unsigned int MAX_INV_SZ</div><div class="ttdoc">The maximum number of entries in an &amp;#39;inv&amp;#39; protocol message. </div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00056">net.h:56</a></div></div>
<div class="ttc" id="class_c_node_html_ad253434141efcbca34150864069aee7e"><div class="ttname"><a href="class_c_node.html#ad253434141efcbca34150864069aee7e">CNode::nLastBlockTime</a></div><div class="ttdeci">std::atomic&lt; int64_t &gt; nLastBlockTime</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00785">net.h:785</a></div></div>
<div class="ttc" id="utilstrencodings_8h_html_aa3052ab82a2ba880ea3e30b3357c8820"><div class="ttname"><a href="utilstrencodings_8h.html#aa3052ab82a2ba880ea3e30b3357c8820">PAIRTYPE</a></div><div class="ttdeci">#define PAIRTYPE(t1, t2)</div><div class="ttdoc">This is needed because the foreach macro can&amp;#39;t get over the comma in pair&lt;t1, t2&gt; ...</div><div class="ttdef"><b>Definition:</b> <a href="utilstrencodings_8h_source.html#l00023">utilstrencodings.h:23</a></div></div>
<div class="ttc" id="class_c_private_send_client_manager_html_a5ffa7ec563a356049bd99301b1d7e55f"><div class="ttname"><a href="class_c_private_send_client_manager.html#a5ffa7ec563a356049bd99301b1d7e55f">CPrivateSendClientManager::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="privatesend-client_8cpp_source.html#l00024">privatesend-client.cpp:24</a></div></div>
<div class="ttc" id="struct_c_main_signals_html_a2f8f94d91265dc946e97614042698a7b"><div class="ttname"><a href="struct_c_main_signals.html#a2f8f94d91265dc946e97614042698a7b">CMainSignals::Inventory</a></div><div class="ttdeci">boost::signals2::signal&lt; void(const uint256 &amp;)&gt; Inventory</div><div class="ttdoc">Notifies listeners about an inventory item being seen on the network. </div><div class="ttdef"><b>Definition:</b> <a href="validationinterface_8h_source.html#l00088">validationinterface.h:88</a></div></div>
<div class="ttc" id="class_c_node_html_a7593dfbd76c34a81169e3fb2aa0e0cf7"><div class="ttname"><a href="class_c_node.html#a7593dfbd76c34a81169e3fb2aa0e0cf7">CNode::mapAskFor</a></div><div class="ttdeci">std::multimap&lt; int64_t, CInv &gt; mapAskFor</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00776">net.h:776</a></div></div>
<div class="ttc" id="class_c_node_html_aca9fdf7c1fa23060ef2769cc4ec85423"><div class="ttname"><a href="class_c_node.html#aca9fdf7c1fa23060ef2769cc4ec85423">CNode::vInventoryOtherToSend</a></div><div class="ttdeci">std::vector&lt; CInv &gt; vInventoryOtherToSend</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00773">net.h:773</a></div></div>
<div class="ttc" id="class_c_masternode_man_html_a9021ef50962e58f495dbf125ff243952"><div class="ttname"><a href="class_c_masternode_man.html#a9021ef50962e58f495dbf125ff243952">CMasternodeMan::DisallowMixing</a></div><div class="ttdeci">bool DisallowMixing(const COutPoint &amp;outpoint)</div><div class="ttdef"><b>Definition:</b> <a href="masternodeman_8cpp_source.html#l00144">masternodeman.cpp:144</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a4b27db90b09bb5f7918229ef40985fdd"><div class="ttname"><a href="class_c_instant_send.html#a4b27db90b09bb5f7918229ef40985fdd">CInstantSend::Vote</a></div><div class="ttdeci">void Vote(CTxLockCandidate &amp;txLockCandidate, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00224">instantx.cpp:224</a></div></div>
<div class="ttc" id="validation_8cpp_html_a887b8e9f9fea0ea870c6987f1fd52eb6"><div class="ttname"><a href="validation_8cpp.html#a887b8e9f9fea0ea870c6987f1fd52eb6">mapBlockIndex</a></div><div class="ttdeci">BlockMap mapBlockIndex</div><div class="ttdef"><b>Definition:</b> <a href="validation_8cpp_source.html#l00071">validation.cpp:71</a></div></div>
<div class="ttc" id="class_c_instant_send_html_a12b011c3b48d3a3d9a0e71a9e5ed164d"><div class="ttname"><a href="class_c_instant_send.html#a12b011c3b48d3a3d9a0e71a9e5ed164d">CInstantSend::GetTxLockRequest</a></div><div class="ttdeci">bool GetTxLockRequest(const uint256 &amp;txHash, CTxLockRequest &amp;txLockRequestRet)</div><div class="ttdef"><b>Definition:</b> <a href="instantx_8cpp_source.html#l00771">instantx.cpp:771</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a4975c8d11415845148babbfd973b34e9"><div class="ttname"><a href="net__processing_8cpp.html#a4975c8d11415845148babbfd973b34e9">SendBlockTransactions</a></div><div class="ttdeci">static void SendBlockTransactions(const CBlock &amp;block, const BlockTransactionsRequest &amp;req, CNode *pfrom, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l01344">net_processing.cpp:1344</a></div></div>
<div class="ttc" id="class_c_chain_params_html_a8ca8fe289d1c3d5851d6aebaf28db22f"><div class="ttname"><a href="class_c_chain_params.html#a8ca8fe289d1c3d5851d6aebaf28db22f">CChainParams::AlertKey</a></div><div class="ttdeci">const std::vector&lt; unsigned char &gt; &amp; AlertKey() const</div><div class="ttdef"><b>Definition:</b> <a href="chainparams_8h_source.html#l00061">chainparams.h:61</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_a060fe6da0466954fc00d0eab78bb8c3d"><div class="ttname"><a href="net__processing_8cpp.html#a060fe6da0466954fc00d0eab78bb8c3d">most_recent_block_hash</a></div><div class="ttdeci">static uint256 most_recent_block_hash</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l00784">net_processing.cpp:784</a></div></div>
<div class="ttc" id="net_8cpp_html_a0cde2b3256757536c42c0bd3037847d1"><div class="ttname"><a href="net_8cpp.html#a0cde2b3256757536c42c0bd3037847d1">AdvertiseLocal</a></div><div class="ttdeci">void AdvertiseLocal(CNode *pnode)</div><div class="ttdef"><b>Definition:</b> <a href="net_8cpp_source.html#l00183">net.cpp:183</a></div></div>
<div class="ttc" id="class_c_block_index_html_ac8e219a377839d2f9133a4387f46e44e"><div class="ttname"><a href="class_c_block_index.html#ac8e219a377839d2f9133a4387f46e44e">CBlockIndex::nTx</a></div><div class="ttdeci">unsigned int nTx</div><div class="ttdoc">Number of transactions in this block. </div><div class="ttdef"><b>Definition:</b> <a href="chain_8h_source.html#l00183">chain.h:183</a></div></div>
<div class="ttc" id="class_c_block_header_html"><div class="ttname"><a href="class_c_block_header.html">CBlockHeader</a></div><div class="ttdoc">Nodes collect new transactions into a block, hash them into a hash tree, and scan through nonce value...</div><div class="ttdef"><b>Definition:</b> <a href="block_8h_source.html#l00020">block.h:20</a></div></div>
<div class="ttc" id="validation_8h_html_a3db9a6c313045e841191037a97268a96"><div class="ttname"><a href="validation_8h.html#a3db9a6c313045e841191037a97268a96">BLOCK_DOWNLOAD_WINDOW</a></div><div class="ttdeci">static const unsigned int BLOCK_DOWNLOAD_WINDOW</div><div class="ttdoc">Size of the &quot;block download window&quot;: how far ahead of our current height do we fetch? Larger windows tolerate larger download speed differences between peer, but increase the potential degree of disordering of blocks on disk (which make reindexing and in the future perhaps pruning harder). </div><div class="ttdef"><b>Definition:</b> <a href="validation_8h_source.html#l00103">validation.h:103</a></div></div>
<div class="ttc" id="class_c_masternode_payments_html_afead8c7f19dfe473ca63e7473ec6ce62"><div class="ttname"><a href="class_c_masternode_payments.html#afead8c7f19dfe473ca63e7473ec6ce62">CMasternodePayments::ProcessMessage</a></div><div class="ttdeci">void ProcessMessage(CNode *pfrom, const std::string &amp;strCommand, CDataStream &amp;vRecv, CConnman &amp;connman)</div><div class="ttdef"><b>Definition:</b> <a href="masternode-payments_8cpp_source.html#l00406">masternode-payments.cpp:406</a></div></div>
<div class="ttc" id="protocol_8h_html_a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33"><div class="ttname"><a href="protocol_8h.html#a7f1603e1604ea41e417c77fdbc9b2991a11f393e43f75b471170b96ce59a07d33">MSG_FILTERED_BLOCK</a></div><div class="ttdoc">Defined in BIP37. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00355">protocol.h:355</a></div></div>
<div class="ttc" id="block_8h_html"><div class="ttname"><a href="block_8h.html">block.h</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_a75c8dba2361ddda663917c27f14c3a16"><div class="ttname"><a href="namespace_net_msg_type.html#a75c8dba2361ddda663917c27f14c3a16">NetMsgType::FILTERADD</a></div><div class="ttdeci">const char * FILTERADD</div><div class="ttdoc">The filteradd message tells the receiving peer to add a single element to a previously-set bloom filt...</div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00034">protocol.cpp:34</a></div></div>
<div class="ttc" id="class_c_critical_section_html"><div class="ttname"><a href="class_c_critical_section.html">CCriticalSection</a></div><div class="ttdoc">Wrapped boost mutex: supports recursive locking, but no waiting TODO: We should move away from using ...</div><div class="ttdef"><b>Definition:</b> <a href="sync_8h_source.html#l00092">sync.h:92</a></div></div>
<div class="ttc" id="utilstrencodings_8cpp_html_a565b3ea015b133d01dc52b4ec6e45f07"><div class="ttname"><a href="utilstrencodings_8cpp.html#a565b3ea015b133d01dc52b4ec6e45f07">itostr</a></div><div class="ttdeci">std::string itostr(int n)</div><div class="ttdef"><b>Definition:</b> <a href="utilstrencodings_8cpp_source.html#l00556">utilstrencodings.cpp:556</a></div></div>
<div class="ttc" id="net__processing_8cpp_html_ac8c54607864417006ffb7b454c1b3591"><div class="ttname"><a href="net__processing_8cpp.html#ac8c54607864417006ffb7b454c1b3591">ProcessGetData</a></div><div class="ttdeci">static void ProcessGetData(CNode *pfrom, const Consensus::Params &amp;consensusParams, CConnman &amp;connman, const std::atomic&lt; bool &gt; &amp;interruptMsgProc)</div><div class="ttdef"><b>Definition:</b> <a href="net__processing_8cpp_source.html#l01017">net_processing.cpp:1017</a></div></div>
<div class="ttc" id="fees_8h_html"><div class="ttname"><a href="fees_8h.html">fees.h</a></div></div>
<div class="ttc" id="chain_8cpp_html_abe314b9d901829ab0166322b67cffd70"><div class="ttname"><a href="chain_8cpp.html#abe314b9d901829ab0166322b67cffd70">GetBlockProofEquivalentTime</a></div><div class="ttdeci">int64_t GetBlockProofEquivalentTime(const CBlockIndex &amp;to, const CBlockIndex &amp;from, const CBlockIndex &amp;tip, const Consensus::Params &amp;params)</div><div class="ttdoc">Return the time it would take to redo the work difference between from and to, assuming the current h...</div><div class="ttdef"><b>Definition:</b> <a href="chain_8cpp_source.html#l00135">chain.cpp:135</a></div></div>
<div class="ttc" id="random_8cpp_html_a27d9149d522b1fa87d84e5e9ca902aef"><div class="ttname"><a href="random_8cpp.html#a27d9149d522b1fa87d84e5e9ca902aef">GetRand</a></div><div class="ttdeci">uint64_t GetRand(uint64_t nMax)</div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00153">random.cpp:153</a></div></div>
<div class="ttc" id="class_c_node_html_a9c8fd0d0ef6e26896c53380e6d6bf331"><div class="ttname"><a href="class_c_node.html#a9c8fd0d0ef6e26896c53380e6d6bf331">CNode::setAskFor</a></div><div class="ttdeci">std::set&lt; uint256 &gt; setAskFor</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00775">net.h:775</a></div></div>
<div class="ttc" id="namespace_net_msg_type_html_af9b6c7c7cc77f2f0b6af1949a6ee5920"><div class="ttname"><a href="namespace_net_msg_type.html#af9b6c7c7cc77f2f0b6af1949a6ee5920">NetMsgType::GETBLOCKTXN</a></div><div class="ttdeci">const char * GETBLOCKTXN</div><div class="ttdoc">Contains a BlockTransactionsRequest Peer should respond with &quot;blocktxn&quot; message. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8cpp_source.html#l00040">protocol.cpp:40</a></div></div>
<div class="ttc" id="struct_c_node_signals_html_ae96100eac4458c80929678cd6f58bc53"><div class="ttname"><a href="struct_c_node_signals.html#ae96100eac4458c80929678cd6f58bc53">CNodeSignals::SendMessages</a></div><div class="ttdeci">boost::signals2::signal&lt; bool(CNode *, CConnman &amp;, std::atomic&lt; bool &gt; &amp;), CombinerAll &gt; SendMessages</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00549">net.h:549</a></div></div>
<div class="ttc" id="version_8h_html_a943e862a09cbbc7c60e94c4a946fb4d5"><div class="ttname"><a href="version_8h.html#a943e862a09cbbc7c60e94c4a946fb4d5">MIN_PEER_PROTO_VERSION_DIP3</a></div><div class="ttdeci">static const int MIN_PEER_PROTO_VERSION_DIP3</div><div class="ttdoc">disconnect from peers older than this proto version when DIP3 is activated via the BIP9 deployment ...</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00026">version.h:26</a></div></div>
<div class="ttc" id="class_c_message_header_html"><div class="ttname"><a href="class_c_message_header.html">CMessageHeader</a></div><div class="ttdoc">Message header. </div><div class="ttdef"><b>Definition:</b> <a href="protocol_8h_source.html#l00027">protocol.h:27</a></div></div>
<div class="ttc" id="class_c_out_point_html_af131c7194a660558b0ff158f4efa7a28"><div class="ttname"><a href="class_c_out_point.html#af131c7194a660558b0ff158f4efa7a28">COutPoint::hash</a></div><div class="ttdeci">uint256 hash</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8h_source.html#l00029">transaction.h:29</a></div></div>
<div class="ttc" id="quorums__dummydkg_8h_html"><div class="ttname"><a href="quorums__dummydkg_8h.html">quorums_dummydkg.h</a></div></div>
<div class="ttc" id="policy_8h_html_aefbb84a1c575dfc90d140d06f8c8d1e9"><div class="ttname"><a href="policy_8h.html#aefbb84a1c575dfc90d140d06f8c8d1e9">MAX_STANDARD_TX_SIZE</a></div><div class="ttdeci">static const unsigned int MAX_STANDARD_TX_SIZE</div><div class="ttdoc">The maximum size for transactions we&amp;#39;re willing to relay/mine. </div><div class="ttdef"><b>Definition:</b> <a href="policy_8h_source.html#l00024">policy.h:24</a></div></div>
<div class="ttc" id="class_c_out_point_html_a85f13609edc1f66afe82fb68f28fb8b7"><div class="ttname"><a href="class_c_out_point.html#a85f13609edc1f66afe82fb68f28fb8b7">COutPoint::ToStringShort</a></div><div class="ttdeci">std::string ToStringShort() const</div><div class="ttdef"><b>Definition:</b> <a href="transaction_8cpp_source.html#l00017">transaction.cpp:17</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
		<!-- HTML footer for doxygen 1.8.14-->
		<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
		  <ul>
			<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="net__processing_8cpp.html">net_processing.cpp</a></li>
			<li class="footer">Generated on Wed Mar 20 2019 18:11:44 for Dash Core by
			<a href="http://www.doxygen.org/index.html">
			<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
		  </ul>
		</div>
		</div>
		<div class="ddfooter">
			<div class="footerlicense">Released under the <a href="http://opensource.org/licenses/mit-license.php" target="_blank">MIT license</a></div>
		  </div>
		</div>
	</body>
</html>
